/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2018 SAP SE. All rights reserved
 */
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/Sorter","sap/ui/model/json/JSONModel"],function(C,S,J){"use strict";return C.extend("sap.ui.mdc.internal.table.p13nsettings.P13nSettings",{onCancel:function(e){e.getSource().close();this.getView().destroy();},onConfirm:function(e){var p=e.getSource().getPanels(),o=this.oTableController.oP13nSettingsPropertyModel.oData.p13nSortItems,O=this.oTableController.oP13nSettingsPropertyModel.oData.p13nGroupItems,c=[],s=[],P,d,i=false,a=false,b=false,I;for(I in p){var f=p[I].getMetadata().getName();if(f==="sap.m.P13nSortPanel"){c.sortCondition=p[I]._getConditions();}if(f==="sap.m.P13nGroupPanel"){c.groupCondition=p[I]._getConditions();}}var g=function(l){P=(c.groupCondition&&c.groupCondition[0].keyField);var m=l.getProperty(P);var n=(c.groupCondition[0]&&c.groupCondition[0].text);if(n.indexOf(":")>0){n=n.substr(0,n.indexOf(":"));}return{key:m,text:n+" : "+m};};var h=function(l,n,m){if(l.length===0&&(!n||n.length===0)){return false;}if(l&&n&&l.length!==n.length){return true;}if(l&&n===undefined){if(m==="group"){c.groupCondition=l;}if(m==="sort"){c.sortCondition=l;}return false;}if(n){for(I in l){if(!(l[I].columnKey===n[I].keyField&&l[I].operation===n[I].operation)){b=true;break;}}}return b;};var G=h(O,c.groupCondition,"group"),j=h(o,c.sortCondition,"sort");if(G&&c.groupCondition&&c.groupCondition.length>0){P=c.groupCondition[0]&&(c.groupCondition[0].keyField);d=!!(c[0]&&c[0].operation==="GroupDescending");var k=new S(P,d,g);s.push(k);a=true;}if(j&&c.sortCondition){for(I in c.sortCondition){P=c.sortCondition[I].keyField;d=!!(c.sortCondition[I].operation==="Descending");s.push(new S(P,d));i=true;}}if((j||G)&&s.length===0){var K=this.oTableController.oP13nSettingsPropertyModel.getData().keyAttributes;for(I in K){s.push(new S(K[I]));}}this._saveP13DialogState(c,a,i);this.oTableController.applyGroupAndSort(s);e.getSource().close();this.getView().destroy();},_saveP13DialogState:function(c,i,a){var p=this.oView.getModel().getData(),I,_;if(!p.isMultiTab&&i&&c.sortCondition&&c.sortCondition.length>0){c.sortCondition=[];}if(!p.isMultiTab&&a&&c.groupCondition&&c.groupCondition.length>0){c.groupCondition=[];}var P=[];for(I in c.sortCondition){_={"columnKey":c.sortCondition[I].keyField||c.sortCondition[I].columnKey,"operation":c.sortCondition[I].operation};P.push(_);}p.p13nSortItems=P;var b=[];if(c.groupCondition!=undefined&&c.groupCondition!=null){for(I in c.groupCondition){_={"columnKey":c.groupCondition[I].keyField||c.groupCondition[I].columnKey,"operation":c.groupCondition[I].operation};b.push(_);}}p.p13nGroupItems=b;this.oTableController.oP13nSettingsPropertyModel=new J(p);}});});
