/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","./library","./ViewportBase","sap/ui/core/ResizeHandler","./Loco","./ViewportHandler","./Smart2DHandler","./Messages","./ContentConnector","./ViewStateManager"],function(q,l,V,R,L,a,S,M,C,b){"use strict";var c=V.extend("sap.ui.vk.Viewport",{metadata:{library:"sap.ui.vk"}});var d=c.getMetadata().getParent().getClass().prototype;c.prototype.init=function(){if(d.init){d.init.call(this);}this._implementation=null;this._deferred={};};c.prototype.exit=function(){this._deferred=null;this._destroyImplementation();if(d.exit){d.exit.call(this);}};c.prototype.getImplementation=function(){return this._implementation;};c.prototype._destroyImplementation=function(){if(this._implementation){this._implementation.destroy();this._implementation=null;}return this;};c.prototype.getShowDebugInfo=function(){if(this._implementation){return this._implementation.getShowDebugInfo();}return d.getShowDebugInfo.call(this);};c.prototype.setShowDebugInfo=function(v){d.setShowDebugInfo.call(this,v);if(this._implementation){this._implementation.setShowDebugInfo(v);}return this;};c.prototype.getBackgroundColorTop=function(){if(this._implementation){return this._implementation.getBackgroundColorTop();}return d.getBackgroundColorTop.call(this);};c.prototype.setBackgroundColorTop=function(v){d.setBackgroundColorTop.call(this,v);if(this._implementation){this._implementation.setBackgroundColorTop(v);}return this;};c.prototype.getBackgroundColorBottom=function(){if(this._implementation){return this._implementation.getBackgroundColorBottom();}return d.getBackgroundColorBottom.call(this);};c.prototype.setBackgroundColorBottom=function(v){d.setBackgroundColorBottom.call(this,v);if(this._implementation){this._implementation.setBackgroundColorBottom(v);}return this;};c.prototype.setWidth=function(v){d.setWidth.call(this,v);if(this._implementation){this._implementation.setWidth(v);}return this;};c.prototype.setHeight=function(v){d.setHeight.call(this,v);if(this._implementation){this._implementation.setHeight(v);}return this;};c.prototype.setSelectionMode=function(v){d.setSelectionMode.call(this,v);if(this._implementation){this._implementation.setSelectionMode(v);}return this;};c.prototype.getSelectionMode=function(){if(this._implementation){return this._implementation.getSelectionMode();}return d.getSelectionMode.call(this);};c.prototype.setCamera=function(v){d.setCamera.call(this,v);if(this._implementation){this._implementation.setCamera(v);return this;}return this;};c.prototype.getCamera=function(){if(this._implementation){return this._implementation.getCamera();}return d.getCamera.call(this);};c.prototype.setShouldRenderFrame=function(){if(this._implementation){this._implementation.setShouldRenderFrame();}return this;};c.prototype.shouldRenderFrame=function(){if(this._implementation){this._implementation.shouldRenderFrame();}};c.prototype._setContent=function(j){var k=null;var m=null;if(j){k=j;if(!(k instanceof sap.ui.vk.Scene)){k=null;}m=j.camera;if(!(m instanceof sap.ui.vk.Camera)){m=null;}}this._setScene(k);if(m){this.setCamera(m);}};c.prototype._onAfterUpdateContentConnector=function(){this._setContent(this._contentConnector.getContent());};c.prototype._onBeforeClearContentConnector=function(){if(d._onBeforeClearContentConnector){d._onBeforeClearContentConnector.call(this);}this._setScene(null);};c.prototype._handleContentReplaced=function(j){var k=j.getParameter("newContent");this._setContent(k);};c.prototype._setScene=function(j){if(j instanceof sap.ui.vk.Scene){var k=j.getMetadata().getName(),m=this._implementation&&this._implementation.getMetadata().getName(),r=k==="sap.ui.vk.dvl.Scene"&&m==="sap.ui.vk.dvl.Viewport"||k==="sap.ui.vk.threejs.Scene"&&m==="sap.ui.vk.threejs.Viewport";if(!r){this._destroyImplementation();var n;var t=this;var o=this.getCamera();if(k==="sap.ui.vk.dvl.Scene"){n="sap.ui.vk.dvl.Viewport";}else if(k==="sap.ui.vk.threejs.Scene"){n="sap.ui.vk.threejs.Viewport";}if(n){q.sap.require(n);this._implementation=new(q.sap.getObject(n))({viewStateManager:this.getViewStateManager(),urlClicked:function(p){t.fireUrlClicked({nodeRef:p.getParameter("nodeRef"),url:p.getParameter("url")});},nodeClicked:function(p){t.fireNodeClicked({nodeRef:p.getParameter("nodeRef"),x:p.getParameter("x"),y:p.getParameter("y")});},resize:function(p){t.fireResize({size:p.getParameter("size")});},showDebugInfo:this.getShowDebugInfo(),width:this.getWidth(),height:this.getHeight(),backgroundColorTop:this.getBackgroundColorTop(),backgroundColorBottom:this.getBackgroundColorBottom(),selectionMode:this.getSelectionMode(),contentConnector:this.getContentConnector()});if(o){this._camera=null;this._implementation.setCamera(o);}if("graphicsCore"in this._deferred&&this._implementation.setGraphicsCore){this._implementation.setGraphicsCore(this._deferred.graphicsCore);}delete this._deferred.graphicsCore;if("scene"in this._deferred&&this._implementation.setScene){this._implementation.setScene(this._deferred.scene);}delete this._deferred.scene;this._implementation.attachNodesPicked(function(p){this.fireNodesPicked({picked:p.getParameter("picked")});},this);this._implementation.attachNodeZoomed(function(p){this.fireNodeZoomed({zoomed:p.getParameter("zoomed"),isZoomIn:p.getParameter("isZoomIn")});},this);}this.invalidate();}}else{this._destroyImplementation();this.invalidate();}return this;};c.prototype._onAfterUpdateViewStateManager=function(){if(this._implementation){this._implementation.setViewStateManager(this._viewStateManager);}};c.prototype._onBeforeClearViewStateManager=function(){if(this._implementation){this._implementation.setViewStateManager(null);}};c.prototype.activateView=function(v){if(this._implementation){this._implementation.activateView(v);return this;}else{q.sap.log.error("no implementation");return this;}};c.prototype.zoomTo=function(w,n,j,m){if(this._implementation){this._implementation.zoomTo(w,n,j,m);return this;}else{q.sap.log.error("no implementation");return this;}};var s=function(j){j.camera={};};var e=function(j){if(typeof j.camera==="object"&&j.camera!==null){j.camera.matrices=false;}};var f=function(j){if(typeof j.camera==="object"&&j.camera!==null){j.camera.useTransitionCamera=false;}};var g=function(j){j.animation=true;};var h=function(j){j.visibility=false;};var i=function(j){if(typeof j.visibility==="object"&&j.visibility!==null){j.visibility.mode=sap.ui.vk.VisibilityMode.Complete;}};c.prototype.getViewInfo=function(j){if(!this._implementation){q.sap.log.error("no implementation");return null;}var k={};if(typeof j!=="object"||j===null){s(k);e(k);f(k);g(k);h(k);i(k);}else{if(typeof j.camera==="object"&&j.camera!==null){k.camera={};if(typeof j.camera.matrices==="boolean"){k.camera.matrices=j.camera.matrices;}else if("matrices"in j.camera){k.camera.matrices=false;}else{e(k);}if(typeof j.camera.useTransitionCamera==="boolean"){k.camera.useTransitionCamera=j.camera.useTransitionCamera;}else if("useTransitionCamera"in j.camera){k.camera.useTransitionCamera=false;}else{f(k);}}else if(typeof j.camera==="boolean"){if(j.camera===true){k.camera={};e(k);f(k);}else{k.camera=false;}}else if("camera"in j){k.camera=false;}else{s(k);e(k);f(k);}if(typeof j.animation==="boolean"){k.animation=j.animation;}else if("animation"in j){k.animation=false;}else{g(k);}if(typeof j.visibility==="object"&&j.visibility!==null){k.visibility={};if(j.visibility.mode===sap.ui.vk.VisibilityMode.Complete||j.visibility.mode===sap.ui.vk.VisibilityMode.Differences){k.visibility.mode=j.visibility.mode;}else{i(k);}}else if(typeof j.visibility==="boolean"){if(j.visibility===true){k.visibility={};i(k);}else{k.visibility=false;}}else if("visibility"in j){k.visibility=false;}else{h(k);i(k);}}return this._implementation.getViewInfo(k);};c.prototype.setViewInfo=function(v,j){if(this._implementation){this._implementation.setViewInfo(v,j);}else{q.sap.log.error("no implementation");}return this;};c.prototype.getImage=function(w,j,t,k){if(this._implementation&&this._implementation.getImage){return this._implementation.getImage(w,j,t,k);}return null;};C.injectMethodsIntoClass(c);b.injectMethodsIntoClass(c);return c;});
