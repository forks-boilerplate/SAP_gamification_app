/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2018 SAP SE. All rights reserved
	
 */
sap.ui.define(['jquery.sap.global','sap/m/MessageBox','sap/ui/comp/filterbar/FilterBar','sap/ui/comp/filterbar/FilterGroupItem','sap/ui/comp/filterbar/FilterItem','sap/ui/comp/library','./AdditionalConfigurationHelper','./ControlConfiguration','./FilterProvider','./GroupConfiguration','sap/ui/comp/util/FormatUtil','sap/ui/comp/smartvariants/PersonalizableInfo','sap/ui/comp/smartvariants/SmartVariantManagement','sap/ui/comp/odata/ODataModelUtil'],function(q,M,F,a,b,l,A,C,c,G,d,P,S,O){"use strict";var f=l.smartfilterbar.FilterType;var g=F.extend("sap.ui.comp.smartfilterbar.SmartFilterBar",{metadata:{library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/smartfilterbar/SmartFilterBar.designtime",properties:{entityType:{type:"string",group:"Misc",defaultValue:null},entitySet:{type:"string",group:"Misc",defaultValue:null},resourceUri:{type:"string",group:"Misc",defaultValue:null},basicSearchFieldName:{type:"string",group:"Misc",defaultValue:null},enableBasicSearch:{type:"boolean",group:"Misc",defaultValue:false},liveMode:{type:"boolean",group:"Misc",defaultValue:false},showMessages:{type:"boolean",group:"Misc",defaultValue:true},considerAnalyticalParameters:{type:"boolean",group:"Misc",defaultValue:false},useDateRangeType:{type:"boolean",group:"Misc",defaultValue:null},suppressSelection:{type:"boolean",group:"Misc",defaultValue:false},considerSelectionVariants:{type:"boolean",group:"Misc",defaultValue:false},defaultSelectionVariantName:{type:"string",group:"Misc",defaultValue:null},useProvidedNavigationProperties:{type:"boolean",group:"Misc",defaultValue:false},navigationProperties:{type:"string",group:"Misc",defaultValue:""}},associations:{smartVariant:{type:"sap.ui.comp.smartvariants.SmartVariantManagement",multiple:false}},aggregations:{controlConfiguration:{type:"sap.ui.comp.smartfilterbar.ControlConfiguration",multiple:true,singularName:"controlConfiguration"},groupConfiguration:{type:"sap.ui.comp.smartfilterbar.GroupConfiguration",multiple:true,singularName:"groupConfiguration"}},events:{pendingChange:{pendingValue:{type:"boolean"}}}},renderer:function(r,o){F.getMetadata().getRenderer().render(r,o);}});g.LIVE_MODE_INTERVAL=300;g.SELECTION_VARIANT_KEY_PREFIX="#";g.prototype.init=function(){this._bCreateFilterProviderCalled=false;this._aFilterBarViewMetadata=null;this.isRunningInValueHelpDialog=false;F.prototype.init.apply(this);sap.ui.getCore().getMessageManager().registerObject(this,true);};g.prototype._initializeMetadata=function(){if(!this.bIsInitialised){O.handleModelInit(this,this._onMetadataInitialised);}};g.prototype._onMetadataInitialised=function(){var r,m,e,E;this._bMetaModelLoadAttached=false;if(!this.bIsInitialised&&!this._bCreateFilterProviderCalled){m=this.getModel();r=this.getResourceUri();e=this.getEntityType();E=this.getEntitySet();if((m||r)&&(e||E)){this._bCreateFilterProviderCalled=true;this._createFilterProvider(m,r,e,E).then(function(o){if(o){this._oFilterProvider=o;this._aFilterBarViewMetadata=this._oFilterProvider.getFilterBarViewMetadata();if(this._aFilterBarViewMetadata){this._attachAdditionalConfigurationChanged();this.bIsInitialised=true;this.setModel(this._oFilterProvider.oModel,this._oFilterProvider.sFilterModelName);this.registerGetFiltersWithValues(this.getFiltersWithValues.bind(this));this.registerFetchData(this.getFilterDataAsStringForVariant.bind(this,true));this.registerApplyData(function(j){this.setFilterDataAsStringFromVariant(j,true);}.bind(this));this._initializeVariantManagement();}this._oFilterProvider.attachPendingChange(function(h){this.firePendingChange({pendingValue:h.getParameter("pending")});}.bind(this));}}.bind(this));}}};g.prototype.getModelData=function(){var D=null;if(this._oFilterProvider){D=this._oFilterProvider.getModel().getData();}return D;};g.prototype.getFilterBarViewMetadata=function(){return this._aFilterBarViewMetadata;};g.prototype.getAnalyticalParameters=function(){return this._oFilterProvider?this._oFilterProvider.getAnalyticParameters():[];};g.prototype.getSelectionVariants=function(){var s=null;if(this._oFilterProvider){s=this._oFilterProvider.getSelectionVariants();if(Object.keys(s).length<1){s=null;}}return s;};g.prototype._createFilterProvider=function(m,r,e,E){return c._createFilterProvider({basicSearchFieldName:this.getBasicSearchFieldName(),enableBasicSearch:this.getEnableBasicSearch(),entityType:e,entitySet:E,serviceUrl:r,isRunningInValueHelpDialog:this.isRunningInValueHelpDialog,model:m,additionalConfiguration:this.getAdditionalConfiguration(),defaultDropDownDisplayBehaviour:this.data("defaultDropDownDisplayBehaviour"),defaultTokenDisplayBehaviour:this.data("defaultTokenDisplayBehaviour"),dateFormatSettings:this.data("dateFormatSettings"),useContainsAsDefaultFilter:this.data("useContainsAsDefaultFilter"),smartFilter:this,considerAnalyticalParameters:this.getConsiderAnalyticalParameters(),useDateRangeType:this.getUseDateRangeType(),considerSelectionVariants:this.getConsiderSelectionVariants(),considerNavigations:this.getUseProvidedNavigationProperties()?this._createArrayFromString(this.getNavigationProperties()):null});};g.prototype._createArrayFromString=function(L){if(!L){return[];}var e=[];var r=L.split(",");r.forEach(function(s){if(s!==""){e.push(s.trim());}});return e;};g.prototype._attachAdditionalConfigurationChanged=function(){var e,h,i,j;h=this.getGroupConfiguration();j=h.length;for(i=0;i<j;i++){h[i].attachChange(this._handleGroupConfigurationChanged.bind(this));}e=this.getControlConfiguration();j=e.length;for(i=0;i<j;i++){e[i].attachChange(this._handleControlConfigurationChanged.bind(this));}};g.prototype._handleControlConfigurationChanged=function(e){var p,o,h,k,v;p=e.getParameter("propertyName");o=e.oSource;if(!o){return;}k=o.getKey();h=this._getFilterItemByName(k);if(!h){this._handleControlConfigurationChangedForDelayedFilterItems(k,o,p);return;}if(p==="visible"){v=o.getVisible();h.setVisible(v);}else if(p==="label"){v=o.getLabel();h.setLabel(v);}else if(p==="visibleInAdvancedArea"){v=o.getVisibleInAdvancedArea();if(h.setVisibleInAdvancedArea){h.setVisibleInAdvancedArea(v);}}};g.prototype._handleControlConfigurationChangedForDelayedFilterItems=function(k,o,p){var v,e=null;if(this._aFilterBarViewMetadata){this._aFilterBarViewMetadata.some(function(h){h.fields.some(function(i){if(i.fieldName===k){e=i;}return e?true:false;});return e?true:false;});}if(e){if(p==="visible"){v=o.getVisible();e.isVisible=v;}else if(p==="label"){v=o.getLabel();e.label=v;}else if(p==="visibleInAdvancedArea"){v=o.getVisibleInAdvancedArea();e.visibleInAdvancedArea=v;}}};g.prototype._handleGroupConfigurationChanged=function(e){var p,o;p=e.getParameter("propertyName");o=e.oSource;if(p==="label"){this._handleGroupConfigurationLabelChanged(o);}};g.prototype._handleGroupConfigurationLabelChanged=function(o){var e,k,L;if(!o){return;}L=o.getLabel();k=o.getKey();e=this._getFilterGroupItemByGroupName(k);if(e){e.setGroupTitle(L);}else{this._handleGroupConfigurationLabelChangedForDelayedFilterItems(k,L);}};g.prototype._handleGroupConfigurationLabelChangedForDelayedFilterItems=function(k,L){var o=null;if(this._aFilterBarViewMetadata){this._aFilterBarViewMetadata.some(function(i){if(i.groupName===k){o=i;}return o?true:false;});}if(o){o.groupLabel=L;}};g.prototype._getFilterItemByName=function(n){return this.determineFilterItemByName(n);};g.prototype._getFilterGroupItemByGroupName=function(n){return this.determineFilterItemByName(n);};g.prototype.getAdditionalConfiguration=function(){return new A(this.getControlConfiguration(),this.getGroupConfiguration());};g.prototype.setEntityType=function(e){this.setProperty("entityType",e);this._initializeMetadata();return this;};g.prototype.setResourceUri=function(r){this.setProperty("resourceUri",r);this._initializeMetadata();return this;};g.prototype.propagateProperties=function(){F.prototype.propagateProperties.apply(this,arguments);this._initializeMetadata();};g.prototype._getFilterInformation=function(){var o,i,j,L=0,e=0,h,k=[],m;if(this._aFilterBarViewMetadata){L=this._aFilterBarViewMetadata.length;for(i=0;i<L;i++){o=this._aFilterBarViewMetadata[i];h=o.fields;e=h.length;for(j=0;j<e;j++){m=h[j];if(m.name===c.BASIC_SEARCH_FIELD_ID){this.setBasicSearch(m.control);this._attachToBasicSearch(m.control);continue;}else if(o.groupName===c.BASIC_FILTER_AREA_ID){this._createFieldInAdvancedArea({groupName:F.INTERNAL_GROUP,groupLabel:""},m);}else{this._createFieldInAdvancedArea(o,m);}k.push(m);}}var p=this.getAnalyticalParameters();L=p.length;for(i=0;i<L;i++){m=p[i];this._createAnalyticParameter(m);k.push(m);}}return k;};g.prototype._validateState=function(){var e=null,L,o,i=false;e=this.getAllFilterItems(true);if(e){L=e.length;while(L--){o=this.determineControlByFilterItem(e[L],true);if(o){if(o.__bValidatingToken){this.bIsSearchPending=true;i=true;break;}else if(o.getValueState&&o.getValueState()===sap.ui.core.ValueState.Error&&!o.data("__mandatoryEmpty")){i=true;break;}}}}if(this._oFilterProvider){return!i&&!this._oFilterProvider._validateConditionTypeFields();}else{return!i;}};g.prototype._isDateRangeTypeFilter=function(s){if(this._oFilterProvider&&this._oFilterProvider._mConditionTypeFields[s]){return true;}return false;};g.prototype._specialControls=function(o,s){if(o.setValue){if(this._isDateRangeTypeFilter(s)){return true;}else{if(o.isA("sap.m.DatePicker")){return true;}}}return false;};g.prototype._clearErroneusControlValues=function(){var e=null,L,o,v;e=this.getAllFilterItems(true);if(e){L=e.length;while(L--){o=this.determineControlByFilterItem(e[L],true);if(o){if(o.getValueState&&o.getValueState()===sap.ui.core.ValueState.Error){v=o.getBinding("value");if(v&&!this._specialControls(o,e[L].getName())){v.checkUpdate(true);}else if(o.setValue){o.setValue("");o.setValueState(sap.ui.core.ValueState.None);}}}}}};g.prototype._attachToBasicSearch=function(B){if(B){B.attachSearch(function(e){if(e&&e.getParameter("clearButtonPressed")){return;}if(!this.isDialogOpen()){this.search();}}.bind(this));B.attachLiveChange(this._onChange.bind(this));}};g.prototype._onLiveChange=function(e){var o=e.getSource();if(o.data("__validationError")&&!o.getValue()){o.data("__validationError",null);o.setValueState(sap.ui.core.ValueState.None);}};g.prototype._onChange=function(e){var o=e.getSource();if(o.data("__mandatoryEmpty")){o.data("__mandatoryEmpty",null);o.setValueState(sap.ui.core.ValueState.None);}if(o.data("__validationError")&&!o.getValue()){o.data("__validationError",null);o.setValueState(sap.ui.core.ValueState.None);}if(this._oFilterProvider._bUpdatingFilterData||this._oFilterProvider._bCreatingInitialModel){return;}if(!o||(o&&!o.__bValidatingToken)){this.fireFilterChange(e);this._oFilterProvider._updateConditionTypeFields(e.getParameter("filterChangeReason"));}else{this._filterSetInErrorState(o);}if(this.isLiveMode()){this.search();}};g.prototype._handleChange=function(o){if(o){if(o.attachChange){o.attachChange(this._onChange.bind(this));}if(o.attachLiveChange){o.attachLiveChange(this._onLiveChange.bind(this));}}};g.prototype._handleEnter=function(o){if(this.isLiveMode()){return;}o.attachBrowserEvent("keydown",function(e){if(e.which===13){o.__bSuggestInProgress=(o._oSuggestionPopup&&o._oSuggestionPopup.isOpen());}});o.attachBrowserEvent("keyup",function(e){if(e.which===13&&!o.__bSuggestInProgress){this.search();}}.bind(this));};g.prototype._createFilterFieldControl=function(o){if(o.conditionType){o.control=o.conditionType.initializeFilterItem();}else if(!o.control&&o.fCreateControl){o.fCreateControl(o);delete o.fCreateControl;}this._handleEnter(o.control);this._handleChange(o.control);};g.prototype._createAnalyticParameter=function(p){p.factory=function(){this._createFilterFieldControl(p);if(!p.control){return;}var o=new a({labelTooltip:p.quickInfo,name:p.fieldName,mandatory:p.isMandatory,visible:p.isVisible,control:p.control,hiddenFilter:false});this._setLabel(o,p.label);this._addParameter(o);}.bind(this);p.groupName=F.INTERNAL_GROUP;return p;};g.prototype._createFieldInAdvancedArea=function(o,e){e.factory=function(){this._createFilterFieldControl(e);var h=new a({labelTooltip:e.quickInfo,name:e.fieldName,groupName:o.groupName,groupTitle:o.groupLabel,mandatory:e.isMandatory,visible:e.isVisible,visibleInAdvancedArea:e.visibleInAdvancedArea||(o.groupName===F.INTERNAL_GROUP),control:e.control,hiddenFilter:e.hiddenFilter});if(e.isCustomFilterField){h.data("isCustomField",true);}this._setLabel(h,e.label);this.addFilterGroupItem(h);}.bind(this);e.groupName=o.groupName;e.groupTitle=o.groupLabel;return e;};g.prototype._setLabel=function(o,L){if(L.match(/{@i18n>.+}/gi)){o.bindProperty("label",L.substring(1,L.length-1));}else{o.setLabel(L);}};g.prototype._logAccessWhenNotInitialized=function(m){if(!this.bIsInitialised){q.sap.log.error("SmartFilterBar."+m+": called before the SmartFilterBar is initialized");}};g.prototype.ensureLoadedValueHelp=function(s){this._logAccessWhenNotInitialized("ensureLoadedValueHelp");if(this._oFilterProvider){this._oFilterProvider.getAssociatedValueHelpProviders().some(function(v){if(v.sFieldName===s){if(!v._bValueListRequested){v.loadAnnotation();}return true;}});}};g.prototype.ensureLoadedValueList=function(s){if(this._oFilterProvider){this._oFilterProvider.getAssociatedValueListProviders().some(function(v){if(v.sFieldName===s){if(!v._bValueListRequested){v.loadAnnotation();}return true;}});}};g.prototype.ensureLoadedValueHelpList=function(s){this.ensureLoadedValueHelp(s);this.ensureLoadedValueList(s);};g.prototype.getFilters=function(e){this._logAccessWhenNotInitialized("getFilters");if(!e||!e.length){e=this._getVisibleFieldNames(true);}return this._oFilterProvider?this._oFilterProvider.getFilters(e):[];};g.prototype.getParameters=function(){this._logAccessWhenNotInitialized("getParameters");return this._oFilterProvider?this._oFilterProvider.getParameters():{};};g.prototype.getAnalyticBindingPath=function(){var B="";this._logAccessWhenNotInitialized("getAnalyticBindingPath");if(this._oFilterProvider){B=this._oFilterProvider.getAnalyticBindingPath();}return B;};g.prototype.getParameterBindingPath=function(){return this.getAnalyticBindingPath();};g.prototype.getControlByKey=function(k){this._logAccessWhenNotInitialized("getControlByKey");return this.determineControlByName(k);};g.prototype._getVisibleFieldNames=function(i){var e=[],v=this.getAllFilterItems(true),L=v.length,I;L=v.length;while(L--){I=v[L];if(I){if(i&&I._isParameter()){continue;}e.push(I.getName());}}return e;};g.prototype.getFilterData=function(e){var D=null;this._logAccessWhenNotInitialized("getFilterData");if(this._oFilterProvider){if(e){D=this._oFilterProvider.getFilterData();}else{D=this._oFilterProvider.getFilledFilterData(this._getVisibleFieldNames());}}return D;};g.prototype._checkHasValueData=function(o){if(o){if(typeof o==="boolean"){return o;}else if(typeof o==="string"){if(o.toLowerCase()==="true"){return true;}}}return false;};g.prototype._checkForValues=function(D,o,e){var v=null;if(D&&o&&e){if(!o.data("isCustomField")){v=D[o.getName()];}else{var h=e.data("hasValue");if((h!==undefined)&&(h!=null)){return this._checkHasValueData(h);}else{if(e.getValue){if(e.getValue()){return true;}}if(e.getSelectedKey){if(e.getSelectedKey()){return true;}}if(e.getSelectedKeys){if(e.getSelectedKeys().length>0){return true;}}}}}return v?true:false;};g.prototype.getFiltersWithValues=function(){var e=[];this._logAccessWhenNotInitialized("getFiltersWithValues");var h=this.getAllFilterItems(true),o,D=this.getFilterData(),L=0,i;if(h&&D){L=h.length;while(L--){o=h[L];i=this.determineControlByFilterItem(o,true);if(this._checkForValues(D,o,i)){e.push(o);}}}return e.reverse();};g.prototype.getFilterDataAsStringForVariant=function(e){var j={},D=this._oFilterProvider._aFilterBarDateTimeFieldNames;if(D.length>0){j=q.extend(true,j,this.getFilterData(e));D.forEach(function(s){var v,o,h=c._getFieldMetadata(this._aFilterBarViewMetadata,s);if(h&&(h.type==="Edm.DateTimeOffset")){o=j[s];if(o&&o.low){if(h.filterRestriction===f.interval){v=d.parseDateTimeOffsetInterval(o.low);if(v&&(v.length==2)){o.low=h.ui5Type.parseValue(v[0],"string");o.high=h.ui5Type.parseValue(v[1],"string");}}}}}.bind(this));return JSON.stringify(j);}else{return this.getFilterDataAsString(e);}};g.prototype.getFilterDataAsString=function(e){var D=null;this._logAccessWhenNotInitialized("getFilterDataAsString");if(this._oFilterProvider){if(e){D=this._oFilterProvider.getFilterDataAsString();}else{D=this._oFilterProvider.getFilledFilterDataAsString(this._getVisibleFieldNames());}}return D;};g.prototype.setFilterDataAsStringFromVariant=function(j,r){var J,D=this._oFilterProvider._aFilterBarDateTimeFieldNames;if(j){if(D.length>0){J=JSON.parse(j);D.forEach(function(s){var o,e=c._getFieldMetadata(this._aFilterBarViewMetadata,s);if(e&&(e.type==="Edm.DateTimeOffset")){o=J[s];if(o&&(e.filterRestriction===f.multiple)||(e.filterRestriction===f.auto)){if(o.ranges){for(var i=0;i<o.ranges.length;i++){delete o.ranges[i].tokenText;}}}}}.bind(this));this.setFilterData(J,r);}else{this.setFilterDataAsString(j,r);}}};g.prototype.setFilterData=function(j,r){this._logAccessWhenNotInitialized("setFilterData");if(this._oFilterProvider){this._oFilterProvider.setFilterData(j,r);}if(j&&(Object.keys(j).length===1)&&j._CUSTOM){return;}this.fireFilterChange({afterFilterDataUpdate:true});};g.prototype.setFilterDataAsString=function(j,r){if(j){this.setFilterData(JSON.parse(j),r);}};g.prototype.fireClear=function(){this._clearFilterFields();this.fireEvent("clear",arguments);};g.prototype._clearFilterFields=function(){if(this._oFilterProvider){this._oFilterProvider.clear();this._clearErroneusControlValues();}this.fireFilterChange({afterFilterDataUpdate:true});};g.prototype.fireReset=function(){this._resetFilterFields();this.fireEvent("reset",arguments);};g.prototype._resetFilterFields=function(){if(this._oFilterProvider){this._oFilterProvider.reset();this._clearErroneusControlValues();}this.fireFilterChange({afterFilterDataUpdate:true});};g.prototype.triggerSearch=function(D){if(this.getSuppressSelection()){return;}this._clearDelayedSearch();this._iDelayedSearchId=q.sap.delayedCall(D||0,this,"_search");};g.prototype.search=function(s){if(this.getSuppressSelection()){return undefined;}this._logAccessWhenNotInitialized("search");var L=this.isLiveMode();if(s&&!L){return this._search();}else{this.triggerSearch(L?g.LIVE_MODE_INTERVAL:0);}return true;};g.prototype._search=function(){var p=[],o={},e=true,i=false,E;var I=this.verifySearchAllowed();if(I.hasOwnProperty("pending")){if(this._iDelayedSearchId&&!this.getSuppressSelection()){this.triggerSearch();}return undefined;}else if(I.hasOwnProperty("error")){e=false;i=true;}else if(I.hasOwnProperty("mandatory")){e=false;}if(this.isPending()&&!this._bIsPendingChangeAttached){var h=function(j){if(j.getParameter("pendingValue")===false){this.detachPendingChange(h);this._bIsPendingChangeAttached=false;this.triggerSearch();}}.bind(this);this._bIsPendingChangeAttached=true;this.attachPendingChange(h);return undefined;}this._clearDelayedSearch();if(e){if(this._isTablet()&&this.getUseToolbar()&&!this.getAdvancedMode()){this.setFilterBarExpanded(false);}o.selectionSet=this._retrieveCurrentSelectionSet(false,true);p.push(o);this.fireSearch(p);}else{if(!this._oResourceBundle){this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");}if(!i){if(!this._sMandatoryErrorMessage){this._sMandatoryErrorMessage=this._oResourceBundle.getText("EMPTY_MANDATORY_MESSAGE");}E=this._sMandatoryErrorMessage;}else{if(!this._sValidationErrorMessage){this._sValidationErrorMessage=this._oResourceBundle.getText("VALIDATION_ERROR_MESSAGE");}E=this._sValidationErrorMessage;}if(this.getShowMessages()&&!this.getLiveMode()){try{this._activateMainContent();M.error(E,{styleClass:(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":"",onClose:this._setFocusOnFirstErroneousField.bind(this)});}catch(x){return undefined;}}else{this._setFocusOnFirstErroneousField();q.sap.log.warning("search was not triggered. "+E);}if(this._bExpandAdvancedFilterArea&&this.rerenderFilters){this.rerenderFilters(true);}}return e;};g.prototype.validateMandatoryFields=function(){this._logAccessWhenNotInitialized("validateMandatoryFields");return this._validateMandatoryFields();};g.prototype.verifySearchAllowed=function(){this._logAccessWhenNotInitialized("verifySearchAllowed");delete this.bIsSearchPending;if(this._validateState()){if(this.validateMandatoryFields()){return{};}return{mandatory:true};}if(this.bIsSearchPending){return{pending:true};}return{error:true};};g.prototype._setFocusOnFirstErroneousField=function(){var e=null,L,o,i;e=this.getAllFilterItems(true);if(e){L=e.length;for(i=0;i<L;i++){o=this.determineControlByFilterItem(e[i],true);if(o&&o.getValueState&&o.getValueState()===sap.ui.core.ValueState.Error){q.sap.delayedCall(0,o,"focus");break;}}}};g.prototype.setLiveMode=function(e){if(!this._isPhone()){if(e){this.hideGoButton();}else{this.restoreGoButton();}}if(this._oSmartVariantManagement){if(e){if(this._bShowShareState===undefined){this._bShowShareState=this._oSmartVariantManagement.getShowExecuteOnSelection();}this._oSmartVariantManagement.setShowExecuteOnSelection(false);}else if(this._bShowShareState!==undefined){this._oSmartVariantManagement.setShowExecuteOnSelection(this._bShowShareState);}}this.setProperty("liveMode",e);return this;};g.prototype.isLiveMode=function(){if(this._isPhone()){return false;}return this.getLiveMode();};g.prototype._clearDelayedSearch=function(){if(this._iDelayedSearchId){q.sap.clearDelayedCall(this._iDelayedSearchId);this._iDelayedSearchId=null;}};g.prototype.isPending=function(){if(!this._oFilterProvider){return false;}return this._oFilterProvider.isPending();};g.prototype._validateMandatoryFields=function(){var e=true,h=this.determineMandatoryFilterItems(),o,D=this.getFilterData(),L=0,i;this._bExpandAdvancedFilterArea=false;if(h&&D){L=h.length;while(L--){o=h[L];i=this.determineControlByFilterItem(o,true);if(i&&i.setValueState){if(this._checkForValues(D,o,i)){if(i.data("__mandatoryEmpty")){i.data("__mandatoryEmpty",null);i.setValueState(sap.ui.core.ValueState.None);}}else{e=false;i.setValueState(sap.ui.core.ValueState.Error);i.data("__mandatoryEmpty",true);if(o.getGroupName){this._bExpandAdvancedFilterArea=true;}}}}}return e;};g.prototype._setSmartVariant=function(s){if(s){var o=sap.ui.getCore().byId(s);if(o){if(o instanceof S){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._replaceVariantManagement(o);this._oSmartVariantManagement=o;}}else{q.sap.log.error("Control with the id="+s+" not of expected type");}}else{q.sap.log.error("Control with the id="+s+" not found");}}};g.prototype.setSmartVariant=function(s){if(this.getAdvancedMode()){q.sap.log.error("not supported for the advanced mode");return this;}this.setAssociation("smartVariant",s);this._setSmartVariant(s);return this;};g.prototype.getSmartVariant=function(){if(this.getAdvancedMode()){q.sap.log.error("not supported for the advanced mode");return null;}var s=this.getAssociation("smartVariant");if(s){return sap.ui.getCore().byId(s);}return this._oSmartVariantManagement;};g.prototype._createVariantManagement=function(){this._oSmartVariantManagement=null;if(this.getAdvancedMode()){return F.prototype._createVariantManagement.apply(this);}var s=this.getSmartVariant();this._setSmartVariant(s);if(!this._oSmartVariantManagement){this._oSmartVariantManagement=new S(this.getId()+"-variant",{showExecuteOnSelection:true,showShare:true});}return this._oSmartVariantManagement;};g.prototype._initializeVariantManagement=function(){if(!this.isRunningInValueHelpDialog&&this._oSmartVariantManagement&&this.getPersistencyKey()){var p=new P({type:"filterBar",keyName:"persistencyKey",dataSource:this.getEntitySet()||this.getEntityType()});p.setControl(this);this._oSmartVariantManagement.addPersonalizableControl(p);var v=this._checkHasValueData(this.data("executeStandardVariantOnSelect"));if(v){this._oSmartVariantManagement._executeOnSelectForStandardVariantByXML(v);}F.prototype._initializeVariantManagement.apply(this,arguments);}else{this.fireInitialise();this.fireInitialized();}};g.prototype.setConsiderSelectionvariants=function(v){this.setProperty("considerSelectionVariants",v);};g.prototype.fireInitialized=function(){if(!this.isRunningInValueHelpDialog&&this.getPersistencyKey()&&this.getConsiderSelectionVariants()&&this._oSmartVariantManagement&&this._oSmartVariantManagement.getEnabled()){try{if(!this._oSmartVariantManagement.isPageVariant()){this._prepareSelectionVariants();}}finally{}}F.prototype.fireInitialized.apply(this,arguments);};g.prototype._prepareSelectionVariants=function(){var s,v,D,k=g.SELECTION_VARIANT_KEY_PREFIX,n=false,V=[];s=this.getSelectionVariants();if(s){this._oSmartVariantManagement.registerSelectionVariantHandler({callback:this.getSelectionVariant,handler:this},k);sap.ui.require("sap.ui.comp.variants.VariantItem");s.forEach(function(o){var e=k+o.qualifier;if(o.qualifier){v=new sap.ui.comp.variants.VariantItem({key:e,text:o.annotation.Text.String,global:true,executeOnSelection:false,lifecycleTransportId:"",lifecyclePackage:"",namespace:"",readOnly:true,labelReadOnly:true,author:""});this._oSmartVariantManagement.insertVariantItem(v,0);V.push(e);}else{n=this._defaultSelectionVariantHandling(o);}}.bind(this));if(!this._oSmartVariantManagement._getDefaultVariantKey()){if(this.getDefaultSelectionVariantName()){D=k+this.getDefaultSelectionVariantName();this._oSmartVariantManagement.setInitialSelectionKey(D);this._oSmartVariantManagement.fireSelect({key:D});}else if(n){this._oSmartVariantManagement.fireSelect({key:this._oSmartVariantManagement.STANDARDVARIANTKEY});}}this._oSmartVariantManagement.applyDefaultFavorites(V,true);}};g.prototype._defaultSelectionVariantHandling=function(s){var v=null;if(!this._oSmartVariantManagement){return false;}if(this._oSmartVariantManagement._sAppStandardVariantKey){return false;}if(s&&s.annotation){v=this.convertSelectionVariantToInternalVariant(s.annotation);if(v){if(!this._oSmartVariantManagement.isPageVariant()){v.version="V1";var o=JSON.parse(v.filterBarVariant);if(this._oSmartVariantManagement._oStandardVariant){var e=JSON.parse(this._oSmartVariantManagement._oStandardVariant.filterBarVariant);if(e._CUSTOM){o._CUSTOM=e._CUSTOM;v.filterBarVariant=JSON.stringify(o);}}this._oSmartVariantManagement._oStandardVariant=v;return true;}}}return false;};g.prototype._adaptFilterVisibilityProperties=function(o){var e,E=null,h=[];if(this._oSmartVariantManagement&&this._oSmartVariantManagement._oStandardVariant&&this._oSmartVariantManagement._oStandardVariant.filterbar){q.extend(true,h,this._oSmartVariantManagement._oStandardVariant.filterbar);}for(E in o){e=false;h.some(function(i){if(i.name===E){e=true;i.partOfCurrentVariant=true;}return e;});if(!e){h.push({group:this._determineGroupNameByName(E),name:E,partOfCurrentVariant:true,visibleInFilterBar:false,visible:true});}}return h;};g.prototype.getSelectionVariant=function(k,s){var v=null,o=null,K=k.substring(g.SELECTION_VARIANT_KEY_PREFIX.length);this.getSelectionVariants().some(function(i){if(i.qualifier===K){o=i;return true;}return false;});if(o){if(o.variantContent){v=o.variantContent;}else{v=this.convertSelectionVariantToInternalVariant(o.annotation);o.variantContent=v;}}return v;};g.prototype.convertSelectionVariantToInternalVariant=function(s){sap.ui.require("sap.ui.model.odata.AnnotationHelper");sap.ui.require("sap.ui.model.Context");sap.ui.require("sap.ui.comp.filterbar.VariantConverterFrom");var e=JSON.stringify(s),o=JSON.parse(e),v={},p={};var D=new sap.ui.model.Context(null,"/"),h=o.SelectOptions,i=o.Parameters,j;if(h){h.forEach(function(k){k.PropertyName=k.PropertyName.PropertyPath;k.Ranges.forEach(function(r){r.Sign=r.Sign.EnumMember.split("/")[1];r.Option=r.Option.EnumMember.split("/")[1];r.Low=r.Low&&sap.ui.model.odata.AnnotationHelper.format(D,r.Low)||null;r.High=r.High&&sap.ui.model.odata.AnnotationHelper.format(D,r.High)||null;});});}if(i){i.forEach(function(k){k.PropertyName=k.PropertyName.PropertyPath.split("/")[1]||k.PropertyName.PropertyPath;k.PropertyValue=sap.ui.model.odata.AnnotationHelper.format(D,k.PropertyValue)||null;});}j=new sap.ui.comp.filterbar.VariantConverterFrom();v=j.convert(JSON.stringify(o),this,true);p=JSON.parse(v.payload);if(this._oSmartVariantManagement.isPageVariant()){v[this.getPersistencyKey()]={"version":"V2","filterbar":this._adaptFilterVisibilityProperties(p),"filterBarVariant":JSON.stringify(p)};}else{v={"version":"V2","filterbar":this._adaptFilterVisibilityProperties(p),"filterBarVariant":JSON.stringify(p)};}return v;};g.prototype.getBasicSearchControl=function(){return sap.ui.getCore().byId(this.getBasicSearch());};g.prototype.addFieldToAdvancedArea=function(k){var o;this._logAccessWhenNotInitialized("addFieldToAdvancedArea");o=this._getFilterItemByName(k);if(o&&o.setVisibleInAdvancedArea){o.setVisibleInAdvancedArea(true);}};g.prototype.getConditionTypeByKey=function(k){if(this._oFilterProvider._mConditionTypeFields[k]){return this._oFilterProvider._mConditionTypeFields[k].conditionType;}};g.prototype.isInUTCMode=function(){if(this._oFilterProvider&&this._oFilterProvider._oDateFormatSettings){return this._oFilterProvider._oDateFormatSettings.UTC;}return false;};g.prototype.getDateInUTCOffset=function(D){return c.getDateInUTCOffset(D);};g.prototype.isInitialised=function(){return!!this.bIsInitialised;};g.prototype.destroy=function(){this._clearDelayedSearch();if(this._oSmartVariantManagement&&this.getConsiderSelectionVariants()){this._oSmartVariantManagement.unregisterSelectionVariantHandler(this);}F.prototype.destroy.apply(this,arguments);sap.ui.getCore().getMessageManager().unregisterObject(this);if(this._oFilterProvider&&this._oFilterProvider.destroy){this._oFilterProvider.destroy();}this._oFilterProvider=null;this._aFilterBarViewMetadata=null;this._bExpandAdvancedFilterArea=null;this._oResourceBundle=null;this._sMandatoryErrorMessage=null;this._sValidationErrorMessage=null;this._oSmartVariantManagement=null;};return g;},true);
