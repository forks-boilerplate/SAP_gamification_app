/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2018 SAP SE. All rights reserved
	
 */
sap.ui.define(['jquery.sap.global','sap/m/VBoxRenderer','sap/m/Column','sap/m/ColumnListItem','sap/m/Label','sap/m/MessageBox','sap/m/Table','sap/m/Text','sap/m/Title','sap/m/OverflowToolbar','sap/m/ToolbarSpacer','sap/m/ToolbarDesign','sap/m/OverflowToolbarButton','sap/m/ToolbarSeparator','sap/m/VBox','sap/m/FlexItemData','sap/ui/comp/library','sap/ui/comp/providers/TableProvider','sap/ui/comp/smartfilterbar/FilterProvider','sap/ui/comp/smartvariants/SmartVariantManagement','sap/ui/model/Sorter','sap/ui/model/Filter','sap/ui/model/FilterOperator','sap/ui/model/json/JSONModel','sap/ui/table/AnalyticalColumn','sap/ui/table/AnalyticalTable','sap/ui/table/Column','sap/ui/table/Table','sap/ui/table/TreeTable','sap/ui/comp/personalization/Controller','sap/ui/comp/personalization/Util','sap/ui/comp/util/FormatUtil','sap/ui/comp/util/FullScreenUtil','sap/ui/comp/odata/ODataModelUtil','sap/ui/comp/odata/ODataType','sap/ui/comp/state/UIState','sap/ui/comp/smartvariants/PersonalizableInfo','sap/ui/core/format/NumberFormat','sap/ui/Device'],function(q,V,C,a,L,M,R,T,b,O,c,d,f,g,h,F,l,j,k,S,m,n,o,J,A,p,r,s,t,u,P,v,w,x,y,U,z,N,D){"use strict";var B=h.extend("sap.ui.comp.smarttable.SmartTable",{metadata:{library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/smarttable/SmartTable.designtime",properties:{entitySet:{type:"string",group:"Misc",defaultValue:null},smartFilterId:{type:"string",group:"Misc",defaultValue:null},ignoredFields:{type:"string",group:"Misc",defaultValue:null},initiallyVisibleFields:{type:"string",group:"Misc",defaultValue:null},requestAtLeastFields:{type:"string",group:"Misc",defaultValue:null},ignoreFromPersonalisation:{type:"string",group:"Misc",defaultValue:null},tableType:{type:"sap.ui.comp.smarttable.TableType",group:"Misc",defaultValue:null},useVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},showVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},useExportToExcel:{type:"boolean",group:"Misc",defaultValue:true},exportType:{type:"sap.ui.comp.smarttable.ExportType",group:"Misc",defaultValue:"UI5Client"},useTablePersonalisation:{type:"boolean",group:"Misc",defaultValue:true},showTablePersonalisation:{type:"boolean",group:"Misc",defaultValue:true},showRowCount:{type:"boolean",group:"Misc",defaultValue:true},header:{type:"string",group:"Misc",defaultValue:null},toolbarStyleClass:{type:"string",group:"Misc",defaultValue:null},enableCustomFilter:{type:"boolean",group:"Misc",defaultValue:true},persistencyKey:{type:"string",group:"Misc",defaultValue:null},useOnlyOneSolidToolbar:{type:"boolean",group:"Misc",defaultValue:false},placeToolbarInTable:{type:"boolean",group:"Misc",defaultValue:false},currentVariantId:{type:"string",group:"Misc",defaultValue:null},editable:{type:"boolean",group:"Misc",defaultValue:false},enableAutoBinding:{type:"boolean",group:"Misc",defaultValue:false},tableBindingPath:{type:"string",group:"Misc",defaultValue:null},editTogglable:{type:"boolean",group:"Misc",defaultValue:false},demandPopin:{type:"boolean",group:"Misc",defaultValue:false},showFullScreenButton:{type:"boolean",group:"Misc",defaultValue:false}},associations:{smartVariant:{type:"sap.ui.core.Control",multiple:false}},aggregations:{customToolbar:{type:"sap.m.Toolbar",multiple:false},semanticObjectController:{type:"sap.ui.comp.navpopover.SemanticObjectController",multiple:false},noData:{type:"sap.ui.core.Control",altTypes:["string"],multiple:false},semanticKeyAdditionalControl:{type:"sap.ui.core.Control",multiple:false}},events:{initialise:{},beforeRebindTable:{},editToggled:{},dataRequested:{},dataReceived:{},afterVariantInitialise:{},afterVariantSave:{parameters:{currentVariantId:{type:"string"}}},afterVariantApply:{parameters:{currentVariantId:{type:"string"}}},showOverlay:{},fieldChange:{},fullScreenToggled:{parameters:{fullScreen:{type:"boolean"}}},beforeExport:{parameters:{exportSettings:{type:"object"}}}}},renderer:V.render,constructor:function(){h.apply(this,arguments);this._aExistingColumns=[];this._aAlwaysSelect=[];this._oTemplate=null;this._createToolbar();this._oP13nDialogSettings=this.data("p13nDialogSettings");if(typeof this._oP13nDialogSettings==="string"){try{this._oP13nDialogSettings=JSON.parse(this._oP13nDialogSettings);}catch(e){this._oP13nDialogSettings=null;}}this._bIsFilterPanelEnabled=(this._oP13nDialogSettings&&this._oP13nDialogSettings.filter)?this._oP13nDialogSettings.filter.visible!==false:true;this._createTable();}});B.prototype.init=function(){h.prototype.init.call(this);this.addStyleClass("sapUiCompSmartTable");this.setFitContainer(true);this._aColumnKeys=[];this._aDeactivatedColumns=[];this._mLazyColumnMap={};};B.prototype._getVariantManagementControl=function(e){var i=null;if(e){if(typeof e==='string'){i=sap.ui.getCore().byId(e);}else{i=e;}if(i){if(!(i instanceof S)){q.sap.log.error("Control with the id="+e.getId?e.getId():e+" not of expected type");return null;}}}return i;};B.prototype._createVariantManagementControl=function(){if(this._oVariantManagement||(!this.getUseVariantManagement()&&!this.getUseTablePersonalisation())||!this.getPersistencyKey()){return;}var e=new z({type:"table",keyName:"persistencyKey",dataSource:"TODO"});e.setControl(this);var i=this.getSmartVariant();if(i){this._oVariantManagement=this._getVariantManagementControl(i);}else if(this._oSmartFilter&&this._oSmartFilter.data("pageVariantPersistencyKey")){i=this._oSmartFilter.getSmartVariant();if(i){this._oVariantManagement=this._getVariantManagementControl(i);}}else{this._oVariantManagement=new S(this.getId()+"-variant",{showShare:true});}if(this._oVariantManagement){this._oVariantManagement.addPersonalizableControl(e);this._oVariantManagement.attachSave(this._variantSaved,this);this._oVariantManagement.attachAfterSave(this._variantAfterSave,this);this._oVariantManagement.initialise(this._variantInitialised,this);}};B.prototype._variantInitialised=function(){if(!this._oCurrentVariant){this._oCurrentVariant="STANDARD";}this.fireAfterVariantInitialise();if(this._oVariantManagement&&!this._oVariantManagement.getEnabled()){this._checkAndTriggerBinding();}};B.prototype._variantSaved=function(){if(this._oPersController){this._oPersController.setPersonalizationData(this._oCurrentVariant);}};B.prototype._variantAfterSave=function(){this.fireAfterVariantSave({currentVariantId:this.getCurrentVariantId()});};B.prototype.setShowTablePersonalisation=function(e){this.setProperty("showTablePersonalisation",e,true);if(this._oTablePersonalisationButton){this._oTablePersonalisationButton.setVisible(e);}};B.prototype.setUseVariantManagement=function(e){this.setProperty("useVariantManagement",e,true);if(this._oPersController){this._oPersController.setResetToInitialTableState(!e);}};B.prototype.setShowVariantManagement=function(e){this.setProperty("showVariantManagement",e,true);if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setVisible(e);if(this._oSeparator){this._oSeparator.setVisible(e);}}};B.prototype.setToolbarStyleClass=function(e){this.setProperty("toolbarStyleClass",e,true);};B.prototype.setCustomToolbar=function(e){this._oCustomToolbar=e;};B.prototype.getCustomToolbar=function(){return this._oCustomToolbar;};B.prototype.setHeader=function(e){var i=this.getProperty("header"),E;this.setProperty("header",e,true);if(this.bIsInitialised&&this._oToolbar){E=(!i===!e);if(!E){this._createToolbarContent();}else{this._refreshHeaderText();}}};B.prototype.setShowRowCount=function(e){this.setProperty("showRowCount",e,true);this._refreshHeaderText();};B.prototype.setEditable=function(e){this.setProperty("editable",e,true);if(this._oEditModel){this._oEditModel.setProperty("/editable",e);}if(this._oEditButton){this._oEditButton.setIcon(e?"sap-icon://display":"sap-icon://edit");}if(this._isMobileTable&&this._oTable.setKeyboardMode){this._oTable.setKeyboardMode(e?"Edit":"Navigation");}};B.prototype.setDemandPopin=function(e){var i=this.getDemandPopin();if(i===e){return;}this.setProperty("demandPopin",e,true);if(this.bIsInitialised){if(e){this._updateColumnsPopinFeature();}else{this._deactivateColumnsPopinFeature();}}};B.prototype._refreshHeaderText=function(){if(!this._headerText){return;}if(!this._oNumberFormatInstance){this._oNumberFormatInstance=N.getFloatInstance();}var e=this.getHeader();this._headerText.setVisible(!!e);if(this.getShowRowCount()){var i=parseInt(this._getRowCount(true),10);var E=this._oNumberFormatInstance.format(i);e+=" ("+E+")";}this._headerText.setText(e);};B.prototype._addFullScreenButton=function(){if(this._oFullScreenButton){this._oToolbar.removeContent(this._oFullScreenButton);}if(this.getShowFullScreenButton()){if(!this._oFullScreenButton){this._oFullScreenButton=new f(this.getId()+"-btnFullScreen",{press:function(){this._toggleFullScreen(!this.bFullScreen);}.bind(this)});}this._renderFullScreenButton();this._oToolbar.addContent(this._oFullScreenButton);}};B.prototype._createToolbar=function(){var e=null;if(!this._oToolbar){e=this.getCustomToolbar();if(e){this._oToolbar=e;}else{this._oToolbar=new O({design:d.Transparent});this._oToolbar.addStyleClass("sapUiCompSmartTableToolbar");if(this.getToolbarStyleClass()){this._oToolbar.addStyleClass(this.getToolbarStyleClass());}}this._oToolbar.setLayoutData(new F({shrinkFactor:0}));}};B.prototype._toggleFullScreen=function(e,i){if(!this._oFullScreenButton||(e===this.bFullScreen&&!i)){return;}this.bFullScreen=e;w.toggleFullScreen(this,this.bFullScreen,this._oFullScreenButton,this._toggleFullScreen.bind(this,false));this._renderFullScreenButton();this.fireFullScreenToggled({fullScreen:e});};B.prototype._renderFullScreenButton=function(){var e=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp"),i;i=this.bFullScreen?e.getText("CHART_MINIMIZEBTN_TOOLTIP"):e.getText("CHART_MAXIMIZEBTN_TOOLTIP");this._oFullScreenButton.setTooltip(i);this._oFullScreenButton.setText(i);this._oFullScreenButton.setIcon(this.bFullScreen?"sap-icon://exit-full-screen":"sap-icon://full-screen");};B.prototype._createToolbarContent=function(){if(!this._oToolbar){this._createToolbar();}this._addVariantManagementToToolbar();this._addSeparatorToToolbar();this._addHeaderToToolbar();this._addSpacerToToolbar();this._addEditTogglableToToolbar();this._addTablePersonalisationToToolbar();this._addExportToExcelToToolbar();this._addFullScreenButton();this._bToolbarInsertedIntoItems=true;this._placeToolbar();};B.prototype._placeToolbar=function(){if(!this.getPlaceToolbarInTable()){this.insertItem(this._oToolbar,0);}else if(this._isMobileTable){this._oTable.setHeaderToolbar(this._oToolbar);}else{this._oTable.addExtension(this._oToolbar);}};B.prototype.getToolbar=function(){return this._oToolbar;};B.prototype._addEditTogglableToToolbar=function(){var e;if(this._oEditButton){this._oToolbar.removeContent(this._oEditButton);}if(this.getEditTogglable()){if(!this._oEditButton){e=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("TABLE_EDITTOGGLE_TOOLTIP");this._oEditButton=new f(this.getId()+"-btnEditToggle",{icon:this.getEditable()?"sap-icon://display":"sap-icon://edit",text:e,tooltip:e,press:function(){var E=this.getEditable();E=!E;this.setEditable(E,true);this.fireEditToggled({editable:E});}.bind(this)});}this._oToolbar.addContent(this._oEditButton);}};B.prototype._addHeaderToToolbar=function(){if(this._headerText){this._oToolbar.removeContent(this._headerText);}if(!this._headerText){this._headerText=new b(this.getId()+"-header");this._headerText.addStyleClass("sapMH4Style");this._headerText.addStyleClass("sapUiCompSmartTableHeader");}this._refreshHeaderText();this._oToolbar.insertContent(this._headerText,0);};B.prototype._addSeparatorToToolbar=function(){if(this._oSeparator){this._oToolbar.removeContent(this._oSeparator);}if(this.getHeader()&&this.getUseVariantManagement()&&this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){if(!this._oSeparator){this._oSeparator=new g(this.getId()+"-toolbarSeperator");if(!this.getShowVariantManagement()){this._oSeparator.setVisible(false);}}this._oToolbar.insertContent(this._oSeparator,0);}if(this._oToolbar){this._oToolbar.addStyleClass("sapMTBHeader-CTX");}};B.prototype._addVariantManagementToToolbar=function(){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oToolbar.removeContent(this._oVariantManagement);if(this.getUseVariantManagement()){this._oToolbar.insertContent(this._oVariantManagement,0);if(!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setVisible(this.getShowVariantManagement());}}}};B.prototype._addSpacerToToolbar=function(){var e=false,I=this._oToolbar.getContent(),i,E;if(I){E=I.length;i=0;for(i;i<E;i++){if(I[i]instanceof c){e=true;break;}}}if(!e){this._oToolbar.addContent(new c(this.getId()+"-toolbarSpacer"));}};B.prototype._addTablePersonalisationToToolbar=function(){var e;if(this._oTablePersonalisationButton){this._oToolbar.removeContent(this._oTablePersonalisationButton);}if(this.getUseTablePersonalisation()){if(!this._oTablePersonalisationButton){e=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("TABLE_PERSOBTN_TOOLTIP");this._oTablePersonalisationButton=new f(this.getId()+"-btnPersonalisation",{icon:"sap-icon://action-settings",text:e,tooltip:e,press:function(E){this._oPersController.openDialog();}.bind(this)});this._oTablePersonalisationButton.setVisible(this.getShowTablePersonalisation());}this._oToolbar.addContent(this._oTablePersonalisationButton);}};B.prototype._addExportToExcelToToolbar=function(){if(this._oUseExportToExcel){this._oToolbar.removeContent(this._oUseExportToExcel);}if(this.getUseExportToExcel()&&(this._bTableSupportsExcelExport||this.getExportType()==="UI5Client")){var e;if(!this._oUseExportToExcel){e=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("TABLE_EXPORT_TEXT");this._oUseExportToExcel=new f(this.getId()+"-btnExcelExport",{icon:"sap-icon://excel-attachment",text:e,tooltip:e,press:function(E){if(this.getExportType()==="UI5Client"){this._triggerUI5ClientExport();return;}var i=function(){var H=this._getRowBinding();var I=H.getDownloadUrl("xlsx");I=this._removeExpandParameter(I);if(I&&I.length>2048&&D.browser.msie){M.error(sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("DOWNLOAD_TOO_COMPLEX_TEXT"));return;}var K={url:I};this.fireBeforeExport({exportSettings:K});window.open(K.url);}.bind(this);var G=this._getRowCount(true);if(G>10000){M.confirm(sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("DOWNLOAD_CONFIRMATION_TEXT",G),{actions:[M.Action.YES,M.Action.NO],onClose:function(H){if(H===M.Action.YES){i();}}});}else{i();}}.bind(this)});this._setExcelExportEnableState();}this._oToolbar.addContent(this._oUseExportToExcel);}};B.prototype._triggerUI5ClientExport=function(){var e=sap.ui.getCore().loadLibrary("sap.ui.export",true);e.then(function(){var E=this._oTable.getColumns(),i,G=E.length,H,I,K,Q,W,X,Y,Z,$,_=[];if(this._isMobileTable&&E.length){E=E.sort(function(i1,j1){return i1.getOrder()-j1.getOrder();});}for(i=0;i<G;i++){Q=null;W=null;H=E[i];if(H.getVisible()){if(H.getLeadingProperty){Q=H.getLeadingProperty();}I=H.data("p13nData");if(I){if(!Q){Q=I["leadingProperty"];}}if(Array.isArray(Q)){Q=Q[0];}if(Q){if(H.getLabel){K=H.getLabel();}else if(H.getHeader){K=H.getHeader();}X=H.getWidth().toLowerCase()||I.width||"";if(X.indexOf("em")>0){X=Math.round(parseFloat(X));}else if(X.indexOf("px")>0){X=Math.round(parseInt(X,10)/16);}Y=I.type==="numeric"?"number":I.type;$=null;Z=null;if(I.isCurrency){Y="currency";}else if(I.description){W=v.getFormattedExpressionFromDisplayBehaviour(I.displayBehaviour,"{0}","{1}");}else if(I.isDigitSequence){Y="number";}else if(Y!="date"&&y.isDateOrTime(I.edmType)){Y=y.getDefaultValueTypeName(I.edmType);if(Y==="DateTimeOffset"){Y="DateTime";}}else if(Y==="stringdate"){Y="date";Z="YYYYMMDD";}else if(Y==="boolean"){$=y.getType(I.edmType);}_.push({columnId:H.getId(),property:W?[Q,I.description]:Q,type:Y,inputFormat:Z,label:(K&&K.getText)?K.getText():Q,width:X,textAlign:H.getHAlign(),template:W,trueValue:(Y==="boolean"&&$)?$.formatValue(true,"string"):undefined,falseValue:(Y==="boolean"&&$)?$.formatValue(false,"string"):undefined,unitProperty:(Y==="currency"||Y==="number")?I.unit:undefined,displayUnit:Y==="currency",precision:I.precision,scale:I.scale});}}}if(!_||!_.length){M.error(sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_COLS_EXPORT"),{styleClass:(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":""});return;}var a1=this._getRowBinding();var b1=this.getModel();var c1=this.getHeader();var d1=!this._isTreeTable?this._getRowCount(true):undefined;var e1=a1.getDownloadUrl&&a1.getDownloadUrl("json");var f1=b1.sServiceUrl;if(!this._InterceptService){var g1=sap.ui.require("sap/ushell/cloudServices/interceptor/InterceptService");if(g1){this._InterceptService=g1.getInstance();}}if(this._InterceptService){e1=this._InterceptService.interceptUrl?this._InterceptService.interceptUrl(e1):e1;f1=this._InterceptService.interceptUrl?this._InterceptService.interceptUrl(f1):f1;}var h1={workbook:{columns:_,hierarchyLevel:(this._isTreeTable&&a1.getTreeAnnotation)?a1.getTreeAnnotation("hierarchy-level-for"):undefined},dataSource:{type:"odata",dataUrl:e1,serviceUrl:f1,headers:b1.getHeaders(),count:d1,useBatch:b1.bUseBatch},fileName:c1};this.fireBeforeExport({exportSettings:h1});sap.ui.require(["sap/ui/export/Spreadsheet"],function(i1){new i1(h1).build();});}.bind(this));};B.prototype._removeExpandParameter=function(e){var i=e.replace(new RegExp("([\\?&]\\$expand=[^&]+)(&?)"),function(E,G,H){return H?G.substring(0,1):"";});return i;};B.prototype._getRowCount=function(e){var i=this._getRowBinding();if(!i){return 0;}var E=0;if(e&&i.getTotalSize){E=i.getTotalSize();}else{E=i.getLength();}if(E<0||E==="0"){E=0;}return E;};B.prototype._setExcelExportEnableState=function(){if(this._oUseExportToExcel){var i=this._getRowCount();this._oUseExportToExcel.setEnabled(i>0);}};B.prototype._createPersonalizationController=function(){if(this._oPersController||!this.getUseTablePersonalisation()){return;}var e=this._oP13nDialogSettings;e=this._setIgnoreFromPersonalisationToSettings(e);this._oPersController=new u(this.getId()+"-persoController",{table:this._oTable,columnKeys:this._aColumnKeys,setting:e,resetToInitialTableState:!this.getUseVariantManagement(),beforePotentialTableChange:this._beforePersonalisationModelDataChange.bind(this),afterPotentialTableChange:this._afterPersonalisationModelDataChange.bind(this),afterP13nModelDataChange:this._personalisationModelDataChange.bind(this),requestColumns:this._personalisationRequestColumns.bind(this)});};B.prototype._setIgnoreFromPersonalisationToSettings=function(e){var i=P.createArrayFromString(this.getIgnoreFromPersonalisation());if(i.length){if(!e){e={};}var E=function(G){if(!e[G]){e[G]={};}e[G].ignoreColumnKeys=i;};E("filter");E("sort");E("group");E("columns");}return e;};B.prototype._getRowBinding=function(){if(this._oTable){return this._oTable.getBinding(this._sAggregation);}};B.prototype.setEntitySet=function(e){this.setProperty("entitySet",e);this._initialiseMetadata();};B.prototype.propagateProperties=function(){h.prototype.propagateProperties.apply(this,arguments);this._initialiseMetadata();};B.prototype._initialiseMetadata=function(){if(!this.bIsInitialised){x.handleModelInit(this,this._onMetadataInitialised);}};B.prototype._onMetadataInitialised=function(){this._bMetaModelLoadAttached=false;if(!this.bIsInitialised){this._createTableProvider();if(this._oTableProvider){this._aTableViewMetadata=this._oTableProvider.getTableViewMetadata();if(this._aTableViewMetadata){if(!this._isMobileTable&&this.getDemandPopin()){this.setDemandPopin(false);q.sap.log.error("use SmartTable property 'demandPopin' only  with responsive table, property has been set to false");}this.bIsInitialised=true;this._bTableSupportsExcelExport=this._oTableProvider.getSupportsExcelExport();this._listenToSmartFilter();this._createVariantManagementControl();this._createToolbarContent();this._aAlwaysSelect=this._oTableProvider.getRequestAtLeastFields();this._createContent();this._createPersonalizationController();this._oEditModel=new J({editable:this.getEditable()});this.setModel(this._oEditModel,"sm4rtM0d3l");this.attachEvent("_change",this._onPropertyChange,this);this.fireInitialise();if(!this._oVariantManagement||(this._oVariantManagement&&this._bVariantInitialised)){this._checkAndTriggerBinding();}}}}};B.prototype._checkAndTriggerBinding=function(){if(!this._bAutoBindingTriggered){this._bAutoBindingTriggered=true;if(this.getEnableAutoBinding()){if(this._oSmartFilter){this._oSmartFilter.search();}else{this._reBindTable();}}}};B.prototype._aStaticProperties=["entitySet","ignoredFields","initiallyVisibleFields","ignoreFromPersonalisation","tableType","useTablePersonalisation","enableAutoBinding","persistencyKey","smartFilterId"];B.prototype._aToolbarRelatedProperties=["useExportToExcel","exportType","showFullScreenButton","editTogglable","placeToolbarInTable"];B.prototype._onPropertyChange=function(e){var i=e.getParameter("name");if(this._aStaticProperties.indexOf(i)>-1){q.sap.log.error("Property "+i+" cannot be changed after the SmartTable with id "+this.getId()+" is initialised");}if(this._oToolbar&&this._aToolbarRelatedProperties.indexOf(i)>-1){this._createToolbarContent();}};B.prototype._createTableProvider=function(){var e,E,i;E=this.getEntitySet();i=this.getIgnoredFields();e=this.getModel();if(e&&E){if(this._aExistingColumns.length){if(i){i+=","+this._aExistingColumns.toString();}else{i=this._aExistingColumns.toString();}}this._oTableProvider=new j({entitySet:E,ignoredFields:i,initiallyVisibleFields:this.getInitiallyVisibleFields(),isEditableTable:this.getEditable(),smartTableId:this.getId(),isAnalyticalTable:!!this._isAnalyticalTable,isMobileTable:!!this._isMobileTable,dateFormatSettings:this.data("dateFormatSettings"),currencyFormatSettings:this.data("currencyFormatSettings"),defaultDropDownDisplayBehaviour:this.data("defaultDropDownDisplayBehaviour"),useSmartField:this.data("useSmartField"),useSmartToggle:this.data("useSmartToggle"),skipAnnotationParse:this.data("skipAnnotationParse"),lineItemQualifier:this.data("lineItemQualifier"),presentationVariantQualifier:this.data("presentationVariantQualifier"),enableInResultForLineItem:this.data("enableInResultForLineItem"),_semanticKeyAdditionalControl:this.getAggregation("semanticKeyAdditionalControl"),model:e,semanticObjectController:this.getSemanticObjectController()});}};B.prototype._listenToSmartFilter=function(){var e=null;e=this.getSmartFilterId();this._oSmartFilter=this._findControl(e);if(this._oSmartFilter){this._oSmartFilter.attachSearch(this._reBindTable,this);this._oSmartFilter.attachFilterChange(this._filterChangeEvent,this);this._setNoDataText(sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_DATA"));}else{this._setNoDataText(sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_DATA_WITHOUT_FILTERBAR"));}};B.prototype._filterChangeEvent=function(){if(this._isTableBound()&&this._oSmartFilter&&!this._oSmartFilter.getLiveMode()&&!this._oSmartFilter.isDialogOpen()){this._showOverlay(true);}};B.prototype._showOverlay=function(e){if(e){var i={show:true};this.fireShowOverlay({overlay:i});e=i.show;}this._oTable.setShowOverlay(e);};B.prototype._findControl=function(i){var e,E;if(i){e=sap.ui.getCore().byId(i);if(!e){E=this._getView();if(E){e=E.byId(i);}}}return e;};B.prototype._getView=function(){if(!this._oView){var e=this.getParent();while(e){if(e.isA("sap.ui.core.mvc.View")){this._oView=e;break;}e=e.getParent();}}return this._oView;};B.prototype.rebindTable=function(e){this._reBindTable(null,e);};B.prototype._reBindTable=function(e,E){var G,H,I,i,K,Q,W=[],X,Y,Z,$,_,a1,b1,c1={},d1={preventTableBind:false};I=this._getTablePersonalisationData()||{};X=I.filters;Y=I.excludeFilters;b1=I.sorters;if(this._oSmartFilter){Q=this._oSmartFilter.getFilters();c1=this._oSmartFilter.getParameters()||{};}if(Q&&Q.length){if(Y){W=[new n([Q[0],Y],true)];}else{W=Q;}}else if(Y){W=[Y];}if(X){X=W.concat(X);}else{X=W;}Z=this._getRequestAtLeastFields();_=this._getRelevantColumnPaths();$=_["select"];if(!$||!$.length){$=Z;}else{K=Z.length;for(i=0;i<K;i++){if($.indexOf(Z[i])<0){$.push(Z[i]);}}}if(this._sSelectForGroup&&$.indexOf(this._sSelectForGroup)<0){$.push(this._sSelectForGroup);}if($.length){c1["select"]=$.toString();a1=_["expand"];if(a1.length){c1["expand"]=a1.join(",");}}c1["useBatchRequests"]=true;if(!b1){b1=[];}d1.filters=X;d1.sorter=b1;d1.parameters=c1;d1.length=undefined;d1.startIndex=undefined;d1.events={};this.fireBeforeRebindTable({bindingParams:d1});if(!d1.preventTableBind){b1=d1.sorter;X=d1.filters;c1=d1.parameters;$=d1.parameters["select"];if(!$||!$.length){M.error(sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_COLS"),{styleClass:(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":""});return;}H=this.getTableBindingPath()||("/"+this.getEntitySet());if(this._oTable.resumeUpdateAnalyticalInfo){this._oTable.resumeUpdateAnalyticalInfo(true,false);}this._bDataLoadPending=true;this._bIgnoreChange=false;if(this._bForceTableUpdate){E=true;this._bForceTableUpdate=false;}if(!E){G=this._oTable.getBinding(this._sAggregation);if(G&&G.mParameters){E=!(q.sap.equal(c1,G.mParameters,true)&&q.sap.equal(c1.custom,G.mParameters.custom)&&!d1.length&&!d1.startIndex&&H===G.getPath());}}if(!this._bNoDataUpdated){this._bNoDataUpdated=true;this._setNoDataText();}if(!G||!this._bIsTableBound||E){B._addBindingListener(d1,"change",this._onBindingChange.bind(this));B._addBindingListener(d1,"dataRequested",this._onDataRequested.bind(this));B._addBindingListener(d1,"dataReceived",this._onDataReceived.bind(this));this._oTable.bindRows({path:H,filters:X,sorter:b1,parameters:c1,length:d1.length,startIndex:d1.startIndex,template:this._oTemplate,events:d1.events});this._bIsTableBound=true;}else{G.sort(b1);G.filter(X,"Application");}this._showOverlay(false);}};B.prototype._onDataRequested=function(e){if(e&&e.getParameter&&e.getParameter("__simulateAsyncAnalyticalBinding")){return;}this._bIgnoreChange=true;this.fireDataRequested(e.getParameters());};B.prototype._onDataReceived=function(e){if(e&&e.getParameter&&e.getParameter("__simulateAsyncAnalyticalBinding")){return;}this._bIgnoreChange=false;this._onDataLoadComplete(e,true);this.fireDataReceived(e);};B.prototype._onBindingChange=function(e){if(this._bIgnoreChange){return;}var i,E=false;i=(e&&e.getParameter)?e.getParameter("reason"):undefined;if(!i||i==="filter"||i==="context"){E=true;}if(i==="change"||E){this._onDataLoadComplete(e,E);}};B._addBindingListener=function(e,E,H){if(!e.events){e.events={};}if(!e.events[E]){e.events[E]=H;}else{var i=e.events[E];e.events[E]=function(){H.apply(this,arguments);i.apply(this,arguments);};}};B.prototype._onDataLoadComplete=function(e,i){if(this._bDataLoadPending||i){this._bDataLoadPending=false;this.updateTableHeaderState();}};B.prototype._isTableBound=function(){if(this._bIsTableBound){return true;}if(this._oTable){return this._oTable.isBound(this._sAggregation);}return false;};B.prototype.setNoData=function(e){this._oNoData=e;};B.prototype.getNoData=function(){return this._oNoData;};B.prototype._setNoDataText=function(e){var i=this._oTable.setNoData;if(!i){i=this._oTable.setNoDataText;}if(!i){return;}var E=e;if(!E){E=this.getNoData();}if(!E){E=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_RESULTS");}i.call(this._oTable,E,true);};B.prototype.updateTableHeaderState=function(){this._refreshHeaderText();this._setExcelExportEnableState();};B.prototype._createContent=function(){var i,e=0,E,I,G,H=[];if(this._aExistingColumns&&this._aExistingColumns.length){this._aColumnKeys=[].concat(this._aExistingColumns.reverse());}I=this._parseIndexedColumns();e=this._aTableViewMetadata.length;for(i=0;i<e;i++){E=this._aTableViewMetadata[i];if(E.isInitiallyVisible){this._aColumnKeys.push(E.name);}else{H.push(E.name);}if(!(E.isInitiallyVisible||E.inResult)){this._mLazyColumnMap[E.name]=E;}else{G=this._createColumnForField(E);this._oTable.addColumn(G);}}this._insertIndexedColumns(I);this._aColumnKeys=this._aColumnKeys.concat(H);this._updateColumnsPopinFeature();this._storeInitialColumnSettings();};B.prototype._createColumnForField=function(e){var i,I;I=this.getId()+"-"+e.name.replace(/[^A-Za-z0-9_.:-]+/g,"_");i=this._createColumn(e,I);e.isColumnCreated=true;i.data("p13nData",{columnKey:e.name,leadingProperty:e.name,additionalProperty:e.additionalProperty,navigationProperty:e.navigationProperty,sortProperty:e.sortable?e.name:undefined,filterProperty:e.filterable?e.name:undefined,isGroupable:e.sortable&&e.filterable&&e.aggregationRole==="dimension",fullName:e.hasValueListAnnotation?e.fullName:null,type:e.filterType,maxLength:e.maxLength,precision:e.precision,scale:e.scale,align:e.align,edmType:e.type,displayBehaviour:e.displayBehaviour,description:e.description,isDigitSequence:e.isDigitSequence,isCurrency:e.isCurrencyField,unit:e.unit,width:e.width,aggregationRole:e.aggregationRole});if(e.filterable&&i.setFilterProperty){i.setFilterProperty(e.name);}if(e.sortable&&i.setSortProperty){i.setSortProperty(e.name);}this._registerContentTemplateEvents(e.template);return i;};B.prototype._parseIndexedColumns=function(){var i,e,E,I,G,H,K,Q,W;var X=this._oTable.getColumns();var Y=null;if(this._oTemplate&&this._oTemplate.getCells){Y=this._oTemplate.getCells();}if(!X){return null;}I=[];e=X.length;for(i=0;i<e;i++){E=X[i];G=E.data("p13nData");H=null;K=null;if(G){H=G.columnIndex;K=G.columnKey;}Q=-1;if(H!==null&&H!==undefined){Q=parseInt(H,10);}if(!isNaN(Q)&&Q>-1){if(Y){W=Y[i];this._oTemplate.removeCell(W);}else{W=null;}this._aColumnKeys.splice(i-I.length,1);I.push({index:Q,columnKey:K,column:E,template:W});this._oTable.removeColumn(E);}}I.sort(function(Z,$){return Z.index-$.index;});return I;};B.prototype._insertIndexedColumns=function(I){var i,e,E;if(!I){return;}e=I.length;for(i=0;i<e;i++){E=I[i];this._aColumnKeys.splice(E.index,0,E.columnKey);this._oTable.insertColumn(E.column,E.index);if(E.template){this._oTemplate.insertCell(E.template,E.index);}}};B.prototype._updateColumnsPopinFeature=function(){if(!this._isMobileTable||!this.getDemandPopin()){return;}var e=this._oTable.getColumns();if(!e){return;}e=e.filter(function(H){return H.getVisible();});e.sort(function(H,I){return H.getOrder()-I.getOrder();});var E,G=e.length;for(var i=0;i<G;i++){E=e[i];if(i<2){E.setDemandPopin(false);E.setMinScreenWidth("1px");}else{E.setDemandPopin(true);if(E.getPopinDisplay()!="WithoutHeader"){E.setPopinDisplay("Inline");}E.setMinScreenWidth((i+1)*10+"rem");}}};B.prototype._storeInitialColumnSettings=function(){this._aInitialSorters=[];P.createSort2Json(this._oTable,this._aInitialSorters,P.createArrayFromString(this.getIgnoreFromPersonalisation()));};B.prototype._deactivateColumnsPopinFeature=function(){if(!this._isMobileTable){return;}var e=this._oTable.getColumns();if(!e){return;}var E,G=e.length;for(var i=0;i<G;i++){E=e[i];E.setDemandPopin(false);E.setMinScreenWidth("1px");}};B.prototype._registerContentTemplateEvents=function(e){if(e&&e.attachChange){e.attachChange(function(E){this.fireFieldChange({changeEvent:E});}.bind(this));}};B.prototype._updateInitialColumns=function(){var i=this._oTable.getColumns(),E=i?i.length:0,G,H,I;while(E--){I=null;G=i[E];if(G){H=G.data("p13nData");if(typeof H==="string"){try{H=JSON.parse(H);}catch(e){}if(H){G.data("p13nData",H);}}if(H){I=H["columnKey"];}if(I){this._aExistingColumns.push(I);}}}};B.prototype._getRelevantColumnPaths=function(){var e={},E=[],G=[],H=this._oTable.getColumns(),i,I=H?H.length:0,K,Q,W,X,Y;var Z=function(W,$){var _,a1;if(W){a1=W.split(",");_=a1.length;while(_--){W=a1[_];if(W&&$.indexOf(W)<0){$.push(W);}}}};for(i=0;i<I;i++){K=H[i];W=null;if(K.getVisible()||(K.getInResult&&K.getInResult())){if(K.getLeadingProperty){W=K.getLeadingProperty();}Q=K.data("p13nData");if(Q){if(!W){W=Q["leadingProperty"];}X=Q["additionalProperty"];Y=Q["navigationProperty"];}if(W&&E.indexOf(W)<0){E.push(W);}Z(X,E);Z(Y,G);}}e["select"]=E;e["expand"]=G;return e;};B.prototype._createTable=function(){var e=this.getItems(),i=e?e.length:0,E,I;this._sAggregation="rows";while(i--){E=e[i];if(E instanceof s||E instanceof R){break;}E=null;}if(E){this._oTable=E;if(E instanceof p){this._isAnalyticalTable=true;}else if(E instanceof R){this._isMobileTable=true;this._oTemplate=(E.getItems()&&E.getItems().length>0)?E.getItems()[0]:new a();E.removeAllItems();}else if(E instanceof t){this._isTreeTable=true;}this._updateInitialColumns();}else{I=this.getId()+"-ui5table";if(this.getTableType()==="AnalyticalTable"){this._isAnalyticalTable=true;this._oTable=new p(I,{enableCustomFilter:true});}else if(this.getTableType()==="ResponsiveTable"){this._isMobileTable=true;this._oTable=new R(I,{growing:true});this._oTemplate=new a();}else if(this.getTableType()==="TreeTable"){this._isTreeTable=true;this._oTable=new t(I,{selectionMode:"MultiToggle"});}else{this._oTable=new s(I,{selectionMode:"MultiToggle"});}if(this._oTable.setVisibleRowCountMode){this._oTable.setVisibleRowCountMode("Auto");}this.insertItem(this._oTable,2);}if(!this._oTable.getLayoutData()){if(this._oTable instanceof R||(this._oTable.getVisibleRowCountMode&&this._oTable.getVisibleRowCountMode()!=="Auto")){this._oTable.setLayoutData(new F({growFactor:1,baseSize:"auto"}));}else{this._oTable.setLayoutData(new F({growFactor:1,baseSize:"0%"}));}}if(this._oTable.addAriaLabelledBy){this._oTable.addAriaLabelledBy(this.getId()+"-header");}this._oTable.addStyleClass("sapUiCompSmartTableInnerTable");this._oTable.setEnableBusyIndicator(true);this._oTable.setBusyIndicatorDelay(100);if(this._oTable.setEnableCustomFilter){this._oTable.setEnableCustomFilter(this.getEnableCustomFilter());}if(this._oTable.setShowColumnVisibilityMenu){this._oTable.setShowColumnVisibilityMenu(false);}if(this._oTable.getEnableCustomFilter&&this._oTable.getEnableCustomFilter()&&this._bIsFilterPanelEnabled){if(this._oTable.setEnableCellFilter){this._oTable.setEnableCellFilter(false);}if(this._oTable.attachCustomFilter){this._oTable.attachCustomFilter(this._showTableFilterDialog.bind(this));}}if(this._isAnalyticalTable){this._createColumn=this._createAnalyticalColumn;}else if(this._isMobileTable){this._sAggregation="items";this._createColumn=this._createMobileColumn;this._oTable.bindRows=this._oTable.bindItems;}if(!this._isMobileTable){this._oTable.attachEvent("_rowsUpdated",function(){this._setExcelExportEnableState();},this);}if(this._oTable._setLargeDataScrolling){this._oTable._setLargeDataScrolling(true);}};B.prototype.getTable=function(){return this._oTable;};B.prototype._showTableFilterDialog=function(e){if(this._oPersController){this._oPersController.openDialog({filter:{visible:true,payload:{column:e.getParameter("column")}}});}};B.prototype._createColumn=function(e,i){var E;E=new r(i,{autoResizable:true,hAlign:e.align,width:e.width,visible:e.isInitiallyVisible,label:new L(i+"-header",{textAlign:e.align,text:e.label}),sorted:e.sorted,sortOrder:e.sortOrder,tooltip:e.quickInfo,showSortMenuEntry:e.sortable,showFilterMenuEntry:e.filterable&&this._bIsFilterPanelEnabled,name:e.fieldName,template:e.template});return E;};B.prototype._createAnalyticalColumn=function(e,i){var E;if(e.isCurrencyField&&e.template.addStyleClass){e.template.addStyleClass("sapUiCompCurrencyBold");}E=new A(i,{autoResizable:true,hAlign:e.align,width:e.width,visible:e.isInitiallyVisible,inResult:e.inResult,label:new L(i+"-header",{textAlign:e.align,text:e.label}),tooltip:e.quickInfo,sorted:e.sorted,sortOrder:e.sortOrder,grouped:e.grouped,showIfGrouped:e.grouped,showSortMenuEntry:e.sortable,showFilterMenuEntry:e.filterable&&this._bIsFilterPanelEnabled,summed:e.summed,leadingProperty:e.name,template:e.template});return E;};B.prototype._createMobileColumn=function(e,i){var E;E=new C(i,{hAlign:e.align,visible:e.isInitiallyVisible,header:new T(i+"-header",{textAlign:e.align,text:e.label,tooltip:e.quickInfo}),tooltip:e.quickInfo,width:e.isImageURL?"3em":undefined});if(this._oTemplate){this._oTemplate.addCell(e.template);}return E;};B.prototype.fetchVariant=function(){if(this._oCurrentVariant==="STANDARD"||this._oCurrentVariant===null){return{};}return this._oCurrentVariant;};B.prototype.applyVariant=function(e,i){this._oCurrentVariant=e;if(this._oCurrentVariant==="STANDARD"){this._oCurrentVariant=null;}P.recoverPersonalisationDateData(this._oCurrentVariant,this._oTable);this._bApplyingVariant=true;if(this._oTable._setSuppressRefresh){this._oTable._setSuppressRefresh(true);}if(this._oPersController){if(this._oCurrentVariant===null||q.isEmptyObject(this._oCurrentVariant)){this._oPersController.resetPersonalization("ResetFull");}else{this._oPersController.setPersonalizationData(this._oCurrentVariant);}}this._bApplyingVariant=false;this.fireAfterVariantApply({currentVariantId:this.getCurrentVariantId()});};B.prototype.variantsInitialized=function(){this._bVariantInitialised=true;this._checkAndTriggerBinding();};B.prototype.getUiState=function(){var e=this._oPersController?this._oPersController.getDataSuiteFormatSnapshot():null;return new U({presentationVariant:{SortOrder:e?e.SortOrder:[],GroupBy:e?e.GroupBy:[],Total:e?e.Total:[],RequestAtLeast:this._getRequestAtLeastFields(),Visualizations:e?e.Visualizations:[]},selectionVariant:{SelectOptions:e?e.SelectOptions:[]},variantName:this.getCurrentVariantId()});};B.prototype.setUiState=function(e){this._setUiState(e,false);};B.prototype.setUiStateAsVariant=function(e){this._setUiState(e,true);};B.prototype._setUiState=function(e,i){var E=e.getPresentationVariant()&&e.getPresentationVariant().RequestAtLeast?[].concat(e.getPresentationVariant().RequestAtLeast):[];if(!q.sap.equal(E,this._getRequestAtLeastFields())){this._aAlwaysSelect=E;}if(this._oPersController){if(i){this._oPersController.setPersonalizationDataAsDataSuiteFormat(q.extend(true,{},e.getPresentationVariant(),e.getSelectionVariant()));}else{var G=(this._oVariantManagement&&e.getVariantName())?this._oVariantManagement.getVariantContent(this,e.getVariantName()):{};this._oPersController.setDataSuiteFormatSnapshot(q.extend(true,{},e.getPresentationVariant(),e.getSelectionVariant()),G);}}};B.prototype._getRequestAtLeastFields=function(){var e=this.getRequestAtLeastFields();var i=e?e.split(","):[];return i.concat(this._aAlwaysSelect);};B.prototype._personalisationRequestColumns=function(e){var E=e.getParameter("columnKeys"),G,i,H,I,K,Q={};H=E.length;for(i=0;i<H;i++){G=E[i];I=this._mLazyColumnMap[G];if(I){K=this._createColumnForField(I);if(this._isMobileTable){this._oTable.addColumn(K);}Q[I.name]=K;}}this._oPersController.addColumns(Q);};B.prototype._beforePersonalisationModelDataChange=function(e){if(this._oTable.suspendUpdateAnalyticalInfo){this._oTable.suspendUpdateAnalyticalInfo();}};B.prototype._afterPersonalisationModelDataChange=function(e){this._updateColumnsPopinFeature();};B.prototype._personalisationModelDataChange=function(e){this._oCurrentVariant=e.getParameter("persistentData");var i=e.getParameter("runtimeDeltaDataChangeType");var E=this._getChangeStatus(i);if(E==="Unchanged"){return;}if(!(this._bApplyingVariant||this._bDeactivatingColumns)){if(!this.getUseVariantManagement()){this._persistPersonalisation();}else if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(true);}}if(E===sap.ui.comp.personalization.ChangeType.ModelChanged&&this._isTableBound()){if(i&&i.columns==="ModelChanged"){this._bForceTableUpdate=true;}if(this._oSmartFilter){this._oSmartFilter.search();}else{this._reBindTable(null);}}};B.prototype._getChangeStatus=function(e){if(!e){return"ModelChanged";}if(e.sort==="ModelChanged"||e.filter==="ModelChanged"||e.columns==="ModelChanged"||e.group==="ModelChanged"){return"ModelChanged";}if(e.sort==="TableChanged"||e.filter==="TableChanged"||e.columns==="TableChanged"||e.group==="TableChanged"){return"TableChanged";}return"Unchanged";};B.prototype._getTablePersonalisationData=function(){if(!this._oCurrentVariant){return null;}var e=[],i=[],E=[],G,H,I,K,Q,W,X,Y,Z="",$;this._sSelectForGroup=null;if(this._isMobileTable&&this._oCurrentVariant.group&&this._oCurrentVariant.group.groupItems){H=this._oCurrentVariant.group.groupItems[0];if(this._aDeactivatedColumns.indexOf(H.columnKey)<0){Q=this._getColumnByKey(H.columnKey);if(Q){Z=Q.getHeader().getText();}Y=this._getPathFromColumnKeyAndProperty(H.columnKey,"sortProperty");}if(Y){X=Y;I=new m(X,H.operation==="GroupDescending",function(_){var a1=_.getProperty(X);return{key:a1,text:Z?Z+" : "+a1:a1};});this._sSelectForGroup=X;e.push(I);}}if(this._oCurrentVariant.sort){K=this._oCurrentVariant.sort.sortItems;}else{K=this._aInitialSorters;}if(K){K.forEach(function(_){var a1=_.operation==="Descending";Y=null;if(this._aDeactivatedColumns.indexOf(_.columnKey)<0){Y=this._getPathFromColumnKeyAndProperty(_.columnKey,"sortProperty");}if(Y){if(I&&I.sPath===Y){I.bDescending=a1;}else{e.push(new m(Y,a1));}}},this);}if(this._oCurrentVariant.filter){this._oCurrentVariant.filter.filterItems.forEach(function(_){var a1=_.value1,b1=_.value2;Y=null;$=false;Q=null;if(this._aDeactivatedColumns.indexOf(_.columnKey)<0){Q=this._getColumnByKey(_.columnKey);}if(Q){if(Q.getFilterProperty){Y=Q.getFilterProperty();}W=Q.data("p13nData");if(W){$=W.type==="time";if(!Y){Y=W["filterProperty"];}}}if(Y){if($){if(a1 instanceof Date){a1=v.getEdmTimeFromDate(a1);}if(b1 instanceof Date){b1=v.getEdmTimeFromDate(b1);}}else if(a1 instanceof Date&&this._oTableProvider&&this._oTableProvider.getIsUTCDateHandlingEnabled()){a1=k.getDateInUTCOffset(a1);b1=b1?k.getDateInUTCOffset(b1):b1;}if(_.exclude){E.push(new n(Y,o.NE,a1));}else{i.push(new n(Y,_.operation,a1,b1));}}},this);if(E.length){G=new n(E,true);}}return{filters:i,excludeFilters:G,sorters:e};};B.prototype._getColumnByKey=function(e){var E,G,H,i,I;if(this._oTable){E=this._oTable.getColumns();H=E.length;for(i=0;i<H;i++){G=E[i];I=G.data("p13nData");if(I&&I.columnKey===e){return G;}}}return null;};B.prototype._getPathFromColumnKeyAndProperty=function(e,i){var E=null,G,H;G=this._getColumnByKey(e);if(G){if(i=="sortProperty"&&G.getSortProperty){E=G.getSortProperty();}else if(i=="filterProperty"&&G.getFilterProperty){E=G.getFilterProperty();}else if(i=="leadingProperty"&&G.getLeadingProperty){E=G.getLeadingProperty();}if(!E){H=G.data("p13nData");if(H){E=H[i];}}}return E;};B.prototype._persistPersonalisation=function(){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oVariantManagement.getVariantsInfo(function(e){var i,E=null;if(e&&e.length>0){E=e[0].key;}i=E!==null;this._oVariantManagement.fireSave({name:"Personalisation",global:false,overwrite:i,key:E,def:true});}.bind(this));}};B.prototype.getCurrentVariantId=function(){return this._oVariantManagement?this._oVariantManagement.getCurrentVariantId():"";};B.prototype.setCurrentVariantId=function(e){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setCurrentVariantId(e);}else{q.sap.log.error("sap.ui.comp.smarttable.SmartTable.prototype.setCurrentVariantId: VariantManagement does not exist, or is a page variant");}};B.prototype.isInitialised=function(){return!!this.bIsInitialised;};B.prototype._aAvailablePanels=["Columns","Sort","Filter","Group"];B.prototype.openPersonalisationDialog=function(e){if(!e||this._aAvailablePanels.indexOf(e)<0){q.sap.log.warning("sap.ui.comp.smarttable.SmartTable.prototype.openPersonalisationDialog: "+e+" is not a valid panel!");return;}if(this._oPersController){var i={};i[e.toLowerCase()]={visible:true};this._oPersController.openDialog(i);}};B.prototype.deactivateColumns=function(e){this._aDeactivatedColumns=e||[];this._bDeactivatingColumns=true;if(this._oPersController){this._oPersController.addToSettingIgnoreColumnKeys(e);}this._bDeactivatingColumns=false;};B.prototype.exit=function(){var i,e;this.detachEvent("_change",this._onPropertyChange,this);if(this._oSmartFilter){this._oSmartFilter.detachSearch(this._reBindTable,this);this._oSmartFilter.detachFilterChange(this._filterChangeEvent,this);this._oSmartFilter=null;}if(this._oTableProvider&&this._oTableProvider.destroy){this._oTableProvider.destroy();}this._oTableProvider=null;if(this._oPersController&&this._oPersController.destroy){this._oPersController.destroy();}this._oPersController=null;if(this._oVariantManagement){this._oVariantManagement.detachSave(this._variantSaved,this);this._oVariantManagement.detachAfterSave(this._variantAfterSave,this);if(!this._oVariantManagement.isPageVariant()&&this._oVariantManagement.destroy){this._oVariantManagement.destroy();}}this._oNumberFormatInstance=null;w.cleanUpFullScreen(this);if(this._oEditModel){this._oEditModel.destroy();}if(this._oNoData&&this._oNoData.destroy){this._oNoData.destroy();}this.oNoData=null;if(this._aTableViewMetadata){i=this._aTableViewMetadata.length;while(i--){e=this._aTableViewMetadata[i];if(e&&!e.isColumnCreated&&e.template){e.template.destroy();}}}this._aTableViewMetadata=null;this._oEditModel=null;this._oVariantManagement=null;this._oCurrentVariant=null;this._aExistingColumns=null;this._mLazyColumnMap=null;this._aColumnKeys=null;this._aDeactivatedColumns=null;this._aAlwaysSelect=null;this._oCustomToolbar=null;if(this._oToolbar&&!this._bToolbarInsertedIntoItems){this._oToolbar.destroy();}this._oToolbar=null;if(this._oUseExportToExcel&&!this.getUseExportToExcel()){this._oUseExportToExcel.destroy();}this._oUseExportToExcel=null;this._oTablePersonalisationButton=null;this._oP13nDialogSettings=null;if(this._oTemplate){this._oTemplate.destroy();}this._InterceptService=null;this._oTemplate=null;this._oView=null;this._oTable=null;};return B;},true);
