/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2018 SAP SE. All rights reserved
	
 */
sap.ui.define(['jquery.sap.global','sap/m/Dialog','sap/m/MessageBox','sap/m/Token','./ItemsCollection','sap/ui/core/Control','sap/ui/core/format/DateFormat','sap/ui/core/format/NumberFormat','sap/m/VBox','sap/m/HBox','sap/ui/comp/util/FormatUtil','sap/m/DialogRenderer','sap/ui/table/Table','sap/m/Table','sap/ui/model/odata/type/Boolean','sap/m/FlexItemData','sap/m/Title','sap/m/Text','sap/m/Label','sap/m/Button','sap/m/ButtonType','sap/m/Column','sap/ui/table/Column','sap/m/Bar','sap/m/OverflowToolbarLayoutData','sap/m/Tokenizer','sap/m/Panel','sap/m/StandardListItem','sap/m/IconTabBar','sap/m/IconTabFilter','sap/m/library','sap/ui/core/InvisibleText','sap/ui/core/IconPool','sap/ui/layout/HorizontalLayout','sap/ui/layout/Grid','sap/ui/Device','sap/m/List','sap/m/Link','sap/m/P13nFilterPanel','sap/m/P13nItem','sap/m/P13nFilterItem','sap/m/CheckBox','sap/ui/model/odata/type/String'],function(q,D,M,T,I,C,a,N,V,H,F,b,u,t,B,c,d,e,L,f,g,h,U,k,O,l,P,S,m,p,r,s,v,w,G,x,y,z,A,E,J,K,Q){"use strict";var g=r.ButtonType;var R=r.OverflowToolbarPriority;var W=r.ListMode;var X=r.ListType;var _={DESKTOP_LIST_VIEW:"DESKTOP_LIST_VIEW",DESKTOP_CONDITIONS_VIEW:"DESKTOP_CONDITIONS_VIEW",PHONE_MAIN_VIEW:"PHONE_MAIN_VIEW",PHONE_SEARCH_VIEW:"PHONE_SEARCH_VIEW",PHONE_LIST_VIEW:"PHONE_LIST_VIEW",PHONE_CONDITIONS_VIEW:"PHONE_CONDITIONS_VIEW"};var Y=D.extend("sap.ui.comp.valuehelpdialog.ValueHelpDialog",{metadata:{library:"sap.ui.comp",properties:{basicSearchText:{type:"string",group:"Misc",defaultValue:""},supportMultiselect:{type:"boolean",group:"Misc",defaultValue:true},supportRanges:{type:"boolean",group:"Misc",defaultValue:false},supportRangesOnly:{type:"boolean",group:"Misc",defaultValue:false},key:{type:"string",group:"Misc",defaultValue:""},keys:{type:"string[]",group:"Misc",defaultValue:null},descriptionKey:{type:"string",group:"Misc",defaultValue:""},maxIncludeRanges:{type:"string",group:"Misc",defaultValue:'-1'},maxExcludeRanges:{type:"string",group:"Misc",defaultValue:'-1'},displayFormat:{type:"string",group:"Misc",defaultValue:""},tokenDisplayBehaviour:{type:"string",group:"Misc",defaultValue:""},filterMode:{type:"boolean",group:"Misc",defaultValue:false}},aggregations:{filterBar:{type:"sap.ui.comp.filterbar.FilterBar",multiple:false}},events:{ok:{parameters:{tokens:{type:"sap.m.Token[]"}}},cancel:{},selectionChange:{parameters:{tableSelectionParams:{type:"object"},updateTokens:{type:"object[]"},useDefault:{type:"boolean",defaultValue:false}}},tokenRemove:{parameters:{tokenKeys:{type:"string[]"},useDefault:{type:"boolean",defaultValue:false}}},updateSelection:{parameters:{tokenKeys:{type:"string[]"},useDefault:{type:"boolean",defaultValue:false}}}}},renderer:b.render});Y.prototype.setSupportMultiselect=function(i){this.setProperty("supportMultiselect",i);this._updatePropertySupportMultiselect(i);this._oTokenizerGrid.setVisible(i);this._oButtonOk.setVisible(i);return this;};Y.prototype._updatePropertySupportMultiselect=function(i){if(!this._oTable){return undefined;}if(!this._isPhone()){if(this._oTable.setSelectionMode){this._oTable.setSelectionMode(i?sap.ui.table.SelectionMode.MultiToggle:sap.ui.table.SelectionMode.Single);}}else if(this._oTable.setMode){this._oTable.setMode(i?W.MultiSelect:W.SingleSelectLeft);}return this;};Y.prototype.setSupportRanges=function(i){this.setProperty("supportRanges",i);this._updateNavigationControl();return this;};Y.prototype.setSupportRangesOnly=function(i){this.setProperty("supportRangesOnly",i);this._updateNavigationControl();return this;};Y.prototype.setTitle=function(i){this.setProperty("title",i);this._updateDlgTitle();return this;};Y.prototype.setFilterBar=function(o){this.setAggregation("filterBar",o);if(this._oMainLayout&&o){if(this._isPhone()){if(this._oFilterBar){this._oVBox.removeItem(this._oFilterBar);this._oFilterBar.detachInitialise(this._handleFilterBarInitialize);}}else if(this._oFilterBar){this._oMainLayout.removeItem(this._oFilterBar);this._oFilterBar.detachInitialise(this._handleFilterBarInitialize);}this._oFilterBar=o;this._oFilterBar.attachInitialise(this._handleFilterBarInitialize,this);if(this._oFilterBar){this._oFilterBar.addStyleClass("compVHSearch");if(this._isPhone()){var i=sap.ui.getCore().byId(this._oFilterBar.getBasicSearch());if(i instanceof sap.m.SearchField){i.setShowSearchButton(true);i.attachSearch(function(n){if(n.mParameters.refreshButtonPressed!==undefined){this.getFilterBar().search();}}.bind(this));}this._oFilterBar.setShowGoOnFB(false);this._oColSearchBox.setLayoutData(new c({shrinkFactor:0}));this._oVBox.insertItem(this._oColSearchBox,0);this._oFilterBar.setLayoutData(new c({shrinkFactor:0}));this._oVBox.insertItem(this._oFilterBar,1);this._oFilterBar.attachSearch(function(n){this._updateView(_.PHONE_LIST_VIEW);}.bind(this));if(this._currentViewMode===_.PHONE_LIST_VIEW){this._oFilterBar.setVisible(true);this._oFilterBar.setFilterBarExpanded(false);this._handleFilterBarInitialize();}}else{this._oFilterBar._setCollectiveSearch(this._oColSearchBox);this._oMainLayout.insertItem(this._oFilterBar,0);}}if(this._oFilterBar._oSearchButton){this.setInitialFocus(this._oFilterBar._oSearchButton);}if(this._oFilterBar._oBasicSearchField){var j=this._oFilterBar._oBasicSearchField;j.setValue(this.getBasicSearchText());this.setInitialFocus(j);}}return this;};Y.prototype._handleFilterBarInitialize=function(){if(this._currentViewMode===_.PHONE_LIST_VIEW){this._oFilterBar._handleVisibilityOfToolbar();var i=this._oFilterBar&&this._oFilterBar.getFilterGroupItems()&&this._oFilterBar.getFilterGroupItems().length>0;this._oAdvancedSearchLink.setVisible(i);this._oFilterBar.setShowGoButton(!(this._oFilterBar&&this._oFilterBar.getBasicSearch()));}};Y.prototype.getFilterBar=function(){return this._oFilterBar;};Y.prototype.setBasicSearchText=function(i){this.setProperty("basicSearchText",i);if(this._oFilterBar&&this._oFilterBar._oBasicSearchField){this._oFilterBar._oBasicSearchField.setValue(i);}return this;};Y.prototype.setTokens=function(j){var o=true;if(j.length){var n=0,$;for(var i=0;i<j.length;i++){var a1=j[i];if(a1.data("range")){var b1=a1.data("range");$=a1.getKey();if(!$){do{$="range_"+n;n++;}while(this._oSelectedRanges[$]);}var c1=this._getFormatedRangeTokenText(b1.operation,b1.value1,b1.value2,b1.exclude,b1.keyField);this._addToken2Tokenizer($,c1,b1.exclude?this._oExcludedTokens:this._oSelectedTokens,b1.keyField);this._oSelectedRanges[$]=b1;o=false;}else{$=a1.getKey();var d1=a1.getText();var e1=a1.data("longKey");var f1=a1.data("row");if(!e1){e1=$;}this._oSelectedItems.add(e1,f1?f1:a1.getText());var g1=new T(Z.call(this,e1),{key:e1});g1.setText(d1);g1.setTooltip(d1);this._oSelectedTokens.addToken(g1);}}}else{this._oSelectedItems.removeAll();this._oSelectedRanges={};this._oSelectedTokens.destroyTokens();this._oExcludedTokens.destroyTokens();}if(o){this._updateTokenizer();}};Y.prototype.open=function(){this._bIgnoreSelectionChange=false;this.bCollectiveSearchActive=this.oSelectionTitle.getVisible()&&this.oSelectionButton.getVisible();if(this._oColSearchBox){this._oColSearchBox.setVisible(this.bCollectiveSearchActive);}if(!this._isPhone()){if(this.getSupportRangesOnly()||this.getFilterMode()){this._updateView(_.DESKTOP_CONDITIONS_VIEW);}else if(!this._oTable){this._createDefaultTable();}this.setContentWidth(this._getDefaultContentWidth());}else{if(!this._oTable){this._createDefaultTable();}this._updateView(_.PHONE_MAIN_VIEW);}D.prototype.open.apply(this);return this;};Y.prototype.getTable=function(){if(!this._oTable){this._createDefaultTable();}return this._oTable;};Y.prototype.setTable=function(o){if(this._oTable){this._oMainLayout.removeItem(this._oTable);if(this._bTableCreatedInternal){this._oTable.destroy();this._oTable=null;}}this._bTableCreatedInternal=(arguments.length>1)&&(arguments[1]==true);if(o&&o.isA("sap.ui.comp.smarttable.SmartTable")){this._oTable=o.getTable();}else{this._oTable=o;}this._oTable.setLayoutData(new c({shrinkFactor:0,growFactor:1}));this.theTable=this._oTable;this._initializeTable();this._oMainLayout.addItem(o);};Y.prototype._getDefaultContentWidth=function(){var n=0;if(this._oTable){n=this._oTable.getColumns().length;}var i=Math.max(1080,n*130);return i+"px";};Y.prototype.resetTableState=function(){if(this._oTable){if(this._oTable.unbindRows){this._oTable.unbindRows();}this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_PRESSSEARCH"));}};Y.prototype.TableStateSearchData=function(){this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_PRESSSEARCH"));};Y.prototype._updateNoDataText=function(n){if(this._oTable){if(this._oTable.setNoData){this._oTable.setNoData(n);}else if(this._oTable.setNoDataText){this._oTable.setNoDataText(n);}}};Y.prototype.TableStateDataFilled=function(){this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_NODATA"));};Y.prototype.TableStateDataSearching=function(){this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_SEARCHING"));};Y.prototype.init=function(){D.prototype.init.apply(this);this._oTokenIdCount={};this._bTableCreatedInternal=false;this._aIncludeRangeOperations={};this._aExcludeRangeOperations={};this.setStretch(this._isPhone());this.setResizable(!this._isPhone());this.setDraggable(!this._isPhone());this.bCollectiveSearchActive=false;this.addStyleClass("compValueHelpDialog");this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this._sTableTitle1=this._oRb.getText("VALUEHELPDLG_TABLETITLE1");this._sTableTitle2=this._oRb.getText("VALUEHELPDLG_TABLETITLE2");this._sTableTitleNoCount=this._oRb.getText("VALUEHELPDLG_TABLETITLENOCOUNT");this._currentViewMode=null;this._oSelectedItems=new I();this._oSelectedRanges={};this._createHeaderBar();this._createCollectiveSearch();this._createTokenizer();this._updateTokenizer();this._oVBox=new V(this.getId()+"-vbox",{fitContainer:true});this.addContent(this._oVBox);this._oMainLayout=new V(this.getId()+"-mainLayout",{fitContainer:true,items:[this._oFilterBar],layoutData:new c({growFactor:1,shrinkFactor:0})});this._createNavigationControl();this._updateNavigationControl();this._oVBox.addItem(this._oMainLayout);if(this.getMaxIncludeRanges()==="-1"&&this.getMaxExcludeRanges()!=="0"&&!this.getFilterMode()){this._oVBox.addItem(this._oTokenizerGrid);}this._createFooterControls();this.setVerticalScrolling(false);this.setHorizontalScrolling(false);if(!sap.ui.Device.system.desktop){this._oVBox.attachBrowserEvent("touchmove",function(i){i.setMarked();});}if(!this._isPhone()){this._updateView(_.DESKTOP_LIST_VIEW);}};Y.prototype._updateView=function(n){if(this._currentViewMode===n){return;}switch(n){case _.DESKTOP_LIST_VIEW:this._validateRanges(function(){this._oTokenizerGrid.setVisible(this.getSupportMultiselect());this._oMainLayout.removeAllItems();if(this._oTabBar&&this._oTabBar.getSelectedKey()!==_.DESKTOP_LIST_VIEW){this._oTabBar.setSelectedKey(_.DESKTOP_LIST_VIEW);}this._oMainLayout.addItem(this._oFilterBar);this._oMainLayout.addItem(this._oTable);this._updateDlgTitle();}.bind(this),function(){this._oTabBar.setSelectedKey(_.DESKTOP_CONDITIONS_VIEW);this._updateView(_.DESKTOP_CONDITIONS_VIEW);}.bind(this));break;case _.DESKTOP_CONDITIONS_VIEW:if(this.getSupportRanges()){this.bCollectiveSearchActive=this.oSelectionTitle.getVisible()&&this.oSelectionButton.getVisible();this._oMainLayout.removeAllItems();if(this._oTabBar&&this._oTabBar.getSelectedKey()!==_.DESKTOP_CONDITIONS_VIEW){this._oTabBar.setSelectedKey(_.DESKTOP_CONDITIONS_VIEW);}this._createAddRanges();this._oButtonOk.setVisible(this.getSupportRangesOnly()||this.getSupportMultiselect());this._oTokenizerGrid.setVisible(this.getSupportMultiselect());if(!(this.getMaxIncludeRanges()==="-1"&&this.getMaxExcludeRanges()!=="0"&&!this.getFilterMode())){this._oTokenizerGrid.setVisible(false);}}break;case _.PHONE_MAIN_VIEW:this.setVerticalScrolling(false);this._oColSearchBox.setVisible(false);this._oMainListMenu.setVisible(true);this._updateNavigationControl();this._oAdvancedSearchLink.setVisible(false);if(this._oFilterBar){this._oFilterBar.setVisible(false);this._oFilterBar.setFilterBarExpanded(false);}this._oTable.setVisible(false);this._oTokenizerGrid.setVisible(this.getSupportMultiselect());if(!(this.getMaxIncludeRanges()==="-1"&&this.getMaxExcludeRanges()!=="0"&&!this.getFilterMode())){this._oTokenizerGrid.setVisible(false);}if(this._oRanges){this._oRanges.setVisible(false);}this._oButtonGo.setVisible(false);this._oButtonClear.setVisible(false);this._oButtonOk.setVisible(true);this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(false);this._bNoneMainView=false;if(!this._oTokenizerGrid.getVisible()&&!(this._oSelectItemLI.getVisible()&&this._oDefineConditionsLI.getVisible())){this._bNoneMainView=true;if(this._oSelectItemLI.getVisible()){this._updateView(_.PHONE_LIST_VIEW);}if(this._oDefineConditionsLI.getVisible()){this._updateView(_.PHONE_CONDITIONS_VIEW);}return;}break;case _.PHONE_LIST_VIEW:this.setVerticalScrolling(true);this._oColSearchBox.setVisible(this.bCollectiveSearchActive);this._oMainListMenu.setVisible(false);if(this._oFilterBar){var i=this._oFilterBar&&this._oFilterBar.getFilterGroupItems()&&this._oFilterBar.getFilterGroupItems().length>0;this._oAdvancedSearchLink.setVisible(i);this._oFilterBar.setShowGoButton(!(this._oFilterBar&&this._oFilterBar.getBasicSearch()));this._oFilterBar.setVisible(true);this._oFilterBar.setFilterBarExpanded(false);}this._oTable.setVisible(true);this._oTokenizerGrid.setVisible(false);if(this._oRanges){this._oRanges.setVisible(false);}this._oButtonGo.setVisible(false);this._oButtonClear.setVisible(false);this._oButtonOk.setVisible(this.getSupportMultiselect());this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(!this._bNoneMainView);break;case _.PHONE_SEARCH_VIEW:this.setVerticalScrolling(true);this._oColSearchBox.setVisible(false);this._oMainListMenu.setVisible(false);if(this._oFilterBar){this._oFilterBar.setVisible(true);this._oFilterBar.setFilterBarExpanded(true);}this._oAdvancedSearchLink.setVisible(false);this._oTable.setVisible(false);this._oTokenizerGrid.setVisible(false);if(this._oRanges){this._oRanges.setVisible(false);}this._oButtonGo.setVisible(true);this._oButtonClear.setVisible(true);this._oButtonOk.setVisible(false);this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(true);break;case _.PHONE_CONDITIONS_VIEW:this.setVerticalScrolling(true);this._oColSearchBox.setVisible(false);this._oMainListMenu.setVisible(false);if(this._oFilterBar){this._oFilterBar.setVisible(false);}this._oAdvancedSearchLink.setVisible(false);this._oTable.setVisible(false);this._oTokenizerGrid.setVisible(false);if(!this._oRanges){this._createAddRanges();}if(this._oRanges){this._oRanges.setVisible(true);}this._oButtonGo.setVisible(false);this._oButtonClear.setVisible(false);this._oButtonOk.setVisible(true);this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(!this._bNoneMainView);break;default:break;}if(this._oMainListMenu&&this._oVBox){if(this._oFilterBar){this._oFilterBar._handleVisibilityOfToolbar();}this._oVBox.rerender();}this._currentViewMode=n;this._updateDlgTitle();};Y.prototype._changeTableRowSelectionForKey=function(j,n){var i;var o=this._oTable;this._bIgnoreSelectionChange=true;if(sap.ui.table.Table&&o instanceof sap.ui.table.Table){var $=o.getBinding("rows");if($){if($.aKeys){for(i=0;i<$.aKeys.length;i++){if(decodeURIComponent($.aKeys[i])===j){if(n){o.addSelectionInterval(i,i);}else{o.removeSelectionInterval(i,i);}break;}}}else{this.oRows=o.getBinding("rows");if(this.oRows.aIndices){for(i=0;i<this.oRows.aIndices.length;i++){var a1=o.getContextByIndex(this.oRows.aIndices[i]);if(a1){var b1=a1.getObject();if(b1[this.getKey()]===j){if(n){o.addSelectionInterval(i,i);}else{o.removeSelectionInterval(i,i);}break;}}}}}}}else{for(i=0;i<o.getItems().length;i++){var c1=o.getItems()[i];var d1=c1.getBindingContext().getObject();if(d1[this.getKey()]===j){o.setSelectedItem(c1,n);break;}}}this._bIgnoreSelectionChange=false;};Y.prototype.update=function(){var i,j,o,n;var $;var a1=this._oSelectedItems.getItems();var b1={tokenKeys:a1,useDefault:false};this._bIgnoreSelectionChange=true;if(this._hasListeners("updateSelection")){this.fireUpdateSelection(b1);}else{b1.useDefault=true;}if(b1.useDefault){if(sap.ui.table.Table&&this._oTable instanceof sap.ui.table.Table){this.oRows=this._oTable.getBinding("rows");this._oTable.clearSelection();if(this.oRows.aKeys){var c1=this.getKeys();var d1=c1&&c1.length>1?this.getKey()+"=":"";for(j=0;j<a1.length;j++){$=a1[j];var e1=d1+"'"+$+"'";for(i=0;i<this.oRows.aKeys.length;i++){var f1=this.oRows.aKeys[i];if(f1===undefined){continue;}f1=decodeURIComponent(f1);var g1=f1===$;if(g1||f1.indexOf(e1)>=0){if(!g1){this._oSelectedItems.remove($);var h1=this._getTokenByKey($,this._oSelectedTokens);if(h1){h1.setKey(f1);}}n=this._oTable.getContextByIndex(i);if(n){o=n.getObject();this._oSelectedItems.add(f1,o);}this._oTable.addSelectionInterval(i,i);break;}}}}else if(this.oRows.aIndices){this._oTable.clearSelection();for(j=0;j<a1.length;j++){var i1=a1[j];for(i=0;i<this.oRows.aIndices.length;i++){n=this._oTable.getContextByIndex(this.oRows.aIndices[i]);if(n){o=n.getObject();if(o[this.getKey()]===i1){this._oSelectedItems.add(o[this.getKey()],o);this._oTable.addSelectionInterval(i,i);break;}}}}}}else{var j1=this._oTable;for(j=0;j<a1.length;j++){$=a1[j];for(i=0;i<j1.getItems().length;i++){var k1=j1.getItems()[i];var l1=k1.getBindingContext().getObject();if(l1[this.getKey()]===$){j1.setSelectedItem(k1,true);break;}}}}}this._bIgnoreSelectionChange=false;this._updateTitles();};Y.prototype._createHeaderBar=function(){this._oTitle=new d(this.getId()+"-title");var o=null;if(this._isPhone()){o=new f(this.getId()+"-back",{visible:false,type:g.Back,press:function(i){if(this._currentViewMode===_.PHONE_SEARCH_VIEW){this._updateView(_.PHONE_LIST_VIEW);}else{this._updateView(_.PHONE_MAIN_VIEW);}}.bind(this)});this._oBackButton=o;}this.setCustomHeader(new k(this.getId()+"-header",{contentLeft:o,contentMiddle:this._oTitle}));};Y.prototype._createCollectiveSearch=function(){this.oSelectionTitle=new e(this.getId()+"-selTitle",{visible:false,wrapping:false}).addStyleClass("compVHColSearchText");this.oSelectionButton=new f(this.getId()+"-selButton",{icon:"sap-icon://arrow-down",tooltip:this._oRb.getText("VALUEHELPVALDLG_SEARCHTEMPLATES_TOOLTIP"),type:g.Transparent,visible:false,ariaLabelledBy:this.oSelectionTitle}).addStyleClass("compVHColSearchBtn");this._oColSearchBox=new H(this.getId()+"-selBox",{fitContainer:true,visible:this.oSelectionButton.getVisible(),items:[this.oSelectionTitle,this.oSelectionButton]}).addStyleClass("compVHColSearchVBox");};Y.prototype._createFooterControls=function(){this._oButtonOk=new f(this.getId()+"-ok",{text:this._oRb.getText("VALUEHELPDLG_OK"),press:this._onCloseAndTakeOverValues.bind(this),visible:this.getSupportMultiselect(),type:g.Emphasized,layoutData:new O({priority:R.NeverOverflow})});this._oButtonCancel=new f(this.getId()+"-cancel",{text:this._oRb.getText("VALUEHELPDLG_CANCEL"),press:this._onCancel.bind(this),layoutData:new O({priority:R.NeverOverflow})});if(this._isPhone()){this._oButtonGo=new f(this.getId()+"-go",{text:this._oRb.getText("VALUEHELPDLG_GO"),type:g.Emphasized,press:this._onGo.bind(this),visible:false,layoutData:new O({priority:R.NeverOverflow})});this._oButtonClear=new f(this.getId()+"-clear",{text:this._oRb.getText("VALUEHELPDLG_CLEAR"),press:this._onClear.bind(this),visible:false,layoutData:new O({priority:R.NeverOverflow})});this.addButton(this._oButtonGo);this.addButton(this._oButtonClear);}this.addButton(this._oButtonOk);this.addButton(this._oButtonCancel);};Y.prototype._createTokenizer=function(){if(this._oTokenizerGrid){return this._oTokenizerGrid;}this._oSelectedTokenTitle=new s(this.getId()+"-selectedTokenTitle");this._oSelectedTokens=new l(this.getId()+"-selectedTokens",{tokenUpdate:function($){if(this._ignoreRemoveToken){return;}if($.getParameter("type")===l.TokenChangeType.Removed){var a1=$.getParameter("removedTokens");var b1=[];var c1=[];for(var j=0;j<a1.length;j++){var d1=a1[j];var e1=d1.getKey();if(this._oSelectedRanges&&this._oSelectedRanges[e1]){c1.push(e1);this._removeToken(e1);}else{b1.push(e1);this._oSelectedItems.remove(e1);this._removeTokenFromTokenizer(e1,this._oSelectedTokens);}}this._removeRangeByKey(c1,false);var f1={tokenKeys:b1,useDefault:false};if(this._hasListeners("tokenRemove")){this._bIgnoreSelectionChange=true;this.fireTokenRemove(f1);this._bIgnoreSelectionChange=false;}else{f1.useDefault=true;}if(f1.useDefault){b1.forEach(function(i){this._changeTableRowSelectionForKey(i,false);}.bind(this));}if(a1.length===1){setTimeout(function(){if(this._oSelectedTokens.getTokens()){var i=this._oSelectedTokens.getTokens().length-1;if(i>=0){this._oSelectedTokens.getTokens()[i].focus();}}}.bind(this));}this._updateTitles();}}.bind(this),ariaLabelledBy:this._oSelectedTokenTitle}).addStyleClass("compVHTokensDiv");this._oRemoveAllSelectedItemsBtn=new f(this.getId()+"-removeSelItems",{type:g.Transparent,icon:v.getIconURI("sys-cancel"),tooltip:this._oRb.getText("VALUEHELPVALDLG_REMOVETOKENS_TOOLTIP"),press:function(){this._oSelectedTokens.destroyTokens();this._removeRangeByKey(Object.keys(this._oSelectedRanges),false);this._oSelectedItems.removeAll();this._bIgnoreSelectionChange=true;if(this._oTable&&this._oTable.clearSelection){this._oTable.clearSelection();}if(this._oTable&&this._oTable.removeSelections){this._oTable.removeSelections();}this._bIgnoreSelectionChange=false;this._updateTitles();}.bind(this),ariaLabelledBy:this._oSelectedTokenTitle}).addStyleClass("compVHRemoveAllBtn");var o=new w(this.getId()+"-selItemsBox",{content:[this._oSelectedTokens,this._oRemoveAllSelectedItemsBtn]}).addStyleClass("compVHTokenizerHLayout");this._oIncludeTokenGrid=new G(this.getId()+"-selItemsGrid",{width:"100%",defaultSpan:"L12 M12 S12",hSpacing:0,vSpacing:0,content:[this._oSelectedTokenTitle,o]});this._oExcludedTokenTitle=new e(this.getId()+"-excludedTokenTitle").addStyleClass("compVHSelectedItemsText");this._oExcludedTokens=new l(this.getId()+"-excludedTokens",{tokenChange:function(i){if(this._ignoreRemoveToken){return;}if(i.getParameter("type")===l.TokenChangeType.Removed||i.getParameter("type")===l.TokenChangeType.RemovedAll){var $=i.getParameter("removedTokens");var a1=[];if(!$||$.length==0){$=[i.getParameter("token")];}if(!$||$.length==0){$=[i.getParameter("tokens")];}for(var j=0;j<$.length;j++){var b1=$[j];var c1=b1.getKey();if(this._oSelectedRanges&&this._oSelectedRanges[c1]){a1.push(c1);}}this._removeRangeByKey(a1,true);this._updateTitles();}}.bind(this),ariaLabelledBy:this._oExcludedTokenTitle}).addStyleClass("compVHTokensDiv");this._oRemoveAllExcludeItemsBtn=new f(this.getId()+"-removeExclItems",{type:g.Transparent,icon:v.getIconURI("sys-cancel"),tooltip:this._oRb.getText("VALUEHELPVALDLG_REMOVETOKENS_TOOLTIP"),press:function(){this._oExcludedTokens.destroyTokens();this._removeRangeByKey(Object.keys(this._oSelectedRanges),true);this._updateTitles();}.bind(this),ariaLabelledBy:this._oExcludedTokenTitle}).addStyleClass("compVHRemoveAllBtn");var n=new w(this.getId()+"-exclItemsBox",{content:[this._oExcludedTokens,this._oRemoveAllExcludeItemsBtn]}).addStyleClass("compVHTokenizerHLayout");this._oExcludeTokenGrid=new G(this.getId()+"-exclItemsGrid",{width:"100%",defaultSpan:"L12 M12 S12",hSpacing:0,vSpacing:0,content:[this._oExcludedTokenTitle,n]});this._oTokenizerPanel=new P(this.getId()+"-tokenPanel",{expanded:x.system.desktop,expandable:true,expandAnimation:true,headerText:"",width:"auto",content:[this._oIncludeTokenGrid,this._oExcludeTokenGrid],expand:function(i){this._updateTokenizer();if(i.mParameters.expand&&!(this._oTable instanceof sap.m.Table)){var j=q.sap.domById(this.getId()+"-scrollCont");if(j&&j.scrollTop){j.stop().animate({scrollTop:"1000"},1000);}}}.bind(this)}).addStyleClass("compVHBackgroundTransparent").addStyleClass("compVHTokensPanel").addStyleClass("compValueHelpDialogTokens");if(this._isPhone()){this._oSelectedTokens.addStyleClass("sapMTokenizerMultiLine");this._oExcludedTokens.addStyleClass("sapMTokenizerMultiLine");}this._oTokenizerGrid=new G(this.getId()+"-tokenizerGrid",{width:"100%",defaultSpan:"L12 M12 S12",hSpacing:0,vSpacing:0,content:this._oTokenizerPanel}).addStyleClass("compVHDarkBackground");return this._oTokenizerGrid;};Y.prototype._addToken2Tokenizer=function(i,j,o,n){var $=(typeof j==="string")?j:"";var a1=this._getTokenByKey(i,o);if(!a1){a1=new T(Z.call(this,i,n),{key:i});o.addToken(a1);this._updateTokenizer();}if(a1){a1.setText(j);a1.setTooltip($);}};Y.prototype._getTokenByKey=function(j,o){var n=o.getTokens();for(var i=0;i<n.length;i++){var $=n[i];if($.getKey()===j){return $;}}return null;};Y.prototype._removeToken=function(i){if(!this._removeTokenFromTokenizer(i,this._oSelectedTokens)){this._removeTokenFromTokenizer(i,this._oExcludedTokens);}};Y.prototype._removeTokenFromTokenizer=function(i,o){var j=this._getTokenByKey(i,o);if(j){this._ignoreRemoveToken=true;o.removeToken(j);j.destroy();this._ignoreRemoveToken=false;this._updateTokenizer();return true;}return false;};Y.prototype._updateTokenizer=function(){var i=false;if(this._oTokenizerPanel){i=this._oTokenizerPanel.getExpanded();}var n=this._oSelectedTokens.getTokens().length;var j=this._oExcludedTokens.getTokens().length;var o=this._oRb.getText("VALUEHELPDLG_SELECTEDITEMS");var $=this._oRb.getText("VALUEHELPDLG_NONESELECTEDITEMS");var a1=o.replace("{0}",n.toString());var b1=this._oRb.getText("VALUEHELPDLG_EXCLUDEDITEMS",j.toString());var c1=n===0?$:a1;if(this._oTokenizerPanel){if(!i){if(this._isPhone()){a1=this._oRb.getText("VALUEHELPDLG_SELECTEDITEMS_SHORT",n.toString());b1=this._oRb.getText("VALUEHELPDLG_EXCLUDEDITEMS_SHORT",j.toString());}c1="";if(n!==0){c1=a1;}if(j!==0){c1+=(n!==0?" / ":"")+b1;}if(c1===""){c1=$;}}else if(n===0&&j!==0){c1=b1;b1="";}this._oTokenizerPanel.setHeaderText(c1);this._oSelectedTokenTitle.setText(c1);}else{this._oSelectedTokenTitle.setText(c1);}this._oRemoveAllSelectedItemsBtn.setEnabled(n!==0);this._oRemoveAllExcludeItemsBtn.setEnabled(j!==0);this._oExcludedTokenTitle.setText(b1);if(n===0&&j!==0){this._oIncludeTokenGrid.addStyleClass("displayNone");if(!this._isPhone()){this._oExcludedTokenTitle.addStyleClass("displayNone");}}else{this._oIncludeTokenGrid.removeStyleClass("displayNone");this._oExcludedTokenTitle.removeStyleClass("displayNone");}if(j===0){this._oExcludeTokenGrid.addStyleClass("displayNone");}else{this._oExcludeTokenGrid.removeStyleClass("displayNone");}};Y.prototype._createNavigationControl=function(){if(!this._isPhone()){this._oTabBar=new m(this.getId()+"-navigation",{upperCase:true,expandable:false,items:[new p(this.getId()+"-itemstable",{visible:true,text:this._oRb.getText("VALUEHELPDLG_ITEMSTABLE"),key:_.DESKTOP_LIST_VIEW}),new p(this.getId()+"-ranges",{visible:true,text:this._oRb.getText("VALUEHELPDLG_RANGES"),key:_.DESKTOP_CONDITIONS_VIEW})],select:function(o){this._updateView(o.getParameters().key);}.bind(this)});this._oTabBar.setLayoutData(new c({shrinkFactor:0}));this._oVBox.addItem(this._oTabBar);}else{this._oSelectItemLI=new S(this.getId()+"-itemstable",{type:X.Navigation,title:this._oRb.getText("VALUEHELPDLG_ITEMSTABLE")}).data("key",_.PHONE_LIST_VIEW);this._oDefineConditionsLI=new S(this.getId()+"-ranges",{type:X.Navigation,title:this._oRb.getText("VALUEHELPDLG_RANGES")}).data("key",_.PHONE_CONDITIONS_VIEW);this._oMainListMenu=new y(this.getId()+"-navigation",{mode:W.None,items:[this._oSelectItemLI,this._oDefineConditionsLI],itemPress:function(o){if(o){this._updateView(o.mParameters.listItem.data("key"));}}.bind(this)});this._oMainListMenu.setLayoutData(new c({shrinkFactor:0}));this._oVBox.addItem(this._oMainListMenu);this._oAdvancedSearchLink=new z(this.getId()+"-advancedSearchLink",{text:this._oRb.getText("VALUEHELPDLG_ADVANCEDSEARCH"),press:function(){this._updateView(_.PHONE_SEARCH_VIEW);}.bind(this)}).addStyleClass("compVHAdvancedSearchLink");this._oAdvancedSearchLink.setLayoutData(new c({shrinkFactor:0}));this._oVBox.addItem(this._oAdvancedSearchLink);}};Y.prototype._updateNavigationControl=function(){var i=!this.getSupportRangesOnly();var j=this.getSupportRangesOnly()||this.getSupportRanges();if(this._oTabBar){var n=this._oTabBar.getItems();n[0].setVisible(i);n[1].setVisible(j);this._oTabBar.setVisible(i&&j);this._updateDlgTitle();}if(this._oMainListMenu){this._oSelectItemLI.setVisible(i);this._oDefineConditionsLI.setVisible(j);}};Y.prototype._removeRangeByKey=function(i,j){var n=i;if(typeof n==="string"){n=[n];}n.forEach(function(i,$,n){var a1=this._oSelectedRanges[i];if(a1.exclude===j){if(!a1._oGrid){delete this._oSelectedRanges[i];if(this._oFilterPanel){var o=a1.exclude?this._oFilterPanel._oExcludeFilterPanel:this._oFilterPanel._oIncludeFilterPanel;if(n.length==1){o.removeCondition(i);}else{o._removeConditionFromMap(i);}}}}},this);if(n.length>1&&this._oFilterPanel){var o=j?this._oFilterPanel._oExcludeFilterPanel:this._oFilterPanel._oIncludeFilterPanel;o._clearConditions();o._fillConditions();}};Y.prototype._createAddRanges=function(){if(!this._oRanges){if(!sap.ui.require('sap/m/P13nFilterPanel')){sap.ui.require(['sap/m/P13nFilterPanel'],function(){this._oRanges=this._createRanges();this._oMainLayout.addItem(this._oRanges);}.bind(this));}else{this._oRanges=this._createRanges();this._oMainLayout.addItem(this._oRanges);}}else{this._oMainLayout.addItem(this._oRanges);}};Y.prototype._createRanges=function(){this._oFilterPanel=new A(this.getId()+"-filterPanel",{maxIncludes:this.getMaxIncludeRanges(),maxExcludes:this.getMaxExcludeRanges(),containerQuery:true,addFilterItem:function(b1){var c1=b1.mParameters;var d1={exclude:c1.filterItemData.getExclude(),keyField:c1.filterItemData.getColumnKey(),operation:c1.filterItemData.getOperation(),value1:c1.filterItemData.getValue1(),value2:c1.filterItemData.getValue2()};this._oSelectedRanges[c1.key]=d1;var e1=this._getKeyFieldByKey(d1.keyField);d1.value1=this._convertValue2Object(d1.value1,e1.type);d1.value2=this._convertValue2Object(d1.value2,e1.type);this._oFilterPanel.addFilterItem(c1.filterItemData);var f1=this._getFormatedRangeTokenText(d1.operation,d1.value1,d1.value2,d1.exclude,d1.keyField);this._addToken2Tokenizer(c1.key,f1,d1.exclude?this._oExcludedTokens:this._oSelectedTokens,d1.keyField);this._updateTokenizer();}.bind(this),removeFilterItem:function(b1){var c1=b1.mParameters;delete this._oSelectedRanges[c1.key];this._removeToken(c1.key);this._updateTokenizer();}.bind(this),updateFilterItem:function(b1){var c1=b1.mParameters;var d1=this._oSelectedRanges[c1.key];d1.exclude=c1.filterItemData.getExclude();d1.keyField=c1.filterItemData.getColumnKey();d1.operation=c1.filterItemData.getOperation();d1.value1=c1.filterItemData.getValue1();d1.value2=c1.filterItemData.getValue2();var e1=this._getKeyFieldByKey(d1.keyField);d1.value1=this._convertValue2Object(d1.value1,e1.type);d1.value2=this._convertValue2Object(d1.value2,e1.type);var f1=this._getFormatedRangeTokenText(d1.operation,d1.value1,d1.value2,d1.exclude,d1.keyField);this._addToken2Tokenizer(c1.key,f1,d1.exclude?this._oExcludedTokens:this._oSelectedTokens,d1.keyField);this._updateTokenizer();}.bind(this)});this._oFilterPanel._oIncludeFilterPanel.setDisplayFormat(this.getDisplayFormat());this._oFilterPanel._oExcludeFilterPanel.setDisplayFormat(this.getDisplayFormat());this._oFilterPanel._oIncludeFilterPanel._fSuggestCallback=this._fSuggestCallback;this._oFilterPanel._oExcludeFilterPanel._fSuggestCallback=this._fSuggestCallback;this._oFilterPanel._oIncludeFilterPanel._sAddRemoveIconTooltipKey="CONDITION";this._oFilterPanel._oExcludeFilterPanel._sAddRemoveIconTooltipKey="CONDITION";var i;if(this._aIncludeRangeOperations){for(i in this._aIncludeRangeOperations){this._oFilterPanel.setIncludeOperations(this._aIncludeRangeOperations[i],i);}}if(this._aExcludeRangeOperations){for(i in this._aExcludeRangeOperations){this._oFilterPanel.setExcludeOperations(this._aExcludeRangeOperations[i],i);}}var o={};if(this._aRangeKeyFields){this._aRangeKeyFields.forEach(function(b1){if(!o[b1.key]){o[b1.key]=0;}o[b1.key]++;this._oFilterPanel.addItem(new E(this.getId()+"-item_"+b1.key+o[b1.key],{columnKey:b1.key,text:b1.label,type:b1.type,maxLength:b1.maxLength,formatSettings:b1.formatSettings,scale:b1.scale,precision:b1.precision,isDefault:b1.isDefault,values:b1.type==="boolean"?this._getBooleanValues():null}));},this);}if(this._oSelectedRanges){for(var j in this._oSelectedRanges){var n=this._oSelectedRanges[j];if(!o[n.keyField]){o[n.keyField]=0;}o[n.keyField]++;var $=new J(this.getId()+"-item_"+n.keyField+o[n.keyField],{key:j,exclude:n.exclude,columnKey:n.keyField,operation:n.operation});$.setValue1(n.value1);$.setValue2(n.value2);this._oFilterPanel.addFilterItem($);}}var a1=new G(this.getId()+"-rangeFieldsGrid",{width:"100%",defaultSpan:"L12 M12 S12",vSpacing:0,hSpacing:0,content:[this._oFilterPanel]});this._sValidationDialogTitle=this._oRb.getText("VALUEHELPVALDLG_TITLE");this._sValidationDialogMessage=this._oRb.getText("VALUEHELPVALDLG_MESSAGE");this._sValidationDialogFieldMessage=this._oRb.getText("VALUEHELPVALDLG_FIELDMESSAGE");return a1;};Y.prototype.suggest=function(i){this._fSuggestCallback=i;if(this._oFilterPanel){if(this._oFilterPanel._oIncludeFilterPanel){this._oFilterPanel._oIncludeFilterPanel._fSuggestCallback=this._fSuggestCallback;}if(this._oFilterPanel._oExcludeFilterPanel){this._oFilterPanel._oExcludeFilterPanel._fSuggestCallback=this._fSuggestCallback;}}};Y.prototype._getBooleanValues=function(){if(!this._aBooleanValues){var o=new B();if(o){this._aBooleanValues=["",o.formatValue(false,"string"),o.formatValue(true,"string")];}}return this._aBooleanValues;};Y.prototype._convertValue2Object=function(i,j){if(!i){return i;}var n=i;if(j==="date"){n=new Date(i);}if(j==="time"){n=new Date(i);}if(j==="datetime"){n=new Date(i);}if(j==="numeric"){n=parseFloat(i);}if(j==="boolean"){if(i===""){n=null;}else{n=i=='true';}}return n;};Y.prototype._getKeyFieldByKey=function(i){var o;if(this._aRangeKeyFields){this._aRangeKeyFields.some(function(j){if(typeof j!=="string"){if(j.key===i){o=j;return true;}}return false;});}return o;};Y.prototype._validateRanges=function(i,j){if(this._oRanges){if(!this._oRanges.getParent()){i();return;}var n=this._oFilterPanel.validateConditions();if(!n){M.show(this._sValidationDialogMessage,{icon:M.Icon.WARNING,title:this._sValidationDialogTitle,actions:[M.Action.OK,M.Action.CANCEL],styleClass:this.$().closest(".sapUiSizeCompact").length?"sapUiSizeCompact":"",onClose:function(o){if(o===M.Action.OK&&i){i();}if(o===M.Action.CANCEL&&j){j();}}});return;}}i();};Y.prototype.setUpdateSingleRowCallback=function(i){this.fSingleRowCallback=i;this._updateNavigationControl();};Y.prototype._createDefaultTable=function(){if(!this._isPhone()){this.setTable(new u(this.getId()+"-table"),true);}else{this.setTable(new t(this.getId()+"-table"),true);this.TableStateSearchData();}};Y.prototype._initializeTable=function(){if(sap.ui.table.Table&&this._oTable instanceof sap.ui.table.Table){this._oTable.setTitle(x.system.desktop?this._sTableTitleNoCount:null);if(this._bTableCreatedInternal){this._oTable.setSelectionBehavior(sap.ui.table.SelectionBehavior.Row);}this._oTable.setSelectionMode(this.getSupportMultiselect()?sap.ui.table.SelectionMode.MultiToggle:sap.ui.table.SelectionMode.Single);this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_PRESSSEARCH"));this._oTable.setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Fixed);this._oTable.setMinAutoRowCount(x.system.desktop?5:4);this._oTable.attachRowSelectionChange(function(o){if(this._bIgnoreSelectionChange||!o.getParameter("userInteraction")){return;}var $={tableSelectionParams:o.mParameters,updateTokens:[],useDefault:false};if(this._hasListeners("selectionChange")){this._bIgnoreSelectionChange=true;this.fireSelectionChange($);this._bIgnoreSelectionChange=false;$.updateTokens.forEach(function(h1){this._addRemoveTokenByKey(h1.sKey,h1.oRow,h1.bSelected);}.bind(this));}else{$.useDefault=true;}if($.useDefault){var a1=o.getSource();var b1=o.getParameter("rowIndices");var i,n=b1.length;var c1;var d1;var e1;for(i=0;i<n;i++){c1=b1[i];d1=a1.getContextByIndex(c1);e1=d1?d1.getObject():null;if(!e1){M.show(this._oRb.getText("VALUEHELPDLG_SELECTIONFAILED"),{icon:M.Icon.ERROR,title:this._oRb.getText("VALUEHELPDLG_SELECTIONFAILEDTITLE"),actions:[M.Action.OK],styleClass:this.$().closest(".sapUiSizeCompact").length?"sapUiSizeCompact":""});return;}}var f1=false;if(a1.getBinding("rows").aKeys){f1=true;}for(i=0;i<n;i++){c1=b1[i];d1=a1.getContextByIndex(c1);e1=d1?d1.getObject():null;if(e1){var g1;if(f1){g1=d1.sPath.substring(1);}else{g1=e1[this.getKey()];}this._addRemoveTokenByKey(g1,e1,a1.isIndexSelected(c1));}}}this._updateTitles();if(!this.getSupportMultiselect()){this._bIgnoreSelectionChange=true;this._onCloseAndTakeOverValues();}}.bind(this));this._oTable.addStyleClass("compVHMainTable");if(!this._oTable.getParent()||!this._oTable.getParent().isA("sap.ui.comp.smarttable.SmartTable")){this._oTable.bindAggregation("columns","columns>/cols",function(i,o){var n,$;if(o.getProperty("type")==="string"){$={path:o.getProperty("template")};}if(o.getProperty("type")==="boolean"){n=new K(i+"-control",{enabled:false,selected:{path:o.getProperty("template")}});}else{n=new e(i+"-control",{wrapping:false,text:{path:o.getProperty("template"),type:o.getProperty("oType")},tooltip:$});}if(this._oTable instanceof sap.ui.table.AnalyticalTable){return new sap.ui.table.AnalyticalColumn(i,{label:"{columns>label}",tooltip:"{columns>tooltip}",template:n,width:"{columns>width}",hAlign:n instanceof sap.m.CheckBox?sap.ui.core.HorizontalAlign.Center:sap.ui.core.HorizontalAlign.Begin,filterProperty:o.getProperty("filter")});}else{return new U(i,{label:"{columns>label}",tooltip:"{columns>tooltip}",template:n,width:"{columns>width}",hAlign:n instanceof sap.m.CheckBox?sap.ui.core.HorizontalAlign.Center:sap.ui.core.HorizontalAlign.Begin,sortProperty:o.getProperty("sort"),sorted:o.getProperty("sorted"),sortOrder:o.getProperty("sortOrder"),filterProperty:o.getProperty("filter")});}}.bind(this));}}else{this._oTable.setMode(this.getSupportMultiselect()?W.MultiSelect:W.SingleSelectLeft);this._oTable.setGrowing(true);this._oTable.attachSelectionChange(function(o){if(this._bIgnoreSelectionChange){return;}var $=o.mParameters;var a1={tableSelectionParams:o.mParameters,updateTokens:[],useDefault:false};if(this._hasListeners("selectionChange")){this._bIgnoreSelectionChange=true;this.fireSelectionChange(a1);this._bIgnoreSelectionChange=false;a1.updateTokens.forEach(function(g1){this._addRemoveTokenByKey(g1.sKey,g1.oRow,g1.bSelected);}.bind(this));}else{a1.useDefault=true;}if(a1.useDefault){var b1=$.selected;var i,n=$.listItems.length;for(i=0;i<n;i++){var c1=$.listItems[i];var d1=c1.getBindingContext();var e1=d1?d1.getObject():null;if(e1){var f1=e1[this.getKey()];this._addRemoveTokenByKey(f1,e1,b1);}}}if(!this.getSupportMultiselect()){this._onCloseAndTakeOverValues();}}.bind(this));if(!this._oTable.getParent()||!this._oTable.getParent().isA("sap.ui.comp.smarttable.SmartTable")){var j=0;this._oTable.bindAggregation("columns","columns>/cols",function(i,o){var n=o.getProperty("label");var $=this._oTable.getColumns().length>=2;j++;return new h(this._oTable.getId()+"-column"+j,{header:new L(this._oTable.getId()+"-column"+j+"-label",{text:n}),demandPopin:$,minScreenWidth:$?(this._oTable.getColumns().length+1)*10+"rem":"1px"});}.bind(this));}}};Y.prototype._addRemoveTokenByKey=function(i,o,j){i=decodeURIComponent(i);if(j){this._oSelectedItems.add(i,o);this._addToken2Tokenizer(i,this._getFormatedTokenText(i),this._oSelectedTokens);}else{this._oSelectedItems.remove(i);this._removeTokenFromTokenizer(i,this._oSelectedTokens);}};Y.prototype._onCloseAndTakeOverValues=function(){var j=this;var n=function(){var o;var $=j._oSelectedItems.getSelectedItemsTokenArray(j.getKey(),j.getDescriptionKey(),j.getTokenDisplayBehaviour());if(j._oSelectedRanges){var i=0;for(var a1 in j._oSelectedRanges){o=j._oSelectedRanges[a1];var b1=o.tokenValue;if(!b1){b1=j._getFormatedRangeTokenText(o.operation,o.value1,o.value2,o.exclude,o.keyField);}if(!o._oGrid||o._oGrid.select.getSelected()){var c1=new T({key:"range_"+i}).data("range",{"exclude":o.exclude,"operation":o.operation,"keyField":o.keyField,"value1":o.value1,"value2":o.value2});c1.setText(b1);c1.setTooltip(typeof b1==="string"?b1:null);$.push(c1);i++;}}}j.fireOk({"tokens":$});};this._validateRanges(n);};Y.prototype._onCancel=function(){this.fireCancel();};Y.prototype._onGo=function(){this._oFilterBar.search();};Y.prototype._onClear=function(){this._oFilterBar.clear();};Y.prototype._updateTitles=function(){this._updateTableTitle();this._updateTokenizer();};Y.prototype._updateDlgTitle=function(){var i="";var j;if(this._oTitle){if(this._oTabBar&&!this._oTabBar.getVisible()&&!this.getFilterMode()){if(this._oTabBar.getSelectedKey()===_.DESKTOP_LIST_VIEW){i="VALUEHELPDLG_TITLE";}else if(this._oTabBar.getSelectedKey()===_.DESKTOP_CONDITIONS_VIEW){if(this.getMaxIncludeRanges()==="1"&&this.getMaxExcludeRanges()==="0"){i="VALUEHELPDLG_SINGLECONDITION_TITLE";}else{i="VALUEHELPDLG_RANGESTITLE";}}}else if(this._isPhone()&&!this.getFilterMode()){switch(this._currentViewMode){case _.PHONE_MAIN_VIEW:i="";break;case _.PHONE_LIST_VIEW:i="VALUEHELPDLG_ITEMSTABLE";break;case _.PHONE_SEARCH_VIEW:i="VALUEHELPDLG_ADVANCEDSEARCH";break;case _.PHONE_CONDITIONS_VIEW:if(this.getMaxIncludeRanges()==="1"&&this.getMaxExcludeRanges()==="0"){i="VALUEHELPDLG_SINGLECONDITION_TITLE";}else{i="VALUEHELPDLG_RANGES";}break;default:break;}}if(!j){j=this.getTitle();}if(i){j=this._oRb.getText(i,j);}if(j){this._oTitle.setText(j);}}};Y.prototype._updateTableTitle=function(){if(!this._oTable){return;}var i=0;this.oRows=this._oTable.getBinding("rows");var j=false;if(j&&this.getModel()&&this.getModel().isCountSupported){j=this.getModel().isCountSupported();}if(j){if(this.oRows){i=this.oRows.getLength();}this._setTableTitle(this._sTableTitle1.replace("{0}",i));}else{this._setTableTitle(this._sTableTitleNoCount);}};Y.prototype._setTableTitle=function(i){if(sap.ui.Device.system.desktop&&!(this._oTable instanceof sap.m.Table)){if(this._oTable.getTitle()){this._oTable.getTitle().setText(i);}else{this._oTable.setTitle(i);}}};Y.prototype.onAfterRendering=function(){D.prototype.onAfterRendering.apply(this);if(this._oTable){this._updateTitles();}if(!this._isPhone()&&this.getContentHeight()===""){if(this.getSupportRangesOnly()&&(this.getMaxExcludeRanges()==="-1"||this.getMaxIncludeRanges()==="-1")){this.setContentHeight("70%");}else{var o=this.getDomRef("scroll");var i=o.clientHeight;this.setContentHeight(i+"px");}if(sap.ui.table.Table&&this._oTable&&this._oTable instanceof sap.ui.table.Table){this._oTable.setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Auto);}}};Y.prototype._getDialogOffset=function(i){var j=i||this._$Window.width();var n={small:600,large:1024};var o=function($){var a1=parseInt(window.getComputedStyle(document.body).fontSize,10);return($*a1)*2;};var $=1;if(j>n.small&&j<n.large){$=2;}else if(j>=n.large){$=2;}return{top:o($),left:o($)};};Y.prototype.exit=function(){D.prototype.exit.apply(this);var i=function(o){if(o&&o.destroy){o.destroy();}return null;};this._oTokenizerGrid=i(this._oTokenizerGrid);this._oRanges=i(this._oRanges);this._oFilterPanel=i(this._oFilterPanel);if(this._bTableCreatedInternal){this._oTable=i(this._oTable);}this._oTable=null;this.theTable=null;this._oTabBar=i(this._oTabBar);this._oMainListMenu=i(this._oMainListMenu);this._oVBox=i(this._oVBox);this._oVarManagment=i(this._oVarManagment);this._aRangeKeyFields=i(this._aRangeKeyFields);this._aIncludeRangeOperations=i(this._aIncludeRangeOperations);this._aExcludeRangeOperations=i(this._aExcludeRangeOperations);if(this._oFilterBar){this._oFilterBar.detachInitialise(this._handleFilterBarInitialize);this._oFilterBar=i(this._oFilterBar);}this._oRb=i(this._oRb);this._sTableTitle1=i(this._sTableTitle1);this._sTableTitle2=i(this._sTableTitle2);this._sTableTitleNoCount=i(this._sTableTitleNoCount);this._sValidationDialogTitle=i(this._sValidationDialogTitle);this._sValidationDialogMessage=i(this._sValidationDialogMessage);this._sValidationDialogFieldMessage=i(this._sValidationDialogFieldMessage);this._oSelectedItems=i(this._oSelectedItems);this._oSelectedRanges=i(this._oSelectedRanges);this._oButtonOk=i(this._oButtonOk);this._oButtonCancel=i(this._oButtonCancel);if(this._oButtonGo){this._oButtonGo=i(this._oButtonGo);}if(this._oButtonClear){this._oButtonClear=i(this._oButtonClear);}if(this._oColSearchBox){this._oColSearchBox=i(this._oColSearchBox);}};Y.prototype.setRangeKeyFields=function(i){this._aRangeKeyFields=i;};Y.prototype.getRangeKeyFields=function(){return this._aRangeKeyFields;};Y.prototype.setIncludeRangeOperations=function(o,i){i=i||"default";this._aIncludeRangeOperations[i]=o;if(this._oFilterPanel){this._oFilterPanel.setIncludeOperations(this._aIncludeRangeOperations[i],i);}};Y.prototype.setExcludeRangeOperations=function(o,i){i=i||"default";this._aExcludeRangeOperations[i]=o;if(this._oFilterPanel){this._oFilterPanel.setExcludeOperations(this._aExcludeRangeOperations[i],i);}};Y.prototype._getFormatedTokenText=function(i){var o=this._oSelectedItems.getItem(i);var j=o[this.getDescriptionKey()];var n=o[this.getKey()];if(j===undefined){if(typeof o==="string"){j=o;}else{j=i;}}else{j=F.getFormattedExpressionFromDisplayBehaviour(this.getTokenDisplayBehaviour()?this.getTokenDisplayBehaviour():sap.ui.comp.smartfilterbar.DisplayBehaviour.descriptionAndId,n,j);}return j;};Y.prototype._getFormatedRangeTokenText=function(o,i,j,n,$){var a1="";var b1;var c1=this._getKeyFieldByKey($);if(c1){switch(c1.type){case"numc":b1={format:function(f1){return this.oType.formatValue(f1,"string");},oType:new Q({},c1.formatSettings)};break;case"numeric":var d1;if(c1.precision||c1.scale){d1={};if(c1.precision){d1["maxIntegerDigits"]=parseInt(c1.precision,10);}if(c1.scale){d1["maxFractionDigits"]=parseInt(c1.scale,10);}}b1=N.getFloatInstance(d1);break;case"date":b1=a.getDateInstance(q.extend({},c1.formatSettings,{strictParsing:true}));i=new Date(i);j=j!==""?new Date(j):null;break;case"time":b1=a.getTimeInstance(q.extend({},c1.formatSettings,{strictParsing:true}));i=new Date(i);j=j!==""?new Date(j):null;break;case"datetime":b1=a.getDateTimeInstance(q.extend({},c1.formatSettings,{strictParsing:true}));i=new Date(i);j=j!==""?new Date(j):null;break;case"boolean":var e1=this._getBooleanValues();i=e1[i?2:1];j=e1[j?2:1];break;case"stringdate":if(sap.m.P13nConditionStringDateFormatter){b1=new sap.m.P13nConditionStringDateFormatter(q.extend({},c1.formatSettings,{strictParsing:true}));}break;default:break;}if(b1){if(i){i=b1.format(i);}if(j){j=b1.format(j);}}}if(i!==""){switch(o){case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.Initial:a1="=''";break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.EQ:a1="="+i;break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.GT:a1=">"+i;break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.GE:a1=">="+i;break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.LT:a1="<"+i;break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.LE:a1="<="+i;break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.Contains:a1="*"+i+"*";break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.StartsWith:a1=i+"*";break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.EndsWith:a1="*"+i;break;case sap.ui.comp.valuehelpdialog.ValueHelpRangeOperation.BT:if(j!==""){a1=i+"..."+j;break;}break;default:break;}}if(n&&a1!==""){a1="!("+a1+")";}if(this._aRangeKeyFields&&this._aRangeKeyFields.length>1&&c1&&c1.label&&a1!==""){a1=c1.label+": "+a1;}return a1;};Y.prototype._isPhone=function(){return x.system.phone;};Y.prototype._hasListeners=function(i){if(this._bTableCreatedInternal){return false;}return this.hasListeners(i);};Y.prototype._rotateSelectionButtonIcon=function(i){if(!x.system.phone){var o=sap.ui.getCore().byId(this.oSelectionButton.$("img")[0].id);if(i){o.addStyleClass("sapUiVHImageExpand");}else{o.removeStyleClass("sapUiVHImageExpand");}}};function Z(i,j){if(!j){j=this.getKey();}i=i.replace(/[^a-zA-Z0-9]/g,"");var n=j?j+"-"+i:i;if(!this._oTokenIdCount[n]){this._oTokenIdCount[n]=0;}this._oTokenIdCount[n]++;return this.getId()+"-token-"+n+"_"+this._oTokenIdCount[n];}return Y;},true);
