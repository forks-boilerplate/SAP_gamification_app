sap.ui.define(["jquery.sap.global","sap/ovp/cards/charts/Utils","sap/ui/model/odata/CountMode","sap/ovp/cards/charts/VizAnnotationManager","sap/ovp/cards/AnnotationHelper","sap/ui/core/format/NumberFormat","sap/ui/core/format/DateFormat","sap/viz/ui5/api/env/Format","sap/viz/ui5/controls/VizTooltip"],function(q,U,C,V,a,N,D,b,c){"use strict";var e={LABEL_KEY:"sap:label",LABEL_KEY_V4:"com.sap.vocabularies.Common.v1.Label",TEXT_KEY:"sap:text",TEXT_KEY_V4:"com.sap.vocabularies.Common.v1.Text",TYPE_KEY:"type",DISPLAY_FORMAT_KEY:"sap:display-format",SEMANTICS_KEY:"sap:semantics",UNIT_KEY:"sap:unit",UNIT_KEY_V4_ISOCurrency:"Org.OData.Measures.V1.ISOCurrency",UNIT_KEY_V4_Unit:"Org.OData.Measures.V1.Unit",CURRENCY_CODE:"currency-code",NAME_KEY:"name",NAME_CAP_KEY:"Name",EDM_TYPE:"type",EDM_INT32:"Edm.Int32",SCATTER_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Scatter",BUBBLE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Bubble",LINE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Line"};var f={CARD_WARNING:"OVP-AC: Analytic card: Warning: ",CARD_ERROR:"OVP-AC: Analytic card Error: ",DATA_ANNO_ERROR:"OVP-AC: Analytic card Error:",CARD_ANNO_ERROR:"OVP-AC: Analytic card: Error ",CHART_ANNO_ERROR:"OVP-AC: Analytic card: Error ",INVALID_CHART_ANNO:"OVP-AC: Analytic Cards: Invalid Chart Annotation.",ANALYTICAL_CONFIG_ERROR:"Analytic card configuration error",CACHING_ERROR:"no model defined while caching OdataMetaData",INVALID_MAXITEMS:"maxItems is Invalid. ",NO_DATASET:"OVP-AC: Analytic Cards: Could not obtain dataset.",SORTORDER_WARNING:"SortOrder is present in PresentationVariant, but it is empty or not well formed.",BOOLEAN_ERROR:"Boolean value is not present in PresentationVariant.",IS_MANDATORY:"is mandatory.",IS_MISSING:"is missing.",NOT_WELL_FORMED:"is not found or not well formed)",MISSING_CHARTTYPE:"Missing ChartType in ",CHART_ANNO:"Chart Annotation.",DATA_ANNO:"Data Annotation",CARD_ANNO:"card annotation.",CARD_CONFIG:"card configuration.",CARD_CONFIG_ERROR:"Could not obtain configuration for ",CARD_CONTAINER_ERROR:"Could not obtain card container. ",DATA_UNAVAIALABLE:"No data available.",CONFIG_LOAD_ERROR:"Failed to load config.json. Reason: ",INVALID_CHARTTYPE:"Invalid ChartType given for ",INVALID_CONFIG:"No valid configuration given for ",CONFIG_JSON:"in config.json",ENTER_INTEGER:"Please enter an Integer.",NO_CARD_MODEL:"Could not obtain Cards model.",ANNO_REF:"com.sap.vocabularies.UI.v1 annotation.",INVALID_REDUNDANT:"Invalid/redundant role configured for ",CHART_IS:"chart is/are ",CARD_CONFIG_JSON:"card from config.json",ALLOWED_ROLES:"Allowed role(s) for ",DIMENSIONS_MANDATORY:"DimensionAttributes are mandatory.",MEASURES_MANDATORY:"MeasureAttributes are mandatory.",CARD_LEAST:"card: Enter at least ",CARD_MOST:"card: Enter at most ",FEEDS:"feed(s).",MIN_FEEDS:"Minimum number of feeds required for ",FEEDS_OBTAINED:"card is not configured. Obtained ",FEEDS_REQUIRED:"feed(s), Required: ",INVALID_SEMANTIC_MEASURES:"More than one measure is being semantically coloured",INVALID_IMPROVEMENT_DIR:"No Improvement Direction Found",INVALID_CRITICALITY:"Invalid criticality values",INVALID_DIMMEAS:"Invalid number of Measures or Dimensions",INVALID_FORECAST:"Invalid/Redundant Datapoint or Forecast measure",ERROR_MISSING_AXISSCALES:"Minimum and Maximum values are mandatory for AxisScale MinMax to work"};function g(j,k,S,P,v,M,x){var O=j.getSetting("dataModel");var Q;if(x&&x.EnumMember){Q=x.EnumMember.split("/");if(Q&&(Q[1]!='Donut')&&(v===undefined)){return null;}if(Q){O.setDefaultCountMode(C.Inline);}}var R="{";var T=[];var W=[];var X=[];var Y=S&&S.SelectOptions;var Z=S&&S.Parameters;var $=P&&P.SortOrder;var _=P&&P.MaxItems,a1=null;var b1;var c1;var d1=null;var e1=e.TEXT_KEY;var f1=e.TEXT_KEY_V4;var g1=e.UNIT_KEY;var h1=e.UNIT_KEY_V4_ISOCurrency;var i1=e.UNIT_KEY_V4_Unit;if(_){a1=_.Int32?_.Int32:_.Int;}if(a1){if(a1=="0"){q.sap.log.error("OVP-AC: Analytic card Error: maxItems is configured as "+a1);R+="}";return R;}if(!/^\d+$/.test(a1)){q.sap.log.error("OVP-AC: Analytic card Error: maxItems is Invalid. "+"Please enter an Integer.");R+="}";return R;}}var j1,k1,l1,m1=o(),n1=j.getSetting('ovpCardProperties');if(v){for(var o1 in m1){if((j1=m1[o1].reference)&&m1[j1]){var p1=q.extend(true,{},m1[j1]);m1[o1]=p1;}if(m1[o1].default.type==Q[1].toLowerCase()||(m1[o1].time&&m1[o1].time.type==Q[1].toLowerCase())){k1=m1[o1];break;}}var q1=V.hasTimeSemantics(v,k1,O,d1);if(q1){k1=k1.time;}else{k1=k1.default;}l1=n1.getProperty('/dataStep');if(!l1){if(k1.resize&&k1.resize.hasOwnProperty('dataStep')){l1=k1.resize.dataStep;n1.setProperty('/dataStep',l1);}}}if(n1.getProperty('/layoutDetail')==='resizable'){var r1=n1.getProperty('/cardLayout/colSpan');a1=+a1+ +l1*(r1-1);}var s1=n1.getProperty('/parameters');Z=Z||!!s1;if(Z){var t1=a.resolveParameterizedEntitySet(O,k,S,s1);R+="path: '"+t1+"'";}else{R+="path: '/"+k.name+"'";}var u1=[];if(!j||!j.getSetting('ovpCardProperties')){q.sap.log.error(f.ANALYTICAL_CONFIG_ERROR);R+="}";return R;}d1=j.getSetting('ovpCardProperties').getProperty("/entitySet");if(!O||!d1){return R;}var v1=w(O,d1);b1=j.getSetting('ovpCardProperties').getProperty("/filters");if(Y){q.each(S.SelectOptions,function(){var d=this.PropertyName.PropertyPath;q.each(this.Ranges,function(){if(this.Sign.EnumMember==="com.sap.vocabularies.UI.v1.SelectionRangeSignType/I"){var m=s(this.Low);var E1=this.High&&this.High.String;m=J(v1,d,m);var F1={path:d,operator:this.Option.EnumMember.split("/")[1],value1:m};if(E1){F1.value2=J(v1,d,E1);}u1.push(F1);}});});}if(b1&&b1.length>0){u1=u1.concat(b1);}if(u1.length>0){R+=", filters: "+JSON.stringify(u1);}if($){var w1=P.SortOrder;if(!w1.length){w1=U.getSortAnnotationCollection(O,P,k);}if(w1.length<1){q.sap.log.warning(f.CARD_WARNING+f.SORTORDER_WARNING);}else{var x1="";var y1;var z1;var A1;for(var i=0;i<w1.length;i++){y1=w1[i];A1=y1.Property.PropertyPath;X.push(A1);if(typeof y1.Descending=="undefined"){z1='true';}else{var B1=y1.Descending.Bool||y1.Descending.Boolean;if(!B1){q.sap.log.warning(f.CARD_WARNING+f.BOOLEAN_ERROR);z1='true';}else{z1=B1.toLowerCase()=='true'?'true':'false';}}x1=x1+"{path: '"+A1+"',descending: "+z1+"},";}R+=", sorter: ["+x1.substring(0,x1.length-1)+"]";}}var C1=j.getSetting("ovpCardProperties").getProperty("/entityType");q.each(M,function(i,m){c1=m.Measure.PropertyPath;if(m.DataPoint&&m.DataPoint.AnnotationPath){var d=C1[m.DataPoint.AnnotationPath.substring(1)];if(d&&d.ForecastValue&&d.ForecastValue.PropertyPath){W.push(d.ForecastValue.PropertyPath);}if(d&&d.TargetValue&&d.TargetValue.PropertyPath){W.push(d.TargetValue.PropertyPath);}}W.push(c1);if(v1&&v1[c1]){if(v1[c1][f1]){if(v1[c1][f1].String&&c1!=v1[c1][f1].String){W.push(v1[c1][f1].String?v1[c1][f1].String:c1);}else if(v1[c1][f1].Path&&c1!=v1[c1][f1].Path){W.push(v1[c1][f1].Path?v1[c1][f1].Path:c1);}}else if(v1[c1][e1]&&c1!=v1[c1][e1]){W.push(v1[c1][e1]?v1[c1][e1]:c1);}}if(v1&&v1[c1]){var E1;if(v1[c1][h1]){E1=v1[c1][h1].Path?v1[c1][h1].Path:v1[c1][h1].String;}else if(v1[c1][i1]){E1=v1[c1][i1].Path?v1[c1][i1].Path:v1[c1][i1].String;}else if(v1[c1][g1]){E1=v1[c1][g1];}if(E1){if(q.inArray(E1,W)===-1){W.push(E1);}}}});q.each(v,function(i,d){c1=d.Dimension.PropertyPath;T.push(c1);if(v1&&v1[c1]){if(v1[c1][f1]){if(v1[c1][f1].String&&c1!=v1[c1][f1].String){T.push(v1[c1][f1].String?v1[c1][f1].String:c1);}else if(v1[c1][f1].Path&&c1!=v1[c1][f1].Path){T.push(v1[c1][f1].Path?v1[c1][f1].Path:c1);}}else if(v1[c1][e1]&&c1!=v1[c1][e1]){T.push(v1[c1][e1]?v1[c1][e1]:c1);}}});R+=", parameters: {select:'"+[].concat(T,W).join(",");if(X.length>0){R+=","+X.join(",");}R+="'";var D1=[];q.each(T,function(i,d){var m=d.indexOf("/");if(m>0){var E1=d.split("/");E1.splice(-1,1);E1=E1.join("/");D1.push(E1);}});if(D1.length>0){R+=", expand:'"+D1.join(",")+"'";}R+="}";if(Q&&(Q[1]==='Donut')&&(v===undefined)){R+=", length: 1";}else if(Q&&(Q[1]==='Donut')&&(v)&&a1){R+=", length: "+(parseInt(a1,10)+1);}else if(a1){R+=", length: "+a1;}R+="}";return R;}g.requiresIContext=true;function h(){var d={locale:function(){},format:function(v,i){var j="";if(i){j=i.split('/');}if(j.length>0){var m,k;if(j.length==3){m=Number(j[1]);k=Number(j[2]);if(isNaN(m)){m=-1;}if(isNaN(k)){k=0;}}else{m=2;k=0;}if(j[0]=="axisFormatter"||(j[0]=="ShortFloat")){var x;x=N.getFloatInstance({style:'short',minFractionDigits:m,maxFractionDigits:m});if(j[0]=="ShortFloat"){x=N.getFloatInstance({style:'short',minFractionDigits:m,maxFractionDigits:m});}if(m===-1){x=N.getFloatInstance({style:'short'});}return x.format(Number(v));}else if(j[0]==="tooltipNoScaleFormatter"){var M=N.getFloatInstance({style:'short',currencyCode:false,shortRefNumber:k,showScale:false,minFractionDigits:m,maxFractionDigits:m});if(m===-1){M=N.getCurrencyInstance({style:'short',currencyCode:false});}return M.format(Number(v));}else if(j[0]=="CURR"){var O=N.getCurrencyInstance({style:'short',currencyCode:false,minFractionDigits:m,maxFractionDigits:m});if(m===-1){O=N.getCurrencyInstance({style:'short',currencyCode:false});}return O.format(Number(v));}else if(j[0].search("%")!==-1){var P=N.getPercentInstance({style:'short',minFractionDigits:m,maxFractionDigits:m});if(m===-1){P=N.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1});}v=P.format(Number(v));return v;}}if(v.constructor===Date){var Q=D.getDateTimeInstance({pattern:i});if(i==="YearMonthDay"){Q=D.getDateInstance({style:"medium"});}v=Q.format(new Date(v));}return v;}};b.numericFormatter(d);}function l(d,i,j,m,k,v){m=typeof m==="undefined"?false:m;var x=false;var M;if(!d&&m){q.sap.log.error(k+f.CARD_ERROR+j+f.IS_MANDATORY);return x;}if(!d){q.sap.log.warning(k+f.CARD_WARNING+j+f.IS_MISSING);x=true;return x;}M=i[d];if(!M||typeof M!=="object"){var O=m?q.sap.log.error:q.sap.log.warning;O(k+f.CARD_ERROR+"in "+j+". ("+d+" "+f.NOT_WELL_FORMED);return x;}if(v&&v=="sap.ovp.cards.charts.analytical.analyticalChart"&&j=="Chart Annotation"&&(!M.ChartType||!M.ChartType.EnumMember)){q.sap.log.error(k+f.CARD_ERROR+f.MISSING_CHARTTYPE+f.CHART_ANNO);return x;}x=true;return x;}function n(d){var i=false;if(!d){return i;}var j;var k;var m;var v;var x;var P;var M;var O="";var Q;var R=d.getView();if(R){O="["+R.getId()+"] ";}if(!(Q=d.getCardPropertiesModel())){q.sap.log.error(O+f.CARD_ERROR+"in "+f.CARD_CONFIG+f.NO_CARD_MODEL);return i;}M=Q.getProperty("/entityType");if(!M||q.isEmptyObject(M)){q.sap.log.error(O+f.CARD_ERROR+"in "+f.CARD_ANNO);return i;}j=Q.getProperty("/selectionAnnotationPath");k=Q.getProperty("/chartAnnotationPath");v=Q.getProperty("/presentationAnnotationPath");x=Q.getProperty("/identificationAnnotationPath");P=Q.getProperty("/dataPointAnnotationPath");m=Q.getProperty("/contentFragment");i=l(j,M,"Selection Variant",false,O);i=l(k,M,"Chart Annotation",true,O,m)&&i;i=l(v,M,"Presentation Variant",false,O)&&i;i=l(x,M,"Identification Annotation",true,O)&&i;i=l(P,M,"Data Point",false,O)&&i;return i;}function o(d){return U.getConfig(d);}function p(d,j,k,m){var v=false;var M;var x;var O;var P;var Q;var R;if(!j.time||q.isEmptyObject(j.time)){return v;}if(!d){return v;}if(!d[0].Dimension||!(x=d[0].Dimension.PropertyPath)){return v;}M=w(k,m);for(var i=0;i<d.length;i++){if(d[i]&&d[i].Dimension&&d[i].Dimension.PropertyPath){x=d[i].Dimension.PropertyPath;}if(M&&M[x]){O=M[x][e.TYPE_KEY];P=M[x][e.DISPLAY_FORMAT_KEY];Q=M[x][e.SEMANTICS_KEY];R=M[x]["com.sap.vocabularies.Common.v1.IsCalendarYear"];}if(O&&P&&O.lastIndexOf("Edm.Date",0)===0&&P.toLowerCase()=="date"){v=true;return v;}if(O=="Edm.String"&&(R||Q&&Q.lastIndexOf("year",0)===0)){v=true;return v;}}return v;}function r(i,d,j){var k="";var m=o(d);var v,x;if(!m){return k;}k=m.default.type;v=i.getSetting("dataModel");x=i.getSetting('ovpCardProperties').getProperty("/entitySet");if(p(j,m,v,x)){k=m.time.type;}return k;}r.requiresIContext=true;function s(v){var d;if(v){if(v.String){d=v.String;}else if(v.Boolean||v.Bool){d=t(v);}else{d=u(v);}}return d;}function t(v,d){if(v&&v.Boolean){if(v.Boolean.toLowerCase()==="true"){return true;}else if(v.Boolean.toLowerCase()==="false"){return false;}}else if(v&&v.Bool){if(v.Bool.toLowerCase()==="true"){return true;}else if(v.Bool.toLowerCase()==="false"){return false;}}return d;}function u(v){var d;if(v){if(v.String){d=Number(v.String);}else if(v.Int){d=Number(v.Int);}else if(v.Decimal){d=Number(v.Decimal);}else if(v.Double){d=Number(v.Double);}else if(v.Single){d=Number(v.Single);}}return d;}function w(m,d){var i=U.cacheODataMetadata(m);if(!i){return undefined;}return i[d];}function y(v,d){v.attachSelectData(function(m){var M=v.getModel('ovpCardProperties');var O=v.getModel();var P=M.getProperty("/entitySet");var Q=w(O,P);var R=[],S=[];var T={},W={};var X=v.getDataset().getDimensions();var Y;for(var i=0;i<X.length;i++){R.push(X[i].getIdentity());}var Z=q.map(v.getDataset()._getDataContexts(),function(x){return x.getObject();});if(m.getParameter("data")&&m.getParameter("data")[0]&&m.getParameter("data")[0].data){Y=m.getParameter("data")[0].data._context_row_number;if(Z[Y].$isOthers&&Z[Y].$isOthers==true){var $={$isOthers:true};var _={getObject:function(){return $;}};d.doNavigation(_);}else{S=Object.keys(m.getParameter("data")[0].data);for(var j=0;j<R.length;j++){for(var k=0;k<S.length;k++){if(R[j]==S[k]){T[R[j]]=Z[Y][R[j]];}for(var a1 in Z[Y]){if(Q.hasOwnProperty(a1)){W[a1]=Z[Y][a1];}}}}var _={getObject:function(){return T;},getAllData:function(){return W;}};d.doNavigation(_);}}});}function z(d){if(d.EnumMember.endsWith("Bubble")){return true;}else{return false;}}function A(d){var i=false;if(!d||d.constructor!=Array||d.length<1||d[0].constructor!=Object||!d[0].Dimension||!d[0].Dimension.PropertyPath){q.sap.log.error(f.CHART_ANNO_ERROR+"in "+f.CHART_ANNO+" "+f.DIMENSIONS_MANDATORY);return i;}i=true;return i;}function B(m){var d=false;if(!m||m.constructor!=Array||m.length<1||m[0].constructor!=Object||!m[0].Measure||!m[0].Measure.PropertyPath){q.sap.log.error(f.CHART_ANNO_ERROR+"in "+f.CHART_ANNO+" "+f.MEASURES_MANDATORY);return d;}d=true;return d;}function E(d){return d.name;}function F(d){if(d&&d.indexOf("#")!=-1){var i=d.split("#");if(i.length>1){return i[1];}}return"";}function G(d,k,m){function v(P1,Q1,R1){var S1=Q1.split('.');var d1=S1.pop();var T1=S1.reduce(function(U1,V1){if(U1[V1]===undefined){U1[V1]={};}return U1[V1];},P1);if(R1){T1[d1]=R1;}return T1[d1];}var x,M,O,P;var Q,R,S,T,W,X,Y;var Z;var $;var _;var a1=[],b1=[];var c1=d.getChart();Q=c1.getChartType();R=o();for(var d1 in R){if(($=R[d1].reference)&&R[$]){var e1=q.extend(true,{},R[$]);R[d1]=e1;}if(R[d1].default.type==Q||(R[d1].time&&R[d1].time.type==Q)){S=R[d1];break;}}if(!S){q.sap.log.error(f.CARD_ERROR+"in "+f.CARD_CONFIG+f.CARD_CONFIG_ERROR+Q+" "+f.CARD_CONFIG_JSON);return;}if(!(x=d.getModel('ovpCardProperties'))){q.sap.log.error(f.CARD_ERROR+"in "+f.CARD_CONFIG+f.NO_CARD_MODEL);return;}var f1=d.getModel();var g1=x.getProperty("/entitySet");if(!f1||!g1){return;}M=x.getProperty("/entityType");if(!M){q.sap.log.error(f.CARD_ANNO_ERROR+"in "+f.CARD_ANNO);return;}var h1=w(f1,g1);O=x.getProperty("/chartAnnotationPath");if(!O||!(P=M[O])){q.sap.log.error(f.CARD_ANNO_ERROR+"in "+f.CARD_ANNO);return;}if(!(T=P.DimensionAttributes)||!T.length){q.sap.log.error(f.CHART_ANNO_ERROR+"in "+f.CHART_ANNO+" "+f.DIMENSIONS_MANDATORY);return;}var i1;if(!(W=P.MeasureAttributes)||!W.length){q.sap.log.error(f.CHART_ANNO_ERROR+"in "+f.CHART_ANNO+" "+f.MEASURES_MANDATORY);return;}else{var j1=W[0].DataPoint?M[W[0].DataPoint.AnnotationPath.substring(1)]:null;var k1=j1&&j1.NumberFormat&&j1.NumberFormat.NumberOfFractionalDigits&&j1.NumberFormat.NumberOfFractionalDigits.Int;i1=k1?k1:0;}Y=T.slice();X=W.slice();var l1,m1;for(var i=0;i<Y.length;i++){var n1=Y[i];if(n1&&n1.Dimension&&n1.Dimension.PropertyPath){l1=n1.Dimension.PropertyPath;if(h1&&h1[l1]){if(h1[l1][e.LABEL_KEY_V4]){m1=h1[l1][e.LABEL_KEY_V4].String?h1[l1][e.LABEL_KEY_V4].String:h1[l1][e.LABEL_KEY_V4].Path;}else if(h1[l1][e.LABEL_KEY]){m1=h1[l1][e.LABEL_KEY];}else if(l1){m1=l1;}b1.push(m1);}}}for(var j=0;j<X.length;j++){var o1=X[j];if(o1&&o1.Measure&&o1.Measure.PropertyPath){l1=o1.Measure.PropertyPath;if(h1&&h1[l1]){if(h1[l1][e.LABEL_KEY_V4]){m1=h1[l1][e.LABEL_KEY_V4].String?h1[l1][e.LABEL_KEY_V4].String:h1[l1][e.LABEL_KEY_V4].Path;}else if(h1[l1][e.LABEL_KEY]){m1=h1[l1][e.LABEL_KEY];}else if(l1){m1=l1;}a1.push(m1);}}}Z=p(T,S,f1,g1);if(Z){S=S.time;}else{S=S.default;}var p1=false;var q1=i1>0?"tooltipNoScaleFormatter/"+i1.toString()+"/":'tooltipNoScaleFormatter/-1/';var r1=new c({formatString:q1});r1.connect(c1.getVizUid());if(c1){var s1=c1.getVizProperties();var t1=true;if(S.properties&&S.properties.hasOwnProperty("hideLabel")&&!S.properties["hideLabel"]){t1=false;}var u1=false;if(Q=='donut'){u1=true;}if(s1&&s1.plotArea&&s1.plotArea.dataLabel&&s1.plotArea.dataLabel.visible){s1.plotArea.dataLabel.visible=u1;}s1.title.visible=t1?false:true;_={legend:{isScrollable:false},valueAxis:{title:{visible:t1?false:true},label:{formatString:s1.valueAxis.label.formatString+(i1?"/"+i1+"/":"")}},categoryAxis:{title:{visible:t1?false:true}},plotArea:{window:{start:'firstDataPoint',end:'lastDataPoint'},dataLabel:{visible:u1,type:'value'}},interaction:{selectability:{legendSelection:false,axisLabelSelection:false,mode:'EXCLUSIVE',plotLassoSelection:false,plotStdSelection:true},zoom:{enablement:'disabled'}}};var v1=x.getProperty("/colorPalette");var w1;if(P.ChartType.EnumMember===V.constants.COLUMNSTACKED_CHARTTYPE&&v1&&v1.length===4){q.each(T,function(i,P1){if(P1&&P1.Role&&P1.Role.EnumMember=="com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Series"){w1=P1.Dimension&&P1.Dimension.PropertyPath;return;}});var x1;if(w1){var y1=d.getChart();if(w1&&!m.bSorterSetForCustomCharts){var z1=y1.getBinding("data");if(z1){z1.sort([new sap.ui.model.Sorter(w1,true)]);m.bSorterSetForCustomCharts=true;}}if(h1&&h1[w1]){if(h1[w1][e.LABEL_KEY_V4]){x1=h1[w1][e.LABEL_KEY_V4].String?h1[w1][e.LABEL_KEY_V4].String:h1[w1][e.LABEL_KEY_V4].Path;}else if(h1[w1][e.LABEL_KEY]){x1=h1[w1][e.LABEL_KEY];}else if(w1){x1=w1;}}var A1=v1.map(function(P1){return P1.color;});var B1=v1.map(function(P1){return P1.legendText;});var C1=sap.ui.getCore().getLibraryResourceBundle("sap.ovp");var D1=B1[0]!=undefined?B1[0]:C1.getText("OTHERS");var E1=B1[1]!=undefined?B1[1]:C1.getText("BAD");var F1=B1[2]!=undefined?B1[2]:C1.getText("CRITICAL");var G1=B1[3]!=undefined?B1[3]:C1.getText("GOOD");_.plotArea.dataPointStyle={rules:[{callback:function(m){if((m&&(m[x1]==="3"||m[x1]===3))||(m&&(m[w1]==="3"||m[w1]===3))){return true;}},properties:{color:A1[3]},"displayName":G1},{callback:function(m){if((m&&(m[x1]==="2"||m[x1]===2))||(m&&(m[w1]==="2"||m[w1]===2))){return true;}},properties:{color:A1[2]},"displayName":F1},{callback:function(m){if((m&&(m[x1]==="1"||m[x1]===1))||(m&&(m[w1]==="1"||m[w1]===1))){return true;}},properties:{color:A1[1]},"displayName":E1},{callback:function(m){if((m&&(m[x1]==="0"||m[x1]===0))||(m&&(m[w1]==="0"||m[w1]===0))){return true;}},properties:{color:A1[0]},"displayName":D1}]};}}if(P.ChartType.EnumMember===e.SCATTER_CHARTTYPE||P.ChartType.EnumMember===e.BUBBLE_CHARTTYPE||P.ChartType.EnumMember===e.LINE_CHARTTYPE){if(P&&P.AxisScaling&&P.AxisScaling.EnumMember){var H1=P.AxisScaling.EnumMember.substring(P.AxisScaling.EnumMember.lastIndexOf('/')+1,P.AxisScaling.EnumMember.length);switch(H1){case"AdjustToDataIncluding0":_.plotArea.adjustScale=false;break;case"AdjustToData":_.plotArea.adjustScale=true;break;case"MinMaxValues":var I1=[];if(P["MeasureAttributes"][0]&&P["MeasureAttributes"][0].DataPoint&&P["MeasureAttributes"][0].DataPoint.AnnotationPath){var J1=P["MeasureAttributes"][0].DataPoint.AnnotationPath;var K1=J1.substring(J1.lastIndexOf('@')+1,J1.length);if(M&&M[K1]){var L1=M[K1];if(L1&&L1.MaximumValue&&L1.MaximumValue.Decimal&&L1.MinimumValue&&L1.MinimumValue.Decimal){I1.push({feed:"valueAxis",max:L1.MaximumValue.Decimal,min:L1.MinimumValue.Decimal});}else{q.sap.log.error(f.ERROR_MISSING_AXISSCALES);}}}if(P.ChartType.EnumMember!==e.LINE_CHARTTYPE&&P["MeasureAttributes"][1]&&P["MeasureAttributes"][1].DataPoint&&P["MeasureAttributes"][1].DataPoint.AnnotationPath){var J1=P["MeasureAttributes"][1].DataPoint.AnnotationPath;var K1=J1.substring(J1.lastIndexOf('@')+1,J1.length);if(M&&M[K1]){var L1=M[K1];if(L1&&L1.MaximumValue&&L1.MaximumValue.Decimal&&L1.MinimumValue&&L1.MinimumValue.Decimal){I1.push({feed:"valueAxis2",max:L1.MaximumValue.Decimal,min:L1.MinimumValue.Decimal});}else{q.sap.log.error(f.ERROR_MISSING_AXISSCALES);}}}c1.setVizScales(I1);break;default:break;}}}var M1=x.getProperty('/ChartProperties');if(S.hasOwnProperty('vizProperties')){var N1=S.vizProperties;for(var i=0;i<N1.length;i++){if(M1&&N1[i].hasOwnProperty('path')){var O1=v(M1,N1[i].path);if(undefined!==O1){v(_,N1[i].path,O1);}}}}c1.setVizProperties(_);}[S.dimensions,S.measures].forEach(function(P1,i){var Q1=i?W:T;var R1=i?"measure(s)":"dimension(s)";if(P1.min&&Q1.length<P1.min){q.sap.log.error(f.CARD_ERROR+"in "+Q+" "+f.CARD_LEAST+P1.min+" "+R1);p1=true;}if(P1.max&&Q1.length>P1.max){q.sap.log.error(f.CARD_ERROR+"in "+Q+f.CARD_MOST+P1.max+" "+R1);p1=true;}});if(p1){return;}H(a1,b1,k);if(d){if(d._headerText){d._headerText.setTooltip(d.getHeader());d._headerText.addStyleClass("ovpChartTitle");}}}function H(m,d,j){var k="",v="",x="";if(j){k=j.getText();}if(m&&(m.length>1)){for(var i=0;i<m.length-1;i++){if(v!=""){v+=", ";}v+=m[i];}v=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("MEAS_DIM_TITLE",[v,m[i]]);}else if(m){v=m[0];}if(d&&(d.length>1)){for(var i=0;i<d.length-1;i++){if(x!=""){x+=", ";}x+=d[i];}x=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("MEAS_DIM_TITLE",[x,d[i]]);}else if(d){x=d[0];}if(j&&(k=="")){k=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("NO_CHART_TITLE",[v,x]);j.setText(k);j.data("aria-label",k,true);}}function I(m,M){var d;q.each(M,function(i,v){if(v.name==m){if(v["com.sap.vocabularies.Common.v1.Label"]){d=v["com.sap.vocabularies.Common.v1.Label"].String?v["com.sap.vocabularies.Common.v1.Label"].String:v["com.sap.vocabularies.Common.v1.Label"].Path;}else if(v["sap:label"]){d=v["sap:label"];}return false;}});return d;}function J(m,P,v){var d=e.TYPE_KEY;if(!m||!m[P]||!m[P][d]){return v;}var i=["Edm.Int","Edmt.Int16","Edm.Int32","Edm.Int64","Edm.Decimal"];var j=m[P][d];if(q.inArray(j,i)!==-1){return Number(v);}return v;}function K(S){var d=S.getModel('ovpCardProperties'),i=d.getProperty("/entityType"),j=d.getProperty("/presentationAnnotationPath"),k=i.hasOwnProperty(j)&&i[j],m=k&&k.MaxItems;if(m){return{itemsLength:+(m.Int32?m.Int32:m.Int),dataStep:+d.getProperty("/dataStep")};}}function L(S,d){S.attachDataReceived(function(j){var k=d.getView().byId("ovpCT1");var m=S._getVizFrame();var x=d.getView().byId("bubbleText");var M=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("BUBBLESIZE");if(m){if(x!=undefined){var O=m.getFeeds();q.each(O,function(i,v){if(O[i].getUid()=="bubbleWidth"){var P=d.getEntitySet()&&d.getEntitySet().name;var Q=m.getModel();var R=w(Q,P);var T=O[i].getValues()&&O[i].getValues()[0]&&O[i].getValues()[0].getName();var W=I(T,R);x.setText(M+" "+W);}});}}if(!d.isVizPropSet){G(S,k,d);d.isVizPropSet=true;}});}return{getSapLabel:I,buildSmartAttributes:G,errorMessages:f,formatItems:g,formatChartAxes:h,checkExists:l,validateCardConfiguration:n,getConfig:o,hasTimeSemantics:p,getChartType:r,getPrimitiveValue:s,getMetadata:w,getSelectedDataPoint:y,checkBubbleChart:z,dimensionAttrCheck:A,measureAttrCheck:B,getEntitySet:E,getAnnotationQualifier:F,formatByType:J,getMaxItems:K,attachDataReceived:L};},true);
