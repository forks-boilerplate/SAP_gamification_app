sap.ui.define(["sap/ovp/cards/generic/Card.controller","jquery.sap.global","sap/ui/model/json/JSONModel","sap/ovp/cards/OVPCardAsAPIUtils","sap/ovp/cards/CommonUtils","sap/ovp/cards/AnnotationHelper"],function(C,q,J,O,a,A){"use strict";return C.extend("sap.ovp.cards.list.List",{counter:0,arrayLength:0,minMaxModel:{},onInit:function(){C.prototype.onInit.apply(this,arguments);this.counter=0;this.minMaxModel=new J();this.minMaxModel.setData({minValue:0,maxValue:0});this.getView().setModel(this.minMaxModel,"minMaxModel");},onContactDetailsLinkPress:function(e){var p,s,b;s=e.getSource();p=s.getParent().getAggregation("items")[0];b=s.getBindingContext();if(!b){return;}p.bindElement(b.getPath());p.openBy(s);},onAfterRendering:function(){C.prototype.onAfterRendering.apply(this,arguments);var i=this.getCardPropertiesModel().getProperty("/imageSupported");var d=this.getCardPropertiesModel().getProperty("/densityStyle");if(i){var b=this.byId('ovpList');b.attachUpdateFinished(function(){var l=this.byId('ovpList');var f=l.getItems();var g=false;var j=l.getDomRef().getAttribute("class");if(d==="cozy"){j=j+" sapOvpListImageCozy";}else{j=j+" sapOvpListImageCompact";}l.getDomRef().setAttribute("class",j);f.forEach(function(k){if(k.getIcon().indexOf("icon")!=-1){g=true;}});f.forEach(function(k){var m=k.getDomRef();var n;if(m&&m.children[0]&&m.children[0].children[0]){n=m.children[0].children[0];}var o=k.getDescription();var p=k.getIcon();var t=g;var r=k.getTitle();var u=r.split(' ').map(function(x){return x?x[0].toUpperCase():"";}).join('').substring(0,2);if(p!=""&&p.indexOf("icon")==-1){g=false;}if(g&&m.children[0]){q(m.children[0]).addClass("sapOvpIconListItem");}else if(m.children[0]){q(m.children[0]).addClass("sapOvpImageListItem");}if(n&&d==="cozy"&&g===false){if(n){var j=n.getAttribute("class");j=j+" sapOvpImageCozy";n.setAttribute("class",j);}}var v="";if(g===true&&o===""){v=d==="compact"?"sapOvpListWithIconNoDescCompact":"sapOvpListWithIconNoDescCozy";}else if(g===false&&o===""){v=d==="compact"?"sapOvpListWithImageNoDescCompact":"sapOvpListWithImageNoDescCozy";}else{v=d==="compact"?"sapOvpListWithImageIconCompact":"sapOvpListWithImageIconCozy";}k.addStyleClass(v);if(m&&m.children[0]&&p===""&&m.children[0].id!=="ovpIconImagePlaceHolder"){var w=document.createElement('div');w.innerHTML=u;w.setAttribute("id","ovpIconImagePlaceHolder");w.className=g===true?"sapOvpIconPlaceHolder":"sapOvpImagePlaceHolder";if(g===false&&d==="cozy"){w.className=w.className+" sapOvpImageCozy";}m.insertBefore(w,m.children[0]);}g=t;});}.bind(this));}if(!O.checkIfAPIIsUsed(this)&&this.getCardPropertiesModel().getProperty("/layoutDetail")==="resizable"){var c=this.oDashboardLayoutUtil.dashboardLayoutModel.getCardById(this.cardId);var h=Math.max(c.dashboardLayout.headerHeight,this.getHeaderHeight());var s=this.oDashboardLayoutUtil.getCardDomId(this.cardId);var e=document.getElementById(s);if(!c.dashboardLayout.autoSpan){e.getElementsByClassName('sapOvpWrapper')[0].style.height=(c.dashboardLayout.rowSpan*this.oDashboardLayoutUtil.ROW_HEIGHT_PX)-(h+2*this.oDashboardLayoutUtil.CARD_BORDER_PX)+"px";}if(c.dashboardLayout.showOnlyHeader){e.classList.add("sapOvpMinHeightContainer");}}},onListItemPress:function(e){if(O.checkIfAPIIsUsed(this)){a.onContentClicked(e);}else{var n=this.getEntityNavigationEntries(e.getSource().getBindingContext(),this.getCardPropertiesModel().getProperty("/annotationPath"));this.doNavigation(e.getSource().getBindingContext(),n[0]);}},_getMinMaxObjectFromContext:function(n){this.counter++;var e=this.getEntityType(),s=this.getCardPropertiesModel().getProperty("/annotationPath"),r=e[s],c=this.getMetaModel().createBindingContext(e.$path+"/"+s),m={minValue:0,maxValue:0};if(A.isFirstDataPointPercentageUnit(c,r)){m.minValue=0;m.maxValue=100;return m;}var d=A.getFirstDataPointValue(c,r),b=this.getView().byId("ovpList"),l=b.getBinding("items"),M=this.getModel(),f=l.getCurrentContexts();for(var i=0;n?i<n:i<f.length;i++){var o=M.getOriginalProperty(d,f[i]),g=parseFloat(o,10);if(g<m.minValue){m.minValue=g;}else if(g>m.maxValue){m.maxValue=g;}}return m;},_updateMinMaxModel:function(n){var m=this._getMinMaxObjectFromContext(n);this.minMaxModel.setData({minValue:m.minValue,maxValue:m.maxValue});this.minMaxModel.refresh();return m;},returnBarChartValue:function(v){var m=this._updateMinMaxModel();var V=parseFloat(v,10);if(V!==0){return V;}else if(m.maxValue==0&&m.minValue<-10){return-0.1;}else if(m.minValue==0&&m.maxValue>10){return 0.1;}return V;},getCardItemsBinding:function(){var l=this.getView().byId("ovpList");return l.getBinding("items");},getCardItemBindingInfo:function(){var l=this.getView().byId("ovpList");return l.getBindingInfo("items");},resizeCard:function(n,c){var N,i,h;try{var $=document.getElementById(this.oDashboardLayoutUtil.getCardDomId(this.cardId)),b=this.getCardItemBindingInfo(),H=this.getHeaderHeight(),o=this.getView().byId('ovpCardContentContainer').getDomRef();if(n.showOnlyHeader){o.classList.add('sapOvpContentHidden');N=0;}else{o.classList.remove('sapOvpContentHidden');h=H+c.dropDownHeight;i=n.rowSpan*n.iRowHeightPx-h;N=Math.abs(Math.floor(i/c.itemHeight));$.style.height=n.rowSpan*n.iRowHeightPx+'px';}o.style.height=(n.rowSpan*n.iRowHeightPx)-(H+2*n.iCardBorderPx)+"px";if(N!==b.length){b.length=N;n.noOfItems=b.length;this._updateMinMaxModel(b.length);this.getCardItemsBinding().refresh();}}catch(e){q.sap.log.warning("OVP resize: "+this.cardId+" catch "+e.toString());}}});});
