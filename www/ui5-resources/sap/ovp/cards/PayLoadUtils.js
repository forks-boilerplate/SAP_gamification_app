/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(['jquery.sap.global','sap/ovp/cards/rta/SettingsDialogConstants'],function(q,S){"use strict";function g(i,j,k,E){return i+"_sap.ovp.cards."+j+"."+k+"."+E;}function c(V){return{"type":"XTIT","maxLength":40,"value":{"":V}};}function a(i,I,j){var k=i+"["+I+"]";if(j){k+="/"+j;}return k;}function s(j,M){var k=M._getCardsModel();for(var i=0;i<k.length;i++){if(k[i].id===j){return true;}}return false;}function b(i,j,k){var E={"propertyPath":i,"operation":j};if(k){E["propertyValue"]=k;}return E;}function f(j){delete j.id;delete j.dashboardLayout;delete j.settings.baseUrl;delete j.settings.cloneCard;delete j.settings.newCard;delete j["customer.settings"];delete j["vendor.settings"];if(j.settings["staticContent"]){for(var i=0;i<j.settings["staticContent"].length;i++){delete j.settings["staticContent"][i].id;}}}function d(i,O,N){if(N==="customer.settings"&&O){P.aEntityPropertyChange.push(b("vendor.settings","UPSERT",O.settings));i["vendor.settings"]=O.settings;}}function e(N,i,O,j){if(O){if(N==="customer.settings"){O[j]={operation:"DELETE"};}}else{if(N==="customer.settings"){P.aEntityPropertyChange.push(b(i,"UPSERT",{operation:"DELETE"}));}else{P.aEntityPropertyChange.push(b(i,"DELETE"));}}}function h(i){P.aEntityPropertyChange.push(b("customer.settings","UPSERT",i["customer.settings"]));}function l(i,j,k,V,O){var I=g(P.sApplicationId,P.sCardId,i,k),E=j+"/"+k;if(!P.oText){P.oText={};}P.oText[I]=c(V);if(O){O[k]="{{"+I+"}}";}else{P.aEntityPropertyChange.push(b(E,"UPSERT","{{"+I+"}}"));}}function m(N,j,T,O){var k=this._oCardManifestSettings,E=this._oOriginalCardManifestSettings;for(var i=0;i<T.length;i++){if((!E[T[i]]&&k[T[i]])||(E[T[i]]&&k[T[i]]&&(E[T[i]]!=k[T[i]]))){if(O){l(N,N,T[i],k[T[i]],j[N]);}else{l(N,N,T[i],k[T[i]]);}j.settings[T[i]]=k[T[i]];}else if(!k[T[i]]&&E[T[i]]){if(O){e(N,N+"/"+T[i],j[N],T[i]);}else{e(N,N+"/"+T[i]);}delete j.settings[T[i]];}}}function n(i,j,V,O){var k=i+"/"+j;if(O){O[j]=V;}else{P.aEntityPropertyChange.push(b(k,"UPSERT",V));}}function o(N,j,k,O){var E=this._oCardManifestSettings,F=this._oOriginalCardManifestSettings;for(var i=0;i<k.length;i++){if((!F[k[i]]&&E[k[i]])||(F[k[i]]&&E[k[i]]&&(F[k[i]]!=E[k[i]]))){if(O){n(N,k[i],E[k[i]],j[N]);}else{n(N,k[i],E[k[i]]);}j.settings[k[i]]=E[k[i]];}else if(!E[k[i]]&&F[k[i]]){if(O){e(N,N+"/"+k[i],j[N],k[i]);}else{e(N,N+"/"+k[i]);}delete j.settings[k[i]];}}}function p(N,i){var j=S.cardSettings["settings"],T=S.cardSettings["text"];if(N==="customer.settings"){if(i["customer.settings"]){m.bind(this)(N,i,T,false);o.bind(this)(N,i,j,false);}else{i["customer.settings"]={};m.bind(this)(N,i,T,true);o.bind(this)(N,i,j,true);h(i);}}else{m.bind(this)(N,i,T,false);o.bind(this)(N,i,j,false);}}function r(N,k,E,T,F,O){var G=this._oCardManifestSettings[F];for(var i=0;i<G.length;i++){for(var j=0;j<T.length;j++){if(G[i][T[j]]){var H=a(N+"/"+F,i),I=N+"."+F+"."+i;if(O){l(I,H,T[j],G[i][T[j]],k[N][F][i]);}else{l(I,H,T[j],G[i][T[j]],E[i]);}}}}if(!O){n(N,F,E);}}function t(j,T){var O=S.cardSettingsArrayLevel[T]["onlyTabLevelProps"],F=false;for(var i=0;O&&i<O.length;i++){if(O[i]===j){F=true;break;}}return F;}function u(N,j,T,k,E,O){var F=this._oCardManifestSettings,i;for(i=0;i<T.length;i++){if(F[T[i]]&&!t(T[i],E)){if(O){l(N,N,T[i],F[T[i]],j[N]);}else{l(N,N,T[i],F[T[i]]);}j.settings[T[i]]=F[T[i]];}}for(i=0;i<k.length;i++){if(F[k[i]]&&!t(k[i],E)){if(O){n(N,k[i],F[k[i]],j[N]);}else{n(N,k[i],F[k[i]]);}j.settings[k[i]]=F[k[i]];}}if(O){e(N,N+"/"+E,j[N],E);}else{e(N,N+"/"+E);}delete j.settings[E];}function v(N,j,k,T,E,F,O){var i;for(i=0;i<T.length;i++){if(j[N][T[i]]){if(O){e(N,N+"/"+T[i],j[N],T[i]);}else{e(N,N+"/"+T[i]);}delete j.settings[T[i]];}}for(i=0;i<E.length;i++){if(j[N][E[i]]){if(O){e(N,N+"/"+E[i],j[N],E[i]);}else{e(N,N+"/"+E[i]);}delete j.settings[E[i]];}}r.bind(this)(N,j,k,T,F,O);}function w(j,T){return q.map(q.extend(true,{},j),function(k){var E=S.cardSettingsArrayLevel[T]["text"],i,F=S.cardSettingsArrayLevel[T]["settings"],G={};for(i=0;i<E.length;i++){if(k[E[i]]){G[E[i]]=k[E[i]];}}for(i=0;i<F.length;i++){if(k[F[i]]){G[F[i]]=k[F[i]];}}return G;});}function x(N,i,j,k,T,O){var E=S.cardSettingsArrayLevel[T]["text"],F=S.cardSettingsArrayLevel[T]["settings"],G=w(j,T);if(j&&k){i.settings[T]=w(j,T);if(N==="customer.settings"){i[N][T]=w(j,T);}r.bind(this)(N,i,G,E,T,O);}else if(!j&&k){u.bind(this)(N,i,E,F,T,O);}else if(j&&!k){i.settings[T]=w(j,T);if(N==="customer.settings"){i[N][T]=w(j,T);}v.bind(this)(N,i,G,E,F,T,O);}}function y(N,i,O){var j=this._oCardManifestSettings["staticContent"],k=this._oOriginalCardManifestSettings["staticContent"],T=this._oCardManifestSettings["tabs"],E=this._oOriginalCardManifestSettings["tabs"];if(j||k){x.bind(this)(N,i,j,k,"staticContent",O);}else if(T||E){x.bind(this)(N,i,T,E,"tabs",O);}}function z(N,i){var j=S.cardSettingsForComplex["settings"],T=S.cardSettingsForComplex["text"];if(N==="customer.settings"){if(i["customer.settings"]){m.bind(this)(N,i,T,false);o.bind(this)(N,i,j,false);y.bind(this)(N,i,false);}else{i["customer.settings"]={};m.bind(this)(N,i,T,true);o.bind(this)(N,i,j,true);y.bind(this)(N,i,true);h(i);}}else{m.bind(this)(N,i,T,false);o.bind(this)(N,i,j,false);y.bind(this)(N,i,false);}}function A(N,i){var j=this._oCardManifestSettings["staticContent"],O=this._oOriginalCardManifestSettings["staticContent"],T=this._oCardManifestSettings["tabs"],k=this._oOriginalCardManifestSettings["tabs"];if(j||O||T||k){z.bind(this)(N,i);}else{p.bind(this)(N,i);}}function B(){var k=this._oCardManifestSettings["staticContent"],T=S.cardSettingsArrayLevel["staticContent"]["text"],i,j,E=S.cardSettingsArrayLevel["staticContent"]["settings"],F=this._oCardManifestSettings,G=S.cardSettingsForStaticLinkListCard,H={"template":"sap.ovp.cards.linklist","settings":{"staticContent":[]}};for(j=0;j<G.length;j++){if(F[G[j]]){H.settings[G[j]]=F[G[j]];}}for(j=0;j<k.length;j++){H.settings["staticContent"].push({});for(i=0;i<T.length;i++){if(k[j][T[i]]){H.settings["staticContent"][j][T[i]]=k[j][T[i]];}}for(i=0;i<E.length;i++){if(k[j][E[i]]){H.settings["staticContent"][j][E[i]]=k[j][E[i]];}}}return H;}function C(E,F,G){var T,i,j,k,H,I=G.settings["staticContent"],J=G.settings["tabs"];var K=S.cardSettingsWithText;for(i=0;i<K.length;i++){var L;if(typeof K[i]=="string"){if(G.settings[K[i]]){if(!T){T={};}L=g(E,F,"settings",K[i]);T[L]=c(G.settings[K[i]]);G.settings[K[i]]="{{"+L+"}}";}}else if(typeof K[i]=="object"){if(K[i].hasOwnProperty("staticContent")){if(I){for(j=0;j<I.length;j++){for(k=0;k<K[i]["staticContent"].length;k++){H=K[i]["staticContent"][k];if(I[j][H]){if(!T){T={};}L=g(E,F,"settings.staticContent."+j,H);T[L]=c(I[j][H]);G.settings["staticContent"][j][H]="{{"+L+"}}";}}}}}else if(K[i].hasOwnProperty("tabs")){if(J){for(j=0;j<J.length;j++){for(k=0;k<K[i]["tabs"].length;k++){H=K[i]["tabs"][k];if(J[j][H]){if(!T){T={};}L=g(E,F,"settings.tabs."+j,H);T[L]=c(J[j][H]);G.settings["tabs"][j][H]="{{"+L+"}}";}}}}}}}return T;}function D(i,T,F,O,V){var j={};j['appDescriptorChange']={'parameters':i};if(T){j['appDescriptorChange']['texts']=T;}if(O){j['flexibilityChange']={"newAppDescriptor":F,"oldAppDescriptor":O};}else{j['flexibilityChange']=F;}if(V){j['viewSwitchChange']=V;}return j;}var P={sApplicationId:"",sCardId:"",aEntityPropertyChange:[],oText:undefined,getPayLoadForEditCard:function(i){var j=i.oAppDescriptor.id,k={"cardId":j},T,E,F=q.extend(true,{},i.oAppDescriptor),O=q.extend(true,{},i.oAppDescriptor),N,V;N=(j.lastIndexOf("customer.",0)===0)?"settings":"customer.settings";P.sApplicationId=i.sApplicationId;P.sCardId=j;P.aEntityPropertyChange=[];P.oText=undefined;d(F,i.oOriginalAppDescriptor,N);A.bind(this)(N,F);T=q.extend(true,{},P.oText);E=P.aEntityPropertyChange;if(E.length===1){k["entityPropertyChange"]=E[0];}else{k["entityPropertyChange"]=E;}if(this._oCardManifestSettings["tabs"]){var G=this._oCardManifestSettings.defaultViewSelected,H=this._oOriginalCardManifestSettings.selectedKey;H=(H&&H>0)?H:1;if(G&&G>0&&G!==H){V={cardId:j,selectedKey:G,oldKey:H};}F.settings.selectedKey=G;}return D(k,T,F,O,V);},getPayLoadForCloneCard:function(j){return new Promise(function(k,E){var F={card:{}},T,G={},H=j.getComponentInstance().getComponentData(),M=H.mainComponent,I=M._getApplicationId(),J=q.extend(true,{},M._getCardFromManifest(H.cardId));var K="customer."+J.id,i=1;while(s(K+"_"+i,M)){i++;}K=K+"_"+i;f(J);G=q.extend(true,{},J);G.id=K;G.settings.title=G.settings.title+" "+i;J.settings.title=J.settings.title+" "+i;if(J.settings.defaultSpan&&J.settings.defaultSpan.showOnlyHeader){J.settings.defaultSpan.rows=12;}T=C(I,K,J);F.card[K]=J;k(D(F,T,G));});},getPayLoadForNewStaticLinkListCard:function(j){var k={card:{}},T,F={},M=j.oMainComponent,E=M._getApplicationId(),G=B.bind(this)();var H="customer.newStaticLinkListCard",i=1;while(s(H+"_"+i,M)){i++;}H=H+"_"+i;f(G);F=q.extend(true,{},G);F.id=H;T=C(E,H,G);k.card[H]=G;return D(k,T,F);}};return P;},true);
