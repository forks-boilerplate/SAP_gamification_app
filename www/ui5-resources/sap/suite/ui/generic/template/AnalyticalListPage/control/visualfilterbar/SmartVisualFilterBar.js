sap.ui.define(["sap/m/HeaderContainer","sap/suite/ui/generic/template/AnalyticalListPage/controller/VisualFilterDialogController","sap/ui/comp/odata/ODataModelUtil","sap/ui/comp/smartfilterbar/FilterProvider","sap/suite/ui/generic/template/AnalyticalListPage/control/visualfilterbar/VisualFilterProvider","sap/ui/comp/smartvariants/PersonalizableInfo","sap/ui/comp/smartvariants/SmartVariantManagement","sap/ui/model/Filter","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/ui/comp/odata/MetadataAnalyser","sap/suite/ui/generic/template/AnalyticalListPage/util/FilterUtil","sap/suite/ui/generic/template/AnalyticalListPage/util/V4Terms","sap/m/VBox","sap/m/Button","sap/m/Title","sap/suite/ui/generic/template/AnalyticalListPage/controller/DropDownController","sap/suite/ui/generic/template/AnalyticalListPage/control/visualfilterbar/FilterItemMicroBar","sap/suite/ui/generic/template/AnalyticalListPage/control/visualfilterbar/FilterItemMicroLine","sap/suite/ui/generic/template/AnalyticalListPage/control/visualfilterbar/FilterItemMicroDonut","sap/ui/model/json/JSONModel","sap/ui/core/CustomData","sap/m/Text","sap/m/OverflowToolbarLayoutData","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/model/SimpleType","sap/ui/core/library","sap/m/library"],function(H,V,O,F,a,P,S,b,c,T,M,d,e,f,B,g,D,h,k,l,J,C,m,n,o,p,q,r,s){"use strict";var t="Donut";var u="Line";var v="Bar";var w=q.extend("sap.ui.model.DimensionFilterType",{formatValue:function(i){return i;},parseValue:function(i){return i;},validateValue:function(i){}});var x=H.extend("sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.SmartVisualFilterBar",{metadata:{designTime:true,properties:{entitySet:{type:"string",group:"Misc",defaultValue:null},config:{type:"object",group:"Misc",defaultValue:null},persistencyKey:{type:"string",group:"Misc",defaultValue:null},lazyLoadVisualFilter:{type:"boolean",group:"Misc",defaultValue:false},displayCurrency:{type:"string",group:"Misc",defaultValue:null},smartFilterId:{type:"string",group:"Misc",defaultValue:null}},associations:{smartVariant:{type:"sap.ui.core.Control",multiple:false}},events:{filterChange:{},Initialized:{}}},renderer:{}});x.prototype.init=function(){if(H.prototype.init){H.prototype.init.apply(this,arguments);}var i=jQuery(document.body).hasClass("sapUiSizeCozy");this._cellItemHeightNorth="2.0rem";this._cellItemHeightSouth=i?"9.9rem":"7.9rem";this._cellHeight=i?"12rem":"10.9rem";this._cellWidth="20rem";this.labelHeight=2.0;this.compHeight=i?9.9:7.9;this.cellHeightPadding=1;this.cellHeight=(this.labelHeight+this.compHeight+this.cellHeightPadding)+"rem";this.cellWidth=320;this._dialogFilters={};this._compactFilters={};this._oVariantConfig={};this._smartFilterContext;this._oMetadataAnalyser;this.setModel(new J(),'_visualFilterConfigModel');if(i){if(p.system.phone){this.setOrientation("Vertical");this.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterBarCozyPhone");}else{this.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterBarCozy");}}else{this.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterBar");}};x.prototype.propagateProperties=function(){H.prototype.propagateProperties.apply(this,arguments);this._initMetadata();};x.prototype._initMetadata=function(){if(!this.bIsInitialised){O.handleModelInit(this,this._onMetadataInit);}};x.prototype._onMetadataInit=function(){if(this._smartFilterContext.isInitialised()){this._initiateVisualFilterLoad();}else{this._smartFilterContext.attachInitialized(this._initiateVisualFilterLoad,this);}};x.prototype._initiateVisualFilterLoad=function(){if(this.bIsInitialised){return;}this._annoProvider=this._createVisualFilterProvider();if(!this._annoProvider){return;}this._oMetadataAnalyser=this._annoProvider.getMetadataAnalyser();this.bIsInitialised=true;this._updateFilterBar();};x.prototype._createVisualFilterProvider=function(){var i=this.getModel();var j=this.getEntitySet();if(!i||!j){return null;}return new a(this);};x.prototype._getBasicGroupTitle=function(){return this.getModel("i18n").getResourceBundle().getText("VIS_FILTER_GRP_BASIC_TITLE");};x.prototype._getFieldGroupForProperty=function(E,i){return this._annoProvider?this._annoProvider._getFieldGroupForProperty(E,i):undefined;};x.prototype._getGroupList=function(){return this._annoProvider?this._annoProvider.getGroupList():[];};x.prototype._getGroupMap=function(){return this._annoProvider?this._annoProvider.getGroupMap():{};};x.prototype._getMeasureMap=function(){return this._annoProvider?this._annoProvider.getMeasureMap():{};};x.prototype._getDimensionMap=function(){return this._annoProvider?this._annoProvider.getDimensionMap():{};};x.prototype.setSmartFilterContext=function(i){this._smartFilterContext=i;};x.prototype._updateFilterBar=function(){var i=this._getAnnotationSettings();if(i&&i.filterList){var j=this._convertSettingsToConfig(i);}else{j={filterCompList:[]};this.getModel('_visualFilterConfigModel').setData(j);return;}var y=this._getVariantConfig();if(y&&y.config){j.filterCompList.forEach(function(z){if(y.config[z.component.properties.parentProperty]){jQuery.extend(true,z,y.config[z.component.properties.parentProperty]);}});this._oVariantConfig=j;}this.unbindAggregation('content',true);this.getModel('_visualFilterConfigModel').setData(j);this.bindAggregation('content',{path:"_visualFilterConfigModel>/filterCompList",factory:function(I,z){var A=z.getProperty('component'),E=A?A.properties:undefined,G=this._resolveChartType(A?A.type:undefined);return this._createHeaderItems(z.sPath,G,E);}.bind(this),filters:new b("shownInFilterBar",o.EQ,true)});this.fireInitialized();return;};x.prototype._createHeaderItems=function(i,j,y){var z=this._createFilterItemOfType(j,y),A=y.selectFilters&&y.selectFilters.SelectOptions,I=z.getInParameters(),E=[],G=this;if(I&&I.length>0){I.forEach(function(W){E.push({path:'_filter>/'+W.localDataProperty});});}z.addCustomData(new C({key:'sPath',value:i}));if(G.getEntitySet()===z.getEntitySet()){var K=G._smartFilterContext.determineMandatoryFilterItems();if(K&&K.length>0){K.forEach(function(W){if(!W.data("isCustomField")){E.push({path:'_filter>/'+W.getName()});}});}}z.bindProperty('dimensionFilter',{path:'_filter>/'+z.getParentProperty(),type:new w()});z.bindProperty('measureField',{path:'_visualFilterConfigModel>'+i+'/component/properties/measureField'});z.bindProperty('sortOrder',{path:'_visualFilterConfigModel>'+i+'/component/properties/sortOrder'});z.bindProperty('unitField',{path:'_visualFilterConfigModel>'+i+'/component/properties/measureField',formatter:function(){var W=G._getMeasureMap();var X=W[this.getEntitySet()][this.getMeasureField()];return X?X.fieldInfo.unit:"";}});if(E&&E.length>0){z.bindProperty('dimensionFilterExternal',{parts:E,formatter:function(){var I=this.getInParameters(),W=this.getParentProperty();var X,Y;if(!(G.getEntitySet()===this.getEntitySet()&&G._smartFilterContext.getAnalyticBindingPath()!=="")&&(G._smartFilterContext.getAnalyticBindingPath()===""||((G._smartFilterContext.getAnalyticBindingPath().indexOf("P_DisplayCurrency"))!=-1))){var Z=G.getProperty("displayCurrency");if(Z){var $=this.getMeasureField();var _=G.getModel();var a1=_.getMetaModel();var b1=a1.getODataEntityType(G._oMetadataAnalyser.getEntityTypeNameFromEntitySetName(this.getEntitySet()));var c1=a1.getODataEntitySet(this.getEntitySet());var d1=a1.getODataProperty(b1,$);if(d1){var e1=d1[e.ISOCurrency];if(e1){var f1=e1.Path;for(var g1=(I.length-1);g1>-1;g1--){var h1=I[g1].valueListProperty;var i1=I[g1].localDataProperty;if(h1===f1){var j1=G._smartFilterContext.getFilterData();if(!j1[i1]){Y=a1.getODataProperty(b1,f1);var k1=Y&&d.isPropertyNonFilterable(c1,Y.name);if(!k1){X=new b({aFilters:[new b({path:f1,operator:"EQ",value1:Z,value2:undefined})],and:false});}}break;}}}}}}if(this.getId().indexOf("donut")!==-1){this._inParameterFilterList=new b({aFilters:[],bAnd:true});}return G._getFiltersForFilterItem(I,W,X,f1,A,this._inParameterFilterList);}});}if(z.attachFilterChange){z.attachFilterChange(this._onFilterChange,this);}if(z.attachTitleChange){z.attachTitleChange(this._onTitleChange,this);}var L=this._createTitleToolbar(y,z),N=new f({height:this._cellItemHeightNorth,items:[L]});var Q=new f({width:"100%",height:this._cellItemHeightSouth,items:[new m({width:this.cellWidth+"px",textAlign:r.TextAlign.Center,text:{path:'_visualFilterConfigModel>'+i+'/overlayMessage',formatter:function(W){return W&&this.getModel("i18n").getResourceBundle().getText(W);}}})],visible:{path:'_visualFilterConfigModel>'+i+'/showChartOverlay',formatter:function(W){return W;}}});Q.addStyleClass("sapUiOverlay");Q.addStyleClass("sapSmartTemplatesAnalyticalListPageVFOverflow");Q.addStyleClass("sapSmartTemplatesAnalyticalListPageVFOverflowCozy");var R=new f({height:this._cellItemHeightSouth,items:[z],visible:{path:"_visualFilterConfigModel>"+i+"/showChartOverlay",formatter:function(W){return!W;}}});var U=new f({fieldGroupIds:["headerBar"],height:this._cellHeight,width:this.cellWidth+"px",items:[N,Q,R]});return U;};x.prototype._getAnnotationSettings=function(){return this._annoProvider?this._annoProvider.getVisualFilterConfig():null;};x.prototype._convertSettingsToConfig=function(y,I){var z={filterCompList:[]};var A=this._getGroupList();var E={};for(var i=0;i<A.length;i++){var G=A[i];for(var j=0;j<G.fieldList.length;j++){var K=G.fieldList[j];E[K.name]={name:G.name,label:G.label};}}var L=this._getGroupMap();var N=L["_BASIC"];var Q=[];if(N&&N.fieldList){for(var i=0;i<N.fieldList.length;i++){Q.push(N.fieldList[i].name);}}var R=this._getMeasureMap(),U=y.filterList,W={};for(var i=0;i<U.length;i++){var X=U[i];var Y=X.dimension.field;var Z=R[X.collectionPath][X.measure.field];var $=false;if(Z.fieldInfo[e.ISOCurrency]){$=true;}var _={shownInFilterBar:X.selected,component:{type:X.type,properties:{sortOrder:X.sortOrder,measureField:X.measure.field,parentProperty:X.parentProperty?X.parentProperty:undefined}}};if(!I){var a1={shownInFilterDialog:X.selected||Q.indexOf(Y)!=-1,group:E[X.parentProperty],component:{properties:{selectFilters:X.selectionVariant?X.selectionVariant:undefined,scaleFactor:X.scaleFactor,numberOfFractionalDigits:X.numberOfFractionalDigits,filterRestriction:X.filterRestriction,lazyLoadVisualFilter:this.getLazyLoadVisualFilter(),width:this.cellWidth+"px",height:this.compHeight+"rem",entitySet:X.collectionPath?X.collectionPath:this.getEntitySet(),dimensionField:Y,dimensionFieldDisplay:X.dimension.fieldDisplay,dimensionFilter:X.dimensionFilter,unitField:Z?Z.fieldInfo.unit:"",isCurrency:$,isDropDown:X.isDropDown,isMandatory:X.isMandatory,outParameter:X.outParameter?X.outParameter:undefined,inParameters:X.inParameters?X.inParameters:undefined,textArrangement:X.displayBehaviour,chartQualifier:X.chartQualifier?X.chartQualifier:undefined,dimensionFieldIsDateTime:X.dimensionFieldIsDateTime}}};jQuery.extend(true,_,a1);z.filterCompList.push(_);}else{W[X.parentProperty]=_;}}return I?W:z;};x.prototype._setVariantModified=function(){if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(true);}};x.prototype._onFilterChange=function(i){this._setVariantModified();this.fireFilterChange();};x.prototype._getFiltersForFilterItem=function(j,y,z,A,E,G){var I=this;var K={},L=[],N=[],Q=new b({aFilters:[],bAnd:true});var R=function(Z,a1){var b1=new b({aFilters:[],bAnd:false});Z.Ranges.forEach(function(c1){var d1=c1.Low&&c1.Low.String,e1=c1.Sign&&c1.Sign.EnumMember&&c1.Sign.EnumMember.split("/")[1],f1=c1.Option&&c1.Option.EnumMember&&c1.Option.EnumMember.split("/")[1],g1=c1.High&&c1.High.String;var h1=I._getSelectOptionFilters(a1,d1,g1,f1,e1);b1.aFilters.push(h1);});Q.aFilters.push(b1);};if(j){var U=function(a1){a1.sPath=Y;};for(var W=(j.length-1);W>-1;W--){var X=j[W].localDataProperty,Y=j[W].valueListProperty;if(E){for(var i=0;i<E.length;i++){var Z=E[i];var $=Z.PropertyName&&Z.PropertyName.PropertyPath;if(N.indexOf($)===-1){if($===y){R(Z,$);N.push($);}else{var _=this._smartFilterContext.getFilters([$]);if((_&&_.length)||(L.indexOf($)!==-1)){continue;}else{R(Z,$);N.push($);}}}}}if(X!==y&&L.indexOf(X)===-1){K=this._smartFilterContext.getFilters([X]);if(K&&K.length>0){if(K[0].aFilters){K[0].aFilters.forEach(U.bind(this));}else{U(K[0]);}L.push(X);Q.aFilters.push(K[0]);if(G){G.aFilters.push(K[0]);}}}}if(z){Q.aFilters.push(z);}}else{if(E&&E.length){for(var i=0;i<E.length;i++){var Z=E[i];var $=Z.PropertyName&&Z.PropertyName.PropertyPath;R(Z,$);}}}return Q;};x.prototype._getSelectOptionFilters=function(i,L,j,y,z){if(z==="E"){if(y!==o.EQ){jQuery.sap.log.error("Exclude sign is supported only with EQ operator");return;}else{y=o.NE;z="I";}}if(y==="CP"){y=o.Contains;if(L.indexOf("*")!==-1){var A=L.indexOf('*');var E=L.lastIndexOf('*');if(A>-1){if((A===0)&&(E!==(L.length-1))){y=o.EndsWith;L=L.substring(1,L.length);}else if((A!==0)&&(E===(L.length-1))){y=o.StartsWith;L=L.substring(0,L.length-1);}else{L=L.substring(1,L.length-1);}}}}var G=new b({path:i,sign:z,operator:y,value1:L,value2:j});return G;};x.prototype._createTitleToolbar=function(i,j){var y=j.getTitle();var z=new g({text:y.titleMD,titleStyle:r.TitleLevel.H6});if(j.getProperty("isMandatory")){z.addStyleClass("sapMLabelRequired");}var A=new g({text:y.titleUnitCurr.length>1?"| "+y.titleUnitCurr:"",titleStyle:r.TitleLevel.H6,width:"4.15rem"});var I=this._smartFilterContext.getControlByKey(i.parentProperty);this._smartFilterContext.ensureLoadedValueHelp(i.parentProperty);if(I){var E=d.getPropertyNameDisplay(this.getModel(),j.getEntitySet(),j.getDimensionField()),G=this.getModel("i18n").getResourceBundle(),K=I.getShowValueHelp&&I.getShowValueHelp(),L=(i.isDropDown)?"sap-icon://slim-arrow-down":"",N=K?"sap-icon://value-help":L,Q,R=new B({text:{path:"_filter>/"+j.getParentProperty(),formatter:function(W){var X=j.getFilterRestriction();Q=0;if(W){if(X==='single'){Q=1;}else{if(typeof W==="object"){if(W.value){Q++;}if(W.items&&W.items.length){Q+=W.items.length;}if(W.ranges&&W.ranges.length){Q+=W.ranges.length;}}else{Q++;}}}return Q?"("+Q+")":"";}},icon:(K||i.isDropDown)?N:"",visible:{path:"_filter>/"+j.getParentProperty(),formatter:function(W){if(K||i.isDropDown){return true;}else{if(!W){return false;}if(typeof W==="object"){return(W.value||(W.items&&W.items.length)||(W.ranges&&W.ranges.length))?true:false;}return true;}}},press:function(W){if(K){I.fireValueHelpRequest.call(I);}else if(i.isDropDown){var X=this._isEntitytypeSearchable(this.getModel(),i.entitySet),Y=this.getModel("visualFilter")||this.getModel();D.createDropdown(W.getSource(),j,Y,E,i,X);}else{V.launchAllFiltersPopup(R,j,W.getSource().getModel('i18n'));}}.bind(this),layoutData:new n({priority:s.OverflowToolbarPriority.NeverOverflow}),tooltip:{path:"_filter>/"+j.getParentProperty(),formatter:function(){return d.getTooltipForValueHelp(K,E,G,Q);}}});}var U=new c({design:s.ToolbarDesign.Transparent,width:this.cellWidth+"px",content:[z,A,new T(),R]});U.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterTitleToolbar");return U;};x.prototype._isEntitytypeSearchable=function(j,E){var y=j.getMetaModel().getODataEntitySet(E);if(y.extensions.length){for(var i=0;i<y.extensions.length;i++){if(y.extensions[i].name=="searchable"){return y.extensions[i].value=="true";}}}return true;};x.prototype.getTitleByFilterItemConfig=function(i,j,y){var z=i.component.properties;var A=z.entitySet;var E=this.getModel();if(!E){return"";}var G=d.getPropertyNameDisplay(E,A,z.measureField);var I=d.getPropertyNameDisplay(E,A,z.dimensionField);if(!j){j="";}if(!y){y="";}var K=this.getModel("i18n").getResourceBundle();var L=K.getText("VIS_FILTER_TITLE_MD",[G,I]);var N=y+" "+j;N=N.trim();var Q={titleMD:L,titleUnitCurr:N};return Q;};x.prototype._onTitleChange=function(i){var j=i.getSource().getParent().getParent();var L=j.getItems()[0].getItems()[0].getContent()[0];var y=j.getItems()[0].getItems()[0].getContent()[1];var z=this.getModel("i18n");if(!z){return"";}var A=z.getResourceBundle();if(i.getSource().getProperty("isMandatory")){L.addStyleClass("sapMLabelRequired");}var E=i.getSource().getTitle();L.setText(E.titleMD);var G=E.titleUnitCurr==""?E.titleMD:A.getText("VIS_FILTER_TITLE_MD_WITH_UNIT_CURR",[E.titleMD,E.titleUnitCurr]);L.setTooltip(G);y.setText(E.titleUnitCurr.length>0?"| "+E.titleUnitCurr:"");y.setTooltip("");var I=E.titleUnitCurr.split(" ");if(E.titleUnitCurr==""){y.setVisible(false);}else{y.setVisible(true);var W=I.length>1?"4.15rem":"2.4rem";y.setWidth(W);}};x.prototype._getSupportedFilterItemList=function(){if(!this._supportedFilterItemList){this._supportedFilterItemList=[{type:"Bar",className:"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.FilterItemMicroBar",iconLink:"sap-icon://horizontal-bar-chart",textKey:"VISUAL_FILTER_CHART_TYPE_BAR"},{type:"Donut",className:"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.FilterItemMicroDonut",iconLink:"sap-icon://donut-chart",textKey:"VISUAL_FILTER_CHART_TYPE_Donut"},{type:"Line",className:"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.FilterItemMicroLine",iconLink:"sap-icon://line-charts",textKey:"VISUAL_FILTER_CHART_TYPE_Line"}];}return this._supportedFilterItemList;};x.prototype._getSupportedFilterItemMap=function(){if(!this._supportedFilterItemMap){this._supportedFilterItemMap={};var j=this._getSupportedFilterItemList();for(var i=0;i<j.length;i++){var y=j[i];this._supportedFilterItemMap[y.type]=y;}}return this._supportedFilterItemMap;};x.prototype._resolveChartType=function(i){var j=this._getSupportedFilterItemMap();var y=j[i];if(!y){var z;for(z in j){y=j[z];break;}jQuery.sap.log.error("Could not resolve the filter component type: \""+i+"\", falling back to "+z);i=z;}return i;};x.prototype._createFilterItemOfType=function(i,j){var y;if(i===v){y=new h(j);}else if(i===u){y=new k(j);}else if(i===t){y=new l(j);}y.setSmartFilterId(this.getSmartFilterId());y.setModel(this.getModel('i18n'),'i18n');y.setModel(this.getModel("_templPriv"),"_templPriv");if(!this._smartFilterContext.isDialogOpen()){y.setModel(this.getModel('_filter'),'_filter');y.setModel(this.getModel('_visualFilterConfigModel'),"_visualFilterConfigModel");}y.setModel(this.getModel());var z=this.getModel("visualFilter");if(z){y.setModel(z,"visualFilter");}return y;};x.prototype.getConfig=function(I){var j=this.getModel('_visualFilterConfigModel').getData(),y={};if(!j){return{filterCompList:[]};}var z=0;var A=sap.ui.getCore().byFieldGroupId("headerBar");for(var i=0;i<j.filterCompList.length;i++){var E=j.filterCompList[i];if(I){y[E.component.properties.parentProperty]={shownInFilterBar:E.shownInFilterBar,shownInFilterDialog:E.shownInFilterDialog,component:{type:E.component.type,properties:{measureField:E.component.properties.measureField,sortOrder:E.component.properties.sortOrder,parentProperty:E.component.properties.parentProperty}}};}else{if(!E.shownInFilterBar){continue;}var G=A[z];if(!G){jQuery.sap.log.error("The configured selected filter bar items do not correspond to the actual filter bar items.  Could be an error during initialization, e.g. a chart class not found");return{filterCompList:[]};}z++;if(G._chart){var K=G;E.component.properties=K.getP13NConfig();}}}return I?y:j;};x.prototype.setSmartVariant=function(i){this.setAssociation("smartVariant",i);if(i){var j=new P({type:"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.SmartVisualFilterBar",keyName:"persistencyKey"});j.setControl(this);}this._oVariantManagement=this._getVariantManagementControl(i);if(this._oVariantManagement){this._oVariantManagement.addPersonalizableControl(j);this._oVariantManagement.initialise(this._variantInitialised,this);this._oVariantManagement.attachSave(this._onVariantSave,this);}else if(i){if(typeof i==="string"){jQuery.sap.log.error("Variant with id="+i+" cannot be found");}else if(i instanceof sap.ui.core.Control){jQuery.sap.log.error("Variant with id="+i.getId()+" cannot be found");}}else{jQuery.sap.log.error("Missing SmartVariant");}};x.prototype._getVariantManagementControl=function(i){var j=null;if(i){j=typeof i=="string"?sap.ui.getCore().byId(i):i;if(j&&!(j instanceof S)){jQuery.sap.log.error("Control with the id="+i.getId?i.getId():i+" not of expected type");return null;}}return j;};x.prototype._variantInitialised=function(){if(!this._oCurrentVariant){this._oCurrentVariant="STANDARD";}};x.prototype._onVariantSave=function(){if(this._oCurrentVariant=="STANDARD"){this._oCurrentVariant={config:this.getConfig(true)};}};x.prototype.applyVariant=function(i,j){this._oCurrentVariant=i;if(this._oCurrentVariant=="STANDARD"){this._oCurrentVariant=null;}if(this._oCurrentVariant&&this._oCurrentVariant.config&&this._oCurrentVariant.config.filterCompList){this._oCurrentVariant.config=null;}if(this._oCurrentVariant&&this._oCurrentVariant.config==null){var y=this._getAnnotationSettings();if(y&&y.filterList){this._oCurrentVariant.config=this._convertSettingsToConfig(y,true);}}this._updateFilterBar();if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(false);}};x.prototype._getVariantConfig=function(){return this._oCurrentVariant;};x.prototype.fetchVariant=function(){if(!this._oCurrentVariant||this._oCurrentVariant=="STANDARD"){var i=this._getAnnotationSettings();if(i&&i.filterList){this._oCurrentVariant={config:this._convertSettingsToConfig(i,true)};return this._oCurrentVariant;}else{return{config:null};}}return{config:this.getConfig(true)};};x.prototype._getStandardVariantConfig=function(){var i=this._getAnnotationSettings();var j=this._convertSettingsToConfig(i);return j;};x.prototype.updateVisualFilterBindings=function(A,U){if(U){for(var i in this.filterChartList){var j=this.filterChartList[i];if(j._chart){j._updateBinding();j._bAllowBindingUpdateOnPropertyChange=A===true;}}}else{var y=sap.ui.getCore().byFieldGroupId("headerBar");for(var i=0;i<y.length;i++){if(y[i]._chart){y[i]._updateBinding();y[i]._bAllowBindingUpdateOnPropertyChange=A===true;}}}};x.prototype.addVisualFiltersToBasicArea=function(j){var y=jQuery.extend(true,{},this.getModel('_visualFilterConfigModel').getData()),z=(j&&j.constructor===Array&&j.length)?j.length:0,A=0;if(!y){jQuery.sap.log.error("Could not add filter to basic area. No config found!");return false;}else if(!z){jQuery.sap.log.error("Improper parameter passed. Pass an array of properties.");return false;}else{for(var i=0;i<y.filterCompList.length;i++){var E=y.filterCompList[i];if(j.indexOf(d.readProperty(E.component.properties.parentProperty))!==-1&&!E.shownInFilterBar){E.shownInFilterBar=true;E.shownInFilterDialog=true;A++;}}if(A){this.getModel('_visualFilterConfigModel').setData(y);return true;}else{jQuery.sap.log.info("Filters already present in visual filter basic area");return false;}}};return x;},true);
