sap.ui.define(["jquery.sap.global","sap/ui/core/CustomizingConfiguration","sap/ui/core/mvc/ViewType","sap/ui/core/Component","sap/ui/core/UIComponent","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","sap/ui/Device","sap/suite/ui/generic/template/lib/reuseComponentHelper"],function(q,C,V,a,U,J,R,D,r){"use strict";function g(o){var s=o&&typeof o==="string"?o:(o&&a.getOwnerIdFor(o));var i=s&&sap.ui.component(s);if(i instanceof T){i=i.getAppComponent();}return i;}var G=C.getViewExtension;C.getViewExtension=function(v,s,o){var i=g(o),n=i&&i.getId(),t=G.call(C,v,s,n);return t;};var f=C.getControllerExtension;C.getControllerExtension=function(s,o){var i=g(o),n=i&&i.getId(),t=f.call(C,s,n);return t;};function e(o){var I=new R({bundleName:"sap/suite/ui/generic/template/lib/i18n/i18n"});var n=[];var M=o.getAppComponent().getModel("i18n|"+o.getMetadata().getComponentName()+"|"+o.getEntitySet());if(M){n.push(M);}var t=o.getModel("i18n");if(t){n.push(t);}var P=true;for(var s="i18n";P;){s=s+"||Parent";P=o.getModel(s);if(P){n.push(P);}}for(var i=n.length-1;i>=0;i--){I.enhance(n[i].getResourceBundle());}o.setModel(I,"i18n");}function E(o,M){var i=o.getAppComponent().getManifestEntry("sap.ui5");var n=i.extends&&i.extends.extensions&&i.extends.extensions["sap.ui.controllerExtensions"];var t=o.getTemplateName();var s=n&&n[t]&&n[t]["sap.ui.generic.app"];var u=o.getEntitySet();var B=s&&s[u]&&s[u].Actions;var v={};var w=b(o);if(B){if(w){A(v,B,w);}else{c(v,B);}}else{var S=s&&s[u]&&s[u]["Sections"];for(var x in S){B=S[x]["Actions"];if(B){c(v,B);}}}o.getModel("_templPriv").setProperty("/generic/listCommons/breakoutActionsEnabled",v);}function b(o){var i;var n=o.getAppComponent().getConfig();var s=n&&n.pages[0]&&n.pages[0].component&&n.pages[0].component.settings;if(s&&s.quickVariantSelectionX){i=s.quickVariantSelectionX.variants;}return i;}function A(B,o,t){var n;for(var s in o){n=true;if(o[s].requiresSelection){n=false;}for(var i in t){var u=o[s].id;var v=t[i];var S=sap.suite.ui.generic.template.js.AnnotationHelper.getSuffixFromIconTabFilterKey(v);if(S){u=u.concat(S);}B[u]={enabled:n};}}}function c(B,o){var i;for(var s in o){i=true;if(o[s].requiresSelection){i=false;}B[o[s].id]={enabled:i};}}function d(o){if(o.getAppComponent().getMetadata().getComponentName()===""||o.getTemplateName()===""||o.getEntitySet()===""){}return o.getAppComponent().getMetadata().getComponentName()+"::"+o.getTemplateName()+"::"+o.getEntitySet();}function h(s,o,M,t){var i=o.oComponent;var n=i.getAppComponent();var u=i.getEntitySet();var v=o.utils.isDraftEnabled();var S=null;var w=i.getComponentContainer().getSettings();S=q.extend({},w);delete S.appComponent;delete S.entitySet;delete S.navigationProperty;S.subPages=o.routeConfig.pages;S.routeConfig=o.routeConfig;return new J({entitySet:u,entityType:s,routingSpec:o.routingSpec,"sap-ui-debug":window["sap-ui-debug"],isDraftEnabled:v,settings:S,manifest:n.getInternalManifest(),metaModel:M,templateSpecific:t&&t(),appComponentName:i.getAppComponent().getMetadata().getComponentName(),helper:{bool:{"true":true,"false":false}}});}function j(o,i){var n=o.oComponent,s=o.createViewController,t=o.methods&&o.methods.getTemplateSpecificParameters,M=n.getModel(),u,v,w,x,y,N=o.routingSpec&&o.routingSpec.noOData;if(N){u=new J({entitySet:{},entityType:{}});x=u.createBindingContext("/entitySet");y=u.createBindingContext("/entityType");}else{u=M&&M.getMetaModel();v=M&&n.getEntitySet();var z=v&&u.getODataEntitySet(v);w=z&&z.entityType;if(!w){return{loaded:function(){return Promise.reject(new Error("Unknown entityset "+v));}};}x=u.createBindingContext(u.getODataEntitySet(v,true));y=u.createBindingContext(u.getODataEntityType(w,true));}e(n);E(n,M);q.sap.require("sap.ui.model.odata.AnnotationHelper");var S=d(n);var B=sap.ui.getCore().byId(S);if(B){q.sap.log.warning("View with ID: "+S+" already exists - old view is getting destroyed now!");try{B.destroy();}catch(F){q.sap.log.warning("Error destroying view: "+F);}B=null;}var H=new J(D);H.setDefaultBindingMode("OneWay");o.oParameterModel=h(w,o,u,t);n.runAsOwner(function(){var P=o.preprocessorsData;var I={async:true,preprocessors:{xml:{bindingContexts:{entitySet:x,entityType:y},models:{device:H,entitySet:u,entityType:u,parameter:o.oParameterModel},preprocessorsData:P}},id:S,type:V.XML,viewName:n.getTemplateName(),height:"100%",cache:{keys:i,additionalData:[P]}};if(s){var K=s();I.controller=new K();}B=sap.ui.view(I);});return B;}function k(o,s,i){var n=o.oController.extensionAPI;var t=q.extend({},n);if(n.getNavigationController){var N=q.extend({},n.getNavigationController());var u=N.navigateInternal;N.navigateInternal=function(v,w){var x=w&&w.routeName;if(x){o.utils.navigateRoute(x,v,s,w&&w.replaceInHistory);}else{u(v,w);}};t.getNavigationController=function(){return N;};}t.getCommunicationObject=function(L){return L===1?i.communicationObject:o.utils.getCommunicationObject(L);};(o.methods.enhanceExtensionAPI4Reuse||q.noop)(t,i);return t;}function p(o,i,s,n,t){n.extensionAPI=k(o,s,n);r.transferEmbeddedComponentProxy(o,i,s,n,t);var u=o.oController.byId(n.containerId);t.applySettings(u.getSettings());u.setComponent(t);}function l(o,s,i){return i.componentUsage?o.createComponent({usage:i.componentUsage,id:s}):o.runAsOwner(function(){return a.create({name:i.componentName,id:s});});}function m(o){o.reuseComponentsReady=new Promise(function(i,n){var s=Object.create(null);var t=i.bind(null,s);if(o.viewLevel>0){var u=o.oTemplateContract.mEntityTree[o.routeConfig.entitySet];if(u){var L=function(v,w){q.sap.log.error("Failed to load reuse component for key "+v,w instanceof Error?w.message:"","sap.suite.ui.generic.template.lib.TemplateComponent");};o.viewRegisterd.then(function(){var v=[];for(var w in u.embeddedComponents){var x=u.embeddedComponents[w];var y=o.oController.createId(x.containerId+"Content");var z=l(o.oAppComponent,y,x);v.push(z);z.catch(L.bind(null,w));z.then(p.bind(null,o,s,w,x));o.oTemplateContract.oBusyHelper.setBusy(z);}Promise.all(v).then(t,function(B){var N=o.oAppComponent.getNavigationController();N.navigateToMessagePage({text:o.oTemplateContract.getText("ST_ERROR"),description:B instanceof Error?B.message:""});n();});});return;}}t();});}var T=U.extend("sap.suite.ui.generic.template.lib.TemplateComponent",{metadata:{properties:{templateName:{type:"string",defaultValue:null},entitySet:{type:"string",defaultValue:null},navigationProperty:{type:"string",defaultValue:null},appComponent:{type:"object",defaultValue:null},isRefreshRequired:{type:"boolean",defaultValue:false},isLeaf:{type:"boolean"}},library:"sap.suite.ui.generic.template"},init:function(){(U.prototype.init||q.noop).apply(this);var u=new J({editable:false,enabled:false});this.setModel(u,"ui");var o=this.getComponentData().registryEntry;var i=Object.create(null);var n=(o.routeConfig&&o.routeConfig.embeddedComponents)||{};for(var K in n){var s=n[K];var t={hidden:!!s.hiddenByDefault};i[K]=t;}var v=new J({generic:{isActive:false,listCommons:{},viewLevel:o.viewLevel,controlProperties:{},supportedIntents:{},embeddedComponents:i}});v.setDefaultBindingMode("TwoWay");this.setModel(v,"_templPriv");m(o);},getManifestEntry:function(K){var v=U.prototype.getManifestEntry.apply(this,arguments);if(/^\/sap\.ui5\/componentUsages(\/.+)?$/.test(K)){v=q.extend(true,{},v,U.prototype.getManifestEntry.apply(this.getAppComponent(),arguments));}return v;},getComponentContainer:function(){return this.oContainer;},onBeforeRendering:function(o){if(o){var n=o.oComponent.getComponentContainer();var M=!o.createViewStarted&&n&&n.getModel();if(M){M.getMetaModel().loaded().then(function(){if(!o.createViewStarted){var s=[];var t=M.metadataLoaded().then(function(P){var i;if(P&&P.lastModified){i=new Date(P.lastModified).getTime()+"";}else{q.sap.log.error("TemplateComponent: no valid cache key segment last modification date provided by the OData Model");i=new Date().getTime()+"";}return i;});s.push(t);var u=M.annotationsLoaded().then(function(P){var v=0;if(P){for(var i=0;i<P.length;i++){if(P[i].lastModified){var L=new Date(P[i].lastModified).getTime();if(L>v){v=L;}}else{q.sap.log.error("TemplateComponent: no valid cache key segment last modification date provided by OData annotations");v=new Date().getTime()+"";}}}if(v===0){q.sap.log.error("TemplateComponent: no valid cache key segment last modification date provided by OData annotations");v=new Date().getTime();}return v+"";});s.push(u);o.createViewStarted=true;j(o,s).loaded().then(function(v){o.oComponent.setAggregation("rootControl",v);o.fnViewRegisteredResolve();n.invalidate();},function(i){o.fnViewRegisteredResolve(i||{});});}});}}},getRouter:function(){if(this.getAppComponent()){return this.getAppComponent().getRouter();}return U.prototype.getRouter.apply(this,arguments);}});return T;});
