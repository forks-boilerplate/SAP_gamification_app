sap.ui.define(["jquery.sap.global","sap/ui/core/format/DateFormat","sap/m/MessageBox","sap/m/MessageToast","sap/ui/model/Filter","sap/ui/model/Sorter","sap/ui/generic/app/navigation/service/SelectionVariant","sap/suite/ui/generic/template/lib/testableHelper","sap/suite/ui/generic/template/detailTemplates/detailUtils","sap/suite/ui/generic/template/ObjectPage/extensionAPI/ExtensionAPI","sap/ui/model/json/JSONModel","sap/suite/ui/generic/template/js/AnnotationHelper","sap/ui/core/mvc/ViewType","sap/m/Table","sap/ui/layout/DynamicSideContent","sap/suite/ui/generic/template/lib/ShareUtils"],function(q,D,M,a,F,S,b,t,d,E,J,A,V,R,c,f){"use strict";function s(o){o.setSelectedSection(null);}function I(o){return o.data("inlineCreate")==="true";}function g(B,e){if(B.getBindings){var h=B.getBindings();for(var i=0;i<h.length;i++){g(h[i],e);}}else{var T=B.getType();B.setType(T,e);}}var r=/[A-Za-z].*[A-Za-z]/;var m={getMethods:function(v,T,C){var B=d.getControllerBase(v,T,C);B.state.aUnsavedDataCheckFunctions=[];v.oController=C;var h;var o;var l;function n(e){var i=e.getParameter("bindingParams");i.parameters=i.parameters||{};i.parameters.usePreliminaryContext=true;i.parameters.batchGroupId="facets";return i;}function p(){q.sap.log.info("Activate object");var e=T.oServices.oCRUDManager.activateDraftEntity();e.then(function(i){T.oServices.oApplication.showMessageToast(T.oCommonUtils.getText("OBJECT_SAVED"));if(i&&i.context){var j=C.getOwnerComponent();T.oServices.oViewDependencyHelper.setAllPagesDirty([j.getId()]);T.oServices.oViewDependencyHelper.unbindChildren(j);var k=C.getOwnerComponent().getNavToListOnSave();T.oServices.oApplication.invalidatePaginatorInfo();if(k){T.oServices.oNavigationController.navigateToRoot(true);}else{T.oServices.oNavigationController.navigateToContext(i.context,undefined,true);}}var x={activationPromise:e};T.oComponentUtils.fire(C,"AfterActivate",x);},q.noop);}function u(){B.state.beforeSaveHelper.prepareAndRunSaveOperation(true,p);}function w(){var e=C.getView().getBindingContext();var i=C.getView().getModel().getPendingChanges();i=i&&i[e.getPath().replace("/","")]||{};var j=Object.keys(i)||[];var k=T.oComponentUtils.isNonDraftCreate();var x=j.indexOf("__metadata");if(x>-1){j.splice(x,1);}var A1=T.oServices.oCRUDManager.saveEntity();A1.then(function(C1){var D1=T.oComponentUtils.getTemplatePrivateModel();D1.setProperty("/objectPage/displayMode",1);v.setEditable(false);if(k){if(C1&&C1.getPath()!=="/undefined"){T.oServices.oNavigationController.navigateToContext(C1,undefined,true);}else{T.oServices.oNavigationController.navigateBack();}T.oServices.oApplication.showMessageToast(T.oCommonUtils.getText("OBJECT_CREATED"));}else{T.oServices.oApplication.showMessageToast(T.oCommonUtils.getText("OBJECT_SAVED"));if(!T.oComponentUtils.isDraftEnabled()&&!h){T.oServices.oNavigationController.navigateBack();}}if(j.length>0){T.oServices.oApplicationController.executeSideEffects(e,j);}});var B1={saveEntityPromise:A1};T.oComponentUtils.fire(C,"AfterSave",B1);}function y(){B.state.beforeSaveHelper.prepareAndRunSaveOperation(true,w);}function z(e){if(I(e.getSource())){var i=e.getParameter("bindingParams");if(i.filters&&i.filters.length){var j=new F(i.filters);i.filters=new F({filters:[new F({filters:[new F({path:"IsActiveEntity",operator:"EQ",value1:true}),j],and:true}),new F({filters:[new F({path:"IsActiveEntity",operator:"EQ",value1:false}),new F({filters:[j,new F({path:"HasActiveEntity",operator:"EQ",value1:false})],and:false})],and:true})],and:false});}var k=i.sorter[0]&&i.sorter[0].getGroupFunction();var x=k&&function(A1){var B1=A1.getObject();if(B1.IsActiveEntity||B1.HasActiveEntity){var C1=q.extend({},k(A1));C1.key=C1.key.charAt(0)==="ยง"?"ยง"+C1.key:C1.key;return C1;}return{key:"ยง",text:T.oCommonUtils.getText("NEW_ENTRY_GROUP")};};i.sorter.unshift(new S("HasActiveEntity",false,x));}}function G(){return o.getHeaderTitle();}function H(e){var i=T.oComponentUtils.getTemplatePrivateModel();var j={shareEmailPressed:function(){var k=i.getProperty("/objectPage/headerInfo/objectTitle");var x=i.getProperty("/objectPage/headerInfo/objectSubtitle");if(x){k=k+" - "+x;}sap.m.URLHelper.triggerEmail(null,k,document.URL);},shareJamPressed:function(){f.openJamShareDialog(i.getProperty("/objectPage/headerInfo/objectTitle")+" "+i.getProperty("/objectPage/headerInfo/objectSubtitle"));},getModelData:function(){return{title:i.getProperty("/objectPage/headerInfo/objectTitle"),subtitle:i.getProperty("/objectPage/headerInfo/objectSubtitle"),customUrl:document.URL};}};f.openSharePopup(T.oCommonUtils,e.getSource(),j);}function K(){var e=T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.RelatedAppsSheet",{buttonPressed:function(i){var j=i.getSource();var k=j.getBindingContext("buttons");var x=k.getProperty("link");var A1=k.getProperty("param");var B1=x.intent;var C1=B1.split("#")[1].split("-")[0];var D1=B1.split("-")[1].split("?")[0].split("~")[0];var E1={target:{semanticObject:C1,action:D1},params:A1};sap.ushell.Container.getService("CrossApplicationNavigation").toExternal(E1);}},"buttons");return e;}function L(){var e=T.oServices.oApplication.getBusyHelper();if(e.isBusy()){return;}var i=C.getOwnerComponent();var j=i.getNavigationProperty();var k=T.oCommonUtils;var x=T.oComponentUtils.getTemplatePrivateModel();var A1=(x.getProperty("/objectPage/headerInfo/objectTitle")||"").trim();var B1=x.getProperty("/objectPage/headerInfo/objectSubtitle");var C1;var D1={title:k.getText("DELETE")};if(A1){if(B1){C1=[" ",A1,B1];D1.text=k.getText("DELETE_WITH_OBJECTINFO",C1);}else{C1=[B1];D1.text=k.getText("DELETE_WITH_OBJECTTITLE",C1);}}else{D1.text=k.getText("ST_GENERIC_DELETE_SELECTED");}var E1=Promise.resolve(C.beforeDeleteExtension());E1.then(function(F1){q.extend(D1,F1);M.show(D1.text,{icon:M.Icon.WARNING,styleClass:T.oCommonUtils.getContentDensityClass(),title:D1.title,actions:[M.Action.DELETE,M.Action.CANCEL],onClose:function(G1){if(G1===M.Action.DELETE){var H1=i.getModel("_templPrivGlobal");var I1={objectPage:{currentEntitySet:i.getProperty("entitySet")}};H1.setProperty("/generic/multipleViews",I1);var J1=T.oServices.oCRUDManager.deleteEntity();var K1=i.getBindingContext().getPath();var L1=Object.create(null);L1[K1]=J1;T.oServices.oApplication.prepareDeletion(L1);J1.then(function(){T.oServices.oViewDependencyHelper.setParentToDirty(i,j,1);T.oServices.oViewDependencyHelper.unbindChildren(i,true);});var M1={deleteEntityPromise:J1};e.setBusy(J1);T.oComponentUtils.fire(C,"AfterDelete",M1);}}});},q.noop);}function N(e){T.oServices.oApplication.performAfterSideEffectExecution(L);}function O(e){var i,j;if(e){j=e.context||e;if(T.oServices.oDraftController.getDraftContext().hasDraft(j)){T.oServices.oViewDependencyHelper.setRootPageToDirty();i=e.context&&e.context.context||e.context||e;}}if(i){T.oServices.oApplication.invalidatePaginatorInfo();if(B.fclInfo.navigateToDraft){B.fclInfo.navigateToDraft(i);}else{T.oServices.oNavigationController.navigateToContext(i,undefined,true,2);}}else{var k=T.oComponentUtils.getTemplatePrivateModel();k.setProperty("/objectPage/displayMode",2);}v.setEditable(true);}var P;function Q(e){T.oServices.oCRUDManager.editEntity(e).then(function(i){if(i.draftAdministrativeData){P(i.draftAdministrativeData.CreatedByUserDescription||i.draftAdministrativeData.CreatedByUser);}else{O(i.context);}});}P=function(e){var i=T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.UnsavedChangesDialog",{onEdit:function(){i.close();Q(true);},onCancel:function(){i.close();}},"Dialog");var j=i.getModel("Dialog");var k=T.oCommonUtils.getText("DRAFT_LOCK_EXPIRED",[e]);j.setProperty("/unsavedChangesQuestion",k);i.open();};function U(){var j="{\"SelectionVariantID\":\"\"}";var k=C.getOwnerComponent();var A1=k.getEntitySet();var B1=k.getModel();var C1=B1.getMetaModel();var D1=C1.getODataEntitySet(A1);var E1=C1.getODataEntityType(D1.entityType);var F1=E1.property;var G1=[];for(var x in F1){var H1=F1[x]["com.sap.vocabularies.Common.v1.FieldControl"]&&F1[x]["com.sap.vocabularies.Common.v1.FieldControl"].Path;if(H1&&G1.indexOf(H1)<0){G1.push(H1);}}var I1=C.getView().getBindingContext();var J1=I1.getObject();var K1=new b();for(var i in F1){var L1=F1[i].type;var M1=F1[i].name;var N1=J1[F1[i].name];if(G1.indexOf(M1)>-1){continue;}if(M1&&(N1||L1==="Edm.Boolean")){if(L1==="Edm.Time"&&N1.ms!==undefined){N1=N1.ms;}if(typeof N1!=="string"){try{N1=N1.toString();}catch(e){N1=N1+"";}}K1.addParameter(M1,N1);}}j=K1.toJSONString();return j;}function W(e,Y){var i=true;var j=Y.getModel();var k=T.oCommonUtils.getDeleteRestrictions(Y);var x=k&&k.Deletable&&k.Deletable.Path;if(x){i=j.getProperty(x,e);}return i;}var X;var Y;function Z(e,j){X=e;Y=j;var k=[];var x=Y.getId().substring(Y.getId().indexOf(C.getOwnerComponent().getEntitySet()),Y.getId().lastIndexOf("::"));x=x.replace(/--/g,"|").replace(/::/g,"|");return T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.TableDeleteConfirmation",{onCancel:function(i){var A1=i.getSource().getParent();A1.close();},onDelete:function(A1){var B1=T.oServices.oApplication.getBusyHelper();var C1=A1.getSource().getParent();var D1=T.oCommonUtils.getSelectedContexts(Y);k=[];var E1;var F1;var G1=C.getView().getModel().getObject(D1[0].getPath());for(var i=0;i<D1.length;i++){if(W(D1[i],Y)){k.push(D1[i].getPath());}}var H1=T.oServices.oCRUDManager.deleteEntities(k);B1.setBusy(H1);T.oServices.oApplicationController.executeSideEffects(Y.getBindingContext(),[],[Y.getTableBindingPath()]);var I1=X.getParent().getParent().getId();H1.then(function(K1){T.oServices.oViewDependencyHelper.unbindChildren(C.getOwnerComponent());T.oCommonUtils.refreshSmartTable(Y);if(G1.IsActiveEntity===false){F1=0;}else{F1=K1.length;}E1=k.length-F1;var L1="";var M1="";var N1="";if(F1>0){var O1="";if(E1>0){N1=(T.oCommonUtils.getText("DELETE_SUCCESS_PLURAL_WITH_COUNT|"+x)==="DELETE_SUCCESS_PLURAL_WITH_COUNT|"+x)?T.oCommonUtils.getText("DELETE_SUCCESS_PLURAL_WITH_COUNT",[E1]):T.oCommonUtils.getText("DELETE_SUCCESS_PLURAL_WITH_COUNT|"+x,[E1]);M1=(T.oCommonUtils.getText("DELETE_SUCCESS_WITH_COUNT|"+x)==="DELETE_SUCCESS_WITH_COUNT|"+x)?T.oCommonUtils.getText("DELETE_SUCCESS_WITH_COUNT",[E1]):T.oCommonUtils.getText("DELETE_SUCCESS_WITH_COUNT|"+x,[E1]);O1+=(E1>1)?N1:M1;O1+="\n";N1=(T.oCommonUtils.getText("DELETE_ERROR_PLURAL_WITH_COUNT|"+x)==="DELETE_ERROR_PLURAL_WITH_COUNT|"+x)?T.oCommonUtils.getText("DELETE_ERROR_PLURAL_WITH_COUNT",[F1]):T.oCommonUtils.getText("DELETE_ERROR_PLURAL_WITH_COUNT|"+x,[F1]);M1=(T.oCommonUtils.getText("DELETE_ERROR_WITH_COUNT|"+x)==="DELETE_ERROR_WITH_COUNT|"+x)?T.oCommonUtils.getText("DELETE_ERROR_WITH_COUNT",[F1]):T.oCommonUtils.getText("DELETE_ERROR_WITH_COUNT|"+x,[F1]);O1+=(F1>1)?N1:M1;}else{N1=(T.oCommonUtils.getText("DELETE_ERROR_PLURAL|"+x)==="DELETE_ERROR_PLURAL|"+x)?T.oCommonUtils.getText("DELETE_ERROR_PLURAL"):T.oCommonUtils.getText("DELETE_ERROR_PLURAL|"+x);M1=(T.oCommonUtils.getText("DELETE_ERROR|"+x)==="DELETE_ERROR|"+x)?T.oCommonUtils.getText("DELETE_ERROR"):T.oCommonUtils.getText("DELETE_ERROR|"+x);O1=(F1>1)?N1:M1;}M.error(O1);}else{N1=(T.oCommonUtils.getText("DELETE_SUCCESS_PLURAL|"+x)==="DELETE_SUCCESS_PLURAL|"+x)?T.oCommonUtils.getText("DELETE_SUCCESS_PLURAL"):T.oCommonUtils.getText("DELETE_SUCCESS_PLURAL|"+x);M1=(T.oCommonUtils.getText("ITEM_DELETED|"+x)==="ITEM_DELETED|"+x)?T.oCommonUtils.getText("ITEM_DELETED"):T.oCommonUtils.getText("ITEM_DELETED|"+x);L1=(E1>1)?N1:M1;T.oServices.oApplication.showMessageToast(L1);}});var J1={deleteEntitiesPromise:H1,sUiElementId:I1,aContexts:D1};T.oComponentUtils.fire(C,"AfterLineItemDelete",J1);C1.close();}},"delete");}function $(e){var j=T.oServices.oApplication.getBusyHelper();if(j.isBusy()){return;}var X=e.getSource();var Y=T.oCommonUtils.getOwnerControl(X);var k=T.oCommonUtils.getSelectedContexts(Y);if(k.length===0){M.error(T.oCommonUtils.getText("ST_GENERIC_NO_ITEM_SELECTED"),{styleClass:T.oCommonUtils.getContentDensityClass()});return;}var x=[];var A1=[];for(var i=0;i<k.length;i++){if(W(k[i],Y)){x.push(k[i].getPath());}else{A1.push(k[i]);}}var B1=Y.getId().substring(Y.getId().indexOf(C.getOwnerComponent().getEntitySet()),Y.getId().lastIndexOf("::"));B1=B1.replace(/--/g,"|").replace(/::/g,"|");var C1=function(){var G1=Array.apply(null,arguments);G1[0]=G1[0]+"|"+B1;var H1=T.oCommonUtils.getText.apply(null,G1);return(H1===G1[0]?T.oCommonUtils.getText.apply(null,arguments):H1);};var D1={title:(k.length>1?T.oCommonUtils.getText("ST_GENERIC_DELETE_TITLE_WITH_COUNT",[k.length]):T.oCommonUtils.getText("ST_GENERIC_DELETE_TITLE")),text:(k.length>1?C1("DELETE_SELECTED_ITEMS"):C1("DELETE_SELECTED_ITEM")),undeletableText:(A1.length>0?C1("DELETE_UNDELETABLE_ITEMS",[A1.length,k.length]):undefined)};var E1={sUiElementId:X.getParent().getParent().getId(),aContexts:k};var F1=Promise.resolve(C.beforeLineItemDeleteExtension(E1));F1.then(function(G1){q.extend(D1,G1);var H1=Z(X,Y);if(!A1.length){D1.undeletableText=undefined;}var I1=H1.getModel("delete");I1.setData(D1);H1.open();},q.noop);}function _(){var i=C.byId("imageDialog")||T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.ImageDialog",{onImageDialogClose:function(){i.close();}},"headerImage");return i;}function a1(){var e=C.byId("template::ObjectPage::TitleImage");if(!e){return;}var i=C.getView().byId("template::ObjectPage::ObjectPageHeader");e.setVisible(false);i.attachStateChange(function(j){var k=j.getParameter("isExpanded");e.setVisible(!k);});}function b1(){var e;var j=T.oComponentUtils.getTemplatePrivateModel();var k=function(i){return function(x){var A1=x.getSource();var B1=A1.getExternalValue();j.setProperty("/objectPage/headerInfo/"+i,B1);if(!B1&&i==="objectTitle"){var C1=T.oComponentUtils.getHeaderDataAvailablePromise();C1.then(function(D1){B1=A1.getExternalValue();if(B1){return;}var E1=C.getView();var F1=D1.getObject();var G1=E1.getModel("ui");var H1=G1.getProperty("/createMode");if(H1&&F1&&(F1.IsActiveEntity===undefined||F1.IsActiveEntity===false||F1.HasActiveEntity===false)){e=e||T.oCommonUtils.getText("NEW_OBJECT");j.setProperty("/objectPage/headerInfo/objectTitle",e);}});}};};o.getCustomData().forEach(function(x){var A1=x.getKey();if(A1==="objectTitle"||A1==="objectSubtitle"){var B1=x.getBinding("value");var C1=!B1&&x.getBindingInfo("value");if(!B1&&!C1){j.setProperty("/objectPage/headerInfo/"+A1,x.getValue());return;}var D1=k(A1);if(B1){B1.attachChange(D1);g(B1,"string");}else{C1.events={change:D1};for(var i=0;i<C1.parts.length;i++){C1.parts[i].targetType="string";}}}});}function c1(e,i){q.sap.log.info("Set binding context to "+e,"Subsection: "+i.getId(),"Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");i.setBindingContext(e);}function d1(e,i,j,k){if(i){var x=e?T.oComponentUtils.getHeaderDataAvailablePromise():Promise.resolve();x.then(function(){c1(undefined,j);k.refresh(null,true);});}else{c1(null,j);}}var e1={lazyLoading:d1.bind(null,false),lazyLoadingAfterHeader:d1.bind(null,true),reuseComponent:function(i,e){var j=e.getBlocks()[0];var k=i?T.oComponentUtils.getHeaderDataAvailablePromise():Promise.resolve();k.then(T.oComponentUtils.onVisibilityChangeOfReuseComponent.bind(null,i,j));}};function f1(e,i,j){if(j instanceof c){j=j.getMainContent()[0];}else if(!j.getContent){return;}j.getContent().forEach(function(k){if(T.oCommonUtils.isSmartTable(k)){if(i||e[k.getTableBindingPath()]){if(k.isInitialised()){T.oCommonUtils.refreshSmartTable(k);}else{k.attachInitialise(function(){T.oCommonUtils.refreshSmartTable(k);});}if(!i){T.oServices.oApplicationController.executeSideEffects(C.getOwnerComponent().getBindingContext(),[],[k.getTableBindingPath()]);}}}});}function g1(e,i,j){var k=j.getBlocks().concat(j.getMoreBlocks());e.refresh=function(A1,B1){var C1=f1.bind(null,A1,B1);k.forEach(C1);};var x=T.oCommonUtils.getElementCustomData(j).strategyForVisibilityChange;e.strategyForVisibilityChange=e1[x]||q.noop;}function h1(e){return T.oCommonUtils.getControlInformation(e,g1);}function i1(i,e){var j=h1(e);if(j.isVisible===i){return;}j.isVisible=i;j.strategyForVisibilityChange(i,e,j);}function j1(e){i1(false,e);}function k1(e){e.getSubSections().forEach(j1);}function l1(e){var i=e&&e.getParameter("section");l=i?i.getId():o.getSelectedSection();}function m1(e){l1(e);B.stateChanged();}function n1(i){var e=C.getOwnerComponent()&&C.getOwnerComponent().getModel("i18n")&&C.getOwnerComponent().getModel("i18n").getResourceBundle();if(e&&e.getText("HideSideContent|"+i)!==("HideSideContent|"+i)){return e.getText("HideSideContent|"+i);}else if(e&&e.getText("HIDE_SIDE_CONTENT")!=="HIDE_SIDE_CONTENT"){return e.getText("HIDE_SIDE_CONTENT");}}function o1(i){var e=C.getOwnerComponent()&&C.getOwnerComponent().getModel("i18n")&&C.getOwnerComponent().getModel("i18n").getResourceBundle();if(e&&e.getText("ShowSideContent|"+i)!==("ShowSideContent|"+i)){return e.getText("ShowSideContent|"+i);}else if(e&&e.getText("SHOW_SIDE_CONTENT")!=="SHOW_SIDE_CONTENT"){return e.getText("SHOW_SIDE_CONTENT");}}function p1(e,i,j,k,x){var A1=A.createP13NColumnKey(x);var B1=A.getBindingForHiddenPath(x);if(B1==="{= !${} }"){e.push(A1);return false;}if(typeof(B1)==="string"){var C1=B1.match(r)&&B1.match(r)[0];if(C1&&C1.indexOf("/")>0&&k.navigationProperty){var D1=C.getOwnerComponent().getEntitySet();var E1=C1.split("/",1)[0];if(j.getODataAssociationSetEnd(k,E1).entitySet===D1){i[A1]=C1.split("/").slice(1).join("/");return true;}}}else if(!B1){e.push(A1);}return false;}function q1(Y,e,j,k,x,A1){var B1=[];var C1=Object.create(null);var D1=false;for(var i=0;i<A1.length;i++){var E1=A1[i];D1=p1(B1,C1,k,x,E1)||D1;}if(D1){e.dynamicHideInfos={staticHiddenColumns:B1,columnKeyToHiddenPath:C1};j.push("smartTableWithDynamicColumnHide");}if(B1.length){Y.deactivateColumns(B1);}}function r1(e,j,Y){j.push("smartTable");var k=Y.getModel().getMetaModel();var x=k.getODataEntitySet(Y.getEntitySet());var A1=k.getODataEntityType(x.entityType);var B1=A1["com.sap.vocabularies.UI.v1.LineItem"];var C1=Y.getCustomData();for(var i=0;i<C1.length;i++){if(C1[i].getKey()==="lineItemQualifier"){B1=A1["com.sap.vocabularies.UI.v1.LineItem#"+C1[i].getValue()];break;}}q1(Y,e,j,k,A1,B1);}function s1(Y){return T.oCommonUtils.getControlInformation(Y,r1);}function t1(e,i,j){i.push("searchField");var k=j.getParent().getParent();e.table=k;var x=s1(k);x.searchField=j;}function u1(e){return T.oCommonUtils.getControlInformation(e,t1);}function v1(e){u1(e);}function w1(e){var i=u1(e);i.searchString=e.getSource().getValue();i.table.rebindTable();}function x1(e,i){i.setValue("");if(e.searchString){e.searchString="";e.table.rebindTable();}}function y1(){T.oCommonUtils.executeForAllInformationObjects("searchField",x1);}v.refreshFacets=function(e){var i=function(j){var k=h1(j);k.refresh(e,false);};o.getSections().forEach(function(j){j.getSubSections().forEach(i);});};v.getHeaderInfoTitleForNavigationMenue=function(){var e=T.oComponentUtils.getTemplatePrivateModel();var i=e.getProperty("/generic/viewLevel");var j=e.getProperty("/objectPage/headerInfo/objectTitle");T.oServices.oApplication.subTitleForViewLevelChanged(i,j);};v.onComponentActivate=B.onComponentActivate;v.draftResume=function(e,j,k){var x=e.getObject();if(!x||!x.hasOwnProperty("IsActiveEntity")||x.IsActiveEntity!==false){return;}var A1=C.getView().getModel();var B1=A1.getMetaModel();var C1=B1.getODataEntitySet(C.getOwnerComponent().getEntitySet());var D1=B1.getODataEntityType(C1.entityType);var E1="";var F1="";var G1=D1["com.sap.vocabularies.Common.v1.SemanticKey"];for(var i in G1){var H1=G1[i];if(F1===""){F1=j[H1.PropertyPath];}else{F1=F1+"-"+j[H1.PropertyPath];}}var I1="-";if(k&&k.LastChangeDateTime!==null){var J1=D.getDateTimeInstance({pattern:"MMMM d, yyyy HH:mm",style:"long"});I1=J1.format(k.LastChangeDateTime);}var K1=[E1,F1,I1];var L1=T.oCommonUtils.getText("DRAFT_FOUND_RESUME",K1);var M1;var N1=T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.DraftResumeDialog",{onDraftResume:function(){N1.close();T.oServices.oNavigationController.navigateToContext(M1.getProperty("/siblingContext"),null,true);},onDraftDiscard:function(){N1.close();C.getView().getModel("ui").setProperty("/enabled",true);T.oServices.oCRUDManager.deleteEntity(true);M1.getProperty("/activeEntity").HasDraftEntity=false;T.oServices.oViewDependencyHelper.setAllPagesDirty();},onResumeDialogClosed:function(){M1.setProperty("/siblingContext",null);M1.setProperty("/activeEntity",null);}},"Dialog");M1=N1.getModel("Dialog");M1.setProperty("/draftResumeText",L1);M1.setProperty("/siblingContext",e);M1.setProperty("/activeEntity",j);N1.open();};v.getCurrentState=function(){var e=Object.create(null);if(l){e.section={data:l,lifecycle:{permanent:true,pagination:true}};}var i=Object.create(null);C.provideCustomStateExtension(i);for(var j in i){e["$custom$"+j]=i[j];}return e;};v.applyState=function(e,i){var j=Object.create(null);for(var k in e){if(k.indexOf("$custom$")===0){j[k.substring(8)]=e[k];}}C.applyCustomStateExtension(j,i);if(i){if(l!==(e.section||"")){B.stateChanged();}return;}y1();if(e.section){o.setSelectedSection(e.section);l1();}else{Promise.all([T.oComponentUtils.getHeaderDataAvailablePromise(),T.oComponentUtils.getNavigationFinishedPromise()]).then(s.bind(null,o));l="";}};v.beforeRebind=function(){o.getSections().forEach(k1);};v.afterRebind=function(){q.sap.log.info("Call of _triggerVisibleSubSectionsEvents","","Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");o._triggerVisibleSubSectionsEvents();};v.applyHeaderContextToSmartTablesDynamicColumnHide=function(e){var i=function(j,Y){var k=j.dynamicHideInfos.staticHiddenColumns.slice();for(var x in j.dynamicHideInfos.columnKeyToHiddenPath){var A1=j.dynamicHideInfos.columnKeyToHiddenPath[x];if(e.getProperty(A1)){k.push(x);}}Y.deactivateColumns(k);};T.oCommonUtils.executeForAllInformationObjects("smartTableWithDynamicColumnHide",i);};var Q=t.testable(Q,"editEntity");var W=t.testable(W,"isEntryDeletable");var p=t.testable(p,"onActivateImpl");var z1={onInit:function(){o=C.byId("objectPage");var e=G();var k=C.getOwnerComponent().getAppComponent().getConfig();var x=k&&k.settings&&k.settings.objectPageDynamicHeaderTitleWithVM;v.aBreadCrumbs=e&&(x?e.getBreadcrumbs().getLinks():e.getBreadCrumbsLinks());if(x){a1();}B.onInit();b1();T.oCommonUtils.executeGlobalSideEffect();o.attachEvent("subSectionEnteredViewPort",function(i){var j=i.getParameter("subSection");q.sap.log.info("Viewport entered ","Subsection: "+j.getId(),"Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");i1(true,j);});sap.ui.Device.resize.attachHandler(function(A1){var B1="";var C1=C.getOwnerComponent();var D1=o.getSections();for(var i=1;i<D1.length;i++){var E1=D1[i].getSubSections();for(var j=0;j<E1.length;j++){var F1=E1[j];if(F1.getBlocks()[0]instanceof c){var G1=sap.ui.getCore().byId(F1.getBlocks()[0].getId());var H1=F1.getActions()[(F1.getActions().length)-1];var I1=F1.getId();I1=I1.substring(I1.indexOf(C1.getEntitySet()),I1.lastIndexOf("::"));I1=I1.replace(/--/g,"|").replace(/::/g,"|");if(G1.getShowSideContent()===true){B1=n1(I1);H1.setText(B1);if(A1.width>720){G1.setShowMainContent(true);}}else{B1=o1(I1);H1.setText(B1);}}}}},o);},handlers:{addEntry:function(e){var X=e.getSource();var Y=T.oCommonUtils.getOwnerControl(X);var i=I(Y);if(!X.data("CrossNavigation")&&i){T.oCommonEventHandlers.addEntry(X,true);return;}T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){T.oCommonEventHandlers.addEntry(X,false);},q.noop,B.state);},deleteEntries:$,onSelectionChange:function(e){T.oCommonUtils.setEnabledToolbarButtons(e.getSource());},onCancel:function(e){var i="Proceed";var j;if(T.oComponentUtils.isNonDraftCreate()||!h){i="LeavePage";}T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){var k=T.oComponentUtils.getTemplatePrivateModel();k.setProperty("/objectPage/displayMode",1);if(T.oComponentUtils.isNonDraftCreate()){v.setEditable(false);}else if(h){v.setEditable(false);}if(T.oComponentUtils.isNonDraftCreate()||!h){T.oServices.oNavigationController.navigateBack();}},q.noop,B.state,i,j,e);},onContactDetails:function(e){T.oCommonEventHandlers.onContactDetails(e);},onPressDraftInfo:function(e){var i=C.getView().getBindingContext();var j=sap.ui.getCore().byId(e.getSource().getId()+(e.getId()==="markChangesPress"?"-changes":"-lock"));T.oCommonUtils.showDraftPopover(i,j);},onPressDraftInfoObjectPageDynamicHeaderTitle:function(e){var i=C.getView().getBindingContext();var j=C.byId("template::ObjectPage::ObjectMarkerObjectPageDynamicHeaderTitle");T.oCommonUtils.showDraftPopover(i,j);},onShareObjectPageActionButtonPress:H,onRelatedApps:function(e){var x,A1,B1,C1,D1,E1,F1;var G1,H1,I1,J1,K1;x=e.getSource();I1=sap.ushell&&sap.ushell.Container;A1=I1&&I1.getService("URLParsing");B1=A1.parseShellHash(document.location.hash);J1=B1.semanticObject;K1=B1.action;C1=C.getView&&C.getView().getBindingContext();var L1=C.getOwnerComponent().getModel().getMetaModel();var M1=C1.getObject();var N1=M1.__metadata.type;var O1=L1.getODataEntityType(N1);var P1=O1["com.sap.vocabularies.Common.v1.SemanticKey"];var Q1={};if(P1&&P1.length>0){for(var j=0;j<P1.length;j++){var R1=P1[j].PropertyPath;if(!Q1[R1]){Q1[R1]=[];Q1[R1].push(M1[R1]);}}}else{for(var k in O1.key.propertyRef){var S1=O1.key.propertyRef[k].name;if(!Q1[S1]){Q1[S1]=[];Q1[S1].push(M1[S1]);}}}D1=C.getOwnerComponent().getAppComponent();E1=I1&&I1.getService("CrossApplicationNavigation");F1=E1.getLinks({semanticObject:J1,params:Q1,ui5Component:D1});G1=K();H1=G1.getModel("buttons");H1.setProperty("/buttons",[]);G1.openBy(x);F1.done(function(T1){var U1=[];T1.sort(function(Y1,Z1){if(Y1.text<Z1.text){return-1;}if(Y1.text>Z1.text){return 1;}return 0;});for(var i=0;i<T1.length;i++){var V1=T1[i];var W1=V1.intent;var X1=W1.split("-")[1].split("?")[0];if(X1!==K1){U1.push({enabled:true,text:V1.text,link:V1,param:Q1});}}if(U1.length===0){U1.push({enabled:false,text:T.oCommonUtils.getText("NO_RELATED_APPS")});}H1.setProperty("/buttons",U1);});},onSemanticObjectLinkPopoverLinkPressed:function(e){T.oCommonEventHandlers.onSemanticObjectLinkPopoverLinkPressed(e,B.state);},onEdit:function(e){var X=e.getSource();if(X.data("CrossNavigation")){T.oCommonEventHandlers.onEditNavigateIntent(X);return;}h=true;Q();},onSave:y,onActivate:u,onSmartFieldUrlPressed:function(e){T.oCommonEventHandlers.onSmartFieldUrlPressed(e,B.state);},onBreadCrumbUrlPressed:function(e){T.oCommonEventHandlers.onBreadCrumbUrlPressed(e,B.state);},onDiscardDraft:function(e){T.oCommonEventHandlers.onDiscardDraft(e);},onDelete:N,onCallActionFromToolBar:function(e){T.oCommonEventHandlers.onCallActionFromToolBar(e,B.state);},onCallAction:function(e){var i=C.getOwnerComponent();var j=i.getNavigationProperty();var k=T.oCommonUtils.getCustomData(e);var x=[];x.push(C.getView().getBindingContext());if(x[0]&&k.Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"){T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){var A1={functionImportPath:k.Action,contexts:x,sourceControl:"",label:k.Label,operationGrouping:k.InvocationGrouping,navigationProperty:C.getOwnerComponent().getNavigationProperty()};T.oServices.oCRUDManager.callAction(A1).then(function(B1){var C1=B1&&B1[0];if(C1&&C1.response&&C1.response.context&&(!C1.actionContext||C1.actionContext&&C1.response.context.getPath()!==C1.actionContext.getPath())){T.oServices.oViewDependencyHelper.setParentToDirty(i,j,1);}});},q.noop,B.state,"Proceed");}else if(k.Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){T.oCommonEventHandlers.onDataFieldForIntentBasedNavigation(e,B.state);}},onDataFieldForIntentBasedNavigation:function(e){T.oCommonEventHandlers.onDataFieldForIntentBasedNavigation(e,B.state);},onDataFieldWithIntentBasedNavigation:function(e){T.oCommonEventHandlers.onDataFieldWithIntentBasedNavigation(e,B.state);},onDataFieldWithNavigationPath:function(e){T.oCommonEventHandlers.onDataFieldWithNavigationPath(e);},onChartInit:function(e){var i=e.getSource().getChart();var j=C._templateEventHandlers.onSelectionChange;i.attachSelectData(j).attachDeselectData(j);var k=i.getParent();T.oCommonUtils.checkToolbarIntentsSupported(k);},onDataRequested:function(i){q.sap.log.info("Data requested","SmartTable: "+i,"Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");},onDataReceived:function(e){T.oCommonEventHandlers.onDataReceived(e);},onBeforeRebindDetailTable:function(e){var Y=e.getSource();var i=n(e);var j=s1(Y);var k=j.searchField;if(k){var x=T.oCommonUtils.getControlInformation(k);if(x.searchString){i.parameters.custom={search:x.searchString};}}T.oCommonEventHandlers.onBeforeRebindTable(e);C.onBeforeRebindTableExtension(e);z(e);if(T.oCommonUtils.isAnalyticalTable(Y.getTable())){i.parameters.entitySet=Y.getEntitySet();}},onShowDetails:function(e){T.oCommonEventHandlers.onShowDetails(e.getSource(),B.state);},onListNavigate:function(e){if(!C.onListNavigationExtension(e)){T.oCommonEventHandlers.onListNavigate(e.getSource(),B.state);}},onBeforeSemanticObjectLinkPopoverOpens:function(e){var i=e.getParameters();T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){var j=U();T.oCommonUtils.semanticObjectLinkNavigation(i,j,C);},q.noop,B.state,q.noop);},onSemanticObjectLinkNavigationPressed:function(e){var i=e.getParameters();var X=e.getSource();T.oCommonEventHandlers.onSemanticObjectLinkNavigationPressed(X,i);},onSemanticObjectLinkNavigationTargetObtained:function(e){var i=e.getParameters();var X=e.getSource();T.oCommonEventHandlers.onSemanticObjectLinkNavigationTargetObtained(X,i,B.state);},onSemanticObjectLinkNavigationTargetObtainedSmartLink:function(e){var i,X;i=e.getParameters();X=e.getSource();X=X.getParent().getParent().getParent().getParent();T.oCommonEventHandlers.onSemanticObjectLinkNavigationTargetObtained(X,i,B.state);},onHeaderImagePress:function(e){var i=_();var j=e.getSource().getId();i.addAriaLabelledBy(j);var k=i.getModel("headerImage");k.setProperty("/src",e.getSource().getSrc());if(sap.ui.Device.system.phone){i.setProperty("stretch",true);}i.open();},sectionNavigate:m1,onInlineDataFieldForAction:function(e){T.oCommonEventHandlers.onInlineDataFieldForAction(e,B.state);},onInlineDataFieldForIntentBasedNavigation:function(e){T.oCommonEventHandlers.onInlineDataFieldForIntentBasedNavigation(e.getSource(),B.state);},onDeterminingDataFieldForAction:function(e){T.oCommonEventHandlers.onDeterminingDataFieldForAction(e);},onBeforeRebindChart:function(e){n(e);var i=e.getSource();i.oModels=i.getChart().oPropagatedProperties.oModels;},onToggleDynamicSideContent:function(e){var i="";var j=e.getSource().getParent();var k=C.getOwnerComponent();var x=j.getId();x=x.substring(x.indexOf(k.getEntitySet()),x.lastIndexOf("::"));x=x.replace(/--/g,"|").replace(/::/g,"|");var A1=sap.ui.getCore().byId(j.getBlocks()[0].getId());if(A1.getShowSideContent()===false){i=n1(x);if(sap.ui.Device.resize.width<=720){A1.setShowMainContent(false);}A1.setShowSideContent(true);e.getSource().setText(i);}else{i=o1(x);if(sap.ui.Device.resize.width<=720){A1.setShowMainContent(true);}A1.setShowSideContent(false);e.getSource().setText(i);}},onTableInit:function(e){var Y=e.getSource();var i=Y.getTable();s1(Y);T.oCommonUtils.checkToolbarIntentsSupported(Y);if(I(Y)&&!Y.data("CrossNavigation")){i.addEventDelegate({onkeyup:function(e){if(e.ctrlKey&&e.keyCode===q.sap.KeyCodes.ENTER&&Y.getEditable()){T.oCommonEventHandlers.addEntry(Y,true);e.preventDefault();e.setMarked();}}});}},onSearchObjectPage:w1,onSearchLiveChange:v1},formatters:{setNoDataTextForSmartTable:function(){var e=C.getOwnerComponent()&&C.getOwnerComponent().getModel("i18n")&&C.getOwnerComponent().getModel("i18n").getResourceBundle();if(e&&e.getText("NOITEMS_SMARTTABLE")!=="NOITEMS_SMARTTABLE"){return e.getText("NOITEMS_SMARTTABLE");}else{var i=C.getOwnerComponent().getAppComponent();e=i&&i.getModel("i18n")&&i.getModel("i18n").getResourceBundle();if(e&&e.hasText("NOITEMS_SMARTTABLE")){return e.getText("NOITEMS_SMARTTABLE");}else{return"";}}},setVMVisibilityForVendor:function(){var e=q.sap.getUriParameters();if(e.mParams["sap-ui-layer"]){var j=e.mParams["sap-ui-layer"];for(var i=0;i<j.length;i++){if(j[i].toUpperCase()==="VENDOR"){return true;}}}return false;}},extensionAPI:new E(T,C,B)};z1.handlers=q.extend(B.handlers,z1.handlers);return z1;}};return m;});
