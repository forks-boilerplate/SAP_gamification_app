// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
(function(){"use strict";var d=(!window.sap||!sap.ui||!sap.ui.define)?function(v,c){return c();}:sap.ui.define;return d([],function(){var _={pendingEvents:{},subscribers:{},dispatchOperations:{}};function l(M,D,C){if(jQuery&&jQuery.sap&&jQuery.sap.log&&jQuery.sap.log.error){jQuery.sap.log.error(M,D,"sap.ushell.EventHub");return;}if(window.console){var A=[M,D];if(C){A.push("error caused by:");A.push(C);}window.console.error.apply(window.console,A);}}function a(v){var M="An exception was raised while executing a registered callback on event '"+v.eventName+"'";var D="Data passed to the event were: '"+v.eventData+"'";if(v.error.stack){D+=" Error details: "+v.error.stack;}l(M,D,v.fnCausedBy);}function s(v,C,D){var R;try{R=C(D);}catch(x){a({eventName:v,eventData:D,fnCausedBy:C,error:x});}return R;}function b(D){if(typeof D==="object"||typeof D==="function"){try{return JSON.stringify(D);}catch(v){l(""+v,v.stack,b);}}return D;}function c(D){try{return JSON.parse(D);}catch(v){return D;}}function e(H,v,S){if(!H.subscribers[v]){H.subscribers[v]=[];}H.subscribers[v].push(S);}function u(H,v,x){H.subscribers[v]=(H.subscribers[v]||[]).map(function(S){return S.filter(function(L){return L.fn!==x;});}).filter(function(G){return G.length>0;});}function f(){var D;var v=new Promise(function(R){D=R;});var x={dispatching:v,cancelled:false,cancel:function(){x.cancelled=true;},complete:function(){D();}};return x;}function g(H,v){if(!H.subscribers.hasOwnProperty(v)){return null;}var D=f();var S=H.subscribers[v];var G=S.map(function(x){return h(H,v,x,D,0);});Promise.all(G).then(D.complete,D.complete);return D;}function h(H,v,S,D,x){var O=S.length;var y=S.slice(x);return y.reduce(function(P,z,I){return P.then(function(A){if(D.cancelled){u(H,v,z.fn);return A;}return n(H,v,z,S).then(function(B){if(B){D.cancelled=true;}return B;});});},Promise.resolve(false)).then(function(z){if(!z&&O<S.length){return h(H,v,S,D,O);}return z;});}function n(H,v,S,x){return new Promise(function(R){var D=c(H.pendingEvents[v]);setTimeout(function(){if(S.called&&x.offed){R(false);return;}S.called=true;var O=x.offed;s(v,S.fn,D);var y=x.offed;if(y){u(H,v,S.fn);}R(!O&&y);},0);});}function i(H,v,S){return function(){S.forEach(function(L){if(L.called){u(H,v,L.fn);}});S.offed=true;return{off:i(H,v,[])};};}function j(H,v,S){return function(C){var x={fn:C,called:false};S.push(x);if(H.pendingEvents.hasOwnProperty(v)){var D=H.dispatchOperations[v];if(!D){n(H,v,x,S);}else{D.dispatching.then(function(){if(!x.called){n(H,v,x,S);}});}}return{do:j(H,v,S),off:i(H,v,S)};};}function o(H,v){var S=[];e(H,v,S);return{do:j(H,v,S),off:i(H,v,S)};}function k(H,v){var D=o(H,v);D.off();return D;}function m(H,v,D){var S=b(D);if(H.pendingEvents.hasOwnProperty(v)&&H.pendingEvents[v]===S){return this;}H.pendingEvents[v]=S;var x=H.dispatchOperations[v];if(x){x.cancel();}var N=g(H,v);H.dispatchOperations[v]=N;return this;}function p(H,v){return c(H.pendingEvents[v]);}function q(H){var A=Array.prototype.slice.call(arguments);A.shift();var C=0;var O=new Array(A.length).join(",").split(",").map(function(){return 1;});var v=[];var D={do:function(x){A.forEach(function(y,I){y.do(function(I,V){v[I]=V;C+=O[I];O[I]=0;if(C===A.length){x.apply(null,v);}}.bind(null,I));});return{off:D.off};},off:function(){var x=A.reduce(function(x,y){return y.off();},function(){});return{off:x};}};return D;}function w(H,v){var D=H.dispatchOperations[v];return D?D.dispatching:Promise.resolve();}function r(H){var v={};v.emit=m.bind(v,H);v.on=o.bind(null,H);v.once=k.bind(null,H);v.last=p.bind(null,H);v.join=q.bind(null,H);v.wait=w.bind(null,H);v._reset=function(H){H.pendingEvents={};H.subscribers={};H.dispatchOperations={};}.bind(null,H);return v;}function t(C){var x=c(b(C));var y={pendingEvents:{},subscribers:{},dispatchOperations:{}};var z=r(y);function A(v){var S=v.charAt(0);if(S.match(/[a-zA-Z0-9]/)){throw new Error("Invalid path separator '"+S+"'. Please ensure path starts with a non alphanumeric character");}var Q=v.split(S);Q.shift();return Q;}function B(v){return"/"+v.join("/");}function D(v){return Object.prototype.toString.apply(v)==="[object Array]";}function F(v){return Object(v)!==v;}function G(v){return(D(v)?v.length:Object.keys(v).length)===0;}function H(v,Q,R,V){var S="";var T=v;return R.reduce(function(U,W,X){S+="/"+W;T=v[W];if(X===R.length-1){if(U[W]!==null&&typeof U[W]==="object"){throw new Error("Cannot assign a value to a non-leaf node at path '"+S+"'");}U[W]=V;return U[W];}if(!U.hasOwnProperty(W)){U[W]=D(T)?[]:{};}return U[W];},Q);}function I(v,Q){var R="";var S=Q.reduce(function(T,U){R+="/"+U;if(D(T)&&!U.match(/^[0-9]+$/)){throw new Error("Invalid array index '"+U+"' provided in path '"+R+"'");}if(!T.hasOwnProperty(U)){throw new Error("The item '"+U+"' from path "+R+" cannot be accessed in the object: "+b(T));}return T[U];},v);return S;}function J(v,Q){Q.pop();var V=v;var R=[];return Q.reduce(function(S,T){V=V[T];R.push(T);S.push({serializedPath:B(R),value:V});return S;},[]);}function K(v){return v.map(function(Q){var S=Q.serializedPath;if(!y.subscribers.hasOwnProperty(S)||y.subscribers[S].length===0){return null;}return{path:S,value:Q.value};}).filter(function(Q){return!!Q;});}function L(v,Q){var R=A(v);I(C,R);H(C,x,R,Q);z.emit(B(R),Q);var S=J(x,R);K(S).forEach(function(T){z.emit(T.path,T.value);});}function M(v){var Q=A(v);var V=I(C,Q);if(V===undefined){return undefined;}return I(x,Q);}function N(v){var Q=A(v);var S=B(Q);var R=z.last(S);var V=y.pendingEvents.hasOwnProperty(S);if(V){return z.on(S);}R=I(C,Q);if(typeof R!=="undefined"&&(F(R)||!G(c(b(R))))){z.emit(S,R);}return z.on(S);}function O(v){var Q=N(v);Q.off();return Q;}function P(v){var Q=A(v);var R=J(x,Q);var W=K(R).map(function(S){return z.wait(S.path,S.value);});return Promise.all(W.concat(z.wait(v)));}return{emit:L,on:N,once:O,last:M,wait:P,join:q.bind(null,z)};}var E=r(_);E.createChannel=t.bind(null);return E;},false);})();
