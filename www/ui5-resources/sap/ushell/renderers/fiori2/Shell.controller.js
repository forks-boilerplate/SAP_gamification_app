// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(['sap/ushell/ui5service/ShellUIService','sap/ui/Device','sap/ushell/CanvasShapesManager','./AccessKeysHandler','./History','./Lifecycle','sap/ushell/components/applicationIntegration/AppLifeCycle','sap/ushell/services/AppConfiguration','sap/ushell/services/AppType','sap/ushell/services/Message','sap/ushell/services/ShellNavigation','sap/ushell/ui/launchpad/Fiori2LoadingDialog','sap/ushell/utils','sap/ushell/resources','sap/ushell/UserActivityLog','sap/ushell/EventHub','sap/ushell/Config'],function(S,D,C,A,H,L,a,b,c,M,d,F,u,r,U,E,f){"use strict";var g=true,h=true,p=false,B=false,s,j=a.getElementsModel(),m,o={embedded:0,newWindowThenEmbedded:1,newWindow:1,replace:0},n={embedded:"embedded",newWindowThenEmbedded:"newWindowThenEmbedded",newWindow:"newWindow",replace:"replace"},k={},l;sap.ui.controller("sap.ushell.renderers.fiori2.Shell",{onInit:function(){h=true;B=false;g=true;var v=this.getView();var e=window.matchMedia("(min-width: 600px)"),i;var k=(v.getViewData()?v.getViewData().config:{})||{};a.parseStatefulContainerConfiguration(k.statefulApplicationContainer);this.bMeAreaSelected=false;this.bNotificationsSelected=false;this.oEndUserFeedbackConfiguration={showAnonymous:true,anonymousByDefault:true,showLegalAgreement:true,showCustomUIContent:true,feedbackDialogTitle:true,textAreaPlaceholder:true,customUIContent:undefined};this.bMeAreaLoaded=false;k["enableBackGroundShapes"]=k.enableBackGroundShapes===undefined?true:k.enableBackGroundShapes;l=this._historyBackNavigation;this.initShellModel(k);i=function(w){m.setProperty('/isPhoneWidth',!w.matches);};if(e.addListener){e.addListener(i);i(e);}v.setModel(m);v.setModel(r.i18nModel,"i18n");v.oShellHeader.setModel(m);v.oShellHeader.setModel(r.i18nModel,"i18n");sap.ui.getCore().getEventBus().subscribe("externalSearch",this.externalSearchTriggered,this);this._setConfigurationToModel();if(k.moveEditHomePageActionToShellHeader){sap.ui.getCore().getEventBus().subscribe("showCatalog",this._hideEditButton,this);}sap.ui.getCore().getEventBus().subscribe("launchpad","contentRendered",this._loadCoreExt,this);sap.ui.getCore().getEventBus().subscribe("sap.ushell.renderers.fiori2.Renderer","appOpened",this.setBackGroundShapes,this);sap.ui.getCore().getEventBus().subscribe("sap.ushell","coreResourcesFullyLoaded",this._postCoreExtActivities,this);sap.ui.getCore().getEventBus().subscribe("sap.ushell.renderers.fiori2.Renderer","appOpened",this.delayedCloseLoadingScreen,this);sap.ui.getCore().getEventBus().subscribe("launchpad","toggleContentDensity",this.toggleContentDensity,this);sap.ui.getCore().getEventBus().subscribe("sap.ushell.renderers.fiori2.Renderer","appOpened",this._loadCoreExtNonUI5,this);sap.ui.getCore().getEventBus().subscribe("launchpad","appClosed",this.logApplicationUsage,this);sap.ui.getCore().getEventBus().subscribe("launchpad","shellFloatingContainerDockedIsResize",this._onResizeWithDocking,this);sap.ui.getCore().getEventBus().subscribe("launchpad","launchpadCustomRouterRouteMatched",this._centerViewPort,this);sap.ushell.Container.getServiceAsync("AppLifeCycle");s.addHeaderEndItem(["NotificationsCountButton"],false,["home","app","minimal"],true);this.history=new H();this.oViewPortContainer=sap.ui.getCore().byId("viewPortContainer");a.init(k.appState,this.oViewPortContainer,k.rootIntent,k.disableHomeAppCache,{ownerComponent:this.getOwnerComponent()});this.oNotificationsCountButton=sap.ui.getCore().byId("NotificationsCountButton");this.oFiori2LoadingDialog=sap.ui.getCore().byId("Fiori2LoadingDialog");this.oShellNavigation=sap.ushell.Container.getService("ShellNavigation");this.oShellNavigation.registerNavigationFilter(this._handleEmptyHash.bind(this));this.oShellNavigation.init(this.doHashChange.bind(this));this.oShellNavigation.registerNavigationFilter(this.handleDataLoss.bind(this));sap.ushell.Container.getServiceAsync("Message").then(function(w){w.init(this.doShowMessage.bind(this));}.bind(this));sap.ushell.Container.setLogonFrameProvider(this._getLogonFrameProvider());A.init(m);window.onbeforeunload=function(){if(sap.ushell.Container&&sap.ushell.Container.getDirtyFlag()){if(!r.browserI18n){r.browserI18n=r.getTranslationModel(window.navigator.language).getResourceBundle();}return r.browserI18n.getText("dataLossExternalMessage");}};if(m.getProperty("/contentDensity")){a.getAppMeta()._applyContentDensityClass();}D.media.attachHandler(this.onScreenSizeChange.bind(this),null,D.media.RANGESETS.SAP_STANDARD);this.onScreenSizeChange(D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD));this.initShellUIService();if(this.getView().oShellNavigationMenu){this.getView().oShellNavigationMenu.setModel(m);}sap.ui.getCore().attachThemeChanged(this.redrawBackGroundShapes);if(k.sessionTimeoutIntervalInMinutes){var q=20000,t=this;setTimeout(function(){t._createSessionHandler(k);},q);}},initShellModel:function(k){s=j;s.init(k);m=s.getModel();},redrawBackGroundShapes:function(){if(k.enableBackGroundShapes){C.drawShapes();}},setBackGroundShapes:function(){var v=this.getView(),m=v.getModel(),e=m.getProperty('/animationMode')!=='minimal';if(!B&&k.enableBackGroundShapes){B=true;C.drawShapes();C.enableAnimationDrawing(e);}},initShellUIService:function(){a.initShellUIService({fnOnBackNavigationChange:this.onBackNavigationChange.bind(this)});if(k.enableOnlineStatus){sap.ui.require(["sap/ushell/ui5service/UserStatus"],function(e){this.oUserStatus=new e({scopeObject:this.getOwnerComponent(),scopeType:"component"});this.oUserStatus.attachEnabledStatusChanged(function(i){this.getModel().setProperty("/userStatusEnabled",i.mParameters.data);}.bind(this));this.oUserStatus.attachStatusChanged(function(i){this.getModel().setProperty("/userStatus",i.mParameters.data);if(i.mParameters.data==null){this.getModel().setProperty("/userStatusUserEnabled",false);}else{this.getModel().setProperty("/userStatusUserEnabled",true);}}.bind(this));}.bind(this));}},onBackNavigationChange:function(e){this.isBackNavigationChanged=true;var i=e.getParameters().data,m=this.getModel(),q=m.getProperty('/currentState/');if(i){l=i;if(q.stateName==='minimal'||q.stateName==='standalone'||q.stateName==='embedded'){sap.ushell.Container.getRenderer('fiori2').showHeaderItem('backBtn',true);}}else{l=this._historyBackNavigation;}},toggleContentDensity:function(e,i,q){var t=q.contentDensity==="compact";a.getAppMeta()._applyContentDensityByPriority(t);},loadMeAreaView:function(){},_handleEmptyHash:function(e){e=(typeof e==="string")?e:"";e=e.split("?")[0];if(e.length===0){var v=this.getView()?this.getView().getViewData():{};k=v.config||{};if(k.migrationConfig){return this.oShellNavigation.NavigationFilterStatus.Continue;}if(k.rootIntent){setTimeout(function(){window.hasher.setHash(k.rootIntent);},0);return this.oShellNavigation.NavigationFilterStatus.Abandon;}}return this.oShellNavigation.NavigationFilterStatus.Continue;},_setConfigurationToModel:function(){var v=this.getView().getViewData(),e,i;if(v){k=v.config||{};}if(k){if(k.states){i=m.getProperty('/states');for(e in k.states){if(k.states.hasOwnProperty(e)){i[e]=k.states[e];}}m.setProperty('/states',i);}if(k.appState==="headerless"||k.appState==="merged"||k.appState==="blank"){m.setProperty("/personalization",false);k.enablePersonalization=false;}else if(k.enablePersonalization!==undefined){m.setProperty("/personalization",k.enablePersonalization);}if(k.changeEndUserFeedbackTitle!==undefined){this.oEndUserFeedbackConfiguration.feedbackDialogTitle=k.changeEndUserFeedbackTitle;}if(k.changeEndUserFeedbackPlaceholder!==undefined){this.oEndUserFeedbackConfiguration.textAreaPlaceholder=k.changeEndUserFeedbackPlaceholder;}if(k.showEndUserFeedbackAnonymousCheckbox!==undefined){this.oEndUserFeedbackConfiguration.showAnonymous=k.showEndUserFeedbackAnonymousCheckbox;}if(k.makeEndUserFeedbackAnonymousByDefault!==undefined){this.oEndUserFeedbackConfiguration.anonymousByDefault=k.makeEndUserFeedbackAnonymousByDefault;}if(k.showEndUserFeedbackLegalAgreement!==undefined){this.oEndUserFeedbackConfiguration.showLegalAgreement=k.showEndUserFeedbackLegalAgreement;}if(k.enableSetTheme!==undefined){m.setProperty("/setTheme",k.enableSetTheme);}m.setProperty("/contentDensity",k.enableContentDensity===undefined?true:k.enableContentDensity);if(k.title){m.setProperty("/title",k.title);}if(k.migrationConfig!==undefined){m.setProperty("/migrationConfig",k.migrationConfig);}if(k.enableUserDefaultParameters!==undefined){m.setProperty("/userDefaultParameters",k.enableUserDefaultParameters);}if(k.disableHomeAppCache!==undefined){m.setProperty("/disableHomeAppCache",k.disableHomeAppCache);}m.setProperty("/enableHelp",!!k.enableHelp);m.setProperty("/searchAvailable",(k.enableSearch!==false));if(k.sizeBehavior!==undefined){m.setProperty("/sizeBehavior",k.sizeBehavior);}else{m.setProperty("/sizeBehavior","Responsive");}m.bindProperty('/animationMode').attachChange(this.handleAnimationModeChange.bind(this));m.setProperty("/animationMode",k.animationMode);this._getPersonalizer({container:"flp.launchpad.animation.mode",item:"animationMode"}).getPersData().then(function(t){m.setProperty("/animationMode",t?t:k.animationMode);k.animationMode=t?t:k.animationMode;}.bind(this));var q=this._getTrackingUserActivies();q.done(function(t){if(t!==undefined){m.setProperty("/enableTrackingActivity",t);}else{m.setProperty("/enableTrackingActivity",true);}});}},_getTrackingUserActivies:function(){var e=this._getPersonalizer({container:"flp.settings.FlpSettings",item:"userActivitesTracking"}).getPersData();e.fail(function(i){jQuery.sap.log.error("Failed to load anchor bar state from the personalization",i,"sap.ushell.components.flp.settings.FlpSettings");});return e;},_hideEditButton:function(){var e=sap.ui.getCore().byId("ActionModeBtn");if(e){e.setVisible(false);}},_getPreviousPageDirty:function(){return p;},_setPreviousPageDirty:function(e){p=e;},getModelConfiguration:function(){var v=this.getView().getViewData(),e,i;if(v){e=v.config||{};i=jQuery.extend({},e);}delete i.applications;return i;},_getLogonFrameProvider:function(){var v=this.getView();return{create:function(){return v.createIFrameDialog();},show:function(){v.showIFrameDialog();},destroy:function(){v.destroyIFrameDialog();}};},onExit:function(){sap.ui.getCore().getEventBus().unsubscribe("launchpad","contentRendered",this._loadCoreExt,this);sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.renderers.fiori2.Renderer","appOpened",this.setBackGroundShapes,this);sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.renderers.fiori2.Renderer","appOpened",this.delayedCloseLoadingScreen,this);sap.ui.getCore().getEventBus().unsubscribe("launchpad","toggleContentDensity",this.toggleContentDensity,this);sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.renderers.fiori2.Renderer","appOpened",this._loadCoreExtNonUI5,this);sap.ui.getCore().getEventBus().unsubscribe("launchpad","appClosed",this.logApplicationUsage,this);sap.ui.getCore().getEventBus().unsubscribe("sap.ushell","coreResourcesFullyLoaded",this._postCoreExtActivities,this);sap.ui.getCore().getEventBus().unsubscribe("launchpad","launchpadCustomRouterRouteMatched",this._centerViewPort,this);sap.ui.getCore().getEventBus().unsubscribe("externalSearch",this.externalSearchTriggered,this);sap.ui.getCore().getEventBus().unsubscribe("showCatalog",this._hideEditButton,this);D.media.detachHandler(this.onScreenSizeChange.bind(this),null,D.media.RANGESETS.SAP_STANDARD);this.oShellNavigation.hashChanger.destroy();this.getView().aDanglingControls.forEach(function(i){if(i.destroyContent){i.destroyContent();}i.destroy();});var e=this.getView().oShellHeader;if(e){e.destroy();}U.deactivate();s.destroy();s=undefined;},handleAnimationModeChange:function(){var v=this.getView(),m=v.getModel(),e=m.getProperty('/animationMode'),i=e!=='minimal';C.enableAnimationDrawing(i);sap.ui.getCore().getEventBus().publish("launchpad","animationModeChange",e);},getAnimationType:function(){return"show";},onCurtainClose:function(e){jQuery.sap.log.warning("Closing Curtain",e);},handleDataLoss:function(e,i){if(!h){h=true;this.closeLoadingScreen();return this.oShellNavigation.NavigationFilterStatus.Custom;}if(sap.ushell.Container.getDirtyFlag()){if(!r.browserI18n){r.browserI18n=r.getTranslationModel(window.navigator.language).getResourceBundle();}if(confirm(r.browserI18n.getText("dataLossInternalMessage"))){sap.ushell.Container.setDirtyFlag(false);p=true;return this.oShellNavigation.NavigationFilterStatus.Continue;}h=false;window.history.back();return this.oShellNavigation.NavigationFilterStatus.Custom;}return this.oShellNavigation.NavigationFilterStatus.Continue;},doShowMessage:function(t,i,P){sap.ui.require(["sap/m/MessageToast","sap/m/MessageBox"],function(q,v){if(t===M.Type.ERROR){var w=f.last("/core/extension/SupportTicket");if(sap.ushell.Container&&w&&i!==r.i18n.getText("supportTicketCreationFailed")){sap.ui.require(["sap/ushell/ui/launchpad/EmbeddedSupportErrorMessage"],function(x){try{var y=new x("EmbeddedSupportErrorMessage",{title:P.title||r.i18n.getText("error"),content:new sap.m.Text({text:i})});y.open();}catch(e){v.show(i,v.Icon.ERROR,P.title||r.i18n.getText("error"));}});}else{v.show(i,v.Icon.ERROR,P.title||r.i18n.getText("error"));}}else if(t===M.Type.CONFIRM){if(P.actions){v.show(i,v.Icon.QUESTION,P.title,P.actions,P.callback);}else{v.confirm(i,P.callback,P.title);}}else{q.show(i,{duration:P.duration||3000});}});},_isColdStart:function(){if(this.history.getHistoryLength()<=1){return true;}this._isColdStart=function(){return false;};return false;},_setEnableHashChange:function(v){h=v;},_logRecentActivity:function(R){if(this._getConfig()&&s.getModel().getProperty("/enableTrackingActivity")){setTimeout(function(){if(sap.ushell.Container){b.addActivity(R);}},1500);}},_logOpenAppAction:function(e){if(k&&k.enableTilesOpacity&&k.enableRecentActivity&&j.getModel().getProperty("/enableTrackingActivity")){setTimeout(function(){if(sap.ushell.Container){sap.ushell.Container.getServiceAsync("UserRecents").then(function(i){i.addAppUsage(e);});}},1500);}},doHashChange:function(e,i,O,q,P){jQuery.sap.measure.start("FLP:ShellController.doHashChange","doHashChange","FLP");u.addTime("ShellControllerHashChange");return this._doHashChange(this,e,i,O,q,P).then(function(){jQuery.sap.measure.end("FLP:ShellController.doHashChange");},function(v){jQuery.sap.measure.end("FLP:ShellController.doHashChange");});},_doHashChange:function(e,i,q,O,t,P){var I,v,w;e.lastApplicationFullHash=t?O+t:O;if(!h){h=true;e.closeLoadingScreen();return jQuery.when();}if(P){e.hashChangeFailure(e.history.getHistoryLength(),P.message,null,"sap.ushell.renderers.fiori2.Shell.controller",false);return jQuery.when();}if(sap.m.InstanceManager&&g){sap.m.InstanceManager.closeAllDialogs();sap.m.InstanceManager.closeAllPopovers();}g=true;e.openLoadingScreen();if(u.getParameterValueBoolean("sap-ushell-no-ls")){e.closeLoadingScreen();}v=e.history.getHistoryLength();w=e.fixShellHash(i);e.history.hashChange(w,O);e.currentAppBeforeNav=b.getCurrentApplication();jQuery.sap.flpmeasure.end(0,"Creating Shell");jQuery.sap.flpmeasure.start(0,"targetResolution",1);return e._resolveHashFragment(w).then(function(R,x){jQuery.sap.flpmeasure.end(0,"targetResolution");jQuery.sap.flpmeasure.start(0,"CreateComponent",3);var y=x?x.semanticObject+"-"+x.action:"",k=e._getConfig(),z=!!(R&&R.componentHandle),T=R&&R.ui5ComponentName;R=e._calculateNavigationMode(x,R);if(R&&(R.navigationMode===n.newWindow||u.isNativeWebGuiNavigation(R))){if(k&&k.enableRecentActivity){var G=b.getMetadata(R);var J={};J.title=G.title;J.appType=R.applicationType;J.url=w;J.appId=w;e._logRecentActivity(J);}e._openAppInNewWindowAndRestore(R);return;}if(e.getModel().getProperty("/migrationConfig")){k.migrationConfig=false;e.getModel().setProperty("/migrationConfig",false);if(R&&w==='#'){k.rootIntent="";}else if(w==='#'){setTimeout(function(){window.hasher.setHash(k.rootIntent);},0);return;}}if(k&&k.applications&&k.applications[y]){R.applicationConfiguration=k.applications[y];}I=a.isAppInCache("application-"+y);if(z||I||!T){e._initiateApplication(R,w,x,v);return;}a.removeApplication(y);b.setApplicationInInitMode();sap.ui.getCore().getEventBus().publish("ApplicationContainer","_prior.newUI5ComponentInstantion",{name:T});jQuery.sap.measure.start("FLP:ShellController.UI5createComponent","UI5 createComponent","FLP");a.createComponent(R,x).done(function(K){jQuery.sap.measure.end("FLP:ShellController.UI5createComponent");jQuery.sap.flpmeasure.end(0,"CreateComponent");e._initiateApplication(R,w,x,v);}).fail(function(K){b.setCurrentApplication(e.currentAppBeforeNav);e.hashChangeFailure(v,"Failed to load UI5 component for navigation intent "+w,K,"sap.ushell.renderers.fiori2.Shell.controller",false);});},function(x){var y;y="Failed to resolve navigation target: \""+w+"\""+". This is most likely caused by an incorrect SAP Fiori launchpad content configuration"+" or by missing role assignment.";e.hashChangeFailure(v,y,x,"sap.ushell.renderers.fiori2.Shell.controller",false);});},_initiateApplication:function(R,e,P,O){jQuery.sap.measure.start("FLP:ShellController._initiateApplication","_initiateApplication","FLP");var i=b.getMetadata(R),q=f.last("/core/extension/SupportTicket");if(i.title){window.document.title=i.title;}else{jQuery.sap.log.debug("Shell controller._initiateApplication: the title of the window is not changed because most probably the application was resolved with undefined");}if(q){setTimeout(function(){sap.ushell.UserActivityLog.activate();},0);}this._logOpenAppAction(e);try{this.navigate(P,e,i,R);}catch(t){if(t.stack){jQuery.sap.log.error("Application initialization (Intent: \n"+e+"\n failed due to an Exception:\n"+t.stack);}this.hashChangeFailure(O,t.name,t.message,i?i.title:"",false);}finally{if(R&&R.coreResourcesFullyLoaded&&!this._pluginLoadingTriggered){this._loadRendererExtensionPlugins();}}jQuery.sap.measure.end("FLP:ShellController._initiateApplication");},_resolveHashFragment:function(e){jQuery.sap.measure.start("FLP:ShellController._resolveHashFragment","_resolveHashFragment","FLP");var R,P,i=sap.ushell.Container.getService("URLParsing").parseShellHash(e),q=new jQuery.Deferred(),k=this._getConfig();P=i&&i.params||{};if(i&&i.contextRaw&&i.contextRaw==="navResCtx"&&P&&P.additionalInformation&&(P.additionalInformation[0]||P.additionalInformation[0]==="")&&P.applicationType&&P.applicationType[0]&&P.url&&P.url[0]&&P.navigationMode&&(P.navigationMode[0]||P.additionalInformation[0]==="")){P=i.params||{};R={additionalInformation:P.additionalInformation[0],applicationType:P.applicationType[0],url:P.url[0],navigationMode:P.navigationMode[0]};if(P.title){R.text=P.title[0];}q.resolve(R,i);}else{if(window["sap-ushell-async-libs-promise-directstart"]){window["sap-ushell-async-libs-promise-directstart"].then(function(t){q.resolve(t.resolvedHashFragment,i);delete window["sap-ushell-async-libs-promise-directstart"];},function(t){q.reject(t);delete window["sap-ushell-async-libs-promise-directstart"];});return q.promise();}sap.ushell.Container.getService("NavTargetResolution").resolveHashFragment(e).done(function(R){if(i&&(i.semanticObject+"-"+i.action)===k.rootIntent){R.navigationMode="embedded";}jQuery.sap.measure.end("FLP:ShellController._resolveHashFragment");q.resolve(R,i);}).fail(function(t){q.reject(t);});}return q.promise();},_calculateNavigationMode:function(P,R){if(!R){return undefined;}var N=R.navigationMode;if(N===n.newWindowThenEmbedded){if(this._isColdStart()||(P.contextRaw&&P.contextRaw==="navResCtx")||this.history.backwards){R.navigationMode=n.embedded;}else{R.navigationMode=n.newWindow;if(!u.isNativeWebGuiNavigation(R)){R.url=this._getCurrentLocationHash();}}return R;}if(N===n.newWindow&&this._isColdStart()){R.navigationMode=n.replace;return R;}return R;},_usesNavigationRedirect:function(e){if(!e){return new jQuery.Deferred().reject().promise();}var t=this,i=e.getInstance({});if(i&&typeof i.navigationRedirect==="function"){var q=new jQuery.Deferred();var N=i.navigationRedirect();if(N&&typeof N.then==="function"){N.then(function(v){jQuery.sap.log.warning("Performing navigation redirect to hash "+v);i.destroy();t.history.pop();sap.ushell.Container.getService("ShellNavigation").toExternal({target:{shellHash:v}},undefined,false);q.resolve(true);},function(){q.reject();});return q.promise();}}return new jQuery.Deferred().reject().promise();},navigate:function(P,e,i,R){jQuery.sap.measure.start("FLP:ShellController.navigate","navigate","FLP");var N=(jQuery.isPlainObject(R)?R.navigationMode:null),t=this;if(N===null){if(this._isColdStart()){window.hasher.setHash("");return;}h=false;this.history.pop();this._windowHistoryBack(1);return;}R=this._calculateNavigationMode(P,R);N=(jQuery.isPlainObject(R)?R.navigationMode:null);if(N===n.embedded){var q=this._usesNavigationRedirect(R.componentHandle);q.then(null,function(){t._handleEmbeddedNavMode(e,P,i,R);if(P&&P.contextRaw==="navResCtx"){jQuery.sap.log.error(" This path will no longer be supported in 1.40");h=false;if(P&&P.params&&P.params.original_intent&&P.params.original_intent[0]){window.hasher.replaceHash(P.params.original_intent[0]);t.history._history[0]=P.params.original_intent[0];}}});jQuery.sap.measure.end("FLP:ShellController.navigate");return;}if(N===n.replace){h=false;this._changeWindowLocation(R.url);return;}if(N===n.newWindow){this._openAppInNewWindowAndRestore(R);return;}this.hashChangeFailure(this.history.getHistoryLength(),"Navigation mode is not recognized",null,"sap.ushell.renderers.fiori2.Shell.controller",false);},_openAppInNewWindowAndRestore:function(R){h=false;if(u.isNativeWebGuiNavigation(R)){try{var i=u.appendUserIdToUrl("sap-user",R.url);var q=u.getPrivateEpcm();var t=o[R.navigationMode];if(u.hasNavigationModeCapability()){q.doNavigate(i,t||o[n.embedded]);}else{q.doNavigate(i);}}catch(e){if(e.stack){jQuery.sap.log.error("Application initialization failed due to an Exception:\n"+e.stack);}this.hashChangeFailure(this.history.getHistoryLength(),e.name,e.message,R.text,false);}}else{this._openAppNewWindow(R.url);}this.history.pop();var v=R.componentHandle&&R.componentHandle.getInstance&&R.componentHandle.getInstance({});if(v){v.destroy();}this._windowHistoryBack(1);b.setCurrentApplication(this.currentAppBeforeNav);return;},_handleEmbeddedNavMode:function(e,P,i,R){jQuery.sap.measure.start("FLP:ShellController._handleEmbeddedNavMode","_handleEmbeddedNavMode","FLP");var q,I,t;this.resetShellUIServiceHandlers();a.getAppMeta().setAppIcons(i);q='-'+P.semanticObject+'-'+P.action;I=e==="#"||(k.rootIntent&&k.rootIntent===P.semanticObject+"-"+P.action);t=P?P.semanticObject+"-"+P.action:"";a.switchViewState(a.calculateElementsState(I?"home":"app",R.applicationType,k.appState,R.explicitNavMode));if(I){a.getShellUIService().setBackNavigation();}this._handleHomeAndBackButtonsVisibility();a.handleControl(t,q,R,this.getWrappedApplicationWithMoreStrictnessInIntention.bind(this),this.closeLoadingScreen.bind(this));this.closeLoadingScreen();if(this.currentAppBeforeNav){var v=a.getStatefulContainer(this.currentAppBeforeNav.applicationType);if(v){v.onApplicationOpened(R.applicationType);}}jQuery.sap.measure.end("FLP:ShellController._handleEmbeddedNavMode");},_centerViewPort:function(){this.oViewPortContainer.switchState("Center");},_isShellHomeIntent:function(i){return i==="#"||i===k.rootIntent;},getWrappedApplicationWithMoreStrictnessInIntention:function(i,e,R,q,t){var v,w=this;setTimeout(function(){setTimeout(function(){var x;if(m.getProperty("/currentState/stateName")==="app"){x="shellAppTitle";}A.sendFocusBackToShell(x);setTimeout(function(){w.readNavigationEnd();},500);},100);sap.ui.getCore().getEventBus().publish("launchpad","appOpening",R);jQuery.sap.log.info('app is being opened');},0);if(k.applications){R.applicationConfiguration=k.applications[i];}v=a.getAppContainer(q,R,this._isColdStart());R.sShellHash=i;a.publishNavigationStateEvents(v,R,this.onAppAfterRendering.bind(this,R));v.addStyleClass('sapUshellApplicationPage');if(!t){v.addStyleClass("sapUShellApplicationContainerLimitedWidth");}if(this._isDock()&&window.matchMedia('(min-width: 106.4rem)').matches){v.addStyleClass("sapUShellDockingContainer");v.removeStyleClass("sapUShellApplicationContainerLimitedWidth");}else if(this._isDock()){v.removeStyleClass("sapUShellApplicationContainerLimitedWidth");}v.toggleStyleClass('sapUshellDefaultBackground',!e.hideLightBackground);a.getAppMeta()._applyContentDensityByPriority();v.onfocusin=function(){A.bFocusOnShell=false;A.bFocusPassedToExternalHandlerFirstTime=false;};v.onfocusout=function(){A.bFocusOnShell=true;A.bFocusPassedToExternalHandlerFirstTime=true;};a.addControl(v);setTimeout(function(){w.closeLoadingScreen();},0);jQuery.sap.measure.end("FLP:ShellController.getWrappedApplication");return v;},resetShellUIServiceHandlers:function(){a.resetShellUIServiceHandlers();this.isBackNavigationChanged=false;},onAppAfterRendering:function(e){var i=a.getShellUIService();setTimeout(function(){sap.ui.getCore().getEventBus().publish("launchpad","appOpened",e);jQuery.sap.log.info('app was opened');},0);var q=a._publicEventDataFromResolutionResult(e);sap.ushell.renderers.fiori2.utils.publishExternalEvent("appOpened",q);if(i){if(!a.getIsHierarchyChanged()){i.setHierarchy();}if(!a.getIsTitleChanged()){i.setTitle();}if(!a.getIsRelatedAppsChanged()){i.setRelatedApps();}if(!this.isBackNavigationChanged){i.setBackNavigation();}}s.updateStateProperty("application/icon",a.getAppMeta().getAppIcon(),true);s.updateStateProperty("application/showNavMenuTitle",this.bNavMenuTitleVisible,true);},_saveHomePageComponent:function(){if(this.oHomeApp){return;}var t=this,e="sap.ushell.components.container.ApplicationContainer",i=function(q,v,w){t.oHomeApp=w.component;sap.ui.getCore().getEventBus().unsubscribe(e,'componentCreated',i);};sap.ui.getCore().getEventBus().subscribe(e,'componentCreated',i);},hashChangeFailure:function(i,e,q,t,v){this.reportError(e,q,t);this.closeLoadingScreen();this.delayedMessageError(r.i18n.getText("fail_to_start_app_try_later"));g=false;if(i===0){window.hasher.setHash("");}else{if(jQuery.sap.getUriParameters().get("bFallbackToShellHome")){window.hasher.setHash("");}else{h=v;sap.ushell.Container.setDirtyFlag(p);this._windowHistoryBack(1);}}},reportError:function(e,i,q){jQuery.sap.log.error(e,i,q);},delayedMessageError:function(e){setTimeout(function(){if(sap.ushell.Container!==undefined){sap.ushell.Container.getService("Message").error(e);}},0);},fixShellHash:function(e){if(!e){e='#';}else if(e.charAt(0)!=='#'){e='#'+e;}return e;},_openAppNewWindow:function(e){var i=window.open(e);if(!i){var q=r.i18n.getText("fail_to_start_app_popup_blocker",[window.location.hostname]);this.delayedMessageError(q);}},_windowHistoryBack:function(i){window.history.back(i);},_changeWindowLocation:function(e){window.location.href=e;},handleEndItemsOverflow:function(P){var e=this.getModel().getProperty("/currentState/headEndItems");if(e.length===1||(e.length===2&&e.indexOf("NotificationsCountButton")!=-1)){return;}function i(){s.removeHeaderEndItem(["endItemsOverflowBtn"],false,["home","app"]);var q=sap.ui.getCore().byId('headEndItemsOverflow');if(q){q.destroy();}}if(P.name==='Phone'||P.name==='Tablet'){if(e.indexOf("endItemsOverflowBtn")===-1){s.addHeaderEndItem(["endItemsOverflowBtn"],false,["home","app"]);}else{i();s.addHeaderEndItem(["endItemsOverflowBtn"],false,["home","app"]);}}else if(P.name==="Desktop"){if(P.showOverFlowBtn){if(e.indexOf("endItemsOverflowBtn")===-1){s.addHeaderEndItem(["endItemsOverflowBtn"],false,["home","app"]);}}else{i();}}},isHeadEndItemOverflow:function(){var e=0,q,t=this.getModel().getProperty("/currentState/headEndItems");if(t.indexOf("endItemsOverflowBtn")===-1){return false;}else{var v=D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD).name;var w=3;if(v==="Phone"){w=1;}for(var i=0;i<t.length;i++){q=sap.ui.getCore().byId(t[i]);if(q.getVisible()){e++;}}if(sap.ui.getCore().byId("endItemsOverflowBtn").getVisible()){return e>w+1;}else{return e>w;}}},isHeadEndItemInOverflow:function(e){return e!=="ENDITEMSOVERFLOWBTN"&&!this.isHeadEndItemNotInOverflow(e);},isHeadEndItemNotInOverflow:function(e){if(this.isHeadEndItemOverflow()){if(e==="NOTIFICATIONSCOUNTBUTTON"||e==="ENDITEMSOVERFLOWBTN"){return true;}else{var i=D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD).name;if(i==="Tablet"){return e==="SF"||e==="FLOATINGCONTAINERBUTTON";}else if(i==="Desktop"){return e==="SF"||e==="FLOATINGCONTAINERBUTTON"||e==="COPILOTBTN";}else{return i!=="Phone";}}}else if(e==="ENDITEMSOVERFLOWBTN"){return false;}else{return true;}},pressEndItemsOverflow:function(e){var P=sap.ui.getCore().byId('headEndItemsOverflow');function i(){if(P.isOpen()){P.close();}}if(!P){var q=new sap.ui.model.Filter('','EQ','a');q.fnTest=this.isHeadEndItemInOverflow.bind(this);P=new sap.m.Popover("headEndItemsOverflow",{placement:sap.m.PlacementType.Bottom,showHeader:false,showArrow:false,content:{path:"/currentState/headEndItems",filters:[q],factory:function(I,t){var v=sap.ui.getCore().byId(t.getObject());v.detachPress(i);v.attachPress(i);return v;}}});P.addStyleClass("sapUshellPopupContainer sapMPopoverheadEndItemsOverflow");P.updateAggregation=this.getView().updateShellAggregation;P.setModel(m);this.getView().aDanglingControls.push(P);}if(P.isOpen()){P.close();}else{P.updateAggregation("content");P.openBy(e.getSource());}},externalSearchTriggered:function(e,i,q){m.setProperty("/searchTerm",q.searchTerm);q.query=q.searchTerm;},onAfterNavigate:function(e){var t=e.mParameters?e.mParameters.toId:undefined;this.closeLoadingScreen();u.addTime("ShellController.onAfterNavigate");if(t==="application"+"-"+k.rootIntent){var i=sap.ui.getCore().byId("configBtn");if(i){i.focus();}}a.onAfterNavigate(e.getParameter("fromId"),e.getParameter("from"),t);},logApplicationUsage:function(e,N,i){if(k&&k.enableRecentActivity){var I=i.appId,q=I,R={};R.title=i.usageTitle;R.appType=c.APP;R.url='#'+this.lastApplicationFullHash;if(I.indexOf('-')>0){q=I.substr(I.indexOf('-')+1);}R.appId='#'+q;if(q==="Action-search"){R.appType=c.SEARCH;}this._logRecentActivity(R);}},openLoadingScreen:function(){jQuery.sap.measure.start("FLP:ShellController.openLoadingScreen","openLoadingScreen","FLP");if(this.oFiori2LoadingDialog){var e=m.getProperty('/animationMode');var e=e||'full';this.oFiori2LoadingDialog.openLoadingScreen(e);}jQuery.sap.measure.end("FLP:ShellController.openLoadingScreen");},closeLoadingScreen:function(){if(this.oFiori2LoadingDialog){this.oFiori2LoadingDialog.closeLoadingScreen();}},readNavigationEnd:function(){var e=document.getElementById("sapUshellLoadingAccessibilityHelper-loadingComplete");if(e){e.setAttribute("aria-live","polite");e.innerHTML=r.i18n.getText("loadingComplete");setTimeout(function(){e.setAttribute("aria-live","off");e.innerHTML="";},0);}},delayedCloseLoadingScreen:function(){setTimeout(function(){this.closeLoadingScreen();}.bind(this),600);},togglePane:function(e){var i=e.getSource(),q=i.getSelected();sap.ui.getCore().getEventBus().publish("launchpad","togglePane",{currentContent:i.getModel().getProperty("/currentState/paneContent")});if(e.getParameter("id")==="categoriesBtn"){i.getModel().setProperty("/currentState/showCurtainPane",!q);}else{i.getModel().setProperty("/currentState/showPane",!q);}},_switchViewPortStateByControl:function(O,e){var i=false,v=this.oViewPortContainer;if(O&&O.setEnabled&&typeof O.setEnabled==="function"){i=true;}if(i){O.addStyleClass("sapUshellShellHeadItemOverrideDisableStyle");O.setEnabled(false);}function q(){O.setEnabled(true);O.removeStyleClass("sapUshellShellHeadItemOverrideDisableStyle");v.detachAfterSwitchStateAnimationFinished(q);}if(i){v.attachAfterSwitchStateAnimationFinished(q);}v.switchState(e);},onScreenSizeChange:function(P){this.validateShowLogo(P);this.handleNavMenuTitleVisibility(P);this._handleHomeAndBackButtonsVisibility(P);this.handleEndItemsOverflow(P);},_handleHomeAndBackButtonsVisibility:function(P){var m=j.getModel(),i=jQuery("#mainShell").width()<1024&&jQuery(".sapUshellContainerDocked").length>0,I=m.getProperty('/currentViewPortState')==='Center',e=D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD).name,q=sap.ui.getCore().byId("homeBtn"),t=sap.ui.getCore().byId("backBtn"),v=e==="Desktop",w=e!=="Phone"||I;if(i){if(q){v=false;}}if(q){q.setVisible(v);}if(t){t.setVisible(w);}},validateShowLogo:function(P){var e;var i=this.getModel().getProperty('/currentState/stateName');var I=i==='merged'||i==='headerless';if(P){e=P.name;}else{e=D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD).name;}var q=true;if(e==="Phone"&&!this.bMeAreaSelected||I){q=false;}s.updateStateProperty("showLogo",q,false,["home","app","blank","blank-home","minimal","lean"],true);},handleNavMenuTitleVisibility:function(P){this.bNavMenuTitleVisible=false;if(P.name!=="Desktop"){this.bNavMenuTitleVisible=true;}s.updateStateProperty("application/showNavMenuTitle",this.bNavMenuTitleVisible,true);},navigateFromShellApplicationNavigationMenu:function(i){if(window.hasher.getHash()!==i.substr(1)){this.oViewPortContainer.switchState("Center");window.hasher.setHash(i);}var e=sap.ui.getCore().byId("shellAppTitle");if(e){e.close();}},_loadCoreExtNonUI5:function(e,i,q){if(q&&(q.applicationType=="NWBC"||q.applicationType=="TR")){setTimeout(this._loadCoreExt.bind(this),2000);}},_postCoreExtActivities:function(){sap.ushell.Container.getService("UsageAnalytics").init(r.i18n.getText("usageAnalytics"),r.i18n.getText("i_agree"),r.i18n.getText("i_disagree"),r.i18n.getText("remind_me_later"));this.getView().createPostCoreExtControls();},_loadRendererExtensionPlugins:function(){var v=this.getView()?this.getView().getViewData():{},k=v.config||{},e=jQuery.sap.getUriParameters().get("sap-ushell-xx-pluginmode")==="delayed",t=this;if(!this._pluginLoadingTriggered){this._pluginLoadingTriggered=true;if(!sap.ushell.Container.getService("PluginManager").getRegisteredPlugins().RendererExtensions.init){sap.ushell.Container.getService("PluginManager").registerPlugins({init:{component:"sap.ushell.components.shell.defaults",url:jQuery.sap.getResourcePath("sap/ushell/components/shell/defaults")}});}jQuery.sap.log.info("Triggering load of 'RendererExtension' plug-ins after loading core-ext module (after home page content rendered)",null,"sap.ushell.renderers.fiori2.Shell");if(!k.inHeaderLessOpt){if(e){setTimeout(function(){sap.ushell.Container.getService("PluginManager").loadPlugins("RendererExtensions").always(function(){t._publishCoreExtLoadedEvent();});},5000);}else{sap.ushell.Container.getService("PluginManager").loadPlugins("RendererExtensions").always(function(){t._publishCoreExtLoadedEvent();});}}else{this._publishCoreExtLoadedEvent();}}},_loadCoreExt:function(){jQuery.sap.measure.end("FLP:Container.InitLoading");E.once("CoreResourcesComplementLoaded").do(this._loadRendererExtensionPlugins.bind(this));E.emit("loadCoreResourcesComplement");},_publishCoreExtLoadedEvent:function(){setTimeout(function(){sap.ui.getCore().getEventBus().publish("launchpad","coreExtLoaded");},0);setTimeout(function(){sap.ui.getCore().getEventBus().publish("shell","FLP-FMP");},5000);},getCurrentViewportState:function(){var v=m.getProperty('/currentViewPortState');return v;},makeEndUserFeedbackAnonymousByDefault:function(e){this.oEndUserFeedbackConfiguration.anonymousByDefault=e;},showEndUserFeedbackLegalAgreement:function(e){this.oEndUserFeedbackConfiguration.showLegalAgreement=e;},_activateFloatingUIActions:function(w){if(w<417){this.oFloatingUIActions.disable();}else{this.oFloatingUIActions.enable();}},setFloatingContainerDragSelector:function(e){jQuery(e).addClass("sapUshellShellFloatingContainerSelector");sap.ui.require(["sap/ushell/UIActions"],function(i){if(!this.oFloatingUIActions){this.oFloatingUIActions=new sap.ushell.UIActions({containerSelector:".sapUiBody",wrapperSelector:'.sapUshellShellFloatingContainerWrapper',draggableSelector:'.sapUshellShellFloatingContainerWrapper',rootSelector:".sapUiBody",cloneClass:"sapUshellFloatingContainer-clone",dragCallback:this._handleFloatingContainerUIStart.bind(this),endCallback:this._handleFloatingContainerDrop.bind(this),moveTolerance:3,onDragStartUIHandler:this._onDragStartUI.bind(this),onDragEndUIHandler:this._setFloatingContainerHeight.bind(this),dragAndScrollCallback:this._doDock.bind(this),switchModeDelay:1000,isLayoutEngine:false,isTouch:false,elementToCapture:e,defaultMouseMoveHandler:function(){},debug:jQuery.sap.debug()});}else{this.oFloatingUIActions.elementsToCapture=jQuery(e);}this._activateFloatingUIActions(jQuery(window).width());var t;jQuery(window).bind("resize",function(){clearTimeout(t);t=setTimeout(this._activateFloatingUIActions(jQuery(window).width()),300);}.bind(this));}.bind(this));},_doDock:function(e){jQuery.sap.measure.start("FLP:Shell.controller._doDock","dragging co-pilot element","FLP");var i=D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD);if(i.name=="Desktop"){var w=jQuery(window).width();if(e){e.docked={};var q=e.docked;if(e.moveX>=w-64){q.dockPos="right";q.setIsDockingAreaOpen=true;this._openDockingArea(e);}else if(e.moveX<64){q.dockPos="left";q.setIsDockingAreaOpen=true;this._openDockingArea(e);}else{if(this._isDockingAreaOpen()){this._closeDockingArea(e);}if(jQuery("#canvas").hasClass('sapUshellContainerDocked')){this._handleCloseCanvas(e);}}}}jQuery.sap.measure.end("FLP:Shell.controller._doDock");},_finishDoDock:function(e){this._openDockingArea(false);var i=jQuery.sap.storage(jQuery.sap.storage.Type.local,"com.sap.ushell.adapters.local.CopilotLastState");i.put("lastState","docked:"+e.dockPos);this._handleOpenCanvas(e);var w=jQuery('#sapUshellFloatingContainerWrapper');w.css("height","100%");jQuery("#shell-floatingContainer").addClass("sapUshellShellFloatingContainerFullHeight");sap.ui.getCore().getEventBus().publish("launchpad","shellFloatingContainerIsDocked",e.dockPos);if(jQuery(".sapUShellApplicationContainerLimitedWidth").length>0){jQuery('#application-Action-toappnavsample').removeClass("sapUShellApplicationContainerLimitedWidth");jQuery('#application-Action-toappnavsample').addClass("sapUShellDockingContainer");}},_onResizeWithDocking:function(){this.onScreenSizeChange(D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD));setTimeout(function(){sap.ui.getCore().getEventBus().publish("launchpad","appFinderWithDocking");},300);},_onDragStartUI:function(e){jQuery.sap.measure.start("FLP:Shell.controller._onDragStartUI","start drag","FLP");if(this._isDock()){var i=jQuery.sap.storage(jQuery.sap.storage.Type.local,"com.sap.ushell.adapters.local.CopilotLastState");i.put("lastState","floating");jQuery("#sapUshellFloatingContainerWrapper").removeClass('sapUshellContainerDocked');jQuery(".sapUshellShellFloatingContainerFullHeight").removeClass("sapUshellShellFloatingContainerFullHeight");sap.ui.getCore().getEventBus().publish("launchpad","shellFloatingContainerIsUnDocked");jQuery("#sapUshellFloatingContainerWrapper").removeClass("sapUshellContainerDockedMinimizeCoPilot sapUshellContainerDockedExtendCoPilot");jQuery("#sapUshellFloatingContainerWrapper").addClass('sapUshellContainerDockedMinimizeCoPilot');jQuery(jQuery(".sapUshellContainerDockedMinimizeCoPilot")).on('webkitAnimationEnd oanimationend msAnimationEnd animationend',this._handleAnimations(false));this._handleCloseCanvas(e);}jQuery.sap.measure.end("FLP:Shell.controller._onDragStartUI");},_handleAnimations:function(i,e){var q=jQuery('#canvas');var w=jQuery('#sapUshellFloatingContainerWrapper');if(i){q.addClass("sapUshellContainerDockedLaunchpadTranisation");if(q.hasClass('sapUshellContainer-Narrow-Right')||e=="right"){jQuery(".sapUshellContainerDockedLaunchpadTranisation").toggleClass("closeRight",true);}else{jQuery(".sapUshellContainerDockedLaunchpadTranisation").toggleClass("closeLeft",true);}w.addClass(" sapUshellContainerDockedExtendCoPilot");setTimeout(function(){if(q.hasClass('sapUshellContainer-Narrow-Right')||e=="right"){jQuery(".sapUshellContainerDockedLaunchpadTranisation").toggleClass("closeRight",false);jQuery(".sapUshellContainerDockedLaunchpadTranisation").toggleClass("openRight",true);}else if(q.hasClass('sapUshellContainer-Narrow-Left')||e=="left"){jQuery(".sapUshellContainerDockedLaunchpadTranisation").toggleClass("closeLeft",false);jQuery(".sapUshellContainerDockedLaunchpadTranisation").toggleClass("openLeft",true);}},300);this._onResizeWithDocking();}else{jQuery("#sapUshellFloatingContainerWrapper").addClass("sapUshellContainerDockedExtendCoPilot");if(q.hasClass('sapUshellContainer-Narrow-Right')||e=="right"){jQuery(".sapUshellContainerDockedLaunchpadTranisation").toggleClass("openRight",false);}else{jQuery(".sapUshellContainerDockedLaunchpadTranisation").toggleClass("openLeft",false);}setTimeout(function(){q.removeClass("sapUshellContainerDockedLaunchpadTranisation  closeLeft  openLeft closeRight openRight");},550);}var t=sap.ui.getCore().byId('shell-header');t._handleResizeChange();},_openDockingArea:function(e){var i=e?e.docked:false;var I=i?i.setIsDockingAreaOpen:false;if(I&&jQuery("#DockinaAreaDiv").length==0){var q=sap.ui.getCore().getConfiguration().getRTL();if((i.dockPos==="right"&&e.clone&&!q)||(i.dockPos==="left"&&e.clone&&q)){jQuery('<div id="DockinaAreaDiv"  class="sapUshellShellDisplayDockingAreaRight">').appendTo(e.clone.parentElement);}else if((i.dockPos==="left"&&e.clone&&!q)||(i.dockPos==="right"&&e.clone&&q)){jQuery('<div id="DockinaAreaDiv"  class="sapUshellShellDisplayDockingAreaLeft">').appendTo(e.clone.parentElement);}e.clone.oDockedProp={};e.clone.oDockedProp.dockPos=i.dockPos;}else if(!I){this._closeDockingArea();}},_closeDockingArea:function(e){setTimeout(function(){jQuery('.sapUshellShellDisplayDockingAreaRight').remove();jQuery('.sapUshellShellDisplayDockingAreaLeft').remove();},150);var i=sap.ui.getCore().byId('shell-header');if(i){i._handleResizeChange();}},_isDock:function(){return(jQuery('.sapUshellContainerDocked').size()!=0);},_isDockingAreaOpen:function(){return(jQuery('.sapUshellShellDisplayDockingAreaRight').size()!=0||jQuery('.sapUshellShellDisplayDockingAreaLeft').size()!=0);},_handleOpenCanvas:function(e){var i=jQuery('#canvas');var q=jQuery('.sapUshellShellHead');var I=sap.ui.getCore().getConfiguration().getRTL();if((e.dockPos==="right"&&!I)||(e.dockPos==="left"&&I)){i.addClass('sapUshellContainer-Narrow-Right sapUshellContainerDocked ');q.addClass('sapUshellContainerDocked');}if((e.dockPos==="left"&&!I)||(e.dockPos==="right"&&I)){i.addClass('sapUshellContainer-Narrow-Left sapUshellContainerDocked ');q.addClass('sapUshellContainerDocked');}var v=sap.ui.getCore().byId("viewPortContainer");if(v){v._handleSizeChange();}},_handleCloseCanvas:function(e){var i=jQuery('#canvas');var q=jQuery('.sapUshellShellHead');if(e){e.docked.setIsDockingAreaOpen=false;}if(i.hasClass('sapUshellContainer-Narrow-Right')){i.removeClass('sapUshellContainer-Narrow-Right sapUshellContainerDocked sapUshellMoveCanvasRight');q.removeClass('sapUshellContainerDocked');this._openDockingArea(e);this._setFloatingContainerHeight();}if(i.hasClass('sapUshellContainer-Narrow-Left')){i.removeClass('sapUshellContainer-Narrow-Left sapUshellContainerDocked sapUshellMoveCanvasLeft');q.removeClass('sapUshellContainerDocked');this._openDockingArea(e);this._setFloatingContainerHeight();}if(jQuery(".sapUShellDockingContainer").length>0){jQuery('#application-Action-toappnavsample').removeClass("sapUShellDockingContainer");jQuery('#application-Action-toappnavsample').addClass("sapUShellApplicationContainerLimitedWidth");}this._onResizeWithDocking();var v=sap.ui.getCore().byId("viewPortContainer");if(v){v._handleSizeChange();}},_setFloatingContainerHeight:function(e){var w=jQuery(window).width();var W=jQuery('#sapUshellFloatingContainerWrapper');if(this._isDock()){if(e&&(e.clientX>=w-64||e.clientX<64)){W.addClass(' sapUshellContainerDocked');W.addClass("sapUshellContainerDockedMinimizeCoPilot");jQuery(W).on('webkitAnimationEnd oanimationend msAnimationEnd animationend',this._handleAnimations(true));}}else if(!this._isDock()){jQuery("#sapUshellFloatingContainerWrapper").removeClass("sapUshellContainerDockedMinimizeCoPilot sapUshellContainerDockedExtendCoPilot");}},_handleFloatingContainerDrop:function(e,i,q){jQuery.sap.measure.start("FLP:Shell.controller._handleFloatingContainerDrop","drop floating container","FLP");var t=i.firstChild?sap.ui.getCore().byId(i.firstChild.id):undefined,v=jQuery.sap.storage(jQuery.sap.storage.Type.local,"com.sap.ushell.adapters.local.FloatingContainer"),w=jQuery(window).width(),W=jQuery(window).height(),P=q.deltaX/w,x=q.deltaY/W,O=i.style.visibility,y=i.style.display,z=parseFloat(i.style.left.replace("%","")),G=parseFloat(i.style.top.replace("%",""));i.style.visibility='hidden';i.style.display='block';if(typeof(z)==='number'){P=z+100*q.deltaX/w;}if(typeof(G)==='number'){x=G+100*q.deltaY/W;}if(this._isDockingAreaOpen()){x=0;}i.setAttribute("style","left:"+P+"%;top:"+x+"%;position:absolute;");i.visibility=O;i.display=y;v.put("floatingContainerStyle",i.getAttribute("style"));if(t){t.handleDrop();if(!!q.clone.oDockedProp&&this._isDockingAreaOpen()){this._finishDoDock(q.clone.oDockedProp);}}jQuery.sap.measure.end("FLP:Shell.controller.handleFloatingContainerDrop");},_handleFloatingContainerUIStart:function(i,q){jQuery.sap.measure.start("FLP:Shell.controller._handleFloatingContainerUIStart","starts dragging floating container","FLP");var t=q;t.style.display="none";if(window.getSelection){var v=window.getSelection();try{v.removeAllRanges();}catch(e){}}jQuery.sap.measure.end("FLP:Shell.controller._handleFloatingContainerUIStart");},getFloatingContainerState:function(){var e=jQuery.sap.storage(jQuery.sap.storage.Type.local,"com.sap.ushell.adapters.local.CopilotLastState");var i="floating";if(e!=null){i=e.get("lastState");if(i==null){i="floating";}}return i;},setFloatingContainerVisibility:function(v){var e=this.getFloatingContainerState();if(e){if(e=="floating"){this.getView().getOUnifiedShell().setFloatingContainerVisible(v);}else if(e.indexOf("docked")!=-1){if(v==true){var i=D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD);if(i.name=="Desktop"){var w=jQuery('#sapUshellFloatingContainerWrapper');w.addClass("sapUshellContainerDocked");jQuery("#canvas, .sapUshellShellHead").addClass("sapUshellContainerDocked");w.css("height","100%");sap.ui.getCore().byId("shell-floatingContainer").addStyleClass("sapUshellShellFloatingContainerFullHeight");var V=sap.ui.getCore().byId("viewPortContainer");if(V){V._handleSizeChange();}if(sap.ui.getCore().getConfiguration().getRTL()){if(e.indexOf("right")!=-1){jQuery("#canvas").addClass('sapUshellContainer-Narrow-Left');this._handleAnimations(true,"left");}else{jQuery("#canvas").addClass('sapUshellContainer-Narrow-Right');this._handleAnimations(true,"right");}}else{if(e.indexOf("right")!=-1){jQuery("#canvas").addClass('sapUshellContainer-Narrow-Right');this._handleAnimations(true,"right");}else{jQuery("#canvas").addClass('sapUshellContainer-Narrow-Left');this._handleAnimations(true,"left");}}setTimeout(function(){this.getView().getOUnifiedShell().setFloatingContainerVisible(v);}.bind(this),400);}else{jQuery.sap.storage(jQuery.sap.storage.Type.local,"com.sap.ushell.adapters.local.CopilotLastState").put("lastState","floating");this.getView().getOUnifiedShell().setFloatingContainerVisible(v);}if(jQuery(".sapUShellApplicationContainerLimitedWidth").length>0){jQuery('#application-Action-toappnavsample').removeClass("sapUShellApplicationContainerLimitedWidth");jQuery('#application-Action-toappnavsample').addClass("sapUShellDockingContainer");}}else{if(sap.ui.getCore().getConfiguration().getRTL()){if(e.indexOf("right")!=-1){this._handleAnimations(false,"left");}else{this._handleAnimations(false,"right");}}else{if(e.indexOf("right")!=-1){this._handleAnimations(false,"right");}else{this._handleAnimations(false,"left");}}var V=sap.ui.getCore().byId("viewPortContainer");if(V){V._handleSizeChange();}setTimeout(function(){this.getView().getOUnifiedShell().setFloatingContainerVisible(v);}.bind(this),400);if(jQuery(".sapUShellDockingContainer").length>0){jQuery('#application-Action-toappnavsample').removeClass("sapUShellDockingContainer");jQuery('#application-Action-toappnavsample').addClass("sapUShellApplicationContainerLimitedWidth");}}jQuery("#sapUshellFloatingContainerWrapper").removeClass("sapUshellContainerDockedMinimizeCoPilot sapUshellContainerDockedExtendCoPilot");this._onResizeWithDocking();var V=sap.ui.getCore().byId("viewPortContainer");if(V){V._handleSizeChange();}}}},getFloatingContainerVisibility:function(){return this.getView().getOUnifiedShell().getFloatingContainerVisible();},setFloatingContainerContent:function(P,i,e,q){s.setFloatingContainerContent(P,i,e,q);},getRightFloatingContainerVisibility:function(){var R=this.getView().getOUnifiedShell().getRightFloatingContainer(),e=R&&R.getVisible();return e;},setHeaderTitle:function(t,i){if(typeof t!=="string"){throw new Error("sTitle type is invalid");}this.getView().getOUnifiedShell().getHeader().setTitleControl(t,i);},addEndUserFeedbackCustomUI:function(e,i){if(e){this.oEndUserFeedbackConfiguration.customUIContent=e;}if(i===false){this.oEndUserFeedbackConfiguration.showCustomUIContent=i;}},setFooter:function(e){var i=this.getView().getOUnifiedShell();if(typeof e!=="object"||!e.getId){throw new Error("oFooter value is invalid");}if(i.getFooter()!==null){jQuery.sap.log.warning("You can only set one footer. Replacing existing footer: "+i.getFooter().getId()+", with the new footer: "+e.getId()+".");}i.setFooter(e);},removeFooter:function(){this.getView().getOUnifiedShell().setFooter(null);},addUserPreferencesEntry:function(e){this._validateUserPrefEntryConfiguration(e);this._updateUserPrefModel(e);},addUserProfilingEntry:function(e){this._validateUserPrefEntryConfiguration(e);this._updateProfilingModel(e);},_validateUserPrefEntryConfiguration:function(e){if((!e)||(typeof e!=="object")){throw new Error("object oConfig was not provided");}if(!e.title){throw new Error("title was not provided");}if(!e.value){throw new Error("value was not provided");}if(typeof e.entryHelpID!=="undefined"){if(typeof e.entryHelpID!=="string"){throw new Error("entryHelpID type is invalid");}else if(e.entryHelpID===""){throw new Error("entryHelpID type is invalid");}var i=sap.ui.getCore().byId('shell-header');i._handleResizeChange();}if(e.title&&typeof e.title!=="string"){throw new Error("title type is invalid");}if(typeof e.value!=="function"&&typeof e.value!=="string"&&typeof e.value!=="number"){throw new Error("value type is invalid");}if(e.onSave&&typeof e.onSave!=="function"){throw new Error("onSave type is invalid");}if(e.content&&typeof e.content!=="function"){throw new Error("content type is invalid");}if(e.onCancel&&typeof e.onCancel!=="function"){throw new Error("onCancel type is invalid");}},_createSessionHandler:function(k){var t=this;sap.ui.require(["sap/ushell/SessionHandler"],function(e){t.oSessionHandler=new e();t.oSessionHandler.init({oModel:t.getModel(),keepSessionAlivePopupText:k.keepSessionAlivePopupText,pageReloadPopupText:k.pageReloadPopupText,preloadLibrariesForRootIntent:k.preloadLibrariesForRootIntent,sessionTimeoutReminderInMinutes:k.sessionTimeoutReminderInMinutes,sessionTimeoutIntervalInMinutes:k.sessionTimeoutIntervalInMinutes,enableAutomaticSignout:k.enableAutomaticSignout});});},_getSessionHandler:function(){return this.oSessionHandler;},_navBack:function(){this.bMeAreaSelected=false;l();},_historyBackNavigation:function(){window.history.back();},_updateUserPrefModel:function(e){var i=this._getModelEntryFromEntryObject(e),q=m.getProperty("/userPreferences/entries");q.push(i);q=this._reorderUserPrefEntries(q);m.setProperty("/userPreferences/entries",q);},_updateProfilingModel:function(e){var i=this._getModelEntryFromEntryObject(e),q=m.getProperty("/userPreferences/profiling")||[];q.push(i);m.setProperty("/userPreferences/profiling",q);},_getModelEntryFromEntryObject:function(e){return{"entryHelpID":e.entryHelpID,"title":e.title,"editable":e.content?true:false,"valueArgument":e.value,"valueResult":null,"onSave":e.onSave,"onCancel":e.onCancel,"contentFunc":e.content,"contentResult":null,"icon":e.icon};},_reorderUserPrefEntries:function(e){var q,t;for(var i=0;i<e.length;i++){if(e[i].entryHelpID==="flpSettingsEntry"){q=i;}else if(e[i].entryHelpID==="themes"){t=i;}if(q!=undefined&&t!=undefined){var v=e.splice(q,1);e.splice(t+1,0,v[0]);break;}}return e;},onAfterViewPortSwitchState:function(e){var t=e.getParameter("to");var i=sap.ui.getCore().byId("shellAppTitle");m.setProperty("/currentViewPortState",t);if(this.applicationKeyHandler){A.registerAppKeysHandler(this.applicationKeyHandler);this.applicationKeyHandler=undefined;}sap.ui.getCore().getEventBus().publish("launchpad","afterSwitchState",e);if(t==="Center"){i.setVisible(true);this.bMeAreaSelected=false;}else{i.setVisible(false);if(t==="Right"){this.bMeAreaSelected=false;}else if(t=="RightCenter"){this.applicationKeyHandler=A.getAppKeysHandler();A.bFocusOnShell=false;if(sap.ui.getCore().byId("notificationsView")){A.registerAppKeysHandler(sap.ui.getCore().byId("notificationsView").getController().keydownHandler.bind(sap.ui.getCore().byId("notificationsView")));}}}this.validateShowLogo();this._handleHomeAndBackButtonsVisibility();},getModel:function(){return m;},_getConfig:function(){return k?k:{};},_getPersonalizer:function(P){var e=sap.ushell.Container.getService("Personalization");var i=sap.ui.core.Component.getOwnerComponentFor(this.getView());var q={keyCategory:e.constants.keyCategory.FIXED_KEY,writeFrequency:e.constants.writeFrequency.LOW,clientStorageAllowed:true};return e.getPersonalizer(P,q,i);},_getCurrentLocationHash:function(){return window.location.hash;},setMeAreaSelected:function(e){this.bMeAreaSelected=e;},getMeAreaSelected:function(){return this.bMeAreaSelected;},setNotificationsSelected:function(e){this.bNotificationsSelected=e;},getNotificationsSelected:function(){return this.bNotificationsSelected;}});},false);
