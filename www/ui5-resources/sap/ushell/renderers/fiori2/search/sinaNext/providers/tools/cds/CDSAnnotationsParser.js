sinaDefine(['../../../sina/SinaObject'],function(S){"use strict";return S.derive({_init:function(){},parseCDSAnnotationsForDataSource:function(d,c){var p={dataSourceIsCdsBased:false,detailAttributesAreSorted:false,titleAttributesAreSorted:false};var i,a,b,f,u,g;var h={};var j={};var k=[];var l=[];for(a in c.dataSourceAnnotations){b=c.dataSourceAnnotations[a];switch(a.toUpperCase()){case"UI.HEADERINFO.TITLE.VALUE":var t=d.attributeMetadataMap[b];if(t){t.usage.Title={displayOrder:1};}break;case"UI.HEADERINFO.TITLE.URL":var m=d.attributeMetadataMap[b];if(m){m.usage.Navigation={mainNavigation:true};}break;}}for(i=0;i<d.attributesMetadata.length;i++){f=d.attributesMetadata[i];var n=c.attributeAnnotations[f.id]||{};for(a in n){b=n[a];switch(a.toUpperCase()){case"UI.HIDDEN":if(b.toLowerCase()=="true"){}break;case"UI.IDENTIFICATION.URL":if(n["SEMANTICS.IMAGEURL"]!==undefined){var o=c.attributeAnnotations[b];if(o&&o["SEMANTICS.URL.MIMETYPE"]){var m=d.attributeMetadataMap[b];var q=d.attributeMetadataMap[o["SEMANTICS.URL.MIMETYPE"]];f.suvUrlAttribute=m;f.suvMimeTypeAttribute=q;f.format=this.sina.AttributeFormatType.DocumentThumbnail;}}break;case"UI.IDENTIFICATION.IMPORTANCE":if(b=="HIGH"||b=="MEDIUM"){var r=n["UI.IDENTIFICATION.POSITION"];if(typeof r==='string'){try{r=parseInt(r,10);}catch(e){r=Number.MAX_VALUE;}}else if(typeof r!=='number'){r=Number.MAX_VALUE;}f.usage=f.usage||{};f.usage.Detail=f.usage.Detail||{};f.usage.Detail.displayOrder=r;if(b=="HIGH"){k.push(f);}else if(b=="MEDIUM"){l.push(f);}}break;case"SEMANTICS.CONTACT.PHOTO":f.format=this.sina.AttributeFormatType.Round;case"SEMANTICS.IMAGEURL":f.type=this.sina.AttributeType.ImageUrl;break;case"SEMANTICS.EMAIL.ADDRESS":f.isEmailAddress=true;break;case"SEMANTICS.TELEPHONE.TYPE":f.isPhoneNr=true;break;case"SEMANTICS.CURRENCYCODE":f.isCurrency=true;break;case"SEMANTICS.UNITOFMEASURE":f.isUnitOfMeasure=true;break;case"SEMANTICS.QUANTITY.UNITOFMEASURE":f.isQuantity=true;case"SEMANTICS.AMOUNT.CURRENCYCODE":b=b.toUpperCase();u=d.attributeMetadataMap[b];if(u){if((a=="SEMANTICS.QUANTITY.UNITOFMEASURE"&&u.isUnitOfMeasure)||(a=="SEMANTICS.AMOUNT.CURRENCYCODE"&&u.isCurrency)){f.unitOfMeasureAttribute=u;}}else{h[b]=h[b]||[];h[b].push({attribute:f,annotationName:a});}break;case"OBJECTMODEL.TEXT.ELEMENT":g=d.attributeMetadataMap[b];if(g){g.isDescription=true;f.descriptionAttribute=g;}else{j[b]=j[b]||[];j[b].push(f);}var s=n["UI.TEXTARRANGEMENT"];if(s){switch(s.toUpperCase()){case"TEXT_FIRST":f.descriptionTextArrangement=this.sina.AttributeDescriptionTextArrangement.TextFirst;break;case"TEXT_LAST":f.descriptionTextArrangement=this.sina.AttributeDescriptionTextArrangement.TextLast;break;case"TEXT_ONLY":f.descriptionTextArrangement=this.sina.AttributeDescriptionTextArrangement.TextOnly;break;case"TEXT_SEPARATE":f.descriptionTextArrangement=this.sina.AttributeDescriptionTextArrangement.TextSeparate;break;}}break;case"UI.MULTILINETEXT":f.format=this.sina.AttributeFormatType.MultilineText;break;}}}if(k.length>0||l.length>0){if(k.length>0){p.dataSourceIsCdsBased=true;}var v=this._createSortFunction("Detail");k.sort(v);l.sort(v);var w=k.concat(l);for(i=0;i<w.length;++i){w[i].usage.Detail.displayOrder=i;}p.detailAttributesAreSorted=true;}for(var x in h){u=d.attributeMetadataMap[x];if(u){var y=h[x];for(i=0;i<y.length;i++){f=y[i].attribute;a=y[i].annotationName;if((a=="SEMANTICS.QUANTITY.UNITOFMEASURE"&&u.isUnitOfMeasure)||(a=="SEMANTICS.AMOUNT.CURRENCYCODE"&&u.isCurrency)){f.unitOfMeasureAttribute=u;}}}}for(var z in j){g=d.attributeMetadataMap[z];if(g){g.isDescription=true;var A=j[z];for(i=0;i<A.length;i++){f=A[i];f.descriptionAttribute=g;}}}return p;},_createSortFunction:function(u){return function(a,b){if(a.usage[u].displayOrder<b.usage[u].displayOrder){return-1;}else if(a.usage[u].displayOrder>b.usage[u].displayOrder){return 1;}else{return 0;}};}});});
