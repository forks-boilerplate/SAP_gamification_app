sinaDefine(['../core/core','../core/util','./SearchQuery','./ChartQuery','./DataSourceQuery','./SuggestionQuery','./Filter','./DataSource','./ComplexCondition','./SimpleCondition','./AttributeMetadata','./SearchResultSetItemAttribute','./SearchResultSetItem','./SearchResultSet','./AttributeType','./AttributeFormatType','./AttributeDescriptionTextArrangement','./DataSourceType','./SuggestionType','./SuggestionCalculationMode','./FacetType','./MatchingStrategy','./LogicalOperator','./ComparisonOperator','./AttributeUsageType','./FacetResultSet','./FacetResultSetItem','./SearchTermSuggestion','./SearchTermAndDataSourceSuggestion','./DataSourceSuggestion','./ObjectSuggestion','./SuggestionResultSet','./ChartResultSet','./DataSourceResultSet','./ChartResultSetItem','./DataSourceResultSetItem','./EqualsMode','./SortOrder','./Capabilities','./ConditionType','./Configuration','../providers/inav2/typeConverter','./NavigationTarget','../providers/tools/fiori/FioriIntentsResolver','../providers/tools/fiori/NavigationTargetForIntent','../providers/tools/cds/CDSAnnotationsParser','../providers/tools/fiori/SuvNavTargetResolver','./formatters/ConfigSearchResultSetFormatter','./formatters/ConfigMetadataFormatter','./formatters/Formatter','./formatters/DefaultResultSetFormatter'],function(c,u,S,C,D,a,F,b,d,e,A,f,g,h,k,l,m,n,o,p,q,M,L,r,s,t,v,w,x,y,O,z,B,E,G,H,I,J,K,N,P,Q,R,T,U,V,W,X,Y,Z,$){"use strict";return c.defineClass({AttributeType:k,AttributeFormatType:l,AttributeDescriptionTextArrangement:m,DataSourceType:n,AttributeUsageType:s,MatchingStrategy:M,LogicalOperator:L,ComparisonOperator:r,FacetType:q,SuggestionCalculationMode:p,SuggestionType:o,EqualsMode:I,SortOrder:J,ConditionType:N,SearchResultSet:h,SearchResultSetItem:g,SearchResultSetItemAttribute:f,ObjectSuggestion:O,_init:function(i){this.core=c;this.util=u;this.inav2TypeConverter=Q;this.provider=i;this.createSearchQuery=this.generateFactoryMethod(S);this.createChartQuery=this.generateFactoryMethod(C);this.createSuggestionQuery=this.generateFactoryMethod(a);this.createDataSourceQuery=this.generateFactoryMethod(D);this.createFilter=this.generateFactoryMethod(F);this.createComplexCondition=this.generateFactoryMethod(d);this.createSimpleCondition=this.generateFactoryMethod(e);this._createAttributeMetadata=this.generateFactoryMethod(A);this._createSearchResultSetItemAttribute=this.generateFactoryMethod(f);this._createSearchResultSetItem=this.generateFactoryMethod(g);this._createSearchResultSet=this.generateFactoryMethod(h);this._createSearchTermSuggestion=this.generateFactoryMethod(w);this._createSearchTermAndDataSourceSuggestion=this.generateFactoryMethod(x);this._createDataSourceSuggestion=this.generateFactoryMethod(y);this._createObjectSuggestion=this.generateFactoryMethod(O);this._createSuggestionResultSet=this.generateFactoryMethod(z);this._createChartResultSet=this.generateFactoryMethod(B);this._createDataSourceResultSet=this.generateFactoryMethod(E);this._createChartResultSetItem=this.generateFactoryMethod(G);this._createDataSourceResultSetItem=this.generateFactoryMethod(H);this._createCapabilities=this.generateFactoryMethod(K);this._createConfiguration=this.generateFactoryMethod(P);this._createNavigationTarget=this.generateFactoryMethod(R);this._createFioriIntentsResolver=this.generateFactoryMethod(T);this._createNavigationTargetForIntent=this.generateFactoryMethod(U);this._createCDSAnnotationsParser=this.generateFactoryMethod(V);this._createSuvNavTargetResolver=this.generateFactoryMethod(W);this.searchResultSetFormatters=[];this.metadataFormatters=[];this.dataSources=[];this.dataSourceMap={};this.allDataSource=this._createDataSource({id:'All',label:'All',type:this.DataSourceType.Category});this.searchResultSetFormatters.push(new $());},_initAsync:function(i){i=i||{};this.isDummyProvider=i.provider.indexOf("dummy")>-1;return c.Promise.resolve().then(function(){return this._evaluateConfigurationAsync(i);}.bind(this)).then(function(){i.sina=this;return this.provider._initAsync.apply(this.provider,[i]);}.bind(this)).then(function(j){j=j||{};this.capabilities=j.capabilities||this._createCapabilities();return this._formatMetadataAsync();}.bind(this)).then(function(){if(this.getBusinessObjectDataSources().length===0&&!this.isDummyProvider){return Promise.reject(new c.Exception('Not active - no datasources'));}}.bind(this));},_formatMetadataAsync:function(){return c.executeSequentialAsync(this.metadataFormatters,function(i){return i.formatAsync({dataSources:this.dataSources});}.bind(this));},_evaluateConfigurationAsync:function(_){var a1=[];if(_.searchResultSetFormatters){for(var i=0;i<_.searchResultSetFormatters.length;++i){var b1=_.searchResultSetFormatters[i];if(!(b1 instanceof Z)){b1=new X(b1);}this.searchResultSetFormatters.push(b1);a1.push(b1.initAsync());}}if(_.metadataFormatters){for(var j=0;j<_.metadataFormatters.length;++j){var c1=_.metadataFormatters[j];if(!(c1 instanceof Z)){c1=new Y(c1);}this.metadataFormatters.push(c1);a1.push(c1.initAsync());}}return c.Promise.all(a1);},loadMetadata:function(i){if(this.provider.loadMetadata){return this.provider.loadMetadata(i);}return c.Promise.resolve();},createDataSourceMap:function(j){var _={};for(var i=0;i<j.length;++i){var a1=j[i];_[a1.id]=a1;}return _;},generateFactoryMethod:function(i){return function(j){j=j||{};j.sina=this;return new i(j);};},_createDataSource:function(i){i=i||{};i.sina=this;var j=new b(i);if(this.dataSourceMap[j.id]===j){throw new c.Exception('cannot create an already existing datasource: "'+j.id+'"');}this.dataSources.push(j);this.dataSourceMap[j.id]=j;return j;},getAllDataSource:function(){return this.allDataSource;},getBusinessObjectDataSources:function(){var j=[];for(var i=0;i<this.dataSources.length;++i){var _=this.dataSources[i];if(!_.hidden&&_.type===this.DataSourceType.BusinessObject){j.push(_);}}return j;},getDataSource:function(i){return this.dataSourceMap[i];},getConfigurationAsync:function(i){if(!this.provider.getConfigurationAsync){return c.Promise.resolve(this._createConfiguration({personalizedSearch:false,isPersonalizedSearchEditable:false}));}i=i||{};if(this.configurationPromise&&!i.forceReload){return this.configurationPromise;}this.configurationPromise=this.provider.getConfigurationAsync();return this.configurationPromise;},logUserEvent:function(i){if(!this.provider.logUserEvent){return;}this.provider.logUserEvent(i);},getDebugInfo:function(){var i=['Sina Provider:'+this.provider.id];if(this.provider.getDebugInfo){var j=this.provider.getDebugInfo();if(j){i.push(j);}}return i.join('\n');},parseDataSourceFromJson:function(j){var i=this.getDataSource(j.id);if(i){return i;}if(j.type!==this.DataSourceType.Category){throw new c.Exception('Datasource in URL does not exist '+j.id);}i=this._createDataSource(j);return i;},parseSimpleConditionFromJson:function(j){var i;if(c.isObject(j.value)){i=u.dateFromJson(j.value);}else{i=j.value;}return this.createSimpleCondition({operator:j.operator,attribute:j.attribute,value:i,attributeLabel:j.attributeLabel,valueLabel:j.valueLabel,userDefined:j.userDefined?true:false});},parseComplexConditionFromJson:function(j){var _=[];for(var i=0;i<j.conditions.length;++i){var a1=j.conditions[i];_.push(this.parseConditionFromJson(a1));}return this.createComplexCondition({operator:j.operator,conditions:_,attributeLabel:j.attributeLabel,valueLabel:j.valueLabel,userDefined:j.userDefined?true:false});},parseConditionFromJson:function(j){switch(j.type){case'Simple':return this.parseSimpleConditionFromJson(j);case'Complex':return this.parseComplexConditionFromJson(j);default:throw new c.Exception('unknown condition type "'+j.type+'"');}},parseFilterFromJson:function(j){return this.createFilter({searchTerm:j.searchTerm,rootCondition:this.parseConditionFromJson(j.rootCondition),dataSource:this.parseDataSourceFromJson(j.dataSource)});}});});
