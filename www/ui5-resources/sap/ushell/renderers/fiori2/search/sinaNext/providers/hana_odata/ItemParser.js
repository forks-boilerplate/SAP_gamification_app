sinaDefine(['../../core/core','../../core/util','./typeConverter','../tools/fiori/FioriIntentsResolver','../../sina/NavigationTarget'],function(c,u,t,I,N){"use strict";return c.defineClass({_init:function(p){this.provider=p;this.sina=p.sina;this.intentsResolver=this.sina._createFioriIntentsResolver();},parse:function(s,d){if(d.value===null){return Promise.resolve([]);}var a=d.value;var b=[];for(var i=0;i<a.length;++i){var e=a[i];var f=this.parseItem(e);b.push(f);}return Promise.all(b);},parseItem:function(a){var b=[];var d=[];var s={};var e=a['@odata.context'];var p=e.lastIndexOf('#');if(p>-1){e=e.slice(p+1);}var f=this.sina.getDataSource(e);var w=a['@com.sap.vocabularies.Search.v1.WhyFound']||{};var m={};var g='';for(var h in a){if(h[0]==='@'||h[0]==='_'){continue;}m=f.getAttributeMetadata(h);if(m.id=="LOC_4326"){m.usage={Detail:{displayOrder:-1}};}var j=t.odata2Sina(m.type,a[h]);var k="";for(var l in w){if(l===h&&w[l][0]){k=w[l][0];delete w[l];}}var n=this.sina._createSearchResultSetItemAttribute({id:m.id,label:m.label,value:j,valueFormatted:j,valueHighlighted:k||j,isHighlighted:k.length>0?true:false,metadata:m});if(m.usage.Title){b.push(n);}if(m.usage.Detail){d.push(n);}g=f.attributeMetadataMap[m.id].semanticObjectType||'';if(g.length>0){s[g]=j;}}b.sort(function(z,A){return z.metadata.usage.Title.displayOrder-A.metadata.usage.Title.displayOrder;});d.sort(function(z,A){return z.metadata.usage.Detail.displayOrder-A.metadata.usage.Detail.displayOrder;});var o=[];var q=[];for(var i=0;i<b.length;++i){var r=b[i];o.push(r.valueFormatted);q.push(r.valueHighlighted);}o=o.join(' ');q=q.join(' ');g=f.sematicObjectType||'';var v=f.system||'';var x=f.client||'';var y;return this.intentsResolver.resolveIntents({semanticObjectType:g,semanticObjectTypeAttributes:s,systemId:v,client:x,fallbackDefaultNavigationTarget:y}).then(function(z){var A=z&&z.defaultNavigationTarget;var B=z&&z.navigationTargets;return this.sina._createSearchResultSetItem({dataSource:f,title:o,titleHighlighted:q,titleAttributes:b,detailAttributes:d,defaultNavigationTarget:A,navigationTargets:B});}.bind(this));}});});
