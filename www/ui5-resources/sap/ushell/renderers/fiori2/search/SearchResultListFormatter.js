sap.ui.define(['sap/ushell/renderers/fiori2/search/SearchConfiguration','sap/ushell/renderers/fiori2/search/SearchHelper','sap/ushell/renderers/fiori2/search/SearchNavigationObject','sap/ushell/renderers/fiori2/search/SearchNavigationObjectForSinaNavTarget'],function(S,a,b,c){"use strict";var m=sap.ushell.renderers.fiori2.search.SearchResultListFormatter=function(){this.init.apply(this,arguments);};m.prototype={init:function(){},format:function(s,t,o){o=o||{};o.suppressHighlightedValues=o.suppressHighlightedValues||false;var l={};var f=[];var r=s.items;for(var i=0;i<r.length;i++){var d=r[i];var e={};var I={};var g=[];for(var z=0;z<d.detailAttributes.length;z++){var h=d.detailAttributes[z];switch(h.metadata.type.toLowerCase()){case'imageurl':e.imageUrl=h.value;e.imageFormat=h.metadata.format?h.metadata.format.toLowerCase():undefined;if(h.defaultNavigationTarget){e.imageNavigation=new c(h.defaultNavigationTarget);}break;case'geojson':e.geoJson={value:h.value,label:d.title};break;case'double':case'integer':case'string':case'longtext':case'date':case'time':case'timestamp':I={};I.name=h.label;I.valueRaw=h.value;I.value=o.suppressHighlightedValues?h.valueFormatted:h.valueHighlighted;I.valueWithoutWhyfound=h.valueFormatted;if(h.unitOfMeasure){if(o.suppressHighlightedValues||!h.unitOfMeasure.valueHighlighted){I.value+=" "+h.unitOfMeasure.valueFormatted;}else{I.value+=" "+h.unitOfMeasure.valueHighlighted;}I.valueWithoutWhyfound+=" "+h.unitOfMeasure.valueFormatted;}if(h.description){if(o.suppressHighlightedValues||!h.description.valueHighlighted){I.value=this._concatenateAttrValueAndDescriptionAccordingToArrangement(I.value,h.description.valueFormatted,h.metadata.descriptionTextArrangement);}else{I.value=this._concatenateAttrValueAndDescriptionAccordingToArrangement(I.value,h.description.valueHighlighted,h.metadata.descriptionTextArrangement);}I.valueWithoutWhyfound=this._concatenateAttrValueAndDescriptionAccordingToArrangement(I.valueWithoutWhyfound,h.description.valueFormatted,h.metadata.descriptionTextArrangement);}I.key=h.id;I.isTitle=false;I.isSortable=h.metadata.isSortable;I.attributeIndex=z;I.displayOrder=h.metadata.usage.Detail&&h.metadata.usage.Detail.displayOrder;I.whyfound=h.isHighlighted;if(h.defaultNavigationTarget){I.defaultNavigationTarget=new c(h.defaultNavigationTarget);}if(h.metadata.type.toLowerCase()==='longtext'){I.longtext=h.value;}if(h.metadata.format&&h.metadata.format.toLowerCase()==="multilinetext"){I.longtext=h.value;if(!e.descriptionAttribute){e.descriptionAttribute=I;}}g.push(I);break;}}e.key=d.key;e.keystatus=d.keystatus;e.dataSource=d.dataSource;e.dataSourceName=d.dataSource.label;e.title=o.suppressHighlightedValues?d.title.trim():d.titleHighlighted.trim();if(d.titleAttributes&&d.titleAttributes.length==1&&d.titleAttributes[0].description){var k=d.titleAttributes[0].description;var n=o.suppressHighlightedValues?k.valueFormatted.trim():k.valueHighlighted.trim();e.title=this._concatenateAttrValueAndDescriptionAccordingToArrangement(e.title,n,k.metadata.descriptionTextArrangement);}e.titleDescription=d.titleDescription?d.titleDescription.trim():"";e.itemattributes=g;if(d.defaultNavigationTarget){e.titleNavigation=new c(d.defaultNavigationTarget);if(!e.title||e.title.length==0){e.title=d.defaultNavigationTarget.label;}}if(d.navigationTargets&&d.navigationTargets.length>0){e.navigationObjects=[];for(var j=0;j<d.navigationTargets.length;j++){var p=new c(d.navigationTargets[j]);p.setLoggingType('RESULT_LIST_ITEM_NAVIGATE_CONTEXT');e.navigationObjects.push(p);}}var q=l[d.dataSource.id]||{};l[d.dataSource.id]=q;e.layoutCache=q;e.selected=e.selected||false;e.expanded=e.expanded||false;var u={};this._formatResultForDocuments(d,u);this._formatResultForNotes(d,u);e.additionalParameters=u;e.positionInList=i;e.resultSetId=s.id;f.push(e);}return f;},_concatenateAttrValueAndDescriptionAccordingToArrangement:function(d,e,f){switch(f){case'TextFirst':return e+" "+d;case'TextLast':return d+" "+e;case'TextOnly':return e;default:return d+" "+e;}},_formatResultForDocuments:function(r,d){var k='';d.isDocumentConnector=false;var j,e;for(j=0;j<r.detailAttributes.length;j++){e=r.detailAttributes[j];if(e.metadata.id==='FILE_PROPERTY'){d.isDocumentConnector=true;}if(e.metadata.isKey===true){if(k.length>0){k+=';';}k=k+e.metadata.id+'='+e.value;}}if(d.isDocumentConnector===true){var s=';o=sid('+r.dataSource.system+'.'+r.dataSource.client+')';var f=r.dataSource.id;d.imageUrl="/sap/opu/odata/SAP/ESH_SEARCH_SRV"+s+"/FileLoaderFiles(ConnectorId='"+f+"',FileType='ThumbNail',SelectionParameters='"+k+"')/$value";d.titleUrl="/sap/opu/odata/SAP/ESH_SEARCH_SRV"+s+"/FileLoaderFiles(ConnectorId='"+f+"',FileType='BinaryContent',SelectionParameters='"+k+"')/$value";var g="/sap/opu/odata/SAP/ESH_SEARCH_SRV"+s+"/FileLoaderFiles(ConnectorId='"+f+"',FileType='SUVFile',SelectionParameters='"+k+"')/$value";d.suvlink='/sap/bc/ui5_ui5/ui2/ushell/resources/sap/fileviewer/viewer/web/viewer.html?file='+encodeURIComponent(g);if(!r.navigationObjects){r.navigationObjects=[];}var n=new b({text:"Show Document",href:d.suvlink,target:"_blank"});r.navigationObjects.push(n);for(j=0;j<r.detailAttributes.length;j++){e=r.detailAttributes[j];if(e.id=='PHIO_ID_THUMBNAIL'&&e.value){d.containsThumbnail=true;}if(e.id=='PHIO_ID_SUV'&&e.value){d.containsSuvFile=true;}}}},_formatResultForNotes:function(r,d){}};return m;});
