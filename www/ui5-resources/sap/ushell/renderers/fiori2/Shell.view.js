// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(['sap/ui/core/IconPool','sap/ui/Device','sap/ui/core/CustomData','sap/ui/core/theming/Parameters','sap/ui/core/routing/HashChanger','sap/ui/core/HTML','sap/ui/model/Filter','sap/ushell/UserActivityLog','./Navigation','sap/ushell/ui/launchpad/ActionItem','sap/ushell/ui/launchpad/Fiori2LoadingDialog','sap/ushell/ui/launchpad/ViewPortContainer','sap/ushell/ui/shell/SplitContainer','sap/ushell/ui/shell/RightFloatingContainer','sap/ushell/ui/shell/ShellLayout','sap/ushell/ui/shell/ShellHeader','sap/ushell/ui/shell/ShellHeadItem','sap/ushell/ui/shell/ShellTitle','sap/ushell/ui/shell/ShellAppTitle','sap/ushell/ui/shell/ShellNavigationMenu','sap/ushell/ui/shell/ToolArea','sap/ushell/ui/shell/NavigationMiniTile','sap/ushell/ui/footerbar/ContactSupportButton','sap/ushell/ui/launchpad/AccessibilityCustomData','sap/ushell/renderers/fiori2/AccessKeysHandler','sap/m/StandardListItem','sap/m/Button','sap/m/Dialog','sap/ushell/resources','sap/ushell/utils','sap/ushell/Config'],function(I,D,C,T,H,a,F,U,N,A,b,V,S,R,c,d,e,f,g,h,j,k,l,m,n,o,B,p,r,u,q){"use strict";function s(i,t){return sap.ui.getCore().byId(t.getObject());}sap.ui.jsview("sap.ushell.renderers.fiori2.Shell",{createContent:function(t){this.oShellAppTitleStateEnum={SHELL_NAV_MENU_ONLY:0,ALL_MY_APPS_ONLY:1,SHELL_NAV_MENU:2,ALL_MY_APPS:3};var v=this.getViewData()||{},w=v.config||{},x=(w.appState==="embedded")?true:false,y,z=new e({id:"configBtn",tooltip:"{i18n>showGrpsBtn_tooltip}",ariaLabel:"{i18n>showGrpsBtn_tooltip}",icon:I.getIconURI("menu2"),selected:{path:"/currentState/showPane"},press:[t.togglePane,t]}),E=sap.ui.getCore().getConfiguration().getRTL()?"feeder-arrow":"nav-back",G=new e({id:"homeBtn",tooltip:"{i18n>homeBtn_tooltip}",ariaLabel:"{i18n>homeBtn_tooltip}",icon:I.getIconURI("home"),target:w.rootIntent?"#"+w.rootIntent:"#"}),J=new e({id:"backBtn",tooltip:"{i18n>backBtn_tooltip}",ariaLabel:"{i18n>backBtn_tooltip}",icon:I.getIconURI(E),press:t._navBack.bind(t)}),K,L,M;;this._allowUpToThreeActionInShellHeader(w);J.setShowSeparator(false);G.setShowSeparator(false);G.addCustomData(new m({key:"aria-disabled",value:"false",writeToDom:true}));G.addEventDelegate({onsapskipback:function(i){if(n.getAppKeysHandler()){i.preventDefault();n.bFocusOnShell=false;}},onsapskipforward:function(i){if(n.getAppKeysHandler()){i.preventDefault();n.bFocusOnShell=false;}}});z.addEventDelegate({onsapskipforward:function(i){if(n.getAppKeysHandler()){i.preventDefault();n.bFocusOnShell=false;}},onfocusin:function(){n.bFocusOnShell=true;n.bFocusPassedToExternalHandlerFirstTime=true;}});this.aDanglingControls=[];if(!w.preventLoadingDialogAtStartup){y=new b({id:"Fiori2LoadingDialog",text:""});this.aDanglingControls.push(y);}K=this.initViewPortContainer(t);if(u.isNotificationsEnabled()){L=new sap.ushell.ui.shell.ShellHeadItem({id:"NotificationsCountButton",icon:sap.ui.core.IconPool.getIconURI("ui-notifications"),visible:true,enabled:false}).addStyleClass("sapUshellPlaceHolders");L.setShowSeparator(false);this.aDanglingControls.push(L);}M=new sap.ushell.ui.shell.ShellHeadItem({id:"meAreaHeaderButton",icon:'{/userImage/personPlaceHolder}',visible:true,enabled:false}).addStyleClass("sapUshellPlaceHolders");M.setShowSeparator(false);this.aDanglingControls.push(M);if(w.enablePersonalization!==false){var O="openCatalogBtn";var P=r.i18n.getText("open_appFinderBtn");var Q='sap-icon://sys-find';var W=function(){jQuery.sap.measure.start("FLP:AppFinderLoadingStartToEnd","AppFinderLoadingStartToEnd","FLP");var i="Shell-home&/appFinder/catalog";if(this.data("isShellHeader")){var i1=new RegExp("^"+i);if(i1.test(hasher.getHash())){window.location.reload();return;}}setTimeout(function(){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(j1){j1.toExternal({target:{shellHash:"#"+i}});});},D.system.desktop?0:500);};var X=!w.disableAppFinder;if(w.moveAppFinderActionToShellHeader){if(!this.oOpenCatalogItem){this.oOpenCatalogItem=new e(O,{icon:Q,tooltip:P,text:P,press:W,showSeparator:false,visible:X});if(w.enableHelp){this.oOpenCatalogItem.addStyleClass('help-id-openCatalogActionItem');}this.oOpenCatalogItem.data("isShellHeader",true);}}else if(!this.oOpenCatalogItem){this.oOpenCatalogItem=new A(O,{text:P,icon:Q,actionType:'action',press:W,visible:X});if(w.enableHelp){this.oOpenCatalogItem.addStyleClass('help-id-openCatalogActionItem');}}this.aDanglingControls.push(this.oOpenCatalogItem);if(w.moveEditHomePageActionToShellHeader){jQuery.sap.measure.start("FLP:Shell.view.createContent","create the edit home page button as shell head enditem","FLP");if(!this.oTileActionsButton){this.oTileActionsButton=new e("ActionModeBtn",{icon:'sap-icon://edit',visible:false,showSeparator:false});this.oTileActionsButton.data("isShellHeader",true);if(w.enableHelp){this.oTileActionsButton.addStyleClass('help-id-openCatalogActionItem');}}this.aDanglingControls.push(this.oTileActionsButton);jQuery.sap.measure.end("FLP:Shell.view.createContent");}}var Y=new e({id:"endItemsOverflowBtn",tooltip:"{i18n>shellHeaderOverflowBtn_tooltip}",ariaLabel:"{i18n>shellHeaderOverflowBtn_tooltip}",icon:"sap-icon://overflow",press:[t.pressEndItemsOverflow,t],visible:true,showSeparator:false});this.aDanglingControls.push(Y);var Z=new S({id:'shell-split',showSecondaryContent:{path:"/currentState/showPane"},secondaryContent:{path:"/currentState/paneContent",factory:s},content:K,subHeader:{path:"/currentState/subHeader",factory:s}});var $=new j({id:'shell-toolArea',toolAreaItems:{path:"/currentState/toolAreaItems",factory:s}});var _=new R({id:'right-floating-container',top:'6.875',hideItemsAfterPresentation:true,visible:'{/currentState/showRightFloatingContainer}',floatingContainerItems:{path:"/currentState/RightFloatingContainerItems",factory:s},insertItemsWithAnimation:{path:'/animationMode',formatter:function(i){return i!=='minimal';}}});var a1=new f("shellTitle",{text:{path:"/title"}});var b1=function(i1,j1){var k1=j1.getProperty("icon");var l1=j1.getProperty("title");var m1=j1.getProperty("subtitle");var n1=j1.getProperty("intent");if(!k1){k1="sap-icon://circle-task-2";}var o1=(new o({type:"Active",title:l1,description:m1,icon:k1,customData:[new C({key:"intent",value:n1})],press:function(p1){var q1=p1.getSource().getCustomData();if(q1&&q1.length>0){for(var i=0;i<q1.length;i++){if(q1[i].getKey()==="intent"){var r1=q1[i].getValue();if(r1&&r1[0]==="#"){t.navigateFromShellApplicationNavigationMenu(r1);return;}}}}}})).addStyleClass("sapUshellNavigationMenuListItems");return o1;};var c1=function(i,i1){var j1=i1.getProperty("icon");var k1=i1.getProperty("title");var l1=i1.getProperty("subtitle");var m1=i1.getProperty("intent");if(!l1&&!j1){j1="sap-icon://documents";}return new k({title:k1,subtitle:l1,icon:j1,intent:m1,press:function(){var n1=this.getIntent();if(n1&&n1[0]==='#'){t.navigateFromShellApplicationNavigationMenu(n1);}}});};var d1=new h("shellNavigationMenu",{title:"{/currentState/application/title}",icon:"{/currentState/application/icon}",showTitle:{path:"/currentState/application/showNavMenuTitle"},showRelatedApps:(w.appState==="lean")?false:true,items:{path:"/currentState/application/hierarchy",factory:b1.bind(this)},miniTiles:{path:"/currentState/application/relatedApps",factory:c1.bind(this)},visible:{path:'/ShellAppTitleState',formatter:function(i){return i===this.oShellAppTitleStateEnum.SHELL_NAV_MENU;}.bind(this)}});this.oShellNavigationMenu=d1;var e1;e1=new g({id:"shellAppTitle",text:"{/currentState/application/title}",tooltip:r.i18n.getText("shellNavMenu_openMenuTooltip"),navigationMenu:d1});e1.addEventDelegate({onsapskipforward:function(i){if(n.getAppKeysHandler()){i.preventDefault();n.bFocusOnShell=false;}}});var f1=new F('','EQ','a'),g1,h1;f1.fnTest=t.isHeadEndItemNotInOverflow.bind(t);g1=new d({id:'shell-header',showLogo:{path:"/currentState/showLogo"},headItems:{path:"/currentState/headItems",factory:s},headEndItems:{path:"/currentState/headEndItems",factory:s,filters:[f1]},visible:{path:"/currentState/headerVisible"},title:a1,appTitle:e1,showSeparators:false});g1.setAccessKeyHandler(n);this.oShellHeader=g1;this.addEventDelegate({"onBeforeRendering":function(){this.oShellHeader.createUIArea(this.getUIArea().getId());}},this);h1=new c({id:"shell",header:g1,toolArea:$,rightFloatingContainer:_,floatingContainerVisible:false,canvasSplitContainer:Z,toolAreaVisible:{path:"/currentState/toolAreaVisible"},headerVisible:{path:"/currentState/headerVisible"},backgroundColorForce:false,showBrandLine:false,showAnimation:false,enableCanvasShapes:w.enableBackGroundShapes===undefined?true:w.enableBackGroundShapes});h1._setStrongBackground(true);this.setOUnifiedShell(h1);g1.setShellLayout(h1);if(x){g1.setLogo(sap.ui.resource('sap.ui.core','themes/base/img/1x1.gif'));}else{this.initShellBarLogo(g1);}this.setDisplayBlock(true);this.aDanglingControls=this.aDanglingControls.concat([sap.ui.getCore().byId('viewPortContainer'),G,J,z]);h1.updateAggregation=this.updateShellAggregation;g1.updateAggregation=this.updateShellAggregation;$.updateAggregation=this.updateShellAggregation;_.updateAggregation=this.updateShellAggregation;Z.updateAggregation=this.updateShellAggregation;this.logonIFrameReference=null;u.setPerformanceMark("FLP - Shell.view rendering started!");return h1;},_allowUpToThreeActionInShellHeader:function(i){if(Object.keys(i).length!=0){var t=[i.moveAppFinderActionToShellHeader,i.moveUserSettingsActionToShellHeader,i.moveGiveFeedbackActionToShellHeader,i.moveContactSupportActionToShellHeader,i.moveEditHomePageActionToShellHeader];var v=0;for(var w=0;w<5;w++){if(v===3){t[w]=false;}else if(t[w]){v++;}}i.moveAppFinderActionToShellHeader=t[0];i.moveUserSettingsActionToShellHeader=t[1];i.moveGiveFeedbackActionToShellHeader=t[2];i.moveContactSupportActionToShellHeader=t[3];i.moveEditHomePageActionToShellHeader=t[4];}},_createPostCoreExtControls:function(i,t){var v=new i({id:'shell-floatingContainer',content:{path:"/currentState/floatingContainerContent",factory:s}});v.addCustomData(new m({key:"tabindex",value:"-1",writeToDom:true}));v.addEventDelegate({onsapskipforward:function(E){E.preventDefault();n.setIsFocusHandledByAnotherHandler(true);n.sendFocusBackToShell(E);},onsapskipback:function(E){if(n.getAppKeysHandler()){E.preventDefault();n.bFocusOnShell=false;}}});var w=sap.ui.getCore().byId("shell"),M=w.getModel();v.setModel(M);this.aDanglingControls.push(v);var x=new t({id:'shell-floatingActions',floatingActions:{path:"/currentState/floatingActions",factory:s}});x.updateAggregation=this.updateShellAggregation;var y=this.getOUnifiedShell();y.setFloatingContainer(v);y.setFloatingActionsContainer(x);this._createAllMyAppsView();},createPostCoreExtControls:function(){sap.ui.require(["sap/ushell/ui/shell/FloatingContainer","sap/ushell/ui/shell/ShellFloatingActions"],this._createPostCoreExtControls.bind(this));},_createAllMyAppsView:function(){var i=function(t){if(t.isEnabled()){this.oAllMyAppsView=sap.ui.view("allMyAppsView",{type:sap.ui.core.mvc.ViewType.JS,viewName:"sap.ushell.renderers.fiori2.allMyApps.AllMyApps",viewData:{_fnGetShellModel:this.getModel.bind(this)},height:"100%",visible:{path:'/ShellAppTitleState',formatter:function(v){return v!==this.oShellAppTitleStateEnum.SHELL_NAV_MENU;}.bind(this)}}).addStyleClass("sapUshellAllMyAppsView");this.oAllMyAppsView.addCustomData(new m({key:"aria-label",value:r.i18n.getText("allMyApps_headerTitle"),writeToDom:true}));this.getOUnifiedShell().getHeader().getAppTitle().setAllMyApps(this.oAllMyAppsView);}}.bind(this);sap.ushell.Container.getServiceAsync("AllMyApps").then(i);},getOUnifiedShell:function(){return this.oUnifiedShell;},setOUnifiedShell:function(i){this.oUnifiedShell=i;},_getIconURI:function(i){var t=null;if(i){var v=/url[\s]*\('?"?([^\'")]*)'?"?\)/.exec(i);if(v){t=v[1];}}return t;},initShellBarLogo:function(i){var M=jQuery.sap.getModulePath("sap.ushell");i.setLogo(M+'/themes/base/img/sap_55x27.png');var t=this;sap.ui.getCore().attachThemeChanged(function(){if(i.bIsDestroyed){return;}var v=T.get("sapUiGlobalLogo");if(v){v=t._getIconURI(v);if(v){i.setLogo(v);}else{i.setLogo(M+'/themes/base/img/sap_55x27.png');}}else{i.setLogo(M+'/themes/base/img/sap_55x27.png');}});u.setPerformanceMark("FLP-TimeToFirstMeaningfullPaint_setLogo");},initViewPortContainer:function(i){var v=new V({id:"viewPortContainer",defaultState:sap.ushell.ui.launchpad.ViewPortState.Center,afterNavigate:jQuery.proxy(i.onAfterNavigate,i),afterSwitchState:jQuery.proxy(i.onAfterViewPortSwitchState,i)});return v;},updateShellAggregation:function(t){var w=this.mBindingInfos[t],x=this.getMetadata().getJSONKeys()[t],y;jQuery.each(this[x._sGetter](),jQuery.proxy(function(i,v){this[x._sRemoveMutator](v);},this));jQuery.each(w.binding.getContexts(),jQuery.proxy(function(i,v){y=w.factory(this.getId()+"-"+i,v)?w.factory(this.getId()+"-"+i,v).setBindingContext(v,w.model):"";this[x._sMutator](y);},this));},getControllerName:function(){return"sap.ushell.renderers.fiori2.Shell";},createIFrameDialog:function(){var i=null,L=this.logonIFrameReference,t;var _=function(){if(L){L.remove();}return jQuery('<iframe id="SAMLDialogFrame" src="" frameborder="0" height="100%" width="100%"></iframe>');};var v=function(){i.addStyleClass('sapUshellSamlDialogHidden');jQuery('#sap-ui-blocklayer-popup').addClass('sapUshellSamlDialogHidden');};this.destroyIFrameDialog();var w=new B({text:r.i18n.getText("samlCloseBtn"),press:function(){sap.ushell.Container.cancelLogon();}});var x=new a("SAMLDialogFrame");this.logonIFrameReference=_();x.setContent(this.logonIFrameReference.prop('outerHTML'));i=new p({id:"SAMLDialog",title:r.i18n.getText("samlDialogTitle"),contentWidth:"50%",contentHeight:"50%",rightButton:w}).addStyleClass("sapUshellIframeDialog");t=q.last("/core/extension/SupportTicket");if(t){var y=new l();y.setWidth('150px');y.setIcon('');i.setLeftButton(y);}i.addContent(x);i.open();v();this.logonIFrameReference=jQuery('#SAMLDialogFrame');return this.logonIFrameReference[0];},destroyIFrameDialog:function(){var i=sap.ui.getCore().byId('SAMLDialog');if(i){i.destroy();}this.logonIFrameReference=null;},showIFrameDialog:function(){var i=sap.ui.getCore().byId('SAMLDialog');if(i){i.removeStyleClass('sapUshellSamlDialogHidden');jQuery('#sap-ui-blocklayer-popup').removeClass('sapUshellSamlDialogHidden');}},addDanglingControl:function(i){this.aDanglingControls.push(i);}});},false);
