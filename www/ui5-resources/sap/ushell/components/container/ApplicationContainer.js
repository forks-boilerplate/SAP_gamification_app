// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/utils","sap/ushell/library","sap/m/MessagePopover","sap/ui/thirdparty/URI"],function(u,a,M,U){"use strict";var p="sap.ushell.components.container.",c=p+"ApplicationContainer",d="sap.ushell.Container.dirtyState.",l,r;function b(T){var e=sap.ushell.Container.getService("CrossApplicationNavigation");e.isUrlSupported(T.url).done(function(){T.promise.resolve({"allowed":true,"id":T.id});}).fail(function(){T.promise.resolve({"allowed":false,"id":T.id});});}function i(){var e={"asyncURLHandler":G.prototype._adaptIsUrlSupportedResultForMessagePopover};if(M&&M.setDefaultHandlers){M.setDefaultHandlers(e);}}sap.ui.getCore().getEventBus().subscribe("sap.ushell","coreResourcesFullyLoaded",i);l=new u.Map();function g(e){return l.get(e.getId());}function f(e){var P=jQuery.sap.getUriParameters(e).mParams,H=P["sap-xapp-state"],R;delete P["sap-xapp-state"];R={startupParameters:P};if(H){R["sap-xapp-state"]=H;}return R;}function h(K,e){if(!r){r=jQuery.sap.resources({url:jQuery.sap.getModulePath(p)+"/resources/resources.properties",language:sap.ui.getCore().getConfiguration().getLanguage()});}return r.getText(K,e);}function j(){return new sap.ui.core.Icon({size:"2rem",src:"sap-icon://error",tooltip:G.prototype._getTranslatedText("an_error_has_occured")});}function k(e){var H=e.getAggregation("child"),I;if(H instanceof sap.ui.core.ComponentContainer){I=H.getComponentInstance().getMetadata().getName().replace(/\.Component$/,"");jQuery.sap.log.debug("unloading component "+I,null,c);}e.destroyAggregation("child");}function m(e,H,I){var J,K,L,N,O,P,Q,V={},R,S;L=H.indexOf("?");if(L>=0){P=G.prototype._getParameterMap(H);V=P.startupParameters;H=H.slice(0,L);}if(H.slice(-1)!=='/'){H+='/';}if(/\.view\.(\w+)$/i.test(I)){O=/^SAPUI5=(?:([^\/]+)\/)?([^\/]+)\.view\.(\w+)$/i.exec(I);if(!O){jQuery.sap.log.error("Invalid SAPUI5 URL",I,c);return G.prototype._createErrorControl();}Q=O[1];R=O[2];S=O[3].toUpperCase();if(Q){R=Q+"."+R;}else{N=R.lastIndexOf(".");if(N<1){jQuery.sap.log.error("Missing namespace",I,c);return G.prototype._createErrorControl();}Q=R.slice(0,N);}}else{Q=I.replace(/^SAPUI5=/,"");}jQuery.sap.registerModulePath(Q,H+Q.replace(/\./g,'/'));G.prototype._destroyChild(e);if(R){if(e.getApplicationConfiguration()){V.config=e.getApplicationConfiguration();}K=sap.ui.view({id:e.getId()+"-content",type:S,viewData:V||{},viewName:R});e.fireEvent("applicationConfiguration");}else{jQuery.sap.log.debug("loading component "+Q,null,c);var T=P?{startupParameters:P.startupParameters}:{startupParameters:{}};if(P&&P["sap-xapp-state"]){T["sap-xapp-state"]=P["sap-xapp-state"];}if(e.getApplicationConfiguration()){T.config=e.getApplicationConfiguration();}J=sap.ui.component({id:e.getId()+"-component",componentData:T,name:Q});e.fireEvent("applicationConfiguration",{"configuration":J.getMetadata().getConfig()});K=new sap.ui.core.ComponentContainer({id:e.getId()+"-content",component:J});}K.setWidth(e.getWidth());K.setHeight(e.getHeight());K.addStyleClass("sapUShellApplicationContainer");e.setAggregation("child",K,true);return K;}function n(e,H){setTimeout(function(){sap.ui.getCore().getEventBus().publish("sap.ushell.components.container.ApplicationContainer",e,H);},0);}function o(e,H,I){var J,K,L,N,O={startupParameters:{}},P,Q=e.getComponentHandle(),R=sap.ushell.Container.getService("PluginManager"),S,T;u.addTime("createUi5Component");J=H.indexOf("?");if(J>=0){N=G.prototype._getParameterMap(H);O={startupParameters:N.startupParameters};if(N["sap-xapp-state"]){O["sap-xapp-state"]=N["sap-xapp-state"];}H=H.slice(0,J);}if(e.getApplicationConfiguration()){O.config=e.getApplicationConfiguration();}if(H.slice(-1)!=='/'){H+='/';}jQuery.sap.registerModulePath(I,H);G.prototype._destroyChild(e);P={id:e.getId()+"-component",name:I,componentData:O};jQuery.sap.log.debug("Creating component instance for "+I,JSON.stringify(P),c);sap.ui.getCore().getEventBus().publish("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",{name:I});if(Q){K=Q.getInstance(P);}else{jQuery.sap.log.error("No component handle available for '"+I+"'; fallback to component.load()",null,c);K=sap.ui.component({id:e.getId()+"-component",name:I,componentData:O});}e.fireEvent("applicationConfiguration",{"configuration":K.getMetadata().getConfig()});L=new sap.ui.core.ComponentContainer({id:e.getId()+"-content",component:K});L.setHeight(e.getHeight());L.setWidth(e.getWidth());L.addStyleClass("sapUShellApplicationContainer");e._disableRouterEventHandler=G.prototype._disableRouter.bind(this,K);sap.ui.getCore().getEventBus().subscribe("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",e._disableRouterEventHandler);e.setAggregation("child",L,true);if(R){S=R.getPluginLoadingPromise("RendererExtensions");T=S&&S.state();if(T==="pending"){S.done(function(){G.prototype._publishExternalEvent("componentCreated",{component:K});}).fail(function(){G.prototype._publishExternalEvent("componentCreated",{component:K});});}if(T==="resolved"||T==="rejected"){G.prototype._publishExternalEvent("componentCreated",{component:K});}}G.prototype._publishExternalEvent("componentCreated",{component:K});return L;}function q(e){var H;if((e instanceof sap.ui.core.Component)&&(typeof e.getRouter==="function")){H=e.getRouter();if(H&&(typeof H.stop==="function")){jQuery.sap.log.info("router stopped for instance "+e.getId());H.stop();}}}function s(e){var H=document.createElement("a"),I=jQuery.sap.getUriParameters(e).get("sap-client"),J;H.href=e;J=H.protocol+"//"+H.host;return new sap.ushell.System({alias:I?J+"?sap-client="+I:J,baseUrl:J,client:I||undefined,platform:"abap"});}function t(e,H){var T=false,I=e.getDomRef(),J=e.getApplicationType(),K,O;if(I){if(u.isApplicationTypeEmbeddedInIframe(J)){K=U(I.src||window.location&&window.location.href||'');O=K.protocol()+"://"+K.host();T=(H.source===I.contentWindow)||(H.origin===O);}else if(J===sap.ushell.components.container.ApplicationType.URL){K=U();O=K.protocol()+"://"+K.host();T=(H.origin===O);}}return T;}function v(S,e,O){var R=JSON.stringify({type:"request",service:e,request_id:jQuery.sap.uid(),body:{}});jQuery.sap.log.debug("Sending post message request to origin ' "+O+"': "+R,null,"sap.ushell.components.container.ApplicationContainer");S.postMessage(R,O);}function w(){var I=this.getDomRef();if(!I||I.tagName!=="IFRAME"){return null;}return I;}function x(H,I,J){var P=jQuery.sap.getObject("sap-ushell-config.services.PostMessage.config",0),S=J&&J.service,K;jQuery.sap.log.debug("Received post message request from origin '"+I.origin+"': "+JSON.stringify(J),null,"sap.ushell.components.container.ApplicationContainer");if(J.type!=="request"||!S||(S.indexOf("sap.ushell.services.CrossApplicationNavigation")!==0&&S.indexOf("sap.ushell.CrossApplicationNavigation")!==0&&S.indexOf("sap.ushell.ui5service.ShellUIService")!==0&&S.indexOf("sap.ushell.services.Container")!==0)){return;}K=S.split(".")[3];if(P&&P.enabled===false){jQuery.sap.log.warning("Received message for "+K+", but this "+"feature is disabled. It can be enabled via launchpad configuration "+"property 'services.PostMessage.config.enabled: true'",undefined,"sap.ushell.components.container.ApplicationContainer");return;}if(!G.prototype._isTrustedPostMessageSource(H,I)){jQuery.sap.log.warning("Received message from untrusted origin '"+I.origin+"': "+JSON.stringify(I.data),null,"sap.ushell.components.container.ApplicationContainer");return;}function L(e,W){var X=JSON.stringify({type:"response",service:J.service,request_id:J.request_id,status:e,body:W});jQuery.sap.log.debug("Sending post message response to origin ' "+I.origin+"': "+X,null,"sap.ushell.components.container.ApplicationContainer");if(typeof I.source!=="object"||I.source===null){jQuery.sap.log.debug("Cannot send response message to origin ' "+I.origin,"`source` member of request message is not an object","sap.ushell.components.container.ApplicationContainer");return;}I.source.postMessage(X,I.origin);}function N(I,J){var e=new jQuery.Deferred(),W;if(J.body&&J.body.callbackMessage&&J.body.callbackMessage.service){W=G.prototype._backButtonPressedCallback.bind(null,I.source,J.body.callbackMessage.service,I.origin);}e.resolve(H.getShellUIService().setBackNavigation(W));return e.promise();}function O(W,X){var Y,Z,$,_=[W.id];if(arguments.length>1){_.unshift(X);}try{$=JSON.stringify(W);}catch(e){jQuery.sap.log.error("Cannot stringify and store expanded system data: "+e);}if($){Z=u.getLocalStorage();Y=u.generateLocalStorageKey("sap-system-data",_);Z.setItem(Y,$);}}function Q(){var e=sap.ushell.Container.getLogonSystem();var W=e.getName();var X=e.getClient();return"sid("+W+"."+X+")";}function R(e){return Q().toLowerCase()===e.toLowerCase();}function T(K){switch(K){case"sap.ushell.services.CrossApplicationNavigation.hrefForExternal":return new jQuery.Deferred().resolve(sap.ushell.Container.getService("CrossApplicationNavigation").hrefForExternal(J.body.oArgs)).promise();case"sap.ushell.services.CrossApplicationNavigation.getSemanticObjectLinks":return sap.ushell.Container.getService("CrossApplicationNavigation").getSemanticObjectLinks(J.body.sSemanticObject,J.body.mParameters,J.body.bIgnoreFormFactors,undefined,undefined,J.body.bCompactIntents);case"sap.ushell.services.CrossApplicationNavigation.isIntentSupported":return sap.ushell.Container.getService("CrossApplicationNavigation").isIntentSupported(J.body.aIntents);case"sap.ushell.services.CrossApplicationNavigation.isNavigationSupported":return sap.ushell.Container.getService("CrossApplicationNavigation").isNavigationSupported(J.body.aIntents);case"sap.ushell.services.CrossApplicationNavigation.toExternal":var W=u.clone(J.body.oArgs);var X=(W||{}).params;var Y=X&&X.hasOwnProperty("sap-system");if(Y){if(u.isPlainObject(X["sap-system"])){var Z=X["sap-system"];var $=X["sap-system-src"];var _=typeof $==="string";if(!_){O(Z);}else{O(Z,$);X["sap-system-src"]=$;}X["sap-system"]=Z.id;}else if(R(X["sap-system"])){delete X["sap-system"];}}return new jQuery.Deferred().resolve(sap.ushell.Container.getService("CrossApplicationNavigation").toExternal(W)).promise();case"sap.ushell.CrossApplicationNavigation.backToPreviousApp":sap.ushell.Container.getService("CrossApplicationNavigation").backToPreviousApp();return new jQuery.Deferred().resolve().promise();case"sap.ushell.services.CrossApplicationNavigation.backToPreviousApp":sap.ushell.Container.getService("CrossApplicationNavigation").backToPreviousApp();return new jQuery.Deferred().resolve().promise();case"sap.ushell.services.CrossApplicationNavigation.historyBack":sap.ushell.Container.getService("CrossApplicationNavigation").historyBack(J.body.iSteps);return new jQuery.Deferred().resolve().promise();case"sap.ushell.services.CrossApplicationNavigation.getAppStateData":return sap.ushell.Container.getService("CrossApplicationNavigation").getAppStateData(J.body.sAppStateKey);case"sap.ushell.ui5service.ShellUIService.setTitle":return new jQuery.Deferred().resolve(H.getShellUIService().setTitle(J.body.sTitle)).promise();case"sap.ushell.ui5service.ShellUIService.setBackNavigation":return N(I,J);case"sap.ushell.services.Container.setDirtyFlag":sap.ushell.Container.setDirtyFlag(J.body.bIsDirty);return new jQuery.Deferred().resolve().promise();case"sap.ushell.services.Container.getFLPUrl":return new jQuery.Deferred().resolve(sap.ushell.Container.getFLPUrl()).promise();default:var e="Unknown service name: '"+K+"'";return new jQuery.Deferred().reject(e).promise();}}try{T(J.service).done(function(e){L("success",{result:e});}).fail(function(e){L("error",{message:e});});}catch(V){L("error",{message:V.message});}}function y(H,I){var J=H.getUi5ComponentName&&H.getUi5ComponentName();var K=I.data;if(typeof K==="string"){try{K=JSON.parse(I.data);}catch(e){jQuery.sap.log.debug("Message received from origin '"+I.origin+"' cannot be parsed: "+e,K,"sap.ushell.components.container.ApplicationContainer");return;}}if(typeof J==="string"){jQuery.sap.log.debug("Skipping handling of postMessage 'message' event with data '"+JSON.stringify(K)+"' on container of UI5 application '"+J+"'","Only non UI5 application containers can handle 'message' postMessage event","sap.ushell.components.container.ApplicationContainer");return;}if(!H.getActive()){jQuery.sap.log.debug("Skipping handling of postMessage 'message' event with data '"+JSON.stringify(K)+"' on inactive container '"+H.getId()+"'","Only active containers can handle 'message' postMessage event","sap.ushell.components.container.ApplicationContainer");return;}if(K.action==="pro54_setGlobalDirty"&&localStorage.getItem(H.globalDirtyStorageKey)===sap.ushell.Container.DirtyState.PENDING){if(!G.prototype._isTrustedPostMessageSource(H,I)){jQuery.sap.log.warning("Received message from untrusted origin: "+I.origin,K,"sap.ushell.components.container.ApplicationContainer");return;}jQuery.sap.log.debug("getGlobalDirty() pro54_setGlobalDirty SetItem key:"+H.globalDirtyStorageKey+" value: "+K.parameters.globalDirty,null,"sap.ushell.components.container.ApplicationContainer");u.localStorageSetItem(H.globalDirtyStorageKey,K.parameters.globalDirty,true);}else{G.prototype._handleServiceMessageEvent(H,I,K);}}function z(e,H){var I=e._getIFrame(),J=e.getApplicationType();if(u.isApplicationTypeEmbeddedInIframe(e.getApplicationType(J))&&I){I.contentWindow.postMessage(JSON.stringify({action:"pro54_disableDirtyHandler"}),'*');H.preventDefault();}}function A(R,e,H){R.write("<div").writeControlData(e).writeAccessibilityState(e).addClass("sapUShellApplicationContainer").writeClasses(e).addStyle("height",e.getHeight()).addStyle("width",e.getWidth()).writeStyles().write(">").renderControl(H);R.write("</div>");}function B(H,I){var J=I==="TR"?"":"-NWBC";var V,K=function(){var V,L;try{V=sap.ui.getVersionInfo().version;}catch(e){jQuery.sap.log.error("sap ui version could not be determined, using sap.ui.version (core version) as fallback "+e);V=window.sap&&sap.ui&&sap.ui.version;}L=/\d+\.\d+\.\d+/.exec(V);if(L&&L[0]){V=L[0];}else{V=undefined;}return V;};V=K();if(V){H+=H.indexOf("?")>=0?"&":"?";H+="sap-shell="+encodeURIComponent("FLP"+V+J);}return H;}function C(e,H,T,R){var I,J=function(){var L=u.getParameterValueBoolean("sap-accessibility");if(L!==undefined){return L;}return sap.ushell.Container.getUser().getAccessibilityMode();},K=function(){var L=false,N=jQuery.sap.getUriParameters(e)||{mParams:{}};L=sap.ui.getCore().getConfiguration().getStatistics()&&!N.mParams.hasOwnProperty("sap-statistics");return L;};e+=e.indexOf("?")>=0?"&":"?";e+="sap-ie=edge";I=sap.ushell.Container.getUser().getTheme(sap.ushell.User.prototype.constants.themeFormat.NWBC);if(I){e+=e.indexOf("?")>=0?"&":"?";e+="sap-theme="+encodeURIComponent(I);}if(T){e+=e.indexOf("?")>=0?"&":"?";e+="sap-target-navmode="+encodeURIComponent(T);}if(J()){e+=e.indexOf("?")>=0?"&":"?";e+="sap-accessibility=X";}if(K()){e+=e.indexOf("?")>=0?"&":"?";e+="sap-statistics=true";}if(R){e+=e.indexOf("?")>=0?"&":"?";e+="sap-keepclientsession=1";}return B(e,H);}function D(R,e,H,I){var J=e.getAggregation("child");if(!J||e._bRecreateChild){J=G.prototype._createUi5Component(e,H,I);e._bRecreateChild=false;}G.prototype._renderControlInDiv(R,e,J);}function E(e,K,V){var O=e.getProperty(K);if(jQuery.sap.equal(O,V)){return;}e.setProperty(K,V);e._bRecreateChild=true;}function F(R,e,H,I,J){var L;localStorage.removeItem(e.globalDirtyStorageKey);if(J&&J.indexOf("SAPUI5.Component=")===0&&H===sap.ushell.components.container.ApplicationType.URL){D(R,e,I,J.replace(/^SAPUI5\.Component=/,""));return;}if(J&&J.indexOf("SAPUI5=")===0&&H===sap.ushell.components.container.ApplicationType.URL){G.prototype._renderControlInDiv(R,e,G.prototype._createUi5View(e,I,J));return;}jQuery.sap.log.debug("Not resolved as \"SAPUI5.Component=\" or \"SAPUI5=\" , "+"will attempt to load into iframe "+J);if(!e.getActive()){jQuery.sap.log.debug("Skipping rendering container iframe","Container '"+e.getId()+"' is inactive");return;}try{I=e.getFrameSource(H,I,J);}catch(K){jQuery.sap.log.error(K.message||K,null,c);e.fireEvent("applicationConfiguration");R.renderControl(G.prototype._createErrorControl());return;}if(sap.ushell.Container){L=G.prototype._getLogoutHandler(e);if(!L){if(u.isApplicationTypeEmbeddedInIframe(H)){L=G.prototype._logout.bind(null,e);l.put(e.getId(),L);sap.ushell.Container.attachLogoutEvent(L);sap.ushell.Container.addRemoteSystem(G.prototype._createSystemForUrl(I));}}else if(!u.isApplicationTypeEmbeddedInIframe(H)){sap.ushell.Container.detachLogoutEvent(L);l.remove(e.getId());}}if(u.isApplicationTypeEmbeddedInIframe(H)){var T=e.getTargetNavigationMode();I=G.prototype._adjustNwbcUrl(I,H,T,e.getIsStateful());u.localStorageSetItem(e.globalDirtyStorageKey,sap.ushell.Container.DirtyState.INITIAL);}e.fireEvent("applicationConfiguration");R.write("<iframe").writeControlData(e).writeAccessibilityState(e).writeAttributeEscaped("src",I).addClass("sapUShellApplicationContainer").writeClasses(e).addStyle("height",e.getHeight()).addStyle("width",e.getWidth()).writeStyles().write("></iframe>");}var G=sap.ui.core.Control.extend(c,{metadata:{properties:{additionalInformation:{defaultValue:"",type:"string"},application:{type:"object"},applicationConfiguration:{type:"object"},applicationType:{defaultValue:"URL",type:p+"ApplicationType"},height:{defaultValue:"100%",type:"sap.ui.core.CSSSize"},navigationMode:{defaultValue:"",type:"string"},targetNavigationMode:{defaultValue:"",type:"string"},text:{defaultValue:"",type:"string"},url:{defaultValue:"",type:"string"},visible:{defaultValue:true,type:"boolean"},active:{defaultValue:true,type:"boolean"},"sap-system":{defaultValue:undefined,type:"string"},applicationDependencies:{type:"object"},componentHandle:{type:"object"},ui5ComponentName:{type:"string"},width:{defaultValue:"100%",type:"sap.ui.core.CSSSize"},shellUIService:{type:"object"},reservedParameters:{type:"object"},coreResourcesFullyLoaded:{type:"boolean"},isStateful:{defaultValue:false,type:"boolean"}},events:{"applicationConfiguration":{}},aggregations:{child:{multiple:false,type:"sap.ui.core.Control",visibility:"hidden"}},library:"sap.ushell",designtime:"sap/ushell/designtime/ApplicationContainer.designtime"},exit:function(){var L,e=this;if(sap.ushell.Container){L=G.prototype._getLogoutHandler(e);if(L){sap.ushell.Container.detachLogoutEvent(L);l.remove(e.getId());}}localStorage.removeItem(e.globalDirtyStorageKey);if(e._unloadEventListener){removeEventListener("unload",e._unloadEventListener);}if(e._disableRouterEventHandler){sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",e._disableRouterEventHandler);}if(e._storageEventListener){removeEventListener("storage",e._storageEventListener);}if(e._messageEventListener){removeEventListener("message",e._messageEventListener);}G.prototype._destroyChild(e);if(sap.ui.core.Control.exit){sap.ui.core.Control.exit.apply(e);}},init:function(){var e=this;e.globalDirtyStorageKey=d+jQuery.sap.uid();e._unloadEventListener=e.exit.bind(e);addEventListener("unload",e._unloadEventListener);e._storageEventListener=function(S){var H=e.getApplicationType();if(S.key===e.globalDirtyStorageKey&&S.newValue===sap.ushell.Container.DirtyState.PENDING&&u.isApplicationTypeEmbeddedInIframe(H)){var I=e._getIFrame();if(I){jQuery.sap.log.debug("getGlobalDirty() send pro54_getGlobalDirty ",null,"sap.ushell.components.container.ApplicationContainer");I.contentWindow.postMessage(JSON.stringify({action:"pro54_getGlobalDirty"}),'*');}}};addEventListener('storage',e._storageEventListener);e._messageEventListener=G.prototype._handleMessageEvent.bind(null,e);addEventListener('message',e._messageEventListener);},onAfterRendering:function(e){if(this.getIsStateful()){this.rerender=function(){};}},renderer:function(R,e){var H=e.getApplication(),L=e.launchpadData,I;if(!e.getVisible()){G.prototype._renderControlInDiv(R,e);return;}if(e.error){delete e.error;G.prototype._renderControlInDiv(R,e,G.prototype._createErrorControl());}else if(!H){G.prototype._render(R,e,e.getApplicationType(),e.getUrl(),e.getAdditionalInformation());}else if(!H.isResolvable()){G.prototype._render(R,e,H.getType(),H.getUrl(),"");}else if(L){G.prototype._render(R,e,L.applicationType,L.Absolute.url.replace(/\?$/,""),L.applicationData);}else{jQuery.sap.log.debug("Resolving "+H.getUrl(),null,c);H.resolve(function(J){jQuery.sap.log.debug("Resolved "+H.getUrl(),JSON.stringify(J),c);e.launchpadData=J;G.prototype._destroyChild(e);},function(J){var K=H.getMenu().getDefaultErrorHandler();if(K){K(J);}G.prototype._destroyChild(e);e.error=J;});I=new sap.m.Text({text:G.prototype._getTranslatedText("loading",[H.getText()])});G.prototype._destroyChild(e);e.setAggregation("child",I);G.prototype._renderControlInDiv(R,e,I);}}});G.prototype.getFrameSource=function(e,H,I){if(!Object.prototype.hasOwnProperty.call(sap.ushell.components.container.ApplicationType,e)){throw new Error("Illegal application type: "+e);}return H;};G.prototype.setUrl=function(V){E(this,"url",V);};G.prototype.setAdditionalInformation=function(V){E(this,"additionalInformation",V);};G.prototype.setApplicationType=function(V){E(this,"applicationType",V);};G.prototype.createPostMessageRequest=function(S,e){var R=Date.now().toString();return{"type":"request","request_id":R,"service":S,"body":e};};G.prototype.setNewTRApplicationContext=function(e){var I=this._getIFrame();if(!I){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}e=B(e);var R=this.createPostMessageRequest("sap.its.startService",{"url":e});return this.postMessageToIframe(R,I,true).catch(function(H){return Promise.reject({eventData:H,message:"Failed to change application context."});});};G.prototype.postMessageToIframe=function(H,I,W){var J=this;var R=H.request_id;return new Promise(function(N,K){function P(O){var Q;try{Q=JSON.parse(O.data);if(R!==Q.request_id){return;}if("success"===Q.status){N(Q);}else{K(Q);}window.removeEventListener("message",P);}catch(e){N();jQuery.sap.log.warning("Obtained bad response from framework in response to message "+H.request_id);jQuery.sap.log.debug("Underlying framework returned invalid response data: '"+O.data+"'");}}var L=JSON.stringify(H);jQuery.sap.log.debug("Sending postMessage "+L+" to application container '"+J.getId()+"'");if(W){window.addEventListener("message",P,false);I.contentWindow.postMessage(L,"*");}else{I.contentWindow.postMessage(L,"*");N();}});};G.prototype.setNewApplicationContext=function(e,H){var I=this;var S=this["setNew"+e+"ApplicationContext"];if(!S){return Promise.reject({message:"Unsupported application type"});}var J=this._getIFrame();if(!J){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var R=this.createPostMessageRequest("sap.gui.triggerCloseSessionImmediately",{});return this.postMessageToIframe(R,J,true).then(function(){return S.call(I,H);},function(K){return Promise.reject({eventData:K,message:"Failed to change application context."});});};G.prototype.onApplicationOpened=function(N){var I=this.getIsStateful();if(!I){return Promise.resolve();}var e=this.getApplicationType();if(e==="TR"&&N!=="TR"){var H=this._getIFrame();if(!H){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var R=this.createPostMessageRequest("sap.gui.triggerCloseSession",{});return this.postMessageToIframe(R,H,false).catch(function(J){return Promise.reject({eventData:J,message:"Failed to change application context."});});}return Promise.resolve();};G.prototype._adaptIsUrlSupportedResultForMessagePopover=b;G.prototype._getLogoutHandler=g;G.prototype._getParameterMap=f;G.prototype._getTranslatedText=h;G.prototype._createErrorControl=j;G.prototype._destroyChild=k;G.prototype._createUi5View=m;G.prototype._publishExternalEvent=n;G.prototype._createUi5Component=o;G.prototype._disableRouter=q;G.prototype._createSystemForUrl=s;G.prototype._isTrustedPostMessageSource=t;G.prototype._handleServiceMessageEvent=x;G.prototype._handleMessageEvent=y;G.prototype._logout=z;G.prototype._renderControlInDiv=A;G.prototype._adjustNwbcUrl=C;G.prototype._render=F;G.prototype._backButtonPressedCallback=v;G.prototype._getIFrame=w;return G;},true);
