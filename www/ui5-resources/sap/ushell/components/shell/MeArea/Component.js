/*!
 * Copyright (c) 2009-2017 SAP SE, All Rights Reserved
 */
sap.ui.define(['sap/ushell/resources','sap/ui/core/UIComponent','sap/ushell/components/applicationIntegration/AppLifeCycle','sap/ushell/components/flp/ComponentKeysHandler','sap/ushell/ui/footerbar/ContactSupportButton','sap/ushell/ui/footerbar/EndUserFeedback','sap/ushell/EventHub','sap/ushell/Config'],function(r,U,A,C,a,E,b,c){"use strict";return U.extend("sap.ushell.components.shell.MeArea.Component",{metadata:{version:"1.56.5",library:"sap.ushell.components.shell.MeArea",dependencies:{libs:["sap.m","sap.ui.layout"]}},createContent:function(){this.oRenderer=sap.ushell.Container.getRenderer("fiori2");this.oSearchPrefs=false;var t=this,o=this.getComponentData().config,m;function s(S){t._createMeArea();t.toggleMeAreaView(m,S);t.oRenderer.addShellDanglingControl(m);}this.bIsMeAreaCreated=false;this.oDefConfig={view:{position:"left"}};this.oDefConfig=jQuery.extend(this.oDefConfig,o);m=sap.ui.getCore().byId("meAreaHeaderButton");m.applySettings({tooltip:sap.ushell.Container.getUser().getFullName(),icon:'{/userImage/personPlaceHolder}',selected:{path:"/currentViewPortState",formatter:function(v){if(v==='LeftCenter'){return true;}return false;}},press:function(){s(!this.getSelected());},visible:true,enabled:true,showSeparator:false,ariaLabel:"{i18n>MeAreaToggleButtonAria}"}).removeStyleClass("sapUshellPlaceHolders");var e=m.onAfterRendering;m.onAfterRendering=function(){if(e){e.apply(this,arguments);}jQuery(this.getDomRef()).attr("aria-pressed",t.oRenderer.getMeAreaSelected());};m.addEventDelegate({onsapskipforward:function(g){sap.ushell.renderers.fiori2.AccessKeysHandler.bForwardNavigation=true;g.preventDefault();jQuery("#sapUshellHeaderAccessibilityHelper").focus();},onsaptabprevious:function(g){var v=sap.ui.getCore().byId('viewPortContainer'),h=v.getCurrentState(),R;switch(h){case"LeftCenter":R=jQuery("#meAreaIconTabBar-content li:first");if(R.length>0){R[0].focus();}else{var o=window["sap-ushell-config"],i=jQuery.sap.getObject("renderers.fiori2.componentData.config.enableRecentActivity",undefined,o);if(i&&A.getElementsModel().getModel().getProperty("/enableTrackingActivity")){jQuery("#meAreaIconTabBar .sapMITBText")[0].focus();}else{g.preventDefault();jQuery('.sapUshellActionItem:last')[0].focus();}}break;case"RightCenter":break;case"Center":if(sap.ushell.renderers.fiori2.AccessKeysHandler.getAppKeysHandler()){g.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.bFocusOnShell=false;}break;default:}},onsapskipback:function(g){var v=sap.ui.getCore().byId('viewPortContainer'),h=v.getCurrentState(),n;switch(h){case"LeftCenter":g.preventDefault();n=jQuery("#meAreaIconTabBar .sapMITBSelected");if(n.length===0){n=jQuery(".sapUshellActionItem");}n[0].focus();break;case"RightCenter":break;case"Center":g.preventDefault();if(jQuery("#sapUshellFloatingContainerWrapper:visible").length==1&&(g.originalEvent.srcElement.id)!=""){sap.ui.getCore().getEventBus().publish("launchpad","shellFloatingContainerIsAccessible");}else if(sap.ushell.renderers.fiori2.AccessKeysHandler.getAppKeysHandler()){sap.ushell.renderers.fiori2.AccessKeysHandler.bFocusOnShell=false;}break;default:}}});A.getElementsModel().createInspection("actions",[{fnCondition:function(i,I,T){return true;},fnAction:function(i,I,T){if((i&&i.length>0)||(I&&I.length>0)){if(I.indexOf("meAreaHeaderButton")===-1){T.addHeaderItem(["meAreaHeaderButton"],true);}}else{T.removeHeaderItem(["meAreaHeaderButton"],true);}}}],false,["blank-home","blank"]);this._createMeArea();b.on('showMeArea').do(s);sap.ui.getCore().getEventBus().publish("shell","meAreaCompLoaded",{delay:0});},_createMeArea:function(){if(this.bIsMeAreaCreated===true)return;this.bIsMeAreaCreated=true;this._createMeAreaProcess();},_createMeAreaProcess:function(){var t=this;if(this.oDefConfig.view){var m=sap.ui.view("meArea",{viewName:"sap.ushell.components.shell.MeArea.MeArea",type:'JS',viewData:this.oRenderer.getComponentData()});this._createActionButtons();this._setUserPrefModel();sap.ui.getCore().getEventBus().publish("launchpad","Settings");if(this.oDefConfig.view.position==="right"){this.oRenderer.addRightViewPort(m);}else{this.oRenderer.addLeftViewPort(m);}this.oRenderer.ViewPortContainerNavTo('leftViewPort',m.getId());this.oRenderer.ViewPortContainerAttachAfterSwitchStateAnimationFinished(function(D){if(D.getParameter("to")==="LeftCenter"&&!t.oSearchPrefs){setTimeout(function(){this._getSearchPrefs();}.bind(this),0);}}.bind(this));}sap.ui.getCore().getEventBus().subscribe("shell","meAreaButtonPress",function(s,e,M){t._switchToMeAreaView(M);t.oRenderer.addShellDanglingControl(M);});},toggleMeAreaView:function(m,s){if(!m||!m.getDomRef()){return;}if(m.getSelected()===!!s){return;}var M=A.getElementsModel().getModel(),e=M.getProperty('/currentState/stateName');this.oRenderer.setMeAreaSelected(!!s);if(e==='embedded'||e==='embedded-home'||e==='standalone'||e==='blank-home'||e==='blank'){this._showActionsInPopOver(m);}else{this._switchToMeAreaView(m);}var n=sap.ui.getCore().byId("NotificationsCountButton");if(n&&this.oRenderer.getNotificationsSelected()){n.setSelected(false);jQuery(n.getDomRef()).attr("aria-pressed","false");}},_createActionButtons:function(){var t=this,u=sap.ui.getCore().byId("userSettingsBtn"),o=sap.ui.getCore().byId("aboutBtn")||new sap.ushell.ui.footerbar.AboutButton("aboutBtn");if(!u){var i="userSettingsBtn",g=r.i18n.getText("userSettings"),h='sap-icon://action-settings';if(!this.oRenderer.getShellConfig().moveUserSettingsActionToShellHeader){u=new sap.ushell.ui.launchpad.ActionItem("userSettingsBtn",{id:i,text:g,icon:h});}}this.oRenderer.addShellDanglingControl(u);var H=sap.ushell.Container.getRenderer("fiori2").oShellModel.getModel().getProperty("/enableHelp");var s=c.on("/core/extension/SupportTicket");s.do(function(e){if(!e){return;}s.off();var k=sap.ui.getCore().byId("ContactSupportBtn");if(!k){if(!t.oRenderer.getShellConfig().moveContactSupportActionToShellHeader){k=new a("ContactSupportBtn",{visible:false});c.on("/core/extension/SupportTicket").do(function(e){k.setVisible(e);});}}if(H){k.addStyleClass('help-id-contactSupportBtn');}t.oRenderer.addShellDanglingControl(k);});A.getElementsModel().getModel().setProperty('/showEndUserFeedback',false);var j=c.on("/core/extension/EndUserFeedback");j.do(function(k){if(!k){return;}j.off();try{sap.ushell.Container.getService("EndUserFeedback").isEnabled().done(function(){A.getElementsModel().getModel().setProperty('/showEndUserFeedback',true);}).fail(function(){A.getElementsModel().getModel().setProperty('/showEndUserFeedback',false);}).always(function(){var l;var m=sap.ushell.Container.getRenderer("fiori2").oShellModel.getModel().getProperty('/showEndUserFeedback');if(m){var n=t.oRenderer.getEndUserFeedbackConfiguration();if(t.oRenderer.getShellConfig().moveGiveFeedbackActionToShellHeader){jQuery.sap.measure.start("FLP:Shell.controller._createActionButtons","create give feedback as shell head end item","FLP");var p=sap.ui.getCore().byId("EndUserFeedbackHandlerBtn");p.setModel(sap.ushell.Container.getRenderer("fiori2").oShellModel.getModel());p.setShowAnonymous(n.showAnonymous);p.setAnonymousByDefault(n.anonymousByDefault);p.setShowLegalAgreement(n.showLegalAgreement);p.setShowCustomUIContent(n.showCustomUIContent);p.setFeedbackDialogTitle(n.feedbackDialogTitle);p.setTextAreaPlaceholder(n.textAreaPlaceholder);p.setAggregation("customUIContent",n.customUIContent,false);var q=function(){p.firePress();};l=sap.ui.getCore().byId("EndUserFeedbackBtn");l.setVisible(true);l.attachPress(q);jQuery.sap.measure.end("FLP:Shell.controller._createActionButtons");}else{l=sap.ui.getCore().byId("EndUserFeedbackBtn")||new E("EndUserFeedbackBtn",{showAnonymous:n.showAnonymous,anonymousByDefault:n.anonymousByDefault,showLegalAgreement:n.showLegalAgreement,showCustomUIContent:n.showCustomUIContent,feedbackDialogTitle:n.feedbackDialogTitle,textAreaPlaceholder:n.textAreaPlaceholder,customUIContent:n.customUIContent});}c.on("/core/extension/EndUserFeedback").do(function(k){l.setVisible(k);});if(H){l.addStyleClass('help-id-EndUserFeedbackBtn');}t.oRenderer.addShellDanglingControl(l);}});}catch(e){jQuery.sap.log.error("EndUserFeedback adapter is not found",e.message||e);A.getElementsModel().getModel().setProperty('/showEndUserFeedback',false);}});if(H){u.addStyleClass('help-id-loginDetails');o.addStyleClass('help-id-aboutBtn');}this.oRenderer.addShellDanglingControl(o);},_setUserPrefModel:function(){var u=sap.ushell.Container.getRenderer("fiori2").oShellModel.getModel().getProperty("/userPreferences/entries");var D=this._getUserPrefDefaultModel();D.entries=D.entries.concat(u);D.entries=this.oRenderer.reorderUserPrefEntries(D.entries);sap.ushell.Container.getRenderer("fiori2").oShellModel.getModel().setProperty("/userPreferences",D);},_getUserPrefDefaultModel:function(){var m=sap.ushell.Container.getRenderer("fiori2").oShellModel.getModel(),u=sap.ushell.Container.getUser();var t=new G("userPrefThemeSelector","sap.ushell.components.shell.MeArea.ThemeSelector","xml","themes",r.i18n.getText("Appearance"),function(){var l=this.getView().getController().onSave();l.done(function(){if(m.getProperty("/tilesOpacity")===true){sap.ushell.utils.utils.handleTilesOpacity();}});return l;},undefined,undefined,undefined,function(){if(m.getProperty("/setTheme")!==undefined){return m.getProperty("/setTheme")&&u.isSetThemePermitted();}else{return u.isSetThemePermitted();}},m,"sap-icon://palette");var e=new G("userPrefUsageAnalyticsSelector","sap.ushell.components.shell.MeArea.UsageAnalyticsSelector","js","usageAnalytics",r.i18n.getText("usageAnalytics"),undefined,undefined,undefined,undefined,sap.ushell.Container.getService("UsageAnalytics").isSetUsageAnalyticsPermitted());var g=new G("defaultParametersSelector","sap.ushell.components.shell.MeArea.DefaultParameters","js",undefined,r.i18n.getText("defaultsValuesEntry"),undefined,undefined,undefined,undefined,true,undefined,undefined,false);var h=new G("userProfilingView","sap.ushell.components.shell.MeArea.UserProfiling","js","userProfiling",r.i18n.getText("userProfiling"),undefined,undefined,undefined,undefined,false,m,"sap-icon://user-settings",false);var i=[new f(this.oRenderer),t,new L()],p=[];p.push(e);var o=window["sap-ushell-config"],j=jQuery.sap.getObject("renderers.fiori2.componentData.config.enableRecentActivity",undefined,o);if(j){i.push(new d());}i.push(h);if(m.getProperty("/enableNotifications")===true){var n=sap.ushell.Container.getService("Notifications")._getNotificationSettingsAvalability(),k;k=new G("notificationSettings","sap.ushell.components.shell.Notifications.Settings","js",undefined,r.i18n.getText("notificationSettingsEntry_title"),undefined,undefined,undefined,undefined,true,undefined,"sap-icon://ui-notifications",false);i.push(k);n.done(function(s){if(s.settingsAvailable){k.visible=true;m.getProperty("/userPreferences/entries").every(function(l,q){if(l.title===r.i18n.getText("notificationSettingsEntry_title")){m.setProperty("/userPreferences/entries/"+q+"/visible",true);return false;}return true;});}});}if(m.getProperty("/userDefaultParameters")){i.push(g);}return{dialogTitle:r.i18n.getText("userSettings"),isDetailedEntryMode:false,activeEntryPath:null,entries:i,profiling:p};},_showActionsInPopOver:function(o){var m=A.getElementsModel().getModel(),e=m.getProperty('/currentState/actions');if(!this.oActionsPopover){this.oActionsLayout=new sap.ui.layout.VerticalLayout();this.oActionsPopover=new sap.m.Popover("sapUshellActionsPopover",{showHeader:false,placement:sap.m.PlacementType.Bottom,content:this.oActionsLayout}).addStyleClass("sapUshellPopupContainer");}this.oActionsLayout.removeAllContent();this._createActionButtons();e.forEach(function(s,i){var g=sap.ui.getCore().byId(s);if(g&&g.setActionType){this.oActionsLayout.addContent(g);g.setActionType('standard');g.addStyleClass('sapUshellStandardActionItem');}}.bind(this));this.oActionsPopover.openBy(o);this.oActionsPopover.setModel(m);},_switchToMeAreaView:function(o){var B=o.getSelected();if(B){this.oRenderer.switchViewPortStateByControl(o,"Center");}else{this.oRenderer.switchViewPortStateByControl(o,"LeftCenter");}if(this.oRenderer.toggleOverFlowActions){this.oRenderer.toggleOverFlowActions();}},_getSearchPrefs:function(){var t=this;if(this._getIsSearchButtonEnabled()){sap.ui.require(['sap/ushell/renderers/fiori2/search/userpref/SearchPrefs','sap/ushell/renderers/fiori2/search/SearchShellHelperAndModuleLoader'],function(S){t.oSearchPrefs=true;var e=S;var s=e.getEntry();s.isSearchPrefsActive().done(function(i){if(!i){return;}t.oRenderer.addUserProfilingEntry(s);}.bind(this));}.bind(this));}},_getIsSearchButtonEnabled:function(){var m=A.getElementsModel().getModel();try{var e=m.getProperty("/currentState/stateName");var D=m.getData();var s=D.states;if(s[e].headEndItems.indexOf("sf")!=-1){return true;}else{return false;}}catch(g){jQuery.sap.log.debug("Shell controller._createWaitForRendererCreatedPromise: search button is not visible.");return false;}},_getPersonalizer:function(i){if(this.oPersonalizer){return this.oPersonalizer;}var p=sap.ushell.Container.getService("Personalization");var o=sap.ui.core.Component.getOwnerComponentFor(this);var s={keyCategory:p.constants.keyCategory.FIXED_KEY,writeFrequency:p.constants.writeFrequency.LOW,clientStorageAllowed:true};var P={container:this.PERS_KEY,item:i};this.oPersonalizer=p.getPersonalizer(P,s,o);return this.oPersonalizer;},exit:function(){}});function G(v,e,g,h,t,o,i,j,k,l,m,n,p){this.view=null;this.getView=function(){if(!this.view||!sap.ui.getCore().byId(v)){if(g==="xml"){this.view=sap.ui.xmlview(v,e);}else{this.view=sap.ui.jsview(v,e);}}if(m){this.view.setModel(m);}return this.view;};return{entryHelpID:h,title:t,valueResult:null,onSave:o?o.bind(this):function(){if(this.getView().getController().onSave){return this.getView().getController().onSave();}return;}.bind(this),onCancel:i?i.bind(this):function(){if(this.getView().getController().onCancel){return this.getView().getController().onCancel();}return;}.bind(this),contentFunc:j?j.bind(this):function(){if(this.getView().getController().getContent){return this.getView().getController().getContent();}return;}.bind(this),valueArgument:k?k.bind(this):function(){var q=jQuery.Deferred(),s=this;setTimeout(function(){if(s.getView().getController().getValue){s.getView().getController().getValue().done(function(u){q.resolve(u);});}},0);return q.promise();}.bind(this),editable:typeof l==="function"?l():l,contentResult:null,icon:n,defaultVisibility:p};}function L(){this.view=null;this.getView=function getView(){if(!this.languageRegionSelector){this.languageRegionSelector=sap.ui.jsview("languageRegionSelector","sap.ushell.components.shell.MeArea.LanguageRegionSelector");}return this.languageRegionSelector;};var o=function(){var i=this.getView().getController().onSave();return i;}.bind(this);var e=function(){return this.getView().getController().onCancel();}.bind(this);var g=function(){return this.getView().getController().getContent();}.bind(this);var h=function(){return this.getView().getController().getValue();}.bind(this);return{entryHelpID:"language",title:r.i18n.getText("languageRegionTit"),editable:true,valueArgument:h,valueResult:null,onSave:o,onCancel:e,contentFunc:g,contentResult:null,icon:"sap-icon://globe"};}function d(){this.view=null;this.getView=function getView(){if(!this.userActivitiesHandler){this.userActivitiesHandler=sap.ui.jsview("userActivitiesHandler","sap.ushell.components.shell.MeArea.userActivitiesHandler");}return this.userActivitiesHandler;};var o=function(){var i=this.getView().getController().onSave();return i;}.bind(this);var e=function(){return this.getView().getController().onCancel();}.bind(this);var g=function(){return this.getView().getController().getContent();}.bind(this);var h=function(){return this.getView().getController().getValue();}.bind(this);return{entryHelpID:"UserActivitiesEntry",title:r.i18n.getText("userActivities"),editable:true,valueArgument:h,valueResult:null,onSave:o,onCancel:e,contentFunc:g,contentResult:null,icon:"sap-icon://laptop"};}function f(R){this.view=null;this.oRenderer=R;this.getView=function getView(){if(!this.userAccountSelector){if((this.oRenderer.getShellConfig().enableOnlineStatus&&sap.ushell.ui5service.UserStatus.prototype.isEnabled)||this.oRenderer.getShellConfig().enableUserImgConsent){this.userAccountSelector=sap.ui.xmlview("UserAccountSelector","sap.ushell.components.shell.MeArea.userAccount.UserAccountSelector");}else{this.userAccountSelector=sap.ui.xmlview("UserAccountSetting","sap.ushell.components.shell.MeArea.userAccount.UserAccountSetting");}}return this.userAccountSelector;};var o=function(){var i=this.getView().getController().onSave();return i;}.bind(this);var e=function(){return this.getView().getController().onCancel();}.bind(this);var g=function(){return this.getView().getController().getContent();}.bind(this);var h=function(){return this.getView().getController().getValue();}.bind(this);return{entryHelpID:"userAccountEntry",title:r.i18n.getText("UserAccountFld"),editable:true,valueArgument:h,valueResult:null,onSave:o,onCancel:e,contentFunc:g,contentResult:null,icon:"sap-icon://account"};}});
